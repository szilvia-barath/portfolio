function kk(i,e){for(var t=0;t<e.length;t++){const n=e[t];if(typeof n!="string"&&!Array.isArray(n)){for(const r in n)if(r!=="default"&&!(r in i)){const s=Object.getOwnPropertyDescriptor(n,r);s&&Object.defineProperty(i,r,s.get?s:{enumerable:!0,get:()=>n[r]})}}}return Object.freeze(Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=t(r);fetch(r.href,s)}})();function Up(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var nx={exports:{}},qf={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ER;function zk(){if(ER)return qf;ER=1;var i=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(n,r,s){var a=null;if(s!==void 0&&(a=""+s),r.key!==void 0&&(a=""+r.key),"key"in r){s={};for(var l in r)l!=="key"&&(s[l]=r[l])}else s=r;return r=s.ref,{$$typeof:i,type:n,key:a,ref:r!==void 0?r:null,props:s}}return qf.Fragment=e,qf.jsx=t,qf.jsxs=t,qf}var AR;function Vk(){return AR||(AR=1,nx.exports=zk()),nx.exports}var _e=Vk(),ix={exports:{}},kt={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wR;function Gk(){if(wR)return kt;wR=1;var i=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),a=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),p=Symbol.iterator;function g(F){return F===null||typeof F!="object"?null:(F=p&&F[p]||F["@@iterator"],typeof F=="function"?F:null)}var y={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},v=Object.assign,S={};function b(F,se,Me){this.props=F,this.context=se,this.refs=S,this.updater=Me||y}b.prototype.isReactComponent={},b.prototype.setState=function(F,se){if(typeof F!="object"&&typeof F!="function"&&F!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,F,se,"setState")},b.prototype.forceUpdate=function(F){this.updater.enqueueForceUpdate(this,F,"forceUpdate")};function _(){}_.prototype=b.prototype;function E(F,se,Me){this.props=F,this.context=se,this.refs=S,this.updater=Me||y}var M=E.prototype=new _;M.constructor=E,v(M,b.prototype),M.isPureReactComponent=!0;var A=Array.isArray,w={H:null,A:null,T:null,S:null,V:null},R=Object.prototype.hasOwnProperty;function C(F,se,Me,De,j,Z){return Me=Z.ref,{$$typeof:i,type:F,key:se,ref:Me!==void 0?Me:null,props:Z}}function L(F,se){return C(F.type,se,void 0,void 0,void 0,F.props)}function N(F){return typeof F=="object"&&F!==null&&F.$$typeof===i}function D(F){var se={"=":"=0",":":"=2"};return"$"+F.replace(/[=:]/g,function(Me){return se[Me]})}var I=/\/+/g;function W(F,se){return typeof F=="object"&&F!==null&&F.key!=null?D(""+F.key):se.toString(36)}function Y(){}function oe(F){switch(F.status){case"fulfilled":return F.value;case"rejected":throw F.reason;default:switch(typeof F.status=="string"?F.then(Y,Y):(F.status="pending",F.then(function(se){F.status==="pending"&&(F.status="fulfilled",F.value=se)},function(se){F.status==="pending"&&(F.status="rejected",F.reason=se)})),F.status){case"fulfilled":return F.value;case"rejected":throw F.reason}}throw F}function le(F,se,Me,De,j){var Z=typeof F;(Z==="undefined"||Z==="boolean")&&(F=null);var $=!1;if(F===null)$=!0;else switch(Z){case"bigint":case"string":case"number":$=!0;break;case"object":switch(F.$$typeof){case i:case e:$=!0;break;case d:return $=F._init,le($(F._payload),se,Me,De,j)}}if($)return j=j(F),$=De===""?"."+W(F,0):De,A(j)?(Me="",$!=null&&(Me=$.replace(I,"$&/")+"/"),le(j,se,Me,"",function(He){return He})):j!=null&&(N(j)&&(j=L(j,Me+(j.key==null||F&&F.key===j.key?"":(""+j.key).replace(I,"$&/")+"/")+$)),se.push(j)),1;$=0;var ne=De===""?".":De+":";if(A(F))for(var ve=0;ve<F.length;ve++)De=F[ve],Z=ne+W(De,ve),$+=le(De,se,Me,Z,j);else if(ve=g(F),typeof ve=="function")for(F=ve.call(F),ve=0;!(De=F.next()).done;)De=De.value,Z=ne+W(De,ve++),$+=le(De,se,Me,Z,j);else if(Z==="object"){if(typeof F.then=="function")return le(oe(F),se,Me,De,j);throw se=String(F),Error("Objects are not valid as a React child (found: "+(se==="[object Object]"?"object with keys {"+Object.keys(F).join(", ")+"}":se)+"). If you meant to render a collection of children, use an array instead.")}return $}function z(F,se,Me){if(F==null)return F;var De=[],j=0;return le(F,De,"","",function(Z){return se.call(Me,Z,j++)}),De}function k(F){if(F._status===-1){var se=F._result;se=se(),se.then(function(Me){(F._status===0||F._status===-1)&&(F._status=1,F._result=Me)},function(Me){(F._status===0||F._status===-1)&&(F._status=2,F._result=Me)}),F._status===-1&&(F._status=0,F._result=se)}if(F._status===1)return F._result.default;throw F._result}var G=typeof reportError=="function"?reportError:function(F){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var se=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof F=="object"&&F!==null&&typeof F.message=="string"?String(F.message):String(F),error:F});if(!window.dispatchEvent(se))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",F);return}console.error(F)};function he(){}return kt.Children={map:z,forEach:function(F,se,Me){z(F,function(){se.apply(this,arguments)},Me)},count:function(F){var se=0;return z(F,function(){se++}),se},toArray:function(F){return z(F,function(se){return se})||[]},only:function(F){if(!N(F))throw Error("React.Children.only expected to receive a single React element child.");return F}},kt.Component=b,kt.Fragment=t,kt.Profiler=r,kt.PureComponent=E,kt.StrictMode=n,kt.Suspense=u,kt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=w,kt.__COMPILER_RUNTIME={__proto__:null,c:function(F){return w.H.useMemoCache(F)}},kt.cache=function(F){return function(){return F.apply(null,arguments)}},kt.cloneElement=function(F,se,Me){if(F==null)throw Error("The argument must be a React element, but you passed "+F+".");var De=v({},F.props),j=F.key,Z=void 0;if(se!=null)for($ in se.ref!==void 0&&(Z=void 0),se.key!==void 0&&(j=""+se.key),se)!R.call(se,$)||$==="key"||$==="__self"||$==="__source"||$==="ref"&&se.ref===void 0||(De[$]=se[$]);var $=arguments.length-2;if($===1)De.children=Me;else if(1<$){for(var ne=Array($),ve=0;ve<$;ve++)ne[ve]=arguments[ve+2];De.children=ne}return C(F.type,j,void 0,void 0,Z,De)},kt.createContext=function(F){return F={$$typeof:a,_currentValue:F,_currentValue2:F,_threadCount:0,Provider:null,Consumer:null},F.Provider=F,F.Consumer={$$typeof:s,_context:F},F},kt.createElement=function(F,se,Me){var De,j={},Z=null;if(se!=null)for(De in se.key!==void 0&&(Z=""+se.key),se)R.call(se,De)&&De!=="key"&&De!=="__self"&&De!=="__source"&&(j[De]=se[De]);var $=arguments.length-2;if($===1)j.children=Me;else if(1<$){for(var ne=Array($),ve=0;ve<$;ve++)ne[ve]=arguments[ve+2];j.children=ne}if(F&&F.defaultProps)for(De in $=F.defaultProps,$)j[De]===void 0&&(j[De]=$[De]);return C(F,Z,void 0,void 0,null,j)},kt.createRef=function(){return{current:null}},kt.forwardRef=function(F){return{$$typeof:l,render:F}},kt.isValidElement=N,kt.lazy=function(F){return{$$typeof:d,_payload:{_status:-1,_result:F},_init:k}},kt.memo=function(F,se){return{$$typeof:h,type:F,compare:se===void 0?null:se}},kt.startTransition=function(F){var se=w.T,Me={};w.T=Me;try{var De=F(),j=w.S;j!==null&&j(Me,De),typeof De=="object"&&De!==null&&typeof De.then=="function"&&De.then(he,G)}catch(Z){G(Z)}finally{w.T=se}},kt.unstable_useCacheRefresh=function(){return w.H.useCacheRefresh()},kt.use=function(F){return w.H.use(F)},kt.useActionState=function(F,se,Me){return w.H.useActionState(F,se,Me)},kt.useCallback=function(F,se){return w.H.useCallback(F,se)},kt.useContext=function(F){return w.H.useContext(F)},kt.useDebugValue=function(){},kt.useDeferredValue=function(F,se){return w.H.useDeferredValue(F,se)},kt.useEffect=function(F,se,Me){var De=w.H;if(typeof Me=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return De.useEffect(F,se)},kt.useId=function(){return w.H.useId()},kt.useImperativeHandle=function(F,se,Me){return w.H.useImperativeHandle(F,se,Me)},kt.useInsertionEffect=function(F,se){return w.H.useInsertionEffect(F,se)},kt.useLayoutEffect=function(F,se){return w.H.useLayoutEffect(F,se)},kt.useMemo=function(F,se){return w.H.useMemo(F,se)},kt.useOptimistic=function(F,se){return w.H.useOptimistic(F,se)},kt.useReducer=function(F,se,Me){return w.H.useReducer(F,se,Me)},kt.useRef=function(F){return w.H.useRef(F)},kt.useState=function(F){return w.H.useState(F)},kt.useSyncExternalStore=function(F,se,Me){return w.H.useSyncExternalStore(F,se,Me)},kt.useTransition=function(){return w.H.useTransition()},kt.version="19.1.0",kt}var RR;function LT(){return RR||(RR=1,ix.exports=Gk()),ix.exports}var fe=LT();const UT=Up(fe),Hk=kk({__proto__:null,default:UT},[fe]);var rx={exports:{}},$f={},sx={exports:{}},ax={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var CR;function Wk(){return CR||(CR=1,function(i){function e(z,k){var G=z.length;z.push(k);e:for(;0<G;){var he=G-1>>>1,F=z[he];if(0<r(F,k))z[he]=k,z[G]=F,G=he;else break e}}function t(z){return z.length===0?null:z[0]}function n(z){if(z.length===0)return null;var k=z[0],G=z.pop();if(G!==k){z[0]=G;e:for(var he=0,F=z.length,se=F>>>1;he<se;){var Me=2*(he+1)-1,De=z[Me],j=Me+1,Z=z[j];if(0>r(De,G))j<F&&0>r(Z,De)?(z[he]=Z,z[j]=G,he=j):(z[he]=De,z[Me]=G,he=Me);else if(j<F&&0>r(Z,G))z[he]=Z,z[j]=G,he=j;else break e}}return k}function r(z,k){var G=z.sortIndex-k.sortIndex;return G!==0?G:z.id-k.id}if(i.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var s=performance;i.unstable_now=function(){return s.now()}}else{var a=Date,l=a.now();i.unstable_now=function(){return a.now()-l}}var u=[],h=[],d=1,p=null,g=3,y=!1,v=!1,S=!1,b=!1,_=typeof setTimeout=="function"?setTimeout:null,E=typeof clearTimeout=="function"?clearTimeout:null,M=typeof setImmediate<"u"?setImmediate:null;function A(z){for(var k=t(h);k!==null;){if(k.callback===null)n(h);else if(k.startTime<=z)n(h),k.sortIndex=k.expirationTime,e(u,k);else break;k=t(h)}}function w(z){if(S=!1,A(z),!v)if(t(u)!==null)v=!0,R||(R=!0,W());else{var k=t(h);k!==null&&le(w,k.startTime-z)}}var R=!1,C=-1,L=5,N=-1;function D(){return b?!0:!(i.unstable_now()-N<L)}function I(){if(b=!1,R){var z=i.unstable_now();N=z;var k=!0;try{e:{v=!1,S&&(S=!1,E(C),C=-1),y=!0;var G=g;try{t:{for(A(z),p=t(u);p!==null&&!(p.expirationTime>z&&D());){var he=p.callback;if(typeof he=="function"){p.callback=null,g=p.priorityLevel;var F=he(p.expirationTime<=z);if(z=i.unstable_now(),typeof F=="function"){p.callback=F,A(z),k=!0;break t}p===t(u)&&n(u),A(z)}else n(u);p=t(u)}if(p!==null)k=!0;else{var se=t(h);se!==null&&le(w,se.startTime-z),k=!1}}break e}finally{p=null,g=G,y=!1}k=void 0}}finally{k?W():R=!1}}}var W;if(typeof M=="function")W=function(){M(I)};else if(typeof MessageChannel<"u"){var Y=new MessageChannel,oe=Y.port2;Y.port1.onmessage=I,W=function(){oe.postMessage(null)}}else W=function(){_(I,0)};function le(z,k){C=_(function(){z(i.unstable_now())},k)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(z){z.callback=null},i.unstable_forceFrameRate=function(z){0>z||125<z?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):L=0<z?Math.floor(1e3/z):5},i.unstable_getCurrentPriorityLevel=function(){return g},i.unstable_next=function(z){switch(g){case 1:case 2:case 3:var k=3;break;default:k=g}var G=g;g=k;try{return z()}finally{g=G}},i.unstable_requestPaint=function(){b=!0},i.unstable_runWithPriority=function(z,k){switch(z){case 1:case 2:case 3:case 4:case 5:break;default:z=3}var G=g;g=z;try{return k()}finally{g=G}},i.unstable_scheduleCallback=function(z,k,G){var he=i.unstable_now();switch(typeof G=="object"&&G!==null?(G=G.delay,G=typeof G=="number"&&0<G?he+G:he):G=he,z){case 1:var F=-1;break;case 2:F=250;break;case 5:F=1073741823;break;case 4:F=1e4;break;default:F=5e3}return F=G+F,z={id:d++,callback:k,priorityLevel:z,startTime:G,expirationTime:F,sortIndex:-1},G>he?(z.sortIndex=G,e(h,z),t(u)===null&&z===t(h)&&(S?(E(C),C=-1):S=!0,le(w,G-he))):(z.sortIndex=F,e(u,z),v||y||(v=!0,R||(R=!0,W()))),z},i.unstable_shouldYield=D,i.unstable_wrapCallback=function(z){var k=g;return function(){var G=g;g=k;try{return z.apply(this,arguments)}finally{g=G}}}}(ax)),ax}var NR;function jk(){return NR||(NR=1,sx.exports=Wk()),sx.exports}var ox={exports:{}},Yi={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var PR;function qk(){if(PR)return Yi;PR=1;var i=LT();function e(u){var h="https://react.dev/errors/"+u;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var d=2;d<arguments.length;d++)h+="&args[]="+encodeURIComponent(arguments[d])}return"Minified React error #"+u+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var n={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},r=Symbol.for("react.portal");function s(u,h,d){var p=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:r,key:p==null?null:""+p,children:u,containerInfo:h,implementation:d}}var a=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function l(u,h){if(u==="font")return"";if(typeof h=="string")return h==="use-credentials"?h:""}return Yi.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,Yi.createPortal=function(u,h){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)throw Error(e(299));return s(u,h,null,d)},Yi.flushSync=function(u){var h=a.T,d=n.p;try{if(a.T=null,n.p=2,u)return u()}finally{a.T=h,n.p=d,n.d.f()}},Yi.preconnect=function(u,h){typeof u=="string"&&(h?(h=h.crossOrigin,h=typeof h=="string"?h==="use-credentials"?h:"":void 0):h=null,n.d.C(u,h))},Yi.prefetchDNS=function(u){typeof u=="string"&&n.d.D(u)},Yi.preinit=function(u,h){if(typeof u=="string"&&h&&typeof h.as=="string"){var d=h.as,p=l(d,h.crossOrigin),g=typeof h.integrity=="string"?h.integrity:void 0,y=typeof h.fetchPriority=="string"?h.fetchPriority:void 0;d==="style"?n.d.S(u,typeof h.precedence=="string"?h.precedence:void 0,{crossOrigin:p,integrity:g,fetchPriority:y}):d==="script"&&n.d.X(u,{crossOrigin:p,integrity:g,fetchPriority:y,nonce:typeof h.nonce=="string"?h.nonce:void 0})}},Yi.preinitModule=function(u,h){if(typeof u=="string")if(typeof h=="object"&&h!==null){if(h.as==null||h.as==="script"){var d=l(h.as,h.crossOrigin);n.d.M(u,{crossOrigin:d,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0})}}else h==null&&n.d.M(u)},Yi.preload=function(u,h){if(typeof u=="string"&&typeof h=="object"&&h!==null&&typeof h.as=="string"){var d=h.as,p=l(d,h.crossOrigin);n.d.L(u,d,{crossOrigin:p,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0,type:typeof h.type=="string"?h.type:void 0,fetchPriority:typeof h.fetchPriority=="string"?h.fetchPriority:void 0,referrerPolicy:typeof h.referrerPolicy=="string"?h.referrerPolicy:void 0,imageSrcSet:typeof h.imageSrcSet=="string"?h.imageSrcSet:void 0,imageSizes:typeof h.imageSizes=="string"?h.imageSizes:void 0,media:typeof h.media=="string"?h.media:void 0})}},Yi.preloadModule=function(u,h){if(typeof u=="string")if(h){var d=l(h.as,h.crossOrigin);n.d.m(u,{as:typeof h.as=="string"&&h.as!=="script"?h.as:void 0,crossOrigin:d,integrity:typeof h.integrity=="string"?h.integrity:void 0})}else n.d.m(u)},Yi.requestFormReset=function(u){n.d.r(u)},Yi.unstable_batchedUpdates=function(u,h){return u(h)},Yi.useFormState=function(u,h,d){return a.H.useFormState(u,h,d)},Yi.useFormStatus=function(){return a.H.useHostTransitionStatus()},Yi.version="19.1.0",Yi}var DR;function Y2(){if(DR)return ox.exports;DR=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(e){console.error(e)}}return i(),ox.exports=qk(),ox.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var LR;function $k(){if(LR)return $f;LR=1;var i=jk(),e=LT(),t=Y2();function n(o){var c="https://react.dev/errors/"+o;if(1<arguments.length){c+="?args[]="+encodeURIComponent(arguments[1]);for(var f=2;f<arguments.length;f++)c+="&args[]="+encodeURIComponent(arguments[f])}return"Minified React error #"+o+"; visit "+c+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(o){return!(!o||o.nodeType!==1&&o.nodeType!==9&&o.nodeType!==11)}function s(o){var c=o,f=o;if(o.alternate)for(;c.return;)c=c.return;else{o=c;do c=o,(c.flags&4098)!==0&&(f=c.return),o=c.return;while(o)}return c.tag===3?f:null}function a(o){if(o.tag===13){var c=o.memoizedState;if(c===null&&(o=o.alternate,o!==null&&(c=o.memoizedState)),c!==null)return c.dehydrated}return null}function l(o){if(s(o)!==o)throw Error(n(188))}function u(o){var c=o.alternate;if(!c){if(c=s(o),c===null)throw Error(n(188));return c!==o?null:o}for(var f=o,m=c;;){var x=f.return;if(x===null)break;var T=x.alternate;if(T===null){if(m=x.return,m!==null){f=m;continue}break}if(x.child===T.child){for(T=x.child;T;){if(T===f)return l(x),o;if(T===m)return l(x),c;T=T.sibling}throw Error(n(188))}if(f.return!==m.return)f=x,m=T;else{for(var P=!1,O=x.child;O;){if(O===f){P=!0,f=x,m=T;break}if(O===m){P=!0,m=x,f=T;break}O=O.sibling}if(!P){for(O=T.child;O;){if(O===f){P=!0,f=T,m=x;break}if(O===m){P=!0,m=T,f=x;break}O=O.sibling}if(!P)throw Error(n(189))}}if(f.alternate!==m)throw Error(n(190))}if(f.tag!==3)throw Error(n(188));return f.stateNode.current===f?o:c}function h(o){var c=o.tag;if(c===5||c===26||c===27||c===6)return o;for(o=o.child;o!==null;){if(c=h(o),c!==null)return c;o=o.sibling}return null}var d=Object.assign,p=Symbol.for("react.element"),g=Symbol.for("react.transitional.element"),y=Symbol.for("react.portal"),v=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),b=Symbol.for("react.profiler"),_=Symbol.for("react.provider"),E=Symbol.for("react.consumer"),M=Symbol.for("react.context"),A=Symbol.for("react.forward_ref"),w=Symbol.for("react.suspense"),R=Symbol.for("react.suspense_list"),C=Symbol.for("react.memo"),L=Symbol.for("react.lazy"),N=Symbol.for("react.activity"),D=Symbol.for("react.memo_cache_sentinel"),I=Symbol.iterator;function W(o){return o===null||typeof o!="object"?null:(o=I&&o[I]||o["@@iterator"],typeof o=="function"?o:null)}var Y=Symbol.for("react.client.reference");function oe(o){if(o==null)return null;if(typeof o=="function")return o.$$typeof===Y?null:o.displayName||o.name||null;if(typeof o=="string")return o;switch(o){case v:return"Fragment";case b:return"Profiler";case S:return"StrictMode";case w:return"Suspense";case R:return"SuspenseList";case N:return"Activity"}if(typeof o=="object")switch(o.$$typeof){case y:return"Portal";case M:return(o.displayName||"Context")+".Provider";case E:return(o._context.displayName||"Context")+".Consumer";case A:var c=o.render;return o=o.displayName,o||(o=c.displayName||c.name||"",o=o!==""?"ForwardRef("+o+")":"ForwardRef"),o;case C:return c=o.displayName||null,c!==null?c:oe(o.type)||"Memo";case L:c=o._payload,o=o._init;try{return oe(o(c))}catch{}}return null}var le=Array.isArray,z=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,k=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,G={pending:!1,data:null,method:null,action:null},he=[],F=-1;function se(o){return{current:o}}function Me(o){0>F||(o.current=he[F],he[F]=null,F--)}function De(o,c){F++,he[F]=o.current,o.current=c}var j=se(null),Z=se(null),$=se(null),ne=se(null);function ve(o,c){switch(De($,c),De(Z,o),De(j,null),c.nodeType){case 9:case 11:o=(o=c.documentElement)&&(o=o.namespaceURI)?J1(o):0;break;default:if(o=c.tagName,c=c.namespaceURI)c=J1(c),o=eR(c,o);else switch(o){case"svg":o=1;break;case"math":o=2;break;default:o=0}}Me(j),De(j,o)}function He(){Me(j),Me(Z),Me($)}function Ve(o){o.memoizedState!==null&&De(ne,o);var c=j.current,f=eR(c,o.type);c!==f&&(De(Z,o),De(j,f))}function st(o){Z.current===o&&(Me(j),Me(Z)),ne.current===o&&(Me(ne),Vf._currentValue=G)}var Lt=Object.prototype.hasOwnProperty,Rt=i.unstable_scheduleCallback,X=i.unstable_cancelCallback,mn=i.unstable_shouldYield,jt=i.unstable_requestPaint,Ft=i.unstable_now,at=i.unstable_getCurrentPriorityLevel,Kt=i.unstable_ImmediatePriority,pt=i.unstable_UserBlockingPriority,Pt=i.unstable_NormalPriority,Yn=i.unstable_LowPriority,H=i.unstable_IdlePriority,U=i.log,de=i.unstable_setDisableYieldValue,we=null,Ce=null;function Se(o){if(typeof U=="function"&&de(o),Ce&&typeof Ce.setStrictMode=="function")try{Ce.setStrictMode(we,o)}catch{}}var Qe=Math.clz32?Math.clz32:lt,$e=Math.log,rt=Math.LN2;function lt(o){return o>>>=0,o===0?32:31-($e(o)/rt|0)|0}var Be=256,Je=4194304;function ft(o){var c=o&42;if(c!==0)return c;switch(o&-o){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return o&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return o}}function dt(o,c,f){var m=o.pendingLanes;if(m===0)return 0;var x=0,T=o.suspendedLanes,P=o.pingedLanes;o=o.warmLanes;var O=m&134217727;return O!==0?(m=O&~T,m!==0?x=ft(m):(P&=O,P!==0?x=ft(P):f||(f=O&~o,f!==0&&(x=ft(f))))):(O=m&~T,O!==0?x=ft(O):P!==0?x=ft(P):f||(f=m&~o,f!==0&&(x=ft(f)))),x===0?0:c!==0&&c!==x&&(c&T)===0&&(T=x&-x,f=c&-c,T>=f||T===32&&(f&4194048)!==0)?c:x}function je(o,c){return(o.pendingLanes&~(o.suspendedLanes&~o.pingedLanes)&c)===0}function Ct(o,c){switch(o){case 1:case 2:case 4:case 8:case 64:return c+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return c+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function J(){var o=Be;return Be<<=1,(Be&4194048)===0&&(Be=256),o}function Xe(){var o=Je;return Je<<=1,(Je&62914560)===0&&(Je=4194304),o}function Fe(o){for(var c=[],f=0;31>f;f++)c.push(o);return c}function et(o,c){o.pendingLanes|=c,c!==268435456&&(o.suspendedLanes=0,o.pingedLanes=0,o.warmLanes=0)}function ze(o,c,f,m,x,T){var P=o.pendingLanes;o.pendingLanes=f,o.suspendedLanes=0,o.pingedLanes=0,o.warmLanes=0,o.expiredLanes&=f,o.entangledLanes&=f,o.errorRecoveryDisabledLanes&=f,o.shellSuspendCounter=0;var O=o.entanglements,q=o.expirationTimes,ce=o.hiddenUpdates;for(f=P&~f;0<f;){var Ae=31-Qe(f),Ne=1<<Ae;O[Ae]=0,q[Ae]=-1;var pe=ce[Ae];if(pe!==null)for(ce[Ae]=null,Ae=0;Ae<pe.length;Ae++){var me=pe[Ae];me!==null&&(me.lane&=-536870913)}f&=~Ne}m!==0&&Pe(o,m,0),T!==0&&x===0&&o.tag!==0&&(o.suspendedLanes|=T&~(P&~c))}function Pe(o,c,f){o.pendingLanes|=c,o.suspendedLanes&=~c;var m=31-Qe(c);o.entangledLanes|=c,o.entanglements[m]=o.entanglements[m]|1073741824|f&4194090}function nt(o,c){var f=o.entangledLanes|=c;for(o=o.entanglements;f;){var m=31-Qe(f),x=1<<m;x&c|o[m]&c&&(o[m]|=c),f&=~x}}function At(o){switch(o){case 2:o=1;break;case 8:o=4;break;case 32:o=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:o=128;break;case 268435456:o=134217728;break;default:o=0}return o}function fn(o){return o&=-o,2<o?8<o?(o&134217727)!==0?32:268435456:8:2}function rn(){var o=k.p;return o!==0?o:(o=window.event,o===void 0?32:_R(o.type))}function kr(o,c){var f=k.p;try{return k.p=o,c()}finally{k.p=f}}var Ai=Math.random().toString(36).slice(2),yi="__reactFiber$"+Ai,Bi="__reactProps$"+Ai,Sr="__reactContainer$"+Ai,Tl="__reactEvents$"+Ai,nm="__reactListeners$"+Ai,im="__reactHandles$"+Ai,Ml="__reactResources$"+Ai,vo="__reactMarker$"+Ai;function _o(o){delete o[yi],delete o[Bi],delete o[Tl],delete o[nm],delete o[im]}function _a(o){var c=o[yi];if(c)return c;for(var f=o.parentNode;f;){if(c=f[Sr]||f[yi]){if(f=c.alternate,c.child!==null||f!==null&&f.child!==null)for(o=rR(o);o!==null;){if(f=o[yi])return f;o=rR(o)}return c}o=f,f=o.parentNode}return null}function xa(o){if(o=o[yi]||o[Sr]){var c=o.tag;if(c===5||c===6||c===13||c===26||c===27||c===3)return o}return null}function El(o){var c=o.tag;if(c===5||c===26||c===27||c===6)return o.stateNode;throw Error(n(33))}function xo(o){var c=o[Ml];return c||(c=o[Ml]={hoistableStyles:new Map,hoistableScripts:new Map}),c}function ri(o){o[vo]=!0}var rm=new Set,sm={};function ba(o,c){B(o,c),B(o+"Capture",c)}function B(o,c){for(sm[o]=c,o=0;o<c.length;o++)rm.add(c[o])}var ie=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),ge={},ye={};function ae(o){return Lt.call(ye,o)?!0:Lt.call(ge,o)?!1:ie.test(o)?ye[o]=!0:(ge[o]=!0,!1)}function ke(o,c,f){if(ae(c))if(f===null)o.removeAttribute(c);else{switch(typeof f){case"undefined":case"function":case"symbol":o.removeAttribute(c);return;case"boolean":var m=c.toLowerCase().slice(0,5);if(m!=="data-"&&m!=="aria-"){o.removeAttribute(c);return}}o.setAttribute(c,""+f)}}function qe(o,c,f){if(f===null)o.removeAttribute(c);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":o.removeAttribute(c);return}o.setAttribute(c,""+f)}}function Ke(o,c,f,m){if(m===null)o.removeAttribute(f);else{switch(typeof m){case"undefined":case"function":case"symbol":case"boolean":o.removeAttribute(f);return}o.setAttributeNS(c,f,""+m)}}var tt,vt;function mt(o){if(tt===void 0)try{throw Error()}catch(f){var c=f.stack.trim().match(/\n( *(at )?)/);tt=c&&c[1]||"",vt=-1<f.stack.indexOf(`
    at`)?" (<anonymous>)":-1<f.stack.indexOf("@")?"@unknown:0:0":""}return`
`+tt+o+vt}var ut=!1;function Vt(o,c){if(!o||ut)return"";ut=!0;var f=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var m={DetermineComponentFrameRoot:function(){try{if(c){var Ne=function(){throw Error()};if(Object.defineProperty(Ne.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Ne,[])}catch(me){var pe=me}Reflect.construct(o,[],Ne)}else{try{Ne.call()}catch(me){pe=me}o.call(Ne.prototype)}}else{try{throw Error()}catch(me){pe=me}(Ne=o())&&typeof Ne.catch=="function"&&Ne.catch(function(){})}}catch(me){if(me&&pe&&typeof me.stack=="string")return[me.stack,pe.stack]}return[null,null]}};m.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var x=Object.getOwnPropertyDescriptor(m.DetermineComponentFrameRoot,"name");x&&x.configurable&&Object.defineProperty(m.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var T=m.DetermineComponentFrameRoot(),P=T[0],O=T[1];if(P&&O){var q=P.split(`
`),ce=O.split(`
`);for(x=m=0;m<q.length&&!q[m].includes("DetermineComponentFrameRoot");)m++;for(;x<ce.length&&!ce[x].includes("DetermineComponentFrameRoot");)x++;if(m===q.length||x===ce.length)for(m=q.length-1,x=ce.length-1;1<=m&&0<=x&&q[m]!==ce[x];)x--;for(;1<=m&&0<=x;m--,x--)if(q[m]!==ce[x]){if(m!==1||x!==1)do if(m--,x--,0>x||q[m]!==ce[x]){var Ae=`
`+q[m].replace(" at new "," at ");return o.displayName&&Ae.includes("<anonymous>")&&(Ae=Ae.replace("<anonymous>",o.displayName)),Ae}while(1<=m&&0<=x);break}}}finally{ut=!1,Error.prepareStackTrace=f}return(f=o?o.displayName||o.name:"")?mt(f):""}function on(o){switch(o.tag){case 26:case 27:case 5:return mt(o.type);case 16:return mt("Lazy");case 13:return mt("Suspense");case 19:return mt("SuspenseList");case 0:case 15:return Vt(o.type,!1);case 11:return Vt(o.type.render,!1);case 1:return Vt(o.type,!0);case 31:return mt("Activity");default:return""}}function wn(o){try{var c="";do c+=on(o),o=o.return;while(o);return c}catch(f){return`
Error generating stack: `+f.message+`
`+f.stack}}function Zt(o){switch(typeof o){case"bigint":case"boolean":case"number":case"string":case"undefined":return o;case"object":return o;default:return""}}function Qt(o){var c=o.type;return(o=o.nodeName)&&o.toLowerCase()==="input"&&(c==="checkbox"||c==="radio")}function gt(o){var c=Qt(o)?"checked":"value",f=Object.getOwnPropertyDescriptor(o.constructor.prototype,c),m=""+o[c];if(!o.hasOwnProperty(c)&&typeof f<"u"&&typeof f.get=="function"&&typeof f.set=="function"){var x=f.get,T=f.set;return Object.defineProperty(o,c,{configurable:!0,get:function(){return x.call(this)},set:function(P){m=""+P,T.call(this,P)}}),Object.defineProperty(o,c,{enumerable:f.enumerable}),{getValue:function(){return m},setValue:function(P){m=""+P},stopTracking:function(){o._valueTracker=null,delete o[c]}}}}function Wn(o){o._valueTracker||(o._valueTracker=gt(o))}function en(o){if(!o)return!1;var c=o._valueTracker;if(!c)return!0;var f=c.getValue(),m="";return o&&(m=Qt(o)?o.checked?"true":"false":o.value),o=m,o!==f?(c.setValue(o),!0):!1}function qi(o){if(o=o||(typeof document<"u"?document:void 0),typeof o>"u")return null;try{return o.activeElement||o.body}catch{return o.body}}var bo=/[\n"\\]/g;function Rn(o){return o.replace(bo,function(c){return"\\"+c.charCodeAt(0).toString(16)+" "})}function Sa(o,c,f,m,x,T,P,O){o.name="",P!=null&&typeof P!="function"&&typeof P!="symbol"&&typeof P!="boolean"?o.type=P:o.removeAttribute("type"),c!=null?P==="number"?(c===0&&o.value===""||o.value!=c)&&(o.value=""+Zt(c)):o.value!==""+Zt(c)&&(o.value=""+Zt(c)):P!=="submit"&&P!=="reset"||o.removeAttribute("value"),c!=null?$i(o,P,Zt(c)):f!=null?$i(o,P,Zt(f)):m!=null&&o.removeAttribute("value"),x==null&&T!=null&&(o.defaultChecked=!!T),x!=null&&(o.checked=x&&typeof x!="function"&&typeof x!="symbol"),O!=null&&typeof O!="function"&&typeof O!="symbol"&&typeof O!="boolean"?o.name=""+Zt(O):o.removeAttribute("name")}function bn(o,c,f,m,x,T,P,O){if(T!=null&&typeof T!="function"&&typeof T!="symbol"&&typeof T!="boolean"&&(o.type=T),c!=null||f!=null){if(!(T!=="submit"&&T!=="reset"||c!=null))return;f=f!=null?""+Zt(f):"",c=c!=null?""+Zt(c):f,O||c===o.value||(o.value=c),o.defaultValue=c}m=m??x,m=typeof m!="function"&&typeof m!="symbol"&&!!m,o.checked=O?o.checked:!!m,o.defaultChecked=!!m,P!=null&&typeof P!="function"&&typeof P!="symbol"&&typeof P!="boolean"&&(o.name=P)}function $i(o,c,f){c==="number"&&qi(o.ownerDocument)===o||o.defaultValue===""+f||(o.defaultValue=""+f)}function vi(o,c,f,m){if(o=o.options,c){c={};for(var x=0;x<f.length;x++)c["$"+f[x]]=!0;for(f=0;f<o.length;f++)x=c.hasOwnProperty("$"+o[f].value),o[f].selected!==x&&(o[f].selected=x),x&&m&&(o[f].defaultSelected=!0)}else{for(f=""+Zt(f),c=null,x=0;x<o.length;x++){if(o[x].value===f){o[x].selected=!0,m&&(o[x].defaultSelected=!0);return}c!==null||o[x].disabled||(c=o[x])}c!==null&&(c.selected=!0)}}function wi(o,c,f){if(c!=null&&(c=""+Zt(c),c!==o.value&&(o.value=c),f==null)){o.defaultValue!==c&&(o.defaultValue=c);return}o.defaultValue=f!=null?""+Zt(f):""}function Ii(o,c,f,m){if(c==null){if(m!=null){if(f!=null)throw Error(n(92));if(le(m)){if(1<m.length)throw Error(n(93));m=m[0]}f=m}f==null&&(f=""),c=f}f=Zt(c),o.defaultValue=f,m=o.textContent,m===f&&m!==""&&m!==null&&(o.value=m)}function Ws(o,c){if(c){var f=o.firstChild;if(f&&f===o.lastChild&&f.nodeType===3){f.nodeValue=c;return}}o.textContent=c}var Ta=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function JE(o,c,f){var m=c.indexOf("--")===0;f==null||typeof f=="boolean"||f===""?m?o.setProperty(c,""):c==="float"?o.cssFloat="":o[c]="":m?o.setProperty(c,f):typeof f!="number"||f===0||Ta.has(c)?c==="float"?o.cssFloat=f:o[c]=(""+f).trim():o[c]=f+"px"}function eA(o,c,f){if(c!=null&&typeof c!="object")throw Error(n(62));if(o=o.style,f!=null){for(var m in f)!f.hasOwnProperty(m)||c!=null&&c.hasOwnProperty(m)||(m.indexOf("--")===0?o.setProperty(m,""):m==="float"?o.cssFloat="":o[m]="");for(var x in c)m=c[x],c.hasOwnProperty(x)&&f[x]!==m&&JE(o,x,m)}else for(var T in c)c.hasOwnProperty(T)&&JE(o,T,c[T])}function t_(o){if(o.indexOf("-")===-1)return!1;switch(o){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var I3=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),F3=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function am(o){return F3.test(""+o)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":o}var n_=null;function i_(o){return o=o.target||o.srcElement||window,o.correspondingUseElement&&(o=o.correspondingUseElement),o.nodeType===3?o.parentNode:o}var Ou=null,Bu=null;function tA(o){var c=xa(o);if(c&&(o=c.stateNode)){var f=o[Bi]||null;e:switch(o=c.stateNode,c.type){case"input":if(Sa(o,f.value,f.defaultValue,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name),c=f.name,f.type==="radio"&&c!=null){for(f=o;f.parentNode;)f=f.parentNode;for(f=f.querySelectorAll('input[name="'+Rn(""+c)+'"][type="radio"]'),c=0;c<f.length;c++){var m=f[c];if(m!==o&&m.form===o.form){var x=m[Bi]||null;if(!x)throw Error(n(90));Sa(m,x.value,x.defaultValue,x.defaultValue,x.checked,x.defaultChecked,x.type,x.name)}}for(c=0;c<f.length;c++)m=f[c],m.form===o.form&&en(m)}break e;case"textarea":wi(o,f.value,f.defaultValue);break e;case"select":c=f.value,c!=null&&vi(o,!!f.multiple,c,!1)}}}var r_=!1;function nA(o,c,f){if(r_)return o(c,f);r_=!0;try{var m=o(c);return m}finally{if(r_=!1,(Ou!==null||Bu!==null)&&(jm(),Ou&&(c=Ou,o=Bu,Bu=Ou=null,tA(c),o)))for(c=0;c<o.length;c++)tA(o[c])}}function Jh(o,c){var f=o.stateNode;if(f===null)return null;var m=f[Bi]||null;if(m===null)return null;f=m[c];e:switch(c){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(m=!m.disabled)||(o=o.type,m=!(o==="button"||o==="input"||o==="select"||o==="textarea")),o=!m;break e;default:o=!1}if(o)return null;if(f&&typeof f!="function")throw Error(n(231,c,typeof f));return f}var Ma=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),s_=!1;if(Ma)try{var ef={};Object.defineProperty(ef,"passive",{get:function(){s_=!0}}),window.addEventListener("test",ef,ef),window.removeEventListener("test",ef,ef)}catch{s_=!1}var So=null,a_=null,om=null;function iA(){if(om)return om;var o,c=a_,f=c.length,m,x="value"in So?So.value:So.textContent,T=x.length;for(o=0;o<f&&c[o]===x[o];o++);var P=f-o;for(m=1;m<=P&&c[f-m]===x[T-m];m++);return om=x.slice(o,1<m?1-m:void 0)}function lm(o){var c=o.keyCode;return"charCode"in o?(o=o.charCode,o===0&&c===13&&(o=13)):o=c,o===10&&(o=13),32<=o||o===13?o:0}function um(){return!0}function rA(){return!1}function Tr(o){function c(f,m,x,T,P){this._reactName=f,this._targetInst=x,this.type=m,this.nativeEvent=T,this.target=P,this.currentTarget=null;for(var O in o)o.hasOwnProperty(O)&&(f=o[O],this[O]=f?f(T):T[O]);return this.isDefaultPrevented=(T.defaultPrevented!=null?T.defaultPrevented:T.returnValue===!1)?um:rA,this.isPropagationStopped=rA,this}return d(c.prototype,{preventDefault:function(){this.defaultPrevented=!0;var f=this.nativeEvent;f&&(f.preventDefault?f.preventDefault():typeof f.returnValue!="unknown"&&(f.returnValue=!1),this.isDefaultPrevented=um)},stopPropagation:function(){var f=this.nativeEvent;f&&(f.stopPropagation?f.stopPropagation():typeof f.cancelBubble!="unknown"&&(f.cancelBubble=!0),this.isPropagationStopped=um)},persist:function(){},isPersistent:um}),c}var Al={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(o){return o.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},cm=Tr(Al),tf=d({},Al,{view:0,detail:0}),k3=Tr(tf),o_,l_,nf,hm=d({},tf,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:c_,button:0,buttons:0,relatedTarget:function(o){return o.relatedTarget===void 0?o.fromElement===o.srcElement?o.toElement:o.fromElement:o.relatedTarget},movementX:function(o){return"movementX"in o?o.movementX:(o!==nf&&(nf&&o.type==="mousemove"?(o_=o.screenX-nf.screenX,l_=o.screenY-nf.screenY):l_=o_=0,nf=o),o_)},movementY:function(o){return"movementY"in o?o.movementY:l_}}),sA=Tr(hm),z3=d({},hm,{dataTransfer:0}),V3=Tr(z3),G3=d({},tf,{relatedTarget:0}),u_=Tr(G3),H3=d({},Al,{animationName:0,elapsedTime:0,pseudoElement:0}),W3=Tr(H3),j3=d({},Al,{clipboardData:function(o){return"clipboardData"in o?o.clipboardData:window.clipboardData}}),q3=Tr(j3),$3=d({},Al,{data:0}),aA=Tr($3),X3={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Y3={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},K3={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Z3(o){var c=this.nativeEvent;return c.getModifierState?c.getModifierState(o):(o=K3[o])?!!c[o]:!1}function c_(){return Z3}var Q3=d({},tf,{key:function(o){if(o.key){var c=X3[o.key]||o.key;if(c!=="Unidentified")return c}return o.type==="keypress"?(o=lm(o),o===13?"Enter":String.fromCharCode(o)):o.type==="keydown"||o.type==="keyup"?Y3[o.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:c_,charCode:function(o){return o.type==="keypress"?lm(o):0},keyCode:function(o){return o.type==="keydown"||o.type==="keyup"?o.keyCode:0},which:function(o){return o.type==="keypress"?lm(o):o.type==="keydown"||o.type==="keyup"?o.keyCode:0}}),J3=Tr(Q3),eF=d({},hm,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),oA=Tr(eF),tF=d({},tf,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:c_}),nF=Tr(tF),iF=d({},Al,{propertyName:0,elapsedTime:0,pseudoElement:0}),rF=Tr(iF),sF=d({},hm,{deltaX:function(o){return"deltaX"in o?o.deltaX:"wheelDeltaX"in o?-o.wheelDeltaX:0},deltaY:function(o){return"deltaY"in o?o.deltaY:"wheelDeltaY"in o?-o.wheelDeltaY:"wheelDelta"in o?-o.wheelDelta:0},deltaZ:0,deltaMode:0}),aF=Tr(sF),oF=d({},Al,{newState:0,oldState:0}),lF=Tr(oF),uF=[9,13,27,32],h_=Ma&&"CompositionEvent"in window,rf=null;Ma&&"documentMode"in document&&(rf=document.documentMode);var cF=Ma&&"TextEvent"in window&&!rf,lA=Ma&&(!h_||rf&&8<rf&&11>=rf),uA=" ",cA=!1;function hA(o,c){switch(o){case"keyup":return uF.indexOf(c.keyCode)!==-1;case"keydown":return c.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function fA(o){return o=o.detail,typeof o=="object"&&"data"in o?o.data:null}var Iu=!1;function hF(o,c){switch(o){case"compositionend":return fA(c);case"keypress":return c.which!==32?null:(cA=!0,uA);case"textInput":return o=c.data,o===uA&&cA?null:o;default:return null}}function fF(o,c){if(Iu)return o==="compositionend"||!h_&&hA(o,c)?(o=iA(),om=a_=So=null,Iu=!1,o):null;switch(o){case"paste":return null;case"keypress":if(!(c.ctrlKey||c.altKey||c.metaKey)||c.ctrlKey&&c.altKey){if(c.char&&1<c.char.length)return c.char;if(c.which)return String.fromCharCode(c.which)}return null;case"compositionend":return lA&&c.locale!=="ko"?null:c.data;default:return null}}var dF={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function dA(o){var c=o&&o.nodeName&&o.nodeName.toLowerCase();return c==="input"?!!dF[o.type]:c==="textarea"}function pA(o,c,f,m){Ou?Bu?Bu.push(m):Bu=[m]:Ou=m,c=Zm(c,"onChange"),0<c.length&&(f=new cm("onChange","change",null,f,m),o.push({event:f,listeners:c}))}var sf=null,af=null;function pF(o){X1(o,0)}function fm(o){var c=El(o);if(en(c))return o}function mA(o,c){if(o==="change")return c}var gA=!1;if(Ma){var f_;if(Ma){var d_="oninput"in document;if(!d_){var yA=document.createElement("div");yA.setAttribute("oninput","return;"),d_=typeof yA.oninput=="function"}f_=d_}else f_=!1;gA=f_&&(!document.documentMode||9<document.documentMode)}function vA(){sf&&(sf.detachEvent("onpropertychange",_A),af=sf=null)}function _A(o){if(o.propertyName==="value"&&fm(af)){var c=[];pA(c,af,o,i_(o)),nA(pF,c)}}function mF(o,c,f){o==="focusin"?(vA(),sf=c,af=f,sf.attachEvent("onpropertychange",_A)):o==="focusout"&&vA()}function gF(o){if(o==="selectionchange"||o==="keyup"||o==="keydown")return fm(af)}function yF(o,c){if(o==="click")return fm(c)}function vF(o,c){if(o==="input"||o==="change")return fm(c)}function _F(o,c){return o===c&&(o!==0||1/o===1/c)||o!==o&&c!==c}var zr=typeof Object.is=="function"?Object.is:_F;function of(o,c){if(zr(o,c))return!0;if(typeof o!="object"||o===null||typeof c!="object"||c===null)return!1;var f=Object.keys(o),m=Object.keys(c);if(f.length!==m.length)return!1;for(m=0;m<f.length;m++){var x=f[m];if(!Lt.call(c,x)||!zr(o[x],c[x]))return!1}return!0}function xA(o){for(;o&&o.firstChild;)o=o.firstChild;return o}function bA(o,c){var f=xA(o);o=0;for(var m;f;){if(f.nodeType===3){if(m=o+f.textContent.length,o<=c&&m>=c)return{node:f,offset:c-o};o=m}e:{for(;f;){if(f.nextSibling){f=f.nextSibling;break e}f=f.parentNode}f=void 0}f=xA(f)}}function SA(o,c){return o&&c?o===c?!0:o&&o.nodeType===3?!1:c&&c.nodeType===3?SA(o,c.parentNode):"contains"in o?o.contains(c):o.compareDocumentPosition?!!(o.compareDocumentPosition(c)&16):!1:!1}function TA(o){o=o!=null&&o.ownerDocument!=null&&o.ownerDocument.defaultView!=null?o.ownerDocument.defaultView:window;for(var c=qi(o.document);c instanceof o.HTMLIFrameElement;){try{var f=typeof c.contentWindow.location.href=="string"}catch{f=!1}if(f)o=c.contentWindow;else break;c=qi(o.document)}return c}function p_(o){var c=o&&o.nodeName&&o.nodeName.toLowerCase();return c&&(c==="input"&&(o.type==="text"||o.type==="search"||o.type==="tel"||o.type==="url"||o.type==="password")||c==="textarea"||o.contentEditable==="true")}var xF=Ma&&"documentMode"in document&&11>=document.documentMode,Fu=null,m_=null,lf=null,g_=!1;function MA(o,c,f){var m=f.window===f?f.document:f.nodeType===9?f:f.ownerDocument;g_||Fu==null||Fu!==qi(m)||(m=Fu,"selectionStart"in m&&p_(m)?m={start:m.selectionStart,end:m.selectionEnd}:(m=(m.ownerDocument&&m.ownerDocument.defaultView||window).getSelection(),m={anchorNode:m.anchorNode,anchorOffset:m.anchorOffset,focusNode:m.focusNode,focusOffset:m.focusOffset}),lf&&of(lf,m)||(lf=m,m=Zm(m_,"onSelect"),0<m.length&&(c=new cm("onSelect","select",null,c,f),o.push({event:c,listeners:m}),c.target=Fu)))}function wl(o,c){var f={};return f[o.toLowerCase()]=c.toLowerCase(),f["Webkit"+o]="webkit"+c,f["Moz"+o]="moz"+c,f}var ku={animationend:wl("Animation","AnimationEnd"),animationiteration:wl("Animation","AnimationIteration"),animationstart:wl("Animation","AnimationStart"),transitionrun:wl("Transition","TransitionRun"),transitionstart:wl("Transition","TransitionStart"),transitioncancel:wl("Transition","TransitionCancel"),transitionend:wl("Transition","TransitionEnd")},y_={},EA={};Ma&&(EA=document.createElement("div").style,"AnimationEvent"in window||(delete ku.animationend.animation,delete ku.animationiteration.animation,delete ku.animationstart.animation),"TransitionEvent"in window||delete ku.transitionend.transition);function Rl(o){if(y_[o])return y_[o];if(!ku[o])return o;var c=ku[o],f;for(f in c)if(c.hasOwnProperty(f)&&f in EA)return y_[o]=c[f];return o}var AA=Rl("animationend"),wA=Rl("animationiteration"),RA=Rl("animationstart"),bF=Rl("transitionrun"),SF=Rl("transitionstart"),TF=Rl("transitioncancel"),CA=Rl("transitionend"),NA=new Map,v_="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");v_.push("scrollEnd");function Es(o,c){NA.set(o,c),ba(c,[o])}var PA=new WeakMap;function as(o,c){if(typeof o=="object"&&o!==null){var f=PA.get(o);return f!==void 0?f:(c={value:o,source:c,stack:wn(c)},PA.set(o,c),c)}return{value:o,source:c,stack:wn(c)}}var os=[],zu=0,__=0;function dm(){for(var o=zu,c=__=zu=0;c<o;){var f=os[c];os[c++]=null;var m=os[c];os[c++]=null;var x=os[c];os[c++]=null;var T=os[c];if(os[c++]=null,m!==null&&x!==null){var P=m.pending;P===null?x.next=x:(x.next=P.next,P.next=x),m.pending=x}T!==0&&DA(f,x,T)}}function pm(o,c,f,m){os[zu++]=o,os[zu++]=c,os[zu++]=f,os[zu++]=m,__|=m,o.lanes|=m,o=o.alternate,o!==null&&(o.lanes|=m)}function x_(o,c,f,m){return pm(o,c,f,m),mm(o)}function Vu(o,c){return pm(o,null,null,c),mm(o)}function DA(o,c,f){o.lanes|=f;var m=o.alternate;m!==null&&(m.lanes|=f);for(var x=!1,T=o.return;T!==null;)T.childLanes|=f,m=T.alternate,m!==null&&(m.childLanes|=f),T.tag===22&&(o=T.stateNode,o===null||o._visibility&1||(x=!0)),o=T,T=T.return;return o.tag===3?(T=o.stateNode,x&&c!==null&&(x=31-Qe(f),o=T.hiddenUpdates,m=o[x],m===null?o[x]=[c]:m.push(c),c.lane=f|536870912),T):null}function mm(o){if(50<Lf)throw Lf=0,A0=null,Error(n(185));for(var c=o.return;c!==null;)o=c,c=o.return;return o.tag===3?o.stateNode:null}var Gu={};function MF(o,c,f,m){this.tag=o,this.key=f,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=c,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=m,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Vr(o,c,f,m){return new MF(o,c,f,m)}function b_(o){return o=o.prototype,!(!o||!o.isReactComponent)}function Ea(o,c){var f=o.alternate;return f===null?(f=Vr(o.tag,c,o.key,o.mode),f.elementType=o.elementType,f.type=o.type,f.stateNode=o.stateNode,f.alternate=o,o.alternate=f):(f.pendingProps=c,f.type=o.type,f.flags=0,f.subtreeFlags=0,f.deletions=null),f.flags=o.flags&65011712,f.childLanes=o.childLanes,f.lanes=o.lanes,f.child=o.child,f.memoizedProps=o.memoizedProps,f.memoizedState=o.memoizedState,f.updateQueue=o.updateQueue,c=o.dependencies,f.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext},f.sibling=o.sibling,f.index=o.index,f.ref=o.ref,f.refCleanup=o.refCleanup,f}function LA(o,c){o.flags&=65011714;var f=o.alternate;return f===null?(o.childLanes=0,o.lanes=c,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=f.childLanes,o.lanes=f.lanes,o.child=f.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=f.memoizedProps,o.memoizedState=f.memoizedState,o.updateQueue=f.updateQueue,o.type=f.type,c=f.dependencies,o.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext}),o}function gm(o,c,f,m,x,T){var P=0;if(m=o,typeof o=="function")b_(o)&&(P=1);else if(typeof o=="string")P=Ak(o,f,j.current)?26:o==="html"||o==="head"||o==="body"?27:5;else e:switch(o){case N:return o=Vr(31,f,c,x),o.elementType=N,o.lanes=T,o;case v:return Cl(f.children,x,T,c);case S:P=8,x|=24;break;case b:return o=Vr(12,f,c,x|2),o.elementType=b,o.lanes=T,o;case w:return o=Vr(13,f,c,x),o.elementType=w,o.lanes=T,o;case R:return o=Vr(19,f,c,x),o.elementType=R,o.lanes=T,o;default:if(typeof o=="object"&&o!==null)switch(o.$$typeof){case _:case M:P=10;break e;case E:P=9;break e;case A:P=11;break e;case C:P=14;break e;case L:P=16,m=null;break e}P=29,f=Error(n(130,o===null?"null":typeof o,"")),m=null}return c=Vr(P,f,c,x),c.elementType=o,c.type=m,c.lanes=T,c}function Cl(o,c,f,m){return o=Vr(7,o,m,c),o.lanes=f,o}function S_(o,c,f){return o=Vr(6,o,null,c),o.lanes=f,o}function T_(o,c,f){return c=Vr(4,o.children!==null?o.children:[],o.key,c),c.lanes=f,c.stateNode={containerInfo:o.containerInfo,pendingChildren:null,implementation:o.implementation},c}var Hu=[],Wu=0,ym=null,vm=0,ls=[],us=0,Nl=null,Aa=1,wa="";function Pl(o,c){Hu[Wu++]=vm,Hu[Wu++]=ym,ym=o,vm=c}function UA(o,c,f){ls[us++]=Aa,ls[us++]=wa,ls[us++]=Nl,Nl=o;var m=Aa;o=wa;var x=32-Qe(m)-1;m&=~(1<<x),f+=1;var T=32-Qe(c)+x;if(30<T){var P=x-x%5;T=(m&(1<<P)-1).toString(32),m>>=P,x-=P,Aa=1<<32-Qe(c)+x|f<<x|m,wa=T+o}else Aa=1<<T|f<<x|m,wa=o}function M_(o){o.return!==null&&(Pl(o,1),UA(o,1,0))}function E_(o){for(;o===ym;)ym=Hu[--Wu],Hu[Wu]=null,vm=Hu[--Wu],Hu[Wu]=null;for(;o===Nl;)Nl=ls[--us],ls[us]=null,wa=ls[--us],ls[us]=null,Aa=ls[--us],ls[us]=null}var or=null,jn=null,ln=!1,Dl=null,js=!1,A_=Error(n(519));function Ll(o){var c=Error(n(418,""));throw hf(as(c,o)),A_}function OA(o){var c=o.stateNode,f=o.type,m=o.memoizedProps;switch(c[yi]=o,c[Bi]=m,f){case"dialog":Yt("cancel",c),Yt("close",c);break;case"iframe":case"object":case"embed":Yt("load",c);break;case"video":case"audio":for(f=0;f<Of.length;f++)Yt(Of[f],c);break;case"source":Yt("error",c);break;case"img":case"image":case"link":Yt("error",c),Yt("load",c);break;case"details":Yt("toggle",c);break;case"input":Yt("invalid",c),bn(c,m.value,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name,!0),Wn(c);break;case"select":Yt("invalid",c);break;case"textarea":Yt("invalid",c),Ii(c,m.value,m.defaultValue,m.children),Wn(c)}f=m.children,typeof f!="string"&&typeof f!="number"&&typeof f!="bigint"||c.textContent===""+f||m.suppressHydrationWarning===!0||Q1(c.textContent,f)?(m.popover!=null&&(Yt("beforetoggle",c),Yt("toggle",c)),m.onScroll!=null&&Yt("scroll",c),m.onScrollEnd!=null&&Yt("scrollend",c),m.onClick!=null&&(c.onclick=Qm),c=!0):c=!1,c||Ll(o)}function BA(o){for(or=o.return;or;)switch(or.tag){case 5:case 13:js=!1;return;case 27:case 3:js=!0;return;default:or=or.return}}function uf(o){if(o!==or)return!1;if(!ln)return BA(o),ln=!0,!1;var c=o.tag,f;if((f=c!==3&&c!==27)&&((f=c===5)&&(f=o.type,f=!(f!=="form"&&f!=="button")||G0(o.type,o.memoizedProps)),f=!f),f&&jn&&Ll(o),BA(o),c===13){if(o=o.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(n(317));e:{for(o=o.nextSibling,c=0;o;){if(o.nodeType===8)if(f=o.data,f==="/$"){if(c===0){jn=ws(o.nextSibling);break e}c--}else f!=="$"&&f!=="$!"&&f!=="$?"||c++;o=o.nextSibling}jn=null}}else c===27?(c=jn,Fo(o.type)?(o=q0,q0=null,jn=o):jn=c):jn=or?ws(o.stateNode.nextSibling):null;return!0}function cf(){jn=or=null,ln=!1}function IA(){var o=Dl;return o!==null&&(Ar===null?Ar=o:Ar.push.apply(Ar,o),Dl=null),o}function hf(o){Dl===null?Dl=[o]:Dl.push(o)}var w_=se(null),Ul=null,Ra=null;function To(o,c,f){De(w_,c._currentValue),c._currentValue=f}function Ca(o){o._currentValue=w_.current,Me(w_)}function R_(o,c,f){for(;o!==null;){var m=o.alternate;if((o.childLanes&c)!==c?(o.childLanes|=c,m!==null&&(m.childLanes|=c)):m!==null&&(m.childLanes&c)!==c&&(m.childLanes|=c),o===f)break;o=o.return}}function C_(o,c,f,m){var x=o.child;for(x!==null&&(x.return=o);x!==null;){var T=x.dependencies;if(T!==null){var P=x.child;T=T.firstContext;e:for(;T!==null;){var O=T;T=x;for(var q=0;q<c.length;q++)if(O.context===c[q]){T.lanes|=f,O=T.alternate,O!==null&&(O.lanes|=f),R_(T.return,f,o),m||(P=null);break e}T=O.next}}else if(x.tag===18){if(P=x.return,P===null)throw Error(n(341));P.lanes|=f,T=P.alternate,T!==null&&(T.lanes|=f),R_(P,f,o),P=null}else P=x.child;if(P!==null)P.return=x;else for(P=x;P!==null;){if(P===o){P=null;break}if(x=P.sibling,x!==null){x.return=P.return,P=x;break}P=P.return}x=P}}function ff(o,c,f,m){o=null;for(var x=c,T=!1;x!==null;){if(!T){if((x.flags&524288)!==0)T=!0;else if((x.flags&262144)!==0)break}if(x.tag===10){var P=x.alternate;if(P===null)throw Error(n(387));if(P=P.memoizedProps,P!==null){var O=x.type;zr(x.pendingProps.value,P.value)||(o!==null?o.push(O):o=[O])}}else if(x===ne.current){if(P=x.alternate,P===null)throw Error(n(387));P.memoizedState.memoizedState!==x.memoizedState.memoizedState&&(o!==null?o.push(Vf):o=[Vf])}x=x.return}o!==null&&C_(c,o,f,m),c.flags|=262144}function _m(o){for(o=o.firstContext;o!==null;){if(!zr(o.context._currentValue,o.memoizedValue))return!0;o=o.next}return!1}function Ol(o){Ul=o,Ra=null,o=o.dependencies,o!==null&&(o.firstContext=null)}function Xi(o){return FA(Ul,o)}function xm(o,c){return Ul===null&&Ol(o),FA(o,c)}function FA(o,c){var f=c._currentValue;if(c={context:c,memoizedValue:f,next:null},Ra===null){if(o===null)throw Error(n(308));Ra=c,o.dependencies={lanes:0,firstContext:c},o.flags|=524288}else Ra=Ra.next=c;return f}var EF=typeof AbortController<"u"?AbortController:function(){var o=[],c=this.signal={aborted:!1,addEventListener:function(f,m){o.push(m)}};this.abort=function(){c.aborted=!0,o.forEach(function(f){return f()})}},AF=i.unstable_scheduleCallback,wF=i.unstable_NormalPriority,_i={$$typeof:M,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function N_(){return{controller:new EF,data:new Map,refCount:0}}function df(o){o.refCount--,o.refCount===0&&AF(wF,function(){o.controller.abort()})}var pf=null,P_=0,ju=0,qu=null;function RF(o,c){if(pf===null){var f=pf=[];P_=0,ju=L0(),qu={status:"pending",value:void 0,then:function(m){f.push(m)}}}return P_++,c.then(kA,kA),c}function kA(){if(--P_===0&&pf!==null){qu!==null&&(qu.status="fulfilled");var o=pf;pf=null,ju=0,qu=null;for(var c=0;c<o.length;c++)(0,o[c])()}}function CF(o,c){var f=[],m={status:"pending",value:null,reason:null,then:function(x){f.push(x)}};return o.then(function(){m.status="fulfilled",m.value=c;for(var x=0;x<f.length;x++)(0,f[x])(c)},function(x){for(m.status="rejected",m.reason=x,x=0;x<f.length;x++)(0,f[x])(void 0)}),m}var zA=z.S;z.S=function(o,c){typeof c=="object"&&c!==null&&typeof c.then=="function"&&RF(o,c),zA!==null&&zA(o,c)};var Bl=se(null);function D_(){var o=Bl.current;return o!==null?o:Cn.pooledCache}function bm(o,c){c===null?De(Bl,Bl.current):De(Bl,c.pool)}function VA(){var o=D_();return o===null?null:{parent:_i._currentValue,pool:o}}var mf=Error(n(460)),GA=Error(n(474)),Sm=Error(n(542)),L_={then:function(){}};function HA(o){return o=o.status,o==="fulfilled"||o==="rejected"}function Tm(){}function WA(o,c,f){switch(f=o[f],f===void 0?o.push(c):f!==c&&(c.then(Tm,Tm),c=f),c.status){case"fulfilled":return c.value;case"rejected":throw o=c.reason,qA(o),o;default:if(typeof c.status=="string")c.then(Tm,Tm);else{if(o=Cn,o!==null&&100<o.shellSuspendCounter)throw Error(n(482));o=c,o.status="pending",o.then(function(m){if(c.status==="pending"){var x=c;x.status="fulfilled",x.value=m}},function(m){if(c.status==="pending"){var x=c;x.status="rejected",x.reason=m}})}switch(c.status){case"fulfilled":return c.value;case"rejected":throw o=c.reason,qA(o),o}throw gf=c,mf}}var gf=null;function jA(){if(gf===null)throw Error(n(459));var o=gf;return gf=null,o}function qA(o){if(o===mf||o===Sm)throw Error(n(483))}var Mo=!1;function U_(o){o.updateQueue={baseState:o.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function O_(o,c){o=o.updateQueue,c.updateQueue===o&&(c.updateQueue={baseState:o.baseState,firstBaseUpdate:o.firstBaseUpdate,lastBaseUpdate:o.lastBaseUpdate,shared:o.shared,callbacks:null})}function Eo(o){return{lane:o,tag:0,payload:null,callback:null,next:null}}function Ao(o,c,f){var m=o.updateQueue;if(m===null)return null;if(m=m.shared,(dn&2)!==0){var x=m.pending;return x===null?c.next=c:(c.next=x.next,x.next=c),m.pending=c,c=mm(o),DA(o,null,f),c}return pm(o,m,c,f),mm(o)}function yf(o,c,f){if(c=c.updateQueue,c!==null&&(c=c.shared,(f&4194048)!==0)){var m=c.lanes;m&=o.pendingLanes,f|=m,c.lanes=f,nt(o,f)}}function B_(o,c){var f=o.updateQueue,m=o.alternate;if(m!==null&&(m=m.updateQueue,f===m)){var x=null,T=null;if(f=f.firstBaseUpdate,f!==null){do{var P={lane:f.lane,tag:f.tag,payload:f.payload,callback:null,next:null};T===null?x=T=P:T=T.next=P,f=f.next}while(f!==null);T===null?x=T=c:T=T.next=c}else x=T=c;f={baseState:m.baseState,firstBaseUpdate:x,lastBaseUpdate:T,shared:m.shared,callbacks:m.callbacks},o.updateQueue=f;return}o=f.lastBaseUpdate,o===null?f.firstBaseUpdate=c:o.next=c,f.lastBaseUpdate=c}var I_=!1;function vf(){if(I_){var o=qu;if(o!==null)throw o}}function _f(o,c,f,m){I_=!1;var x=o.updateQueue;Mo=!1;var T=x.firstBaseUpdate,P=x.lastBaseUpdate,O=x.shared.pending;if(O!==null){x.shared.pending=null;var q=O,ce=q.next;q.next=null,P===null?T=ce:P.next=ce,P=q;var Ae=o.alternate;Ae!==null&&(Ae=Ae.updateQueue,O=Ae.lastBaseUpdate,O!==P&&(O===null?Ae.firstBaseUpdate=ce:O.next=ce,Ae.lastBaseUpdate=q))}if(T!==null){var Ne=x.baseState;P=0,Ae=ce=q=null,O=T;do{var pe=O.lane&-536870913,me=pe!==O.lane;if(me?(Jt&pe)===pe:(m&pe)===pe){pe!==0&&pe===ju&&(I_=!0),Ae!==null&&(Ae=Ae.next={lane:0,tag:O.tag,payload:O.payload,callback:null,next:null});e:{var St=o,yt=O;pe=c;var vn=f;switch(yt.tag){case 1:if(St=yt.payload,typeof St=="function"){Ne=St.call(vn,Ne,pe);break e}Ne=St;break e;case 3:St.flags=St.flags&-65537|128;case 0:if(St=yt.payload,pe=typeof St=="function"?St.call(vn,Ne,pe):St,pe==null)break e;Ne=d({},Ne,pe);break e;case 2:Mo=!0}}pe=O.callback,pe!==null&&(o.flags|=64,me&&(o.flags|=8192),me=x.callbacks,me===null?x.callbacks=[pe]:me.push(pe))}else me={lane:pe,tag:O.tag,payload:O.payload,callback:O.callback,next:null},Ae===null?(ce=Ae=me,q=Ne):Ae=Ae.next=me,P|=pe;if(O=O.next,O===null){if(O=x.shared.pending,O===null)break;me=O,O=me.next,me.next=null,x.lastBaseUpdate=me,x.shared.pending=null}}while(!0);Ae===null&&(q=Ne),x.baseState=q,x.firstBaseUpdate=ce,x.lastBaseUpdate=Ae,T===null&&(x.shared.lanes=0),Uo|=P,o.lanes=P,o.memoizedState=Ne}}function $A(o,c){if(typeof o!="function")throw Error(n(191,o));o.call(c)}function XA(o,c){var f=o.callbacks;if(f!==null)for(o.callbacks=null,o=0;o<f.length;o++)$A(f[o],c)}var $u=se(null),Mm=se(0);function YA(o,c){o=Ba,De(Mm,o),De($u,c),Ba=o|c.baseLanes}function F_(){De(Mm,Ba),De($u,$u.current)}function k_(){Ba=Mm.current,Me($u),Me(Mm)}var wo=0,Gt=null,gn=null,si=null,Em=!1,Xu=!1,Il=!1,Am=0,xf=0,Yu=null,NF=0;function Kn(){throw Error(n(321))}function z_(o,c){if(c===null)return!1;for(var f=0;f<c.length&&f<o.length;f++)if(!zr(o[f],c[f]))return!1;return!0}function V_(o,c,f,m,x,T){return wo=T,Gt=c,c.memoizedState=null,c.updateQueue=null,c.lanes=0,z.H=o===null||o.memoizedState===null?Dw:Lw,Il=!1,T=f(m,x),Il=!1,Xu&&(T=ZA(c,f,m,x)),KA(o),T}function KA(o){z.H=Dm;var c=gn!==null&&gn.next!==null;if(wo=0,si=gn=Gt=null,Em=!1,xf=0,Yu=null,c)throw Error(n(300));o===null||Ri||(o=o.dependencies,o!==null&&_m(o)&&(Ri=!0))}function ZA(o,c,f,m){Gt=o;var x=0;do{if(Xu&&(Yu=null),xf=0,Xu=!1,25<=x)throw Error(n(301));if(x+=1,si=gn=null,o.updateQueue!=null){var T=o.updateQueue;T.lastEffect=null,T.events=null,T.stores=null,T.memoCache!=null&&(T.memoCache.index=0)}z.H=IF,T=c(f,m)}while(Xu);return T}function PF(){var o=z.H,c=o.useState()[0];return c=typeof c.then=="function"?bf(c):c,o=o.useState()[0],(gn!==null?gn.memoizedState:null)!==o&&(Gt.flags|=1024),c}function G_(){var o=Am!==0;return Am=0,o}function H_(o,c,f){c.updateQueue=o.updateQueue,c.flags&=-2053,o.lanes&=~f}function W_(o){if(Em){for(o=o.memoizedState;o!==null;){var c=o.queue;c!==null&&(c.pending=null),o=o.next}Em=!1}wo=0,si=gn=Gt=null,Xu=!1,xf=Am=0,Yu=null}function Mr(){var o={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return si===null?Gt.memoizedState=si=o:si=si.next=o,si}function ai(){if(gn===null){var o=Gt.alternate;o=o!==null?o.memoizedState:null}else o=gn.next;var c=si===null?Gt.memoizedState:si.next;if(c!==null)si=c,gn=o;else{if(o===null)throw Gt.alternate===null?Error(n(467)):Error(n(310));gn=o,o={memoizedState:gn.memoizedState,baseState:gn.baseState,baseQueue:gn.baseQueue,queue:gn.queue,next:null},si===null?Gt.memoizedState=si=o:si=si.next=o}return si}function j_(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function bf(o){var c=xf;return xf+=1,Yu===null&&(Yu=[]),o=WA(Yu,o,c),c=Gt,(si===null?c.memoizedState:si.next)===null&&(c=c.alternate,z.H=c===null||c.memoizedState===null?Dw:Lw),o}function wm(o){if(o!==null&&typeof o=="object"){if(typeof o.then=="function")return bf(o);if(o.$$typeof===M)return Xi(o)}throw Error(n(438,String(o)))}function q_(o){var c=null,f=Gt.updateQueue;if(f!==null&&(c=f.memoCache),c==null){var m=Gt.alternate;m!==null&&(m=m.updateQueue,m!==null&&(m=m.memoCache,m!=null&&(c={data:m.data.map(function(x){return x.slice()}),index:0})))}if(c==null&&(c={data:[],index:0}),f===null&&(f=j_(),Gt.updateQueue=f),f.memoCache=c,f=c.data[c.index],f===void 0)for(f=c.data[c.index]=Array(o),m=0;m<o;m++)f[m]=D;return c.index++,f}function Na(o,c){return typeof c=="function"?c(o):c}function Rm(o){var c=ai();return $_(c,gn,o)}function $_(o,c,f){var m=o.queue;if(m===null)throw Error(n(311));m.lastRenderedReducer=f;var x=o.baseQueue,T=m.pending;if(T!==null){if(x!==null){var P=x.next;x.next=T.next,T.next=P}c.baseQueue=x=T,m.pending=null}if(T=o.baseState,x===null)o.memoizedState=T;else{c=x.next;var O=P=null,q=null,ce=c,Ae=!1;do{var Ne=ce.lane&-536870913;if(Ne!==ce.lane?(Jt&Ne)===Ne:(wo&Ne)===Ne){var pe=ce.revertLane;if(pe===0)q!==null&&(q=q.next={lane:0,revertLane:0,action:ce.action,hasEagerState:ce.hasEagerState,eagerState:ce.eagerState,next:null}),Ne===ju&&(Ae=!0);else if((wo&pe)===pe){ce=ce.next,pe===ju&&(Ae=!0);continue}else Ne={lane:0,revertLane:ce.revertLane,action:ce.action,hasEagerState:ce.hasEagerState,eagerState:ce.eagerState,next:null},q===null?(O=q=Ne,P=T):q=q.next=Ne,Gt.lanes|=pe,Uo|=pe;Ne=ce.action,Il&&f(T,Ne),T=ce.hasEagerState?ce.eagerState:f(T,Ne)}else pe={lane:Ne,revertLane:ce.revertLane,action:ce.action,hasEagerState:ce.hasEagerState,eagerState:ce.eagerState,next:null},q===null?(O=q=pe,P=T):q=q.next=pe,Gt.lanes|=Ne,Uo|=Ne;ce=ce.next}while(ce!==null&&ce!==c);if(q===null?P=T:q.next=O,!zr(T,o.memoizedState)&&(Ri=!0,Ae&&(f=qu,f!==null)))throw f;o.memoizedState=T,o.baseState=P,o.baseQueue=q,m.lastRenderedState=T}return x===null&&(m.lanes=0),[o.memoizedState,m.dispatch]}function X_(o){var c=ai(),f=c.queue;if(f===null)throw Error(n(311));f.lastRenderedReducer=o;var m=f.dispatch,x=f.pending,T=c.memoizedState;if(x!==null){f.pending=null;var P=x=x.next;do T=o(T,P.action),P=P.next;while(P!==x);zr(T,c.memoizedState)||(Ri=!0),c.memoizedState=T,c.baseQueue===null&&(c.baseState=T),f.lastRenderedState=T}return[T,m]}function QA(o,c,f){var m=Gt,x=ai(),T=ln;if(T){if(f===void 0)throw Error(n(407));f=f()}else f=c();var P=!zr((gn||x).memoizedState,f);P&&(x.memoizedState=f,Ri=!0),x=x.queue;var O=tw.bind(null,m,x,o);if(Sf(2048,8,O,[o]),x.getSnapshot!==c||P||si!==null&&si.memoizedState.tag&1){if(m.flags|=2048,Ku(9,Cm(),ew.bind(null,m,x,f,c),null),Cn===null)throw Error(n(349));T||(wo&124)!==0||JA(m,c,f)}return f}function JA(o,c,f){o.flags|=16384,o={getSnapshot:c,value:f},c=Gt.updateQueue,c===null?(c=j_(),Gt.updateQueue=c,c.stores=[o]):(f=c.stores,f===null?c.stores=[o]:f.push(o))}function ew(o,c,f,m){c.value=f,c.getSnapshot=m,nw(c)&&iw(o)}function tw(o,c,f){return f(function(){nw(c)&&iw(o)})}function nw(o){var c=o.getSnapshot;o=o.value;try{var f=c();return!zr(o,f)}catch{return!0}}function iw(o){var c=Vu(o,2);c!==null&&qr(c,o,2)}function Y_(o){var c=Mr();if(typeof o=="function"){var f=o;if(o=f(),Il){Se(!0);try{f()}finally{Se(!1)}}}return c.memoizedState=c.baseState=o,c.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Na,lastRenderedState:o},c}function rw(o,c,f,m){return o.baseState=f,$_(o,gn,typeof m=="function"?m:Na)}function DF(o,c,f,m,x){if(Pm(o))throw Error(n(485));if(o=c.action,o!==null){var T={payload:x,action:o,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(P){T.listeners.push(P)}};z.T!==null?f(!0):T.isTransition=!1,m(T),f=c.pending,f===null?(T.next=c.pending=T,sw(c,T)):(T.next=f.next,c.pending=f.next=T)}}function sw(o,c){var f=c.action,m=c.payload,x=o.state;if(c.isTransition){var T=z.T,P={};z.T=P;try{var O=f(x,m),q=z.S;q!==null&&q(P,O),aw(o,c,O)}catch(ce){K_(o,c,ce)}finally{z.T=T}}else try{T=f(x,m),aw(o,c,T)}catch(ce){K_(o,c,ce)}}function aw(o,c,f){f!==null&&typeof f=="object"&&typeof f.then=="function"?f.then(function(m){ow(o,c,m)},function(m){return K_(o,c,m)}):ow(o,c,f)}function ow(o,c,f){c.status="fulfilled",c.value=f,lw(c),o.state=f,c=o.pending,c!==null&&(f=c.next,f===c?o.pending=null:(f=f.next,c.next=f,sw(o,f)))}function K_(o,c,f){var m=o.pending;if(o.pending=null,m!==null){m=m.next;do c.status="rejected",c.reason=f,lw(c),c=c.next;while(c!==m)}o.action=null}function lw(o){o=o.listeners;for(var c=0;c<o.length;c++)(0,o[c])()}function uw(o,c){return c}function cw(o,c){if(ln){var f=Cn.formState;if(f!==null){e:{var m=Gt;if(ln){if(jn){t:{for(var x=jn,T=js;x.nodeType!==8;){if(!T){x=null;break t}if(x=ws(x.nextSibling),x===null){x=null;break t}}T=x.data,x=T==="F!"||T==="F"?x:null}if(x){jn=ws(x.nextSibling),m=x.data==="F!";break e}}Ll(m)}m=!1}m&&(c=f[0])}}return f=Mr(),f.memoizedState=f.baseState=c,m={pending:null,lanes:0,dispatch:null,lastRenderedReducer:uw,lastRenderedState:c},f.queue=m,f=Cw.bind(null,Gt,m),m.dispatch=f,m=Y_(!1),T=t0.bind(null,Gt,!1,m.queue),m=Mr(),x={state:c,dispatch:null,action:o,pending:null},m.queue=x,f=DF.bind(null,Gt,x,T,f),x.dispatch=f,m.memoizedState=o,[c,f,!1]}function hw(o){var c=ai();return fw(c,gn,o)}function fw(o,c,f){if(c=$_(o,c,uw)[0],o=Rm(Na)[0],typeof c=="object"&&c!==null&&typeof c.then=="function")try{var m=bf(c)}catch(P){throw P===mf?Sm:P}else m=c;c=ai();var x=c.queue,T=x.dispatch;return f!==c.memoizedState&&(Gt.flags|=2048,Ku(9,Cm(),LF.bind(null,x,f),null)),[m,T,o]}function LF(o,c){o.action=c}function dw(o){var c=ai(),f=gn;if(f!==null)return fw(c,f,o);ai(),c=c.memoizedState,f=ai();var m=f.queue.dispatch;return f.memoizedState=o,[c,m,!1]}function Ku(o,c,f,m){return o={tag:o,create:f,deps:m,inst:c,next:null},c=Gt.updateQueue,c===null&&(c=j_(),Gt.updateQueue=c),f=c.lastEffect,f===null?c.lastEffect=o.next=o:(m=f.next,f.next=o,o.next=m,c.lastEffect=o),o}function Cm(){return{destroy:void 0,resource:void 0}}function pw(){return ai().memoizedState}function Nm(o,c,f,m){var x=Mr();m=m===void 0?null:m,Gt.flags|=o,x.memoizedState=Ku(1|c,Cm(),f,m)}function Sf(o,c,f,m){var x=ai();m=m===void 0?null:m;var T=x.memoizedState.inst;gn!==null&&m!==null&&z_(m,gn.memoizedState.deps)?x.memoizedState=Ku(c,T,f,m):(Gt.flags|=o,x.memoizedState=Ku(1|c,T,f,m))}function mw(o,c){Nm(8390656,8,o,c)}function gw(o,c){Sf(2048,8,o,c)}function yw(o,c){return Sf(4,2,o,c)}function vw(o,c){return Sf(4,4,o,c)}function _w(o,c){if(typeof c=="function"){o=o();var f=c(o);return function(){typeof f=="function"?f():c(null)}}if(c!=null)return o=o(),c.current=o,function(){c.current=null}}function xw(o,c,f){f=f!=null?f.concat([o]):null,Sf(4,4,_w.bind(null,c,o),f)}function Z_(){}function bw(o,c){var f=ai();c=c===void 0?null:c;var m=f.memoizedState;return c!==null&&z_(c,m[1])?m[0]:(f.memoizedState=[o,c],o)}function Sw(o,c){var f=ai();c=c===void 0?null:c;var m=f.memoizedState;if(c!==null&&z_(c,m[1]))return m[0];if(m=o(),Il){Se(!0);try{o()}finally{Se(!1)}}return f.memoizedState=[m,c],m}function Q_(o,c,f){return f===void 0||(wo&1073741824)!==0?o.memoizedState=c:(o.memoizedState=f,o=E1(),Gt.lanes|=o,Uo|=o,f)}function Tw(o,c,f,m){return zr(f,c)?f:$u.current!==null?(o=Q_(o,f,m),zr(o,c)||(Ri=!0),o):(wo&42)===0?(Ri=!0,o.memoizedState=f):(o=E1(),Gt.lanes|=o,Uo|=o,c)}function Mw(o,c,f,m,x){var T=k.p;k.p=T!==0&&8>T?T:8;var P=z.T,O={};z.T=O,t0(o,!1,c,f);try{var q=x(),ce=z.S;if(ce!==null&&ce(O,q),q!==null&&typeof q=="object"&&typeof q.then=="function"){var Ae=CF(q,m);Tf(o,c,Ae,jr(o))}else Tf(o,c,m,jr(o))}catch(Ne){Tf(o,c,{then:function(){},status:"rejected",reason:Ne},jr())}finally{k.p=T,z.T=P}}function UF(){}function J_(o,c,f,m){if(o.tag!==5)throw Error(n(476));var x=Ew(o).queue;Mw(o,x,c,G,f===null?UF:function(){return Aw(o),f(m)})}function Ew(o){var c=o.memoizedState;if(c!==null)return c;c={memoizedState:G,baseState:G,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Na,lastRenderedState:G},next:null};var f={};return c.next={memoizedState:f,baseState:f,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Na,lastRenderedState:f},next:null},o.memoizedState=c,o=o.alternate,o!==null&&(o.memoizedState=c),c}function Aw(o){var c=Ew(o).next.queue;Tf(o,c,{},jr())}function e0(){return Xi(Vf)}function ww(){return ai().memoizedState}function Rw(){return ai().memoizedState}function OF(o){for(var c=o.return;c!==null;){switch(c.tag){case 24:case 3:var f=jr();o=Eo(f);var m=Ao(c,o,f);m!==null&&(qr(m,c,f),yf(m,c,f)),c={cache:N_()},o.payload=c;return}c=c.return}}function BF(o,c,f){var m=jr();f={lane:m,revertLane:0,action:f,hasEagerState:!1,eagerState:null,next:null},Pm(o)?Nw(c,f):(f=x_(o,c,f,m),f!==null&&(qr(f,o,m),Pw(f,c,m)))}function Cw(o,c,f){var m=jr();Tf(o,c,f,m)}function Tf(o,c,f,m){var x={lane:m,revertLane:0,action:f,hasEagerState:!1,eagerState:null,next:null};if(Pm(o))Nw(c,x);else{var T=o.alternate;if(o.lanes===0&&(T===null||T.lanes===0)&&(T=c.lastRenderedReducer,T!==null))try{var P=c.lastRenderedState,O=T(P,f);if(x.hasEagerState=!0,x.eagerState=O,zr(O,P))return pm(o,c,x,0),Cn===null&&dm(),!1}catch{}finally{}if(f=x_(o,c,x,m),f!==null)return qr(f,o,m),Pw(f,c,m),!0}return!1}function t0(o,c,f,m){if(m={lane:2,revertLane:L0(),action:m,hasEagerState:!1,eagerState:null,next:null},Pm(o)){if(c)throw Error(n(479))}else c=x_(o,f,m,2),c!==null&&qr(c,o,2)}function Pm(o){var c=o.alternate;return o===Gt||c!==null&&c===Gt}function Nw(o,c){Xu=Em=!0;var f=o.pending;f===null?c.next=c:(c.next=f.next,f.next=c),o.pending=c}function Pw(o,c,f){if((f&4194048)!==0){var m=c.lanes;m&=o.pendingLanes,f|=m,c.lanes=f,nt(o,f)}}var Dm={readContext:Xi,use:wm,useCallback:Kn,useContext:Kn,useEffect:Kn,useImperativeHandle:Kn,useLayoutEffect:Kn,useInsertionEffect:Kn,useMemo:Kn,useReducer:Kn,useRef:Kn,useState:Kn,useDebugValue:Kn,useDeferredValue:Kn,useTransition:Kn,useSyncExternalStore:Kn,useId:Kn,useHostTransitionStatus:Kn,useFormState:Kn,useActionState:Kn,useOptimistic:Kn,useMemoCache:Kn,useCacheRefresh:Kn},Dw={readContext:Xi,use:wm,useCallback:function(o,c){return Mr().memoizedState=[o,c===void 0?null:c],o},useContext:Xi,useEffect:mw,useImperativeHandle:function(o,c,f){f=f!=null?f.concat([o]):null,Nm(4194308,4,_w.bind(null,c,o),f)},useLayoutEffect:function(o,c){return Nm(4194308,4,o,c)},useInsertionEffect:function(o,c){Nm(4,2,o,c)},useMemo:function(o,c){var f=Mr();c=c===void 0?null:c;var m=o();if(Il){Se(!0);try{o()}finally{Se(!1)}}return f.memoizedState=[m,c],m},useReducer:function(o,c,f){var m=Mr();if(f!==void 0){var x=f(c);if(Il){Se(!0);try{f(c)}finally{Se(!1)}}}else x=c;return m.memoizedState=m.baseState=x,o={pending:null,lanes:0,dispatch:null,lastRenderedReducer:o,lastRenderedState:x},m.queue=o,o=o.dispatch=BF.bind(null,Gt,o),[m.memoizedState,o]},useRef:function(o){var c=Mr();return o={current:o},c.memoizedState=o},useState:function(o){o=Y_(o);var c=o.queue,f=Cw.bind(null,Gt,c);return c.dispatch=f,[o.memoizedState,f]},useDebugValue:Z_,useDeferredValue:function(o,c){var f=Mr();return Q_(f,o,c)},useTransition:function(){var o=Y_(!1);return o=Mw.bind(null,Gt,o.queue,!0,!1),Mr().memoizedState=o,[!1,o]},useSyncExternalStore:function(o,c,f){var m=Gt,x=Mr();if(ln){if(f===void 0)throw Error(n(407));f=f()}else{if(f=c(),Cn===null)throw Error(n(349));(Jt&124)!==0||JA(m,c,f)}x.memoizedState=f;var T={value:f,getSnapshot:c};return x.queue=T,mw(tw.bind(null,m,T,o),[o]),m.flags|=2048,Ku(9,Cm(),ew.bind(null,m,T,f,c),null),f},useId:function(){var o=Mr(),c=Cn.identifierPrefix;if(ln){var f=wa,m=Aa;f=(m&~(1<<32-Qe(m)-1)).toString(32)+f,c="«"+c+"R"+f,f=Am++,0<f&&(c+="H"+f.toString(32)),c+="»"}else f=NF++,c="«"+c+"r"+f.toString(32)+"»";return o.memoizedState=c},useHostTransitionStatus:e0,useFormState:cw,useActionState:cw,useOptimistic:function(o){var c=Mr();c.memoizedState=c.baseState=o;var f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return c.queue=f,c=t0.bind(null,Gt,!0,f),f.dispatch=c,[o,c]},useMemoCache:q_,useCacheRefresh:function(){return Mr().memoizedState=OF.bind(null,Gt)}},Lw={readContext:Xi,use:wm,useCallback:bw,useContext:Xi,useEffect:gw,useImperativeHandle:xw,useInsertionEffect:yw,useLayoutEffect:vw,useMemo:Sw,useReducer:Rm,useRef:pw,useState:function(){return Rm(Na)},useDebugValue:Z_,useDeferredValue:function(o,c){var f=ai();return Tw(f,gn.memoizedState,o,c)},useTransition:function(){var o=Rm(Na)[0],c=ai().memoizedState;return[typeof o=="boolean"?o:bf(o),c]},useSyncExternalStore:QA,useId:ww,useHostTransitionStatus:e0,useFormState:hw,useActionState:hw,useOptimistic:function(o,c){var f=ai();return rw(f,gn,o,c)},useMemoCache:q_,useCacheRefresh:Rw},IF={readContext:Xi,use:wm,useCallback:bw,useContext:Xi,useEffect:gw,useImperativeHandle:xw,useInsertionEffect:yw,useLayoutEffect:vw,useMemo:Sw,useReducer:X_,useRef:pw,useState:function(){return X_(Na)},useDebugValue:Z_,useDeferredValue:function(o,c){var f=ai();return gn===null?Q_(f,o,c):Tw(f,gn.memoizedState,o,c)},useTransition:function(){var o=X_(Na)[0],c=ai().memoizedState;return[typeof o=="boolean"?o:bf(o),c]},useSyncExternalStore:QA,useId:ww,useHostTransitionStatus:e0,useFormState:dw,useActionState:dw,useOptimistic:function(o,c){var f=ai();return gn!==null?rw(f,gn,o,c):(f.baseState=o,[o,f.queue.dispatch])},useMemoCache:q_,useCacheRefresh:Rw},Zu=null,Mf=0;function Lm(o){var c=Mf;return Mf+=1,Zu===null&&(Zu=[]),WA(Zu,o,c)}function Ef(o,c){c=c.props.ref,o.ref=c!==void 0?c:null}function Um(o,c){throw c.$$typeof===p?Error(n(525)):(o=Object.prototype.toString.call(c),Error(n(31,o==="[object Object]"?"object with keys {"+Object.keys(c).join(", ")+"}":o)))}function Uw(o){var c=o._init;return c(o._payload)}function Ow(o){function c(te,Q){if(o){var ue=te.deletions;ue===null?(te.deletions=[Q],te.flags|=16):ue.push(Q)}}function f(te,Q){if(!o)return null;for(;Q!==null;)c(te,Q),Q=Q.sibling;return null}function m(te){for(var Q=new Map;te!==null;)te.key!==null?Q.set(te.key,te):Q.set(te.index,te),te=te.sibling;return Q}function x(te,Q){return te=Ea(te,Q),te.index=0,te.sibling=null,te}function T(te,Q,ue){return te.index=ue,o?(ue=te.alternate,ue!==null?(ue=ue.index,ue<Q?(te.flags|=67108866,Q):ue):(te.flags|=67108866,Q)):(te.flags|=1048576,Q)}function P(te){return o&&te.alternate===null&&(te.flags|=67108866),te}function O(te,Q,ue,Re){return Q===null||Q.tag!==6?(Q=S_(ue,te.mode,Re),Q.return=te,Q):(Q=x(Q,ue),Q.return=te,Q)}function q(te,Q,ue,Re){var it=ue.type;return it===v?Ae(te,Q,ue.props.children,Re,ue.key):Q!==null&&(Q.elementType===it||typeof it=="object"&&it!==null&&it.$$typeof===L&&Uw(it)===Q.type)?(Q=x(Q,ue.props),Ef(Q,ue),Q.return=te,Q):(Q=gm(ue.type,ue.key,ue.props,null,te.mode,Re),Ef(Q,ue),Q.return=te,Q)}function ce(te,Q,ue,Re){return Q===null||Q.tag!==4||Q.stateNode.containerInfo!==ue.containerInfo||Q.stateNode.implementation!==ue.implementation?(Q=T_(ue,te.mode,Re),Q.return=te,Q):(Q=x(Q,ue.children||[]),Q.return=te,Q)}function Ae(te,Q,ue,Re,it){return Q===null||Q.tag!==7?(Q=Cl(ue,te.mode,Re,it),Q.return=te,Q):(Q=x(Q,ue),Q.return=te,Q)}function Ne(te,Q,ue){if(typeof Q=="string"&&Q!==""||typeof Q=="number"||typeof Q=="bigint")return Q=S_(""+Q,te.mode,ue),Q.return=te,Q;if(typeof Q=="object"&&Q!==null){switch(Q.$$typeof){case g:return ue=gm(Q.type,Q.key,Q.props,null,te.mode,ue),Ef(ue,Q),ue.return=te,ue;case y:return Q=T_(Q,te.mode,ue),Q.return=te,Q;case L:var Re=Q._init;return Q=Re(Q._payload),Ne(te,Q,ue)}if(le(Q)||W(Q))return Q=Cl(Q,te.mode,ue,null),Q.return=te,Q;if(typeof Q.then=="function")return Ne(te,Lm(Q),ue);if(Q.$$typeof===M)return Ne(te,xm(te,Q),ue);Um(te,Q)}return null}function pe(te,Q,ue,Re){var it=Q!==null?Q.key:null;if(typeof ue=="string"&&ue!==""||typeof ue=="number"||typeof ue=="bigint")return it!==null?null:O(te,Q,""+ue,Re);if(typeof ue=="object"&&ue!==null){switch(ue.$$typeof){case g:return ue.key===it?q(te,Q,ue,Re):null;case y:return ue.key===it?ce(te,Q,ue,Re):null;case L:return it=ue._init,ue=it(ue._payload),pe(te,Q,ue,Re)}if(le(ue)||W(ue))return it!==null?null:Ae(te,Q,ue,Re,null);if(typeof ue.then=="function")return pe(te,Q,Lm(ue),Re);if(ue.$$typeof===M)return pe(te,Q,xm(te,ue),Re);Um(te,ue)}return null}function me(te,Q,ue,Re,it){if(typeof Re=="string"&&Re!==""||typeof Re=="number"||typeof Re=="bigint")return te=te.get(ue)||null,O(Q,te,""+Re,it);if(typeof Re=="object"&&Re!==null){switch(Re.$$typeof){case g:return te=te.get(Re.key===null?ue:Re.key)||null,q(Q,te,Re,it);case y:return te=te.get(Re.key===null?ue:Re.key)||null,ce(Q,te,Re,it);case L:var qt=Re._init;return Re=qt(Re._payload),me(te,Q,ue,Re,it)}if(le(Re)||W(Re))return te=te.get(ue)||null,Ae(Q,te,Re,it,null);if(typeof Re.then=="function")return me(te,Q,ue,Lm(Re),it);if(Re.$$typeof===M)return me(te,Q,ue,xm(Q,Re),it);Um(Q,Re)}return null}function St(te,Q,ue,Re){for(var it=null,qt=null,ht=Q,_t=Q=0,Ni=null;ht!==null&&_t<ue.length;_t++){ht.index>_t?(Ni=ht,ht=null):Ni=ht.sibling;var sn=pe(te,ht,ue[_t],Re);if(sn===null){ht===null&&(ht=Ni);break}o&&ht&&sn.alternate===null&&c(te,ht),Q=T(sn,Q,_t),qt===null?it=sn:qt.sibling=sn,qt=sn,ht=Ni}if(_t===ue.length)return f(te,ht),ln&&Pl(te,_t),it;if(ht===null){for(;_t<ue.length;_t++)ht=Ne(te,ue[_t],Re),ht!==null&&(Q=T(ht,Q,_t),qt===null?it=ht:qt.sibling=ht,qt=ht);return ln&&Pl(te,_t),it}for(ht=m(ht);_t<ue.length;_t++)Ni=me(ht,te,_t,ue[_t],Re),Ni!==null&&(o&&Ni.alternate!==null&&ht.delete(Ni.key===null?_t:Ni.key),Q=T(Ni,Q,_t),qt===null?it=Ni:qt.sibling=Ni,qt=Ni);return o&&ht.forEach(function(Ho){return c(te,Ho)}),ln&&Pl(te,_t),it}function yt(te,Q,ue,Re){if(ue==null)throw Error(n(151));for(var it=null,qt=null,ht=Q,_t=Q=0,Ni=null,sn=ue.next();ht!==null&&!sn.done;_t++,sn=ue.next()){ht.index>_t?(Ni=ht,ht=null):Ni=ht.sibling;var Ho=pe(te,ht,sn.value,Re);if(Ho===null){ht===null&&(ht=Ni);break}o&&ht&&Ho.alternate===null&&c(te,ht),Q=T(Ho,Q,_t),qt===null?it=Ho:qt.sibling=Ho,qt=Ho,ht=Ni}if(sn.done)return f(te,ht),ln&&Pl(te,_t),it;if(ht===null){for(;!sn.done;_t++,sn=ue.next())sn=Ne(te,sn.value,Re),sn!==null&&(Q=T(sn,Q,_t),qt===null?it=sn:qt.sibling=sn,qt=sn);return ln&&Pl(te,_t),it}for(ht=m(ht);!sn.done;_t++,sn=ue.next())sn=me(ht,te,_t,sn.value,Re),sn!==null&&(o&&sn.alternate!==null&&ht.delete(sn.key===null?_t:sn.key),Q=T(sn,Q,_t),qt===null?it=sn:qt.sibling=sn,qt=sn);return o&&ht.forEach(function(Fk){return c(te,Fk)}),ln&&Pl(te,_t),it}function vn(te,Q,ue,Re){if(typeof ue=="object"&&ue!==null&&ue.type===v&&ue.key===null&&(ue=ue.props.children),typeof ue=="object"&&ue!==null){switch(ue.$$typeof){case g:e:{for(var it=ue.key;Q!==null;){if(Q.key===it){if(it=ue.type,it===v){if(Q.tag===7){f(te,Q.sibling),Re=x(Q,ue.props.children),Re.return=te,te=Re;break e}}else if(Q.elementType===it||typeof it=="object"&&it!==null&&it.$$typeof===L&&Uw(it)===Q.type){f(te,Q.sibling),Re=x(Q,ue.props),Ef(Re,ue),Re.return=te,te=Re;break e}f(te,Q);break}else c(te,Q);Q=Q.sibling}ue.type===v?(Re=Cl(ue.props.children,te.mode,Re,ue.key),Re.return=te,te=Re):(Re=gm(ue.type,ue.key,ue.props,null,te.mode,Re),Ef(Re,ue),Re.return=te,te=Re)}return P(te);case y:e:{for(it=ue.key;Q!==null;){if(Q.key===it)if(Q.tag===4&&Q.stateNode.containerInfo===ue.containerInfo&&Q.stateNode.implementation===ue.implementation){f(te,Q.sibling),Re=x(Q,ue.children||[]),Re.return=te,te=Re;break e}else{f(te,Q);break}else c(te,Q);Q=Q.sibling}Re=T_(ue,te.mode,Re),Re.return=te,te=Re}return P(te);case L:return it=ue._init,ue=it(ue._payload),vn(te,Q,ue,Re)}if(le(ue))return St(te,Q,ue,Re);if(W(ue)){if(it=W(ue),typeof it!="function")throw Error(n(150));return ue=it.call(ue),yt(te,Q,ue,Re)}if(typeof ue.then=="function")return vn(te,Q,Lm(ue),Re);if(ue.$$typeof===M)return vn(te,Q,xm(te,ue),Re);Um(te,ue)}return typeof ue=="string"&&ue!==""||typeof ue=="number"||typeof ue=="bigint"?(ue=""+ue,Q!==null&&Q.tag===6?(f(te,Q.sibling),Re=x(Q,ue),Re.return=te,te=Re):(f(te,Q),Re=S_(ue,te.mode,Re),Re.return=te,te=Re),P(te)):f(te,Q)}return function(te,Q,ue,Re){try{Mf=0;var it=vn(te,Q,ue,Re);return Zu=null,it}catch(ht){if(ht===mf||ht===Sm)throw ht;var qt=Vr(29,ht,null,te.mode);return qt.lanes=Re,qt.return=te,qt}finally{}}}var Qu=Ow(!0),Bw=Ow(!1),cs=se(null),qs=null;function Ro(o){var c=o.alternate;De(xi,xi.current&1),De(cs,o),qs===null&&(c===null||$u.current!==null||c.memoizedState!==null)&&(qs=o)}function Iw(o){if(o.tag===22){if(De(xi,xi.current),De(cs,o),qs===null){var c=o.alternate;c!==null&&c.memoizedState!==null&&(qs=o)}}else Co()}function Co(){De(xi,xi.current),De(cs,cs.current)}function Pa(o){Me(cs),qs===o&&(qs=null),Me(xi)}var xi=se(0);function Om(o){for(var c=o;c!==null;){if(c.tag===13){var f=c.memoizedState;if(f!==null&&(f=f.dehydrated,f===null||f.data==="$?"||j0(f)))return c}else if(c.tag===19&&c.memoizedProps.revealOrder!==void 0){if((c.flags&128)!==0)return c}else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===o)break;for(;c.sibling===null;){if(c.return===null||c.return===o)return null;c=c.return}c.sibling.return=c.return,c=c.sibling}return null}function n0(o,c,f,m){c=o.memoizedState,f=f(m,c),f=f==null?c:d({},c,f),o.memoizedState=f,o.lanes===0&&(o.updateQueue.baseState=f)}var i0={enqueueSetState:function(o,c,f){o=o._reactInternals;var m=jr(),x=Eo(m);x.payload=c,f!=null&&(x.callback=f),c=Ao(o,x,m),c!==null&&(qr(c,o,m),yf(c,o,m))},enqueueReplaceState:function(o,c,f){o=o._reactInternals;var m=jr(),x=Eo(m);x.tag=1,x.payload=c,f!=null&&(x.callback=f),c=Ao(o,x,m),c!==null&&(qr(c,o,m),yf(c,o,m))},enqueueForceUpdate:function(o,c){o=o._reactInternals;var f=jr(),m=Eo(f);m.tag=2,c!=null&&(m.callback=c),c=Ao(o,m,f),c!==null&&(qr(c,o,f),yf(c,o,f))}};function Fw(o,c,f,m,x,T,P){return o=o.stateNode,typeof o.shouldComponentUpdate=="function"?o.shouldComponentUpdate(m,T,P):c.prototype&&c.prototype.isPureReactComponent?!of(f,m)||!of(x,T):!0}function kw(o,c,f,m){o=c.state,typeof c.componentWillReceiveProps=="function"&&c.componentWillReceiveProps(f,m),typeof c.UNSAFE_componentWillReceiveProps=="function"&&c.UNSAFE_componentWillReceiveProps(f,m),c.state!==o&&i0.enqueueReplaceState(c,c.state,null)}function Fl(o,c){var f=c;if("ref"in c){f={};for(var m in c)m!=="ref"&&(f[m]=c[m])}if(o=o.defaultProps){f===c&&(f=d({},f));for(var x in o)f[x]===void 0&&(f[x]=o[x])}return f}var Bm=typeof reportError=="function"?reportError:function(o){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var c=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof o=="object"&&o!==null&&typeof o.message=="string"?String(o.message):String(o),error:o});if(!window.dispatchEvent(c))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",o);return}console.error(o)};function zw(o){Bm(o)}function Vw(o){console.error(o)}function Gw(o){Bm(o)}function Im(o,c){try{var f=o.onUncaughtError;f(c.value,{componentStack:c.stack})}catch(m){setTimeout(function(){throw m})}}function Hw(o,c,f){try{var m=o.onCaughtError;m(f.value,{componentStack:f.stack,errorBoundary:c.tag===1?c.stateNode:null})}catch(x){setTimeout(function(){throw x})}}function r0(o,c,f){return f=Eo(f),f.tag=3,f.payload={element:null},f.callback=function(){Im(o,c)},f}function Ww(o){return o=Eo(o),o.tag=3,o}function jw(o,c,f,m){var x=f.type.getDerivedStateFromError;if(typeof x=="function"){var T=m.value;o.payload=function(){return x(T)},o.callback=function(){Hw(c,f,m)}}var P=f.stateNode;P!==null&&typeof P.componentDidCatch=="function"&&(o.callback=function(){Hw(c,f,m),typeof x!="function"&&(Oo===null?Oo=new Set([this]):Oo.add(this));var O=m.stack;this.componentDidCatch(m.value,{componentStack:O!==null?O:""})})}function FF(o,c,f,m,x){if(f.flags|=32768,m!==null&&typeof m=="object"&&typeof m.then=="function"){if(c=f.alternate,c!==null&&ff(c,f,x,!0),f=cs.current,f!==null){switch(f.tag){case 13:return qs===null?R0():f.alternate===null&&qn===0&&(qn=3),f.flags&=-257,f.flags|=65536,f.lanes=x,m===L_?f.flags|=16384:(c=f.updateQueue,c===null?f.updateQueue=new Set([m]):c.add(m),N0(o,m,x)),!1;case 22:return f.flags|=65536,m===L_?f.flags|=16384:(c=f.updateQueue,c===null?(c={transitions:null,markerInstances:null,retryQueue:new Set([m])},f.updateQueue=c):(f=c.retryQueue,f===null?c.retryQueue=new Set([m]):f.add(m)),N0(o,m,x)),!1}throw Error(n(435,f.tag))}return N0(o,m,x),R0(),!1}if(ln)return c=cs.current,c!==null?((c.flags&65536)===0&&(c.flags|=256),c.flags|=65536,c.lanes=x,m!==A_&&(o=Error(n(422),{cause:m}),hf(as(o,f)))):(m!==A_&&(c=Error(n(423),{cause:m}),hf(as(c,f))),o=o.current.alternate,o.flags|=65536,x&=-x,o.lanes|=x,m=as(m,f),x=r0(o.stateNode,m,x),B_(o,x),qn!==4&&(qn=2)),!1;var T=Error(n(520),{cause:m});if(T=as(T,f),Df===null?Df=[T]:Df.push(T),qn!==4&&(qn=2),c===null)return!0;m=as(m,f),f=c;do{switch(f.tag){case 3:return f.flags|=65536,o=x&-x,f.lanes|=o,o=r0(f.stateNode,m,o),B_(f,o),!1;case 1:if(c=f.type,T=f.stateNode,(f.flags&128)===0&&(typeof c.getDerivedStateFromError=="function"||T!==null&&typeof T.componentDidCatch=="function"&&(Oo===null||!Oo.has(T))))return f.flags|=65536,x&=-x,f.lanes|=x,x=Ww(x),jw(x,o,f,m),B_(f,x),!1}f=f.return}while(f!==null);return!1}var qw=Error(n(461)),Ri=!1;function Fi(o,c,f,m){c.child=o===null?Bw(c,null,f,m):Qu(c,o.child,f,m)}function $w(o,c,f,m,x){f=f.render;var T=c.ref;if("ref"in m){var P={};for(var O in m)O!=="ref"&&(P[O]=m[O])}else P=m;return Ol(c),m=V_(o,c,f,P,T,x),O=G_(),o!==null&&!Ri?(H_(o,c,x),Da(o,c,x)):(ln&&O&&M_(c),c.flags|=1,Fi(o,c,m,x),c.child)}function Xw(o,c,f,m,x){if(o===null){var T=f.type;return typeof T=="function"&&!b_(T)&&T.defaultProps===void 0&&f.compare===null?(c.tag=15,c.type=T,Yw(o,c,T,m,x)):(o=gm(f.type,null,m,c,c.mode,x),o.ref=c.ref,o.return=c,c.child=o)}if(T=o.child,!f0(o,x)){var P=T.memoizedProps;if(f=f.compare,f=f!==null?f:of,f(P,m)&&o.ref===c.ref)return Da(o,c,x)}return c.flags|=1,o=Ea(T,m),o.ref=c.ref,o.return=c,c.child=o}function Yw(o,c,f,m,x){if(o!==null){var T=o.memoizedProps;if(of(T,m)&&o.ref===c.ref)if(Ri=!1,c.pendingProps=m=T,f0(o,x))(o.flags&131072)!==0&&(Ri=!0);else return c.lanes=o.lanes,Da(o,c,x)}return s0(o,c,f,m,x)}function Kw(o,c,f){var m=c.pendingProps,x=m.children,T=o!==null?o.memoizedState:null;if(m.mode==="hidden"){if((c.flags&128)!==0){if(m=T!==null?T.baseLanes|f:f,o!==null){for(x=c.child=o.child,T=0;x!==null;)T=T|x.lanes|x.childLanes,x=x.sibling;c.childLanes=T&~m}else c.childLanes=0,c.child=null;return Zw(o,c,m,f)}if((f&536870912)!==0)c.memoizedState={baseLanes:0,cachePool:null},o!==null&&bm(c,T!==null?T.cachePool:null),T!==null?YA(c,T):F_(),Iw(c);else return c.lanes=c.childLanes=536870912,Zw(o,c,T!==null?T.baseLanes|f:f,f)}else T!==null?(bm(c,T.cachePool),YA(c,T),Co(),c.memoizedState=null):(o!==null&&bm(c,null),F_(),Co());return Fi(o,c,x,f),c.child}function Zw(o,c,f,m){var x=D_();return x=x===null?null:{parent:_i._currentValue,pool:x},c.memoizedState={baseLanes:f,cachePool:x},o!==null&&bm(c,null),F_(),Iw(c),o!==null&&ff(o,c,m,!0),null}function Fm(o,c){var f=c.ref;if(f===null)o!==null&&o.ref!==null&&(c.flags|=4194816);else{if(typeof f!="function"&&typeof f!="object")throw Error(n(284));(o===null||o.ref!==f)&&(c.flags|=4194816)}}function s0(o,c,f,m,x){return Ol(c),f=V_(o,c,f,m,void 0,x),m=G_(),o!==null&&!Ri?(H_(o,c,x),Da(o,c,x)):(ln&&m&&M_(c),c.flags|=1,Fi(o,c,f,x),c.child)}function Qw(o,c,f,m,x,T){return Ol(c),c.updateQueue=null,f=ZA(c,m,f,x),KA(o),m=G_(),o!==null&&!Ri?(H_(o,c,T),Da(o,c,T)):(ln&&m&&M_(c),c.flags|=1,Fi(o,c,f,T),c.child)}function Jw(o,c,f,m,x){if(Ol(c),c.stateNode===null){var T=Gu,P=f.contextType;typeof P=="object"&&P!==null&&(T=Xi(P)),T=new f(m,T),c.memoizedState=T.state!==null&&T.state!==void 0?T.state:null,T.updater=i0,c.stateNode=T,T._reactInternals=c,T=c.stateNode,T.props=m,T.state=c.memoizedState,T.refs={},U_(c),P=f.contextType,T.context=typeof P=="object"&&P!==null?Xi(P):Gu,T.state=c.memoizedState,P=f.getDerivedStateFromProps,typeof P=="function"&&(n0(c,f,P,m),T.state=c.memoizedState),typeof f.getDerivedStateFromProps=="function"||typeof T.getSnapshotBeforeUpdate=="function"||typeof T.UNSAFE_componentWillMount!="function"&&typeof T.componentWillMount!="function"||(P=T.state,typeof T.componentWillMount=="function"&&T.componentWillMount(),typeof T.UNSAFE_componentWillMount=="function"&&T.UNSAFE_componentWillMount(),P!==T.state&&i0.enqueueReplaceState(T,T.state,null),_f(c,m,T,x),vf(),T.state=c.memoizedState),typeof T.componentDidMount=="function"&&(c.flags|=4194308),m=!0}else if(o===null){T=c.stateNode;var O=c.memoizedProps,q=Fl(f,O);T.props=q;var ce=T.context,Ae=f.contextType;P=Gu,typeof Ae=="object"&&Ae!==null&&(P=Xi(Ae));var Ne=f.getDerivedStateFromProps;Ae=typeof Ne=="function"||typeof T.getSnapshotBeforeUpdate=="function",O=c.pendingProps!==O,Ae||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||(O||ce!==P)&&kw(c,T,m,P),Mo=!1;var pe=c.memoizedState;T.state=pe,_f(c,m,T,x),vf(),ce=c.memoizedState,O||pe!==ce||Mo?(typeof Ne=="function"&&(n0(c,f,Ne,m),ce=c.memoizedState),(q=Mo||Fw(c,f,q,m,pe,ce,P))?(Ae||typeof T.UNSAFE_componentWillMount!="function"&&typeof T.componentWillMount!="function"||(typeof T.componentWillMount=="function"&&T.componentWillMount(),typeof T.UNSAFE_componentWillMount=="function"&&T.UNSAFE_componentWillMount()),typeof T.componentDidMount=="function"&&(c.flags|=4194308)):(typeof T.componentDidMount=="function"&&(c.flags|=4194308),c.memoizedProps=m,c.memoizedState=ce),T.props=m,T.state=ce,T.context=P,m=q):(typeof T.componentDidMount=="function"&&(c.flags|=4194308),m=!1)}else{T=c.stateNode,O_(o,c),P=c.memoizedProps,Ae=Fl(f,P),T.props=Ae,Ne=c.pendingProps,pe=T.context,ce=f.contextType,q=Gu,typeof ce=="object"&&ce!==null&&(q=Xi(ce)),O=f.getDerivedStateFromProps,(ce=typeof O=="function"||typeof T.getSnapshotBeforeUpdate=="function")||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||(P!==Ne||pe!==q)&&kw(c,T,m,q),Mo=!1,pe=c.memoizedState,T.state=pe,_f(c,m,T,x),vf();var me=c.memoizedState;P!==Ne||pe!==me||Mo||o!==null&&o.dependencies!==null&&_m(o.dependencies)?(typeof O=="function"&&(n0(c,f,O,m),me=c.memoizedState),(Ae=Mo||Fw(c,f,Ae,m,pe,me,q)||o!==null&&o.dependencies!==null&&_m(o.dependencies))?(ce||typeof T.UNSAFE_componentWillUpdate!="function"&&typeof T.componentWillUpdate!="function"||(typeof T.componentWillUpdate=="function"&&T.componentWillUpdate(m,me,q),typeof T.UNSAFE_componentWillUpdate=="function"&&T.UNSAFE_componentWillUpdate(m,me,q)),typeof T.componentDidUpdate=="function"&&(c.flags|=4),typeof T.getSnapshotBeforeUpdate=="function"&&(c.flags|=1024)):(typeof T.componentDidUpdate!="function"||P===o.memoizedProps&&pe===o.memoizedState||(c.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||P===o.memoizedProps&&pe===o.memoizedState||(c.flags|=1024),c.memoizedProps=m,c.memoizedState=me),T.props=m,T.state=me,T.context=q,m=Ae):(typeof T.componentDidUpdate!="function"||P===o.memoizedProps&&pe===o.memoizedState||(c.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||P===o.memoizedProps&&pe===o.memoizedState||(c.flags|=1024),m=!1)}return T=m,Fm(o,c),m=(c.flags&128)!==0,T||m?(T=c.stateNode,f=m&&typeof f.getDerivedStateFromError!="function"?null:T.render(),c.flags|=1,o!==null&&m?(c.child=Qu(c,o.child,null,x),c.child=Qu(c,null,f,x)):Fi(o,c,f,x),c.memoizedState=T.state,o=c.child):o=Da(o,c,x),o}function e1(o,c,f,m){return cf(),c.flags|=256,Fi(o,c,f,m),c.child}var a0={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function o0(o){return{baseLanes:o,cachePool:VA()}}function l0(o,c,f){return o=o!==null?o.childLanes&~f:0,c&&(o|=hs),o}function t1(o,c,f){var m=c.pendingProps,x=!1,T=(c.flags&128)!==0,P;if((P=T)||(P=o!==null&&o.memoizedState===null?!1:(xi.current&2)!==0),P&&(x=!0,c.flags&=-129),P=(c.flags&32)!==0,c.flags&=-33,o===null){if(ln){if(x?Ro(c):Co(),ln){var O=jn,q;if(q=O){e:{for(q=O,O=js;q.nodeType!==8;){if(!O){O=null;break e}if(q=ws(q.nextSibling),q===null){O=null;break e}}O=q}O!==null?(c.memoizedState={dehydrated:O,treeContext:Nl!==null?{id:Aa,overflow:wa}:null,retryLane:536870912,hydrationErrors:null},q=Vr(18,null,null,0),q.stateNode=O,q.return=c,c.child=q,or=c,jn=null,q=!0):q=!1}q||Ll(c)}if(O=c.memoizedState,O!==null&&(O=O.dehydrated,O!==null))return j0(O)?c.lanes=32:c.lanes=536870912,null;Pa(c)}return O=m.children,m=m.fallback,x?(Co(),x=c.mode,O=km({mode:"hidden",children:O},x),m=Cl(m,x,f,null),O.return=c,m.return=c,O.sibling=m,c.child=O,x=c.child,x.memoizedState=o0(f),x.childLanes=l0(o,P,f),c.memoizedState=a0,m):(Ro(c),u0(c,O))}if(q=o.memoizedState,q!==null&&(O=q.dehydrated,O!==null)){if(T)c.flags&256?(Ro(c),c.flags&=-257,c=c0(o,c,f)):c.memoizedState!==null?(Co(),c.child=o.child,c.flags|=128,c=null):(Co(),x=m.fallback,O=c.mode,m=km({mode:"visible",children:m.children},O),x=Cl(x,O,f,null),x.flags|=2,m.return=c,x.return=c,m.sibling=x,c.child=m,Qu(c,o.child,null,f),m=c.child,m.memoizedState=o0(f),m.childLanes=l0(o,P,f),c.memoizedState=a0,c=x);else if(Ro(c),j0(O)){if(P=O.nextSibling&&O.nextSibling.dataset,P)var ce=P.dgst;P=ce,m=Error(n(419)),m.stack="",m.digest=P,hf({value:m,source:null,stack:null}),c=c0(o,c,f)}else if(Ri||ff(o,c,f,!1),P=(f&o.childLanes)!==0,Ri||P){if(P=Cn,P!==null&&(m=f&-f,m=(m&42)!==0?1:At(m),m=(m&(P.suspendedLanes|f))!==0?0:m,m!==0&&m!==q.retryLane))throw q.retryLane=m,Vu(o,m),qr(P,o,m),qw;O.data==="$?"||R0(),c=c0(o,c,f)}else O.data==="$?"?(c.flags|=192,c.child=o.child,c=null):(o=q.treeContext,jn=ws(O.nextSibling),or=c,ln=!0,Dl=null,js=!1,o!==null&&(ls[us++]=Aa,ls[us++]=wa,ls[us++]=Nl,Aa=o.id,wa=o.overflow,Nl=c),c=u0(c,m.children),c.flags|=4096);return c}return x?(Co(),x=m.fallback,O=c.mode,q=o.child,ce=q.sibling,m=Ea(q,{mode:"hidden",children:m.children}),m.subtreeFlags=q.subtreeFlags&65011712,ce!==null?x=Ea(ce,x):(x=Cl(x,O,f,null),x.flags|=2),x.return=c,m.return=c,m.sibling=x,c.child=m,m=x,x=c.child,O=o.child.memoizedState,O===null?O=o0(f):(q=O.cachePool,q!==null?(ce=_i._currentValue,q=q.parent!==ce?{parent:ce,pool:ce}:q):q=VA(),O={baseLanes:O.baseLanes|f,cachePool:q}),x.memoizedState=O,x.childLanes=l0(o,P,f),c.memoizedState=a0,m):(Ro(c),f=o.child,o=f.sibling,f=Ea(f,{mode:"visible",children:m.children}),f.return=c,f.sibling=null,o!==null&&(P=c.deletions,P===null?(c.deletions=[o],c.flags|=16):P.push(o)),c.child=f,c.memoizedState=null,f)}function u0(o,c){return c=km({mode:"visible",children:c},o.mode),c.return=o,o.child=c}function km(o,c){return o=Vr(22,o,null,c),o.lanes=0,o.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},o}function c0(o,c,f){return Qu(c,o.child,null,f),o=u0(c,c.pendingProps.children),o.flags|=2,c.memoizedState=null,o}function n1(o,c,f){o.lanes|=c;var m=o.alternate;m!==null&&(m.lanes|=c),R_(o.return,c,f)}function h0(o,c,f,m,x){var T=o.memoizedState;T===null?o.memoizedState={isBackwards:c,rendering:null,renderingStartTime:0,last:m,tail:f,tailMode:x}:(T.isBackwards=c,T.rendering=null,T.renderingStartTime=0,T.last=m,T.tail=f,T.tailMode=x)}function i1(o,c,f){var m=c.pendingProps,x=m.revealOrder,T=m.tail;if(Fi(o,c,m.children,f),m=xi.current,(m&2)!==0)m=m&1|2,c.flags|=128;else{if(o!==null&&(o.flags&128)!==0)e:for(o=c.child;o!==null;){if(o.tag===13)o.memoizedState!==null&&n1(o,f,c);else if(o.tag===19)n1(o,f,c);else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===c)break e;for(;o.sibling===null;){if(o.return===null||o.return===c)break e;o=o.return}o.sibling.return=o.return,o=o.sibling}m&=1}switch(De(xi,m),x){case"forwards":for(f=c.child,x=null;f!==null;)o=f.alternate,o!==null&&Om(o)===null&&(x=f),f=f.sibling;f=x,f===null?(x=c.child,c.child=null):(x=f.sibling,f.sibling=null),h0(c,!1,x,f,T);break;case"backwards":for(f=null,x=c.child,c.child=null;x!==null;){if(o=x.alternate,o!==null&&Om(o)===null){c.child=x;break}o=x.sibling,x.sibling=f,f=x,x=o}h0(c,!0,f,null,T);break;case"together":h0(c,!1,null,null,void 0);break;default:c.memoizedState=null}return c.child}function Da(o,c,f){if(o!==null&&(c.dependencies=o.dependencies),Uo|=c.lanes,(f&c.childLanes)===0)if(o!==null){if(ff(o,c,f,!1),(f&c.childLanes)===0)return null}else return null;if(o!==null&&c.child!==o.child)throw Error(n(153));if(c.child!==null){for(o=c.child,f=Ea(o,o.pendingProps),c.child=f,f.return=c;o.sibling!==null;)o=o.sibling,f=f.sibling=Ea(o,o.pendingProps),f.return=c;f.sibling=null}return c.child}function f0(o,c){return(o.lanes&c)!==0?!0:(o=o.dependencies,!!(o!==null&&_m(o)))}function kF(o,c,f){switch(c.tag){case 3:ve(c,c.stateNode.containerInfo),To(c,_i,o.memoizedState.cache),cf();break;case 27:case 5:Ve(c);break;case 4:ve(c,c.stateNode.containerInfo);break;case 10:To(c,c.type,c.memoizedProps.value);break;case 13:var m=c.memoizedState;if(m!==null)return m.dehydrated!==null?(Ro(c),c.flags|=128,null):(f&c.child.childLanes)!==0?t1(o,c,f):(Ro(c),o=Da(o,c,f),o!==null?o.sibling:null);Ro(c);break;case 19:var x=(o.flags&128)!==0;if(m=(f&c.childLanes)!==0,m||(ff(o,c,f,!1),m=(f&c.childLanes)!==0),x){if(m)return i1(o,c,f);c.flags|=128}if(x=c.memoizedState,x!==null&&(x.rendering=null,x.tail=null,x.lastEffect=null),De(xi,xi.current),m)break;return null;case 22:case 23:return c.lanes=0,Kw(o,c,f);case 24:To(c,_i,o.memoizedState.cache)}return Da(o,c,f)}function r1(o,c,f){if(o!==null)if(o.memoizedProps!==c.pendingProps)Ri=!0;else{if(!f0(o,f)&&(c.flags&128)===0)return Ri=!1,kF(o,c,f);Ri=(o.flags&131072)!==0}else Ri=!1,ln&&(c.flags&1048576)!==0&&UA(c,vm,c.index);switch(c.lanes=0,c.tag){case 16:e:{o=c.pendingProps;var m=c.elementType,x=m._init;if(m=x(m._payload),c.type=m,typeof m=="function")b_(m)?(o=Fl(m,o),c.tag=1,c=Jw(null,c,m,o,f)):(c.tag=0,c=s0(null,c,m,o,f));else{if(m!=null){if(x=m.$$typeof,x===A){c.tag=11,c=$w(null,c,m,o,f);break e}else if(x===C){c.tag=14,c=Xw(null,c,m,o,f);break e}}throw c=oe(m)||m,Error(n(306,c,""))}}return c;case 0:return s0(o,c,c.type,c.pendingProps,f);case 1:return m=c.type,x=Fl(m,c.pendingProps),Jw(o,c,m,x,f);case 3:e:{if(ve(c,c.stateNode.containerInfo),o===null)throw Error(n(387));m=c.pendingProps;var T=c.memoizedState;x=T.element,O_(o,c),_f(c,m,null,f);var P=c.memoizedState;if(m=P.cache,To(c,_i,m),m!==T.cache&&C_(c,[_i],f,!0),vf(),m=P.element,T.isDehydrated)if(T={element:m,isDehydrated:!1,cache:P.cache},c.updateQueue.baseState=T,c.memoizedState=T,c.flags&256){c=e1(o,c,m,f);break e}else if(m!==x){x=as(Error(n(424)),c),hf(x),c=e1(o,c,m,f);break e}else{switch(o=c.stateNode.containerInfo,o.nodeType){case 9:o=o.body;break;default:o=o.nodeName==="HTML"?o.ownerDocument.body:o}for(jn=ws(o.firstChild),or=c,ln=!0,Dl=null,js=!0,f=Bw(c,null,m,f),c.child=f;f;)f.flags=f.flags&-3|4096,f=f.sibling}else{if(cf(),m===x){c=Da(o,c,f);break e}Fi(o,c,m,f)}c=c.child}return c;case 26:return Fm(o,c),o===null?(f=lR(c.type,null,c.pendingProps,null))?c.memoizedState=f:ln||(f=c.type,o=c.pendingProps,m=Jm($.current).createElement(f),m[yi]=c,m[Bi]=o,zi(m,f,o),ri(m),c.stateNode=m):c.memoizedState=lR(c.type,o.memoizedProps,c.pendingProps,o.memoizedState),null;case 27:return Ve(c),o===null&&ln&&(m=c.stateNode=sR(c.type,c.pendingProps,$.current),or=c,js=!0,x=jn,Fo(c.type)?(q0=x,jn=ws(m.firstChild)):jn=x),Fi(o,c,c.pendingProps.children,f),Fm(o,c),o===null&&(c.flags|=4194304),c.child;case 5:return o===null&&ln&&((x=m=jn)&&(m=dk(m,c.type,c.pendingProps,js),m!==null?(c.stateNode=m,or=c,jn=ws(m.firstChild),js=!1,x=!0):x=!1),x||Ll(c)),Ve(c),x=c.type,T=c.pendingProps,P=o!==null?o.memoizedProps:null,m=T.children,G0(x,T)?m=null:P!==null&&G0(x,P)&&(c.flags|=32),c.memoizedState!==null&&(x=V_(o,c,PF,null,null,f),Vf._currentValue=x),Fm(o,c),Fi(o,c,m,f),c.child;case 6:return o===null&&ln&&((o=f=jn)&&(f=pk(f,c.pendingProps,js),f!==null?(c.stateNode=f,or=c,jn=null,o=!0):o=!1),o||Ll(c)),null;case 13:return t1(o,c,f);case 4:return ve(c,c.stateNode.containerInfo),m=c.pendingProps,o===null?c.child=Qu(c,null,m,f):Fi(o,c,m,f),c.child;case 11:return $w(o,c,c.type,c.pendingProps,f);case 7:return Fi(o,c,c.pendingProps,f),c.child;case 8:return Fi(o,c,c.pendingProps.children,f),c.child;case 12:return Fi(o,c,c.pendingProps.children,f),c.child;case 10:return m=c.pendingProps,To(c,c.type,m.value),Fi(o,c,m.children,f),c.child;case 9:return x=c.type._context,m=c.pendingProps.children,Ol(c),x=Xi(x),m=m(x),c.flags|=1,Fi(o,c,m,f),c.child;case 14:return Xw(o,c,c.type,c.pendingProps,f);case 15:return Yw(o,c,c.type,c.pendingProps,f);case 19:return i1(o,c,f);case 31:return m=c.pendingProps,f=c.mode,m={mode:m.mode,children:m.children},o===null?(f=km(m,f),f.ref=c.ref,c.child=f,f.return=c,c=f):(f=Ea(o.child,m),f.ref=c.ref,c.child=f,f.return=c,c=f),c;case 22:return Kw(o,c,f);case 24:return Ol(c),m=Xi(_i),o===null?(x=D_(),x===null&&(x=Cn,T=N_(),x.pooledCache=T,T.refCount++,T!==null&&(x.pooledCacheLanes|=f),x=T),c.memoizedState={parent:m,cache:x},U_(c),To(c,_i,x)):((o.lanes&f)!==0&&(O_(o,c),_f(c,null,null,f),vf()),x=o.memoizedState,T=c.memoizedState,x.parent!==m?(x={parent:m,cache:m},c.memoizedState=x,c.lanes===0&&(c.memoizedState=c.updateQueue.baseState=x),To(c,_i,m)):(m=T.cache,To(c,_i,m),m!==x.cache&&C_(c,[_i],f,!0))),Fi(o,c,c.pendingProps.children,f),c.child;case 29:throw c.pendingProps}throw Error(n(156,c.tag))}function La(o){o.flags|=4}function s1(o,c){if(c.type!=="stylesheet"||(c.state.loading&4)!==0)o.flags&=-16777217;else if(o.flags|=16777216,!dR(c)){if(c=cs.current,c!==null&&((Jt&4194048)===Jt?qs!==null:(Jt&62914560)!==Jt&&(Jt&536870912)===0||c!==qs))throw gf=L_,GA;o.flags|=8192}}function zm(o,c){c!==null&&(o.flags|=4),o.flags&16384&&(c=o.tag!==22?Xe():536870912,o.lanes|=c,nc|=c)}function Af(o,c){if(!ln)switch(o.tailMode){case"hidden":c=o.tail;for(var f=null;c!==null;)c.alternate!==null&&(f=c),c=c.sibling;f===null?o.tail=null:f.sibling=null;break;case"collapsed":f=o.tail;for(var m=null;f!==null;)f.alternate!==null&&(m=f),f=f.sibling;m===null?c||o.tail===null?o.tail=null:o.tail.sibling=null:m.sibling=null}}function kn(o){var c=o.alternate!==null&&o.alternate.child===o.child,f=0,m=0;if(c)for(var x=o.child;x!==null;)f|=x.lanes|x.childLanes,m|=x.subtreeFlags&65011712,m|=x.flags&65011712,x.return=o,x=x.sibling;else for(x=o.child;x!==null;)f|=x.lanes|x.childLanes,m|=x.subtreeFlags,m|=x.flags,x.return=o,x=x.sibling;return o.subtreeFlags|=m,o.childLanes=f,c}function zF(o,c,f){var m=c.pendingProps;switch(E_(c),c.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return kn(c),null;case 1:return kn(c),null;case 3:return f=c.stateNode,m=null,o!==null&&(m=o.memoizedState.cache),c.memoizedState.cache!==m&&(c.flags|=2048),Ca(_i),He(),f.pendingContext&&(f.context=f.pendingContext,f.pendingContext=null),(o===null||o.child===null)&&(uf(c)?La(c):o===null||o.memoizedState.isDehydrated&&(c.flags&256)===0||(c.flags|=1024,IA())),kn(c),null;case 26:return f=c.memoizedState,o===null?(La(c),f!==null?(kn(c),s1(c,f)):(kn(c),c.flags&=-16777217)):f?f!==o.memoizedState?(La(c),kn(c),s1(c,f)):(kn(c),c.flags&=-16777217):(o.memoizedProps!==m&&La(c),kn(c),c.flags&=-16777217),null;case 27:st(c),f=$.current;var x=c.type;if(o!==null&&c.stateNode!=null)o.memoizedProps!==m&&La(c);else{if(!m){if(c.stateNode===null)throw Error(n(166));return kn(c),null}o=j.current,uf(c)?OA(c):(o=sR(x,m,f),c.stateNode=o,La(c))}return kn(c),null;case 5:if(st(c),f=c.type,o!==null&&c.stateNode!=null)o.memoizedProps!==m&&La(c);else{if(!m){if(c.stateNode===null)throw Error(n(166));return kn(c),null}if(o=j.current,uf(c))OA(c);else{switch(x=Jm($.current),o){case 1:o=x.createElementNS("http://www.w3.org/2000/svg",f);break;case 2:o=x.createElementNS("http://www.w3.org/1998/Math/MathML",f);break;default:switch(f){case"svg":o=x.createElementNS("http://www.w3.org/2000/svg",f);break;case"math":o=x.createElementNS("http://www.w3.org/1998/Math/MathML",f);break;case"script":o=x.createElement("div"),o.innerHTML="<script><\/script>",o=o.removeChild(o.firstChild);break;case"select":o=typeof m.is=="string"?x.createElement("select",{is:m.is}):x.createElement("select"),m.multiple?o.multiple=!0:m.size&&(o.size=m.size);break;default:o=typeof m.is=="string"?x.createElement(f,{is:m.is}):x.createElement(f)}}o[yi]=c,o[Bi]=m;e:for(x=c.child;x!==null;){if(x.tag===5||x.tag===6)o.appendChild(x.stateNode);else if(x.tag!==4&&x.tag!==27&&x.child!==null){x.child.return=x,x=x.child;continue}if(x===c)break e;for(;x.sibling===null;){if(x.return===null||x.return===c)break e;x=x.return}x.sibling.return=x.return,x=x.sibling}c.stateNode=o;e:switch(zi(o,f,m),f){case"button":case"input":case"select":case"textarea":o=!!m.autoFocus;break e;case"img":o=!0;break e;default:o=!1}o&&La(c)}}return kn(c),c.flags&=-16777217,null;case 6:if(o&&c.stateNode!=null)o.memoizedProps!==m&&La(c);else{if(typeof m!="string"&&c.stateNode===null)throw Error(n(166));if(o=$.current,uf(c)){if(o=c.stateNode,f=c.memoizedProps,m=null,x=or,x!==null)switch(x.tag){case 27:case 5:m=x.memoizedProps}o[yi]=c,o=!!(o.nodeValue===f||m!==null&&m.suppressHydrationWarning===!0||Q1(o.nodeValue,f)),o||Ll(c)}else o=Jm(o).createTextNode(m),o[yi]=c,c.stateNode=o}return kn(c),null;case 13:if(m=c.memoizedState,o===null||o.memoizedState!==null&&o.memoizedState.dehydrated!==null){if(x=uf(c),m!==null&&m.dehydrated!==null){if(o===null){if(!x)throw Error(n(318));if(x=c.memoizedState,x=x!==null?x.dehydrated:null,!x)throw Error(n(317));x[yi]=c}else cf(),(c.flags&128)===0&&(c.memoizedState=null),c.flags|=4;kn(c),x=!1}else x=IA(),o!==null&&o.memoizedState!==null&&(o.memoizedState.hydrationErrors=x),x=!0;if(!x)return c.flags&256?(Pa(c),c):(Pa(c),null)}if(Pa(c),(c.flags&128)!==0)return c.lanes=f,c;if(f=m!==null,o=o!==null&&o.memoizedState!==null,f){m=c.child,x=null,m.alternate!==null&&m.alternate.memoizedState!==null&&m.alternate.memoizedState.cachePool!==null&&(x=m.alternate.memoizedState.cachePool.pool);var T=null;m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(T=m.memoizedState.cachePool.pool),T!==x&&(m.flags|=2048)}return f!==o&&f&&(c.child.flags|=8192),zm(c,c.updateQueue),kn(c),null;case 4:return He(),o===null&&I0(c.stateNode.containerInfo),kn(c),null;case 10:return Ca(c.type),kn(c),null;case 19:if(Me(xi),x=c.memoizedState,x===null)return kn(c),null;if(m=(c.flags&128)!==0,T=x.rendering,T===null)if(m)Af(x,!1);else{if(qn!==0||o!==null&&(o.flags&128)!==0)for(o=c.child;o!==null;){if(T=Om(o),T!==null){for(c.flags|=128,Af(x,!1),o=T.updateQueue,c.updateQueue=o,zm(c,o),c.subtreeFlags=0,o=f,f=c.child;f!==null;)LA(f,o),f=f.sibling;return De(xi,xi.current&1|2),c.child}o=o.sibling}x.tail!==null&&Ft()>Hm&&(c.flags|=128,m=!0,Af(x,!1),c.lanes=4194304)}else{if(!m)if(o=Om(T),o!==null){if(c.flags|=128,m=!0,o=o.updateQueue,c.updateQueue=o,zm(c,o),Af(x,!0),x.tail===null&&x.tailMode==="hidden"&&!T.alternate&&!ln)return kn(c),null}else 2*Ft()-x.renderingStartTime>Hm&&f!==536870912&&(c.flags|=128,m=!0,Af(x,!1),c.lanes=4194304);x.isBackwards?(T.sibling=c.child,c.child=T):(o=x.last,o!==null?o.sibling=T:c.child=T,x.last=T)}return x.tail!==null?(c=x.tail,x.rendering=c,x.tail=c.sibling,x.renderingStartTime=Ft(),c.sibling=null,o=xi.current,De(xi,m?o&1|2:o&1),c):(kn(c),null);case 22:case 23:return Pa(c),k_(),m=c.memoizedState!==null,o!==null?o.memoizedState!==null!==m&&(c.flags|=8192):m&&(c.flags|=8192),m?(f&536870912)!==0&&(c.flags&128)===0&&(kn(c),c.subtreeFlags&6&&(c.flags|=8192)):kn(c),f=c.updateQueue,f!==null&&zm(c,f.retryQueue),f=null,o!==null&&o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(f=o.memoizedState.cachePool.pool),m=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(m=c.memoizedState.cachePool.pool),m!==f&&(c.flags|=2048),o!==null&&Me(Bl),null;case 24:return f=null,o!==null&&(f=o.memoizedState.cache),c.memoizedState.cache!==f&&(c.flags|=2048),Ca(_i),kn(c),null;case 25:return null;case 30:return null}throw Error(n(156,c.tag))}function VF(o,c){switch(E_(c),c.tag){case 1:return o=c.flags,o&65536?(c.flags=o&-65537|128,c):null;case 3:return Ca(_i),He(),o=c.flags,(o&65536)!==0&&(o&128)===0?(c.flags=o&-65537|128,c):null;case 26:case 27:case 5:return st(c),null;case 13:if(Pa(c),o=c.memoizedState,o!==null&&o.dehydrated!==null){if(c.alternate===null)throw Error(n(340));cf()}return o=c.flags,o&65536?(c.flags=o&-65537|128,c):null;case 19:return Me(xi),null;case 4:return He(),null;case 10:return Ca(c.type),null;case 22:case 23:return Pa(c),k_(),o!==null&&Me(Bl),o=c.flags,o&65536?(c.flags=o&-65537|128,c):null;case 24:return Ca(_i),null;case 25:return null;default:return null}}function a1(o,c){switch(E_(c),c.tag){case 3:Ca(_i),He();break;case 26:case 27:case 5:st(c);break;case 4:He();break;case 13:Pa(c);break;case 19:Me(xi);break;case 10:Ca(c.type);break;case 22:case 23:Pa(c),k_(),o!==null&&Me(Bl);break;case 24:Ca(_i)}}function wf(o,c){try{var f=c.updateQueue,m=f!==null?f.lastEffect:null;if(m!==null){var x=m.next;f=x;do{if((f.tag&o)===o){m=void 0;var T=f.create,P=f.inst;m=T(),P.destroy=m}f=f.next}while(f!==x)}}catch(O){Sn(c,c.return,O)}}function No(o,c,f){try{var m=c.updateQueue,x=m!==null?m.lastEffect:null;if(x!==null){var T=x.next;m=T;do{if((m.tag&o)===o){var P=m.inst,O=P.destroy;if(O!==void 0){P.destroy=void 0,x=c;var q=f,ce=O;try{ce()}catch(Ae){Sn(x,q,Ae)}}}m=m.next}while(m!==T)}}catch(Ae){Sn(c,c.return,Ae)}}function o1(o){var c=o.updateQueue;if(c!==null){var f=o.stateNode;try{XA(c,f)}catch(m){Sn(o,o.return,m)}}}function l1(o,c,f){f.props=Fl(o.type,o.memoizedProps),f.state=o.memoizedState;try{f.componentWillUnmount()}catch(m){Sn(o,c,m)}}function Rf(o,c){try{var f=o.ref;if(f!==null){switch(o.tag){case 26:case 27:case 5:var m=o.stateNode;break;case 30:m=o.stateNode;break;default:m=o.stateNode}typeof f=="function"?o.refCleanup=f(m):f.current=m}}catch(x){Sn(o,c,x)}}function $s(o,c){var f=o.ref,m=o.refCleanup;if(f!==null)if(typeof m=="function")try{m()}catch(x){Sn(o,c,x)}finally{o.refCleanup=null,o=o.alternate,o!=null&&(o.refCleanup=null)}else if(typeof f=="function")try{f(null)}catch(x){Sn(o,c,x)}else f.current=null}function u1(o){var c=o.type,f=o.memoizedProps,m=o.stateNode;try{e:switch(c){case"button":case"input":case"select":case"textarea":f.autoFocus&&m.focus();break e;case"img":f.src?m.src=f.src:f.srcSet&&(m.srcset=f.srcSet)}}catch(x){Sn(o,o.return,x)}}function d0(o,c,f){try{var m=o.stateNode;lk(m,o.type,f,c),m[Bi]=c}catch(x){Sn(o,o.return,x)}}function c1(o){return o.tag===5||o.tag===3||o.tag===26||o.tag===27&&Fo(o.type)||o.tag===4}function p0(o){e:for(;;){for(;o.sibling===null;){if(o.return===null||c1(o.return))return null;o=o.return}for(o.sibling.return=o.return,o=o.sibling;o.tag!==5&&o.tag!==6&&o.tag!==18;){if(o.tag===27&&Fo(o.type)||o.flags&2||o.child===null||o.tag===4)continue e;o.child.return=o,o=o.child}if(!(o.flags&2))return o.stateNode}}function m0(o,c,f){var m=o.tag;if(m===5||m===6)o=o.stateNode,c?(f.nodeType===9?f.body:f.nodeName==="HTML"?f.ownerDocument.body:f).insertBefore(o,c):(c=f.nodeType===9?f.body:f.nodeName==="HTML"?f.ownerDocument.body:f,c.appendChild(o),f=f._reactRootContainer,f!=null||c.onclick!==null||(c.onclick=Qm));else if(m!==4&&(m===27&&Fo(o.type)&&(f=o.stateNode,c=null),o=o.child,o!==null))for(m0(o,c,f),o=o.sibling;o!==null;)m0(o,c,f),o=o.sibling}function Vm(o,c,f){var m=o.tag;if(m===5||m===6)o=o.stateNode,c?f.insertBefore(o,c):f.appendChild(o);else if(m!==4&&(m===27&&Fo(o.type)&&(f=o.stateNode),o=o.child,o!==null))for(Vm(o,c,f),o=o.sibling;o!==null;)Vm(o,c,f),o=o.sibling}function h1(o){var c=o.stateNode,f=o.memoizedProps;try{for(var m=o.type,x=c.attributes;x.length;)c.removeAttributeNode(x[0]);zi(c,m,f),c[yi]=o,c[Bi]=f}catch(T){Sn(o,o.return,T)}}var Ua=!1,Zn=!1,g0=!1,f1=typeof WeakSet=="function"?WeakSet:Set,Ci=null;function GF(o,c){if(o=o.containerInfo,z0=sg,o=TA(o),p_(o)){if("selectionStart"in o)var f={start:o.selectionStart,end:o.selectionEnd};else e:{f=(f=o.ownerDocument)&&f.defaultView||window;var m=f.getSelection&&f.getSelection();if(m&&m.rangeCount!==0){f=m.anchorNode;var x=m.anchorOffset,T=m.focusNode;m=m.focusOffset;try{f.nodeType,T.nodeType}catch{f=null;break e}var P=0,O=-1,q=-1,ce=0,Ae=0,Ne=o,pe=null;t:for(;;){for(var me;Ne!==f||x!==0&&Ne.nodeType!==3||(O=P+x),Ne!==T||m!==0&&Ne.nodeType!==3||(q=P+m),Ne.nodeType===3&&(P+=Ne.nodeValue.length),(me=Ne.firstChild)!==null;)pe=Ne,Ne=me;for(;;){if(Ne===o)break t;if(pe===f&&++ce===x&&(O=P),pe===T&&++Ae===m&&(q=P),(me=Ne.nextSibling)!==null)break;Ne=pe,pe=Ne.parentNode}Ne=me}f=O===-1||q===-1?null:{start:O,end:q}}else f=null}f=f||{start:0,end:0}}else f=null;for(V0={focusedElem:o,selectionRange:f},sg=!1,Ci=c;Ci!==null;)if(c=Ci,o=c.child,(c.subtreeFlags&1024)!==0&&o!==null)o.return=c,Ci=o;else for(;Ci!==null;){switch(c=Ci,T=c.alternate,o=c.flags,c.tag){case 0:break;case 11:case 15:break;case 1:if((o&1024)!==0&&T!==null){o=void 0,f=c,x=T.memoizedProps,T=T.memoizedState,m=f.stateNode;try{var St=Fl(f.type,x,f.elementType===f.type);o=m.getSnapshotBeforeUpdate(St,T),m.__reactInternalSnapshotBeforeUpdate=o}catch(yt){Sn(f,f.return,yt)}}break;case 3:if((o&1024)!==0){if(o=c.stateNode.containerInfo,f=o.nodeType,f===9)W0(o);else if(f===1)switch(o.nodeName){case"HEAD":case"HTML":case"BODY":W0(o);break;default:o.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((o&1024)!==0)throw Error(n(163))}if(o=c.sibling,o!==null){o.return=c.return,Ci=o;break}Ci=c.return}}function d1(o,c,f){var m=f.flags;switch(f.tag){case 0:case 11:case 15:Po(o,f),m&4&&wf(5,f);break;case 1:if(Po(o,f),m&4)if(o=f.stateNode,c===null)try{o.componentDidMount()}catch(P){Sn(f,f.return,P)}else{var x=Fl(f.type,c.memoizedProps);c=c.memoizedState;try{o.componentDidUpdate(x,c,o.__reactInternalSnapshotBeforeUpdate)}catch(P){Sn(f,f.return,P)}}m&64&&o1(f),m&512&&Rf(f,f.return);break;case 3:if(Po(o,f),m&64&&(o=f.updateQueue,o!==null)){if(c=null,f.child!==null)switch(f.child.tag){case 27:case 5:c=f.child.stateNode;break;case 1:c=f.child.stateNode}try{XA(o,c)}catch(P){Sn(f,f.return,P)}}break;case 27:c===null&&m&4&&h1(f);case 26:case 5:Po(o,f),c===null&&m&4&&u1(f),m&512&&Rf(f,f.return);break;case 12:Po(o,f);break;case 13:Po(o,f),m&4&&g1(o,f),m&64&&(o=f.memoizedState,o!==null&&(o=o.dehydrated,o!==null&&(f=ZF.bind(null,f),mk(o,f))));break;case 22:if(m=f.memoizedState!==null||Ua,!m){c=c!==null&&c.memoizedState!==null||Zn,x=Ua;var T=Zn;Ua=m,(Zn=c)&&!T?Do(o,f,(f.subtreeFlags&8772)!==0):Po(o,f),Ua=x,Zn=T}break;case 30:break;default:Po(o,f)}}function p1(o){var c=o.alternate;c!==null&&(o.alternate=null,p1(c)),o.child=null,o.deletions=null,o.sibling=null,o.tag===5&&(c=o.stateNode,c!==null&&_o(c)),o.stateNode=null,o.return=null,o.dependencies=null,o.memoizedProps=null,o.memoizedState=null,o.pendingProps=null,o.stateNode=null,o.updateQueue=null}var Un=null,Er=!1;function Oa(o,c,f){for(f=f.child;f!==null;)m1(o,c,f),f=f.sibling}function m1(o,c,f){if(Ce&&typeof Ce.onCommitFiberUnmount=="function")try{Ce.onCommitFiberUnmount(we,f)}catch{}switch(f.tag){case 26:Zn||$s(f,c),Oa(o,c,f),f.memoizedState?f.memoizedState.count--:f.stateNode&&(f=f.stateNode,f.parentNode.removeChild(f));break;case 27:Zn||$s(f,c);var m=Un,x=Er;Fo(f.type)&&(Un=f.stateNode,Er=!1),Oa(o,c,f),If(f.stateNode),Un=m,Er=x;break;case 5:Zn||$s(f,c);case 6:if(m=Un,x=Er,Un=null,Oa(o,c,f),Un=m,Er=x,Un!==null)if(Er)try{(Un.nodeType===9?Un.body:Un.nodeName==="HTML"?Un.ownerDocument.body:Un).removeChild(f.stateNode)}catch(T){Sn(f,c,T)}else try{Un.removeChild(f.stateNode)}catch(T){Sn(f,c,T)}break;case 18:Un!==null&&(Er?(o=Un,iR(o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o,f.stateNode),jf(o)):iR(Un,f.stateNode));break;case 4:m=Un,x=Er,Un=f.stateNode.containerInfo,Er=!0,Oa(o,c,f),Un=m,Er=x;break;case 0:case 11:case 14:case 15:Zn||No(2,f,c),Zn||No(4,f,c),Oa(o,c,f);break;case 1:Zn||($s(f,c),m=f.stateNode,typeof m.componentWillUnmount=="function"&&l1(f,c,m)),Oa(o,c,f);break;case 21:Oa(o,c,f);break;case 22:Zn=(m=Zn)||f.memoizedState!==null,Oa(o,c,f),Zn=m;break;default:Oa(o,c,f)}}function g1(o,c){if(c.memoizedState===null&&(o=c.alternate,o!==null&&(o=o.memoizedState,o!==null&&(o=o.dehydrated,o!==null))))try{jf(o)}catch(f){Sn(c,c.return,f)}}function HF(o){switch(o.tag){case 13:case 19:var c=o.stateNode;return c===null&&(c=o.stateNode=new f1),c;case 22:return o=o.stateNode,c=o._retryCache,c===null&&(c=o._retryCache=new f1),c;default:throw Error(n(435,o.tag))}}function y0(o,c){var f=HF(o);c.forEach(function(m){var x=QF.bind(null,o,m);f.has(m)||(f.add(m),m.then(x,x))})}function Gr(o,c){var f=c.deletions;if(f!==null)for(var m=0;m<f.length;m++){var x=f[m],T=o,P=c,O=P;e:for(;O!==null;){switch(O.tag){case 27:if(Fo(O.type)){Un=O.stateNode,Er=!1;break e}break;case 5:Un=O.stateNode,Er=!1;break e;case 3:case 4:Un=O.stateNode.containerInfo,Er=!0;break e}O=O.return}if(Un===null)throw Error(n(160));m1(T,P,x),Un=null,Er=!1,T=x.alternate,T!==null&&(T.return=null),x.return=null}if(c.subtreeFlags&13878)for(c=c.child;c!==null;)y1(c,o),c=c.sibling}var As=null;function y1(o,c){var f=o.alternate,m=o.flags;switch(o.tag){case 0:case 11:case 14:case 15:Gr(c,o),Hr(o),m&4&&(No(3,o,o.return),wf(3,o),No(5,o,o.return));break;case 1:Gr(c,o),Hr(o),m&512&&(Zn||f===null||$s(f,f.return)),m&64&&Ua&&(o=o.updateQueue,o!==null&&(m=o.callbacks,m!==null&&(f=o.shared.hiddenCallbacks,o.shared.hiddenCallbacks=f===null?m:f.concat(m))));break;case 26:var x=As;if(Gr(c,o),Hr(o),m&512&&(Zn||f===null||$s(f,f.return)),m&4){var T=f!==null?f.memoizedState:null;if(m=o.memoizedState,f===null)if(m===null)if(o.stateNode===null){e:{m=o.type,f=o.memoizedProps,x=x.ownerDocument||x;t:switch(m){case"title":T=x.getElementsByTagName("title")[0],(!T||T[vo]||T[yi]||T.namespaceURI==="http://www.w3.org/2000/svg"||T.hasAttribute("itemprop"))&&(T=x.createElement(m),x.head.insertBefore(T,x.querySelector("head > title"))),zi(T,m,f),T[yi]=o,ri(T),m=T;break e;case"link":var P=hR("link","href",x).get(m+(f.href||""));if(P){for(var O=0;O<P.length;O++)if(T=P[O],T.getAttribute("href")===(f.href==null||f.href===""?null:f.href)&&T.getAttribute("rel")===(f.rel==null?null:f.rel)&&T.getAttribute("title")===(f.title==null?null:f.title)&&T.getAttribute("crossorigin")===(f.crossOrigin==null?null:f.crossOrigin)){P.splice(O,1);break t}}T=x.createElement(m),zi(T,m,f),x.head.appendChild(T);break;case"meta":if(P=hR("meta","content",x).get(m+(f.content||""))){for(O=0;O<P.length;O++)if(T=P[O],T.getAttribute("content")===(f.content==null?null:""+f.content)&&T.getAttribute("name")===(f.name==null?null:f.name)&&T.getAttribute("property")===(f.property==null?null:f.property)&&T.getAttribute("http-equiv")===(f.httpEquiv==null?null:f.httpEquiv)&&T.getAttribute("charset")===(f.charSet==null?null:f.charSet)){P.splice(O,1);break t}}T=x.createElement(m),zi(T,m,f),x.head.appendChild(T);break;default:throw Error(n(468,m))}T[yi]=o,ri(T),m=T}o.stateNode=m}else fR(x,o.type,o.stateNode);else o.stateNode=cR(x,m,o.memoizedProps);else T!==m?(T===null?f.stateNode!==null&&(f=f.stateNode,f.parentNode.removeChild(f)):T.count--,m===null?fR(x,o.type,o.stateNode):cR(x,m,o.memoizedProps)):m===null&&o.stateNode!==null&&d0(o,o.memoizedProps,f.memoizedProps)}break;case 27:Gr(c,o),Hr(o),m&512&&(Zn||f===null||$s(f,f.return)),f!==null&&m&4&&d0(o,o.memoizedProps,f.memoizedProps);break;case 5:if(Gr(c,o),Hr(o),m&512&&(Zn||f===null||$s(f,f.return)),o.flags&32){x=o.stateNode;try{Ws(x,"")}catch(me){Sn(o,o.return,me)}}m&4&&o.stateNode!=null&&(x=o.memoizedProps,d0(o,x,f!==null?f.memoizedProps:x)),m&1024&&(g0=!0);break;case 6:if(Gr(c,o),Hr(o),m&4){if(o.stateNode===null)throw Error(n(162));m=o.memoizedProps,f=o.stateNode;try{f.nodeValue=m}catch(me){Sn(o,o.return,me)}}break;case 3:if(ng=null,x=As,As=eg(c.containerInfo),Gr(c,o),As=x,Hr(o),m&4&&f!==null&&f.memoizedState.isDehydrated)try{jf(c.containerInfo)}catch(me){Sn(o,o.return,me)}g0&&(g0=!1,v1(o));break;case 4:m=As,As=eg(o.stateNode.containerInfo),Gr(c,o),Hr(o),As=m;break;case 12:Gr(c,o),Hr(o);break;case 13:Gr(c,o),Hr(o),o.child.flags&8192&&o.memoizedState!==null!=(f!==null&&f.memoizedState!==null)&&(T0=Ft()),m&4&&(m=o.updateQueue,m!==null&&(o.updateQueue=null,y0(o,m)));break;case 22:x=o.memoizedState!==null;var q=f!==null&&f.memoizedState!==null,ce=Ua,Ae=Zn;if(Ua=ce||x,Zn=Ae||q,Gr(c,o),Zn=Ae,Ua=ce,Hr(o),m&8192)e:for(c=o.stateNode,c._visibility=x?c._visibility&-2:c._visibility|1,x&&(f===null||q||Ua||Zn||kl(o)),f=null,c=o;;){if(c.tag===5||c.tag===26){if(f===null){q=f=c;try{if(T=q.stateNode,x)P=T.style,typeof P.setProperty=="function"?P.setProperty("display","none","important"):P.display="none";else{O=q.stateNode;var Ne=q.memoizedProps.style,pe=Ne!=null&&Ne.hasOwnProperty("display")?Ne.display:null;O.style.display=pe==null||typeof pe=="boolean"?"":(""+pe).trim()}}catch(me){Sn(q,q.return,me)}}}else if(c.tag===6){if(f===null){q=c;try{q.stateNode.nodeValue=x?"":q.memoizedProps}catch(me){Sn(q,q.return,me)}}}else if((c.tag!==22&&c.tag!==23||c.memoizedState===null||c===o)&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===o)break e;for(;c.sibling===null;){if(c.return===null||c.return===o)break e;f===c&&(f=null),c=c.return}f===c&&(f=null),c.sibling.return=c.return,c=c.sibling}m&4&&(m=o.updateQueue,m!==null&&(f=m.retryQueue,f!==null&&(m.retryQueue=null,y0(o,f))));break;case 19:Gr(c,o),Hr(o),m&4&&(m=o.updateQueue,m!==null&&(o.updateQueue=null,y0(o,m)));break;case 30:break;case 21:break;default:Gr(c,o),Hr(o)}}function Hr(o){var c=o.flags;if(c&2){try{for(var f,m=o.return;m!==null;){if(c1(m)){f=m;break}m=m.return}if(f==null)throw Error(n(160));switch(f.tag){case 27:var x=f.stateNode,T=p0(o);Vm(o,T,x);break;case 5:var P=f.stateNode;f.flags&32&&(Ws(P,""),f.flags&=-33);var O=p0(o);Vm(o,O,P);break;case 3:case 4:var q=f.stateNode.containerInfo,ce=p0(o);m0(o,ce,q);break;default:throw Error(n(161))}}catch(Ae){Sn(o,o.return,Ae)}o.flags&=-3}c&4096&&(o.flags&=-4097)}function v1(o){if(o.subtreeFlags&1024)for(o=o.child;o!==null;){var c=o;v1(c),c.tag===5&&c.flags&1024&&c.stateNode.reset(),o=o.sibling}}function Po(o,c){if(c.subtreeFlags&8772)for(c=c.child;c!==null;)d1(o,c.alternate,c),c=c.sibling}function kl(o){for(o=o.child;o!==null;){var c=o;switch(c.tag){case 0:case 11:case 14:case 15:No(4,c,c.return),kl(c);break;case 1:$s(c,c.return);var f=c.stateNode;typeof f.componentWillUnmount=="function"&&l1(c,c.return,f),kl(c);break;case 27:If(c.stateNode);case 26:case 5:$s(c,c.return),kl(c);break;case 22:c.memoizedState===null&&kl(c);break;case 30:kl(c);break;default:kl(c)}o=o.sibling}}function Do(o,c,f){for(f=f&&(c.subtreeFlags&8772)!==0,c=c.child;c!==null;){var m=c.alternate,x=o,T=c,P=T.flags;switch(T.tag){case 0:case 11:case 15:Do(x,T,f),wf(4,T);break;case 1:if(Do(x,T,f),m=T,x=m.stateNode,typeof x.componentDidMount=="function")try{x.componentDidMount()}catch(ce){Sn(m,m.return,ce)}if(m=T,x=m.updateQueue,x!==null){var O=m.stateNode;try{var q=x.shared.hiddenCallbacks;if(q!==null)for(x.shared.hiddenCallbacks=null,x=0;x<q.length;x++)$A(q[x],O)}catch(ce){Sn(m,m.return,ce)}}f&&P&64&&o1(T),Rf(T,T.return);break;case 27:h1(T);case 26:case 5:Do(x,T,f),f&&m===null&&P&4&&u1(T),Rf(T,T.return);break;case 12:Do(x,T,f);break;case 13:Do(x,T,f),f&&P&4&&g1(x,T);break;case 22:T.memoizedState===null&&Do(x,T,f),Rf(T,T.return);break;case 30:break;default:Do(x,T,f)}c=c.sibling}}function v0(o,c){var f=null;o!==null&&o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(f=o.memoizedState.cachePool.pool),o=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(o=c.memoizedState.cachePool.pool),o!==f&&(o!=null&&o.refCount++,f!=null&&df(f))}function _0(o,c){o=null,c.alternate!==null&&(o=c.alternate.memoizedState.cache),c=c.memoizedState.cache,c!==o&&(c.refCount++,o!=null&&df(o))}function Xs(o,c,f,m){if(c.subtreeFlags&10256)for(c=c.child;c!==null;)_1(o,c,f,m),c=c.sibling}function _1(o,c,f,m){var x=c.flags;switch(c.tag){case 0:case 11:case 15:Xs(o,c,f,m),x&2048&&wf(9,c);break;case 1:Xs(o,c,f,m);break;case 3:Xs(o,c,f,m),x&2048&&(o=null,c.alternate!==null&&(o=c.alternate.memoizedState.cache),c=c.memoizedState.cache,c!==o&&(c.refCount++,o!=null&&df(o)));break;case 12:if(x&2048){Xs(o,c,f,m),o=c.stateNode;try{var T=c.memoizedProps,P=T.id,O=T.onPostCommit;typeof O=="function"&&O(P,c.alternate===null?"mount":"update",o.passiveEffectDuration,-0)}catch(q){Sn(c,c.return,q)}}else Xs(o,c,f,m);break;case 13:Xs(o,c,f,m);break;case 23:break;case 22:T=c.stateNode,P=c.alternate,c.memoizedState!==null?T._visibility&2?Xs(o,c,f,m):Cf(o,c):T._visibility&2?Xs(o,c,f,m):(T._visibility|=2,Ju(o,c,f,m,(c.subtreeFlags&10256)!==0)),x&2048&&v0(P,c);break;case 24:Xs(o,c,f,m),x&2048&&_0(c.alternate,c);break;default:Xs(o,c,f,m)}}function Ju(o,c,f,m,x){for(x=x&&(c.subtreeFlags&10256)!==0,c=c.child;c!==null;){var T=o,P=c,O=f,q=m,ce=P.flags;switch(P.tag){case 0:case 11:case 15:Ju(T,P,O,q,x),wf(8,P);break;case 23:break;case 22:var Ae=P.stateNode;P.memoizedState!==null?Ae._visibility&2?Ju(T,P,O,q,x):Cf(T,P):(Ae._visibility|=2,Ju(T,P,O,q,x)),x&&ce&2048&&v0(P.alternate,P);break;case 24:Ju(T,P,O,q,x),x&&ce&2048&&_0(P.alternate,P);break;default:Ju(T,P,O,q,x)}c=c.sibling}}function Cf(o,c){if(c.subtreeFlags&10256)for(c=c.child;c!==null;){var f=o,m=c,x=m.flags;switch(m.tag){case 22:Cf(f,m),x&2048&&v0(m.alternate,m);break;case 24:Cf(f,m),x&2048&&_0(m.alternate,m);break;default:Cf(f,m)}c=c.sibling}}var Nf=8192;function ec(o){if(o.subtreeFlags&Nf)for(o=o.child;o!==null;)x1(o),o=o.sibling}function x1(o){switch(o.tag){case 26:ec(o),o.flags&Nf&&o.memoizedState!==null&&Rk(As,o.memoizedState,o.memoizedProps);break;case 5:ec(o);break;case 3:case 4:var c=As;As=eg(o.stateNode.containerInfo),ec(o),As=c;break;case 22:o.memoizedState===null&&(c=o.alternate,c!==null&&c.memoizedState!==null?(c=Nf,Nf=16777216,ec(o),Nf=c):ec(o));break;default:ec(o)}}function b1(o){var c=o.alternate;if(c!==null&&(o=c.child,o!==null)){c.child=null;do c=o.sibling,o.sibling=null,o=c;while(o!==null)}}function Pf(o){var c=o.deletions;if((o.flags&16)!==0){if(c!==null)for(var f=0;f<c.length;f++){var m=c[f];Ci=m,T1(m,o)}b1(o)}if(o.subtreeFlags&10256)for(o=o.child;o!==null;)S1(o),o=o.sibling}function S1(o){switch(o.tag){case 0:case 11:case 15:Pf(o),o.flags&2048&&No(9,o,o.return);break;case 3:Pf(o);break;case 12:Pf(o);break;case 22:var c=o.stateNode;o.memoizedState!==null&&c._visibility&2&&(o.return===null||o.return.tag!==13)?(c._visibility&=-3,Gm(o)):Pf(o);break;default:Pf(o)}}function Gm(o){var c=o.deletions;if((o.flags&16)!==0){if(c!==null)for(var f=0;f<c.length;f++){var m=c[f];Ci=m,T1(m,o)}b1(o)}for(o=o.child;o!==null;){switch(c=o,c.tag){case 0:case 11:case 15:No(8,c,c.return),Gm(c);break;case 22:f=c.stateNode,f._visibility&2&&(f._visibility&=-3,Gm(c));break;default:Gm(c)}o=o.sibling}}function T1(o,c){for(;Ci!==null;){var f=Ci;switch(f.tag){case 0:case 11:case 15:No(8,f,c);break;case 23:case 22:if(f.memoizedState!==null&&f.memoizedState.cachePool!==null){var m=f.memoizedState.cachePool.pool;m!=null&&m.refCount++}break;case 24:df(f.memoizedState.cache)}if(m=f.child,m!==null)m.return=f,Ci=m;else e:for(f=o;Ci!==null;){m=Ci;var x=m.sibling,T=m.return;if(p1(m),m===f){Ci=null;break e}if(x!==null){x.return=T,Ci=x;break e}Ci=T}}}var WF={getCacheForType:function(o){var c=Xi(_i),f=c.data.get(o);return f===void 0&&(f=o(),c.data.set(o,f)),f}},jF=typeof WeakMap=="function"?WeakMap:Map,dn=0,Cn=null,Xt=null,Jt=0,pn=0,Wr=null,Lo=!1,tc=!1,x0=!1,Ba=0,qn=0,Uo=0,zl=0,b0=0,hs=0,nc=0,Df=null,Ar=null,S0=!1,T0=0,Hm=1/0,Wm=null,Oo=null,ki=0,Bo=null,ic=null,rc=0,M0=0,E0=null,M1=null,Lf=0,A0=null;function jr(){if((dn&2)!==0&&Jt!==0)return Jt&-Jt;if(z.T!==null){var o=ju;return o!==0?o:L0()}return rn()}function E1(){hs===0&&(hs=(Jt&536870912)===0||ln?J():536870912);var o=cs.current;return o!==null&&(o.flags|=32),hs}function qr(o,c,f){(o===Cn&&(pn===2||pn===9)||o.cancelPendingCommit!==null)&&(sc(o,0),Io(o,Jt,hs,!1)),et(o,f),((dn&2)===0||o!==Cn)&&(o===Cn&&((dn&2)===0&&(zl|=f),qn===4&&Io(o,Jt,hs,!1)),Ys(o))}function A1(o,c,f){if((dn&6)!==0)throw Error(n(327));var m=!f&&(c&124)===0&&(c&o.expiredLanes)===0||je(o,c),x=m?XF(o,c):C0(o,c,!0),T=m;do{if(x===0){tc&&!m&&Io(o,c,0,!1);break}else{if(f=o.current.alternate,T&&!qF(f)){x=C0(o,c,!1),T=!1;continue}if(x===2){if(T=c,o.errorRecoveryDisabledLanes&T)var P=0;else P=o.pendingLanes&-536870913,P=P!==0?P:P&536870912?536870912:0;if(P!==0){c=P;e:{var O=o;x=Df;var q=O.current.memoizedState.isDehydrated;if(q&&(sc(O,P).flags|=256),P=C0(O,P,!1),P!==2){if(x0&&!q){O.errorRecoveryDisabledLanes|=T,zl|=T,x=4;break e}T=Ar,Ar=x,T!==null&&(Ar===null?Ar=T:Ar.push.apply(Ar,T))}x=P}if(T=!1,x!==2)continue}}if(x===1){sc(o,0),Io(o,c,0,!0);break}e:{switch(m=o,T=x,T){case 0:case 1:throw Error(n(345));case 4:if((c&4194048)!==c)break;case 6:Io(m,c,hs,!Lo);break e;case 2:Ar=null;break;case 3:case 5:break;default:throw Error(n(329))}if((c&62914560)===c&&(x=T0+300-Ft(),10<x)){if(Io(m,c,hs,!Lo),dt(m,0,!0)!==0)break e;m.timeoutHandle=tR(w1.bind(null,m,f,Ar,Wm,S0,c,hs,zl,nc,Lo,T,2,-0,0),x);break e}w1(m,f,Ar,Wm,S0,c,hs,zl,nc,Lo,T,0,-0,0)}}break}while(!0);Ys(o)}function w1(o,c,f,m,x,T,P,O,q,ce,Ae,Ne,pe,me){if(o.timeoutHandle=-1,Ne=c.subtreeFlags,(Ne&8192||(Ne&16785408)===16785408)&&(zf={stylesheets:null,count:0,unsuspend:wk},x1(c),Ne=Ck(),Ne!==null)){o.cancelPendingCommit=Ne(U1.bind(null,o,c,T,f,m,x,P,O,q,Ae,1,pe,me)),Io(o,T,P,!ce);return}U1(o,c,T,f,m,x,P,O,q)}function qF(o){for(var c=o;;){var f=c.tag;if((f===0||f===11||f===15)&&c.flags&16384&&(f=c.updateQueue,f!==null&&(f=f.stores,f!==null)))for(var m=0;m<f.length;m++){var x=f[m],T=x.getSnapshot;x=x.value;try{if(!zr(T(),x))return!1}catch{return!1}}if(f=c.child,c.subtreeFlags&16384&&f!==null)f.return=c,c=f;else{if(c===o)break;for(;c.sibling===null;){if(c.return===null||c.return===o)return!0;c=c.return}c.sibling.return=c.return,c=c.sibling}}return!0}function Io(o,c,f,m){c&=~b0,c&=~zl,o.suspendedLanes|=c,o.pingedLanes&=~c,m&&(o.warmLanes|=c),m=o.expirationTimes;for(var x=c;0<x;){var T=31-Qe(x),P=1<<T;m[T]=-1,x&=~P}f!==0&&Pe(o,f,c)}function jm(){return(dn&6)===0?(Uf(0),!1):!0}function w0(){if(Xt!==null){if(pn===0)var o=Xt.return;else o=Xt,Ra=Ul=null,W_(o),Zu=null,Mf=0,o=Xt;for(;o!==null;)a1(o.alternate,o),o=o.return;Xt=null}}function sc(o,c){var f=o.timeoutHandle;f!==-1&&(o.timeoutHandle=-1,ck(f)),f=o.cancelPendingCommit,f!==null&&(o.cancelPendingCommit=null,f()),w0(),Cn=o,Xt=f=Ea(o.current,null),Jt=c,pn=0,Wr=null,Lo=!1,tc=je(o,c),x0=!1,nc=hs=b0=zl=Uo=qn=0,Ar=Df=null,S0=!1,(c&8)!==0&&(c|=c&32);var m=o.entangledLanes;if(m!==0)for(o=o.entanglements,m&=c;0<m;){var x=31-Qe(m),T=1<<x;c|=o[x],m&=~T}return Ba=c,dm(),f}function R1(o,c){Gt=null,z.H=Dm,c===mf||c===Sm?(c=jA(),pn=3):c===GA?(c=jA(),pn=4):pn=c===qw?8:c!==null&&typeof c=="object"&&typeof c.then=="function"?6:1,Wr=c,Xt===null&&(qn=1,Im(o,as(c,o.current)))}function C1(){var o=z.H;return z.H=Dm,o===null?Dm:o}function N1(){var o=z.A;return z.A=WF,o}function R0(){qn=4,Lo||(Jt&4194048)!==Jt&&cs.current!==null||(tc=!0),(Uo&134217727)===0&&(zl&134217727)===0||Cn===null||Io(Cn,Jt,hs,!1)}function C0(o,c,f){var m=dn;dn|=2;var x=C1(),T=N1();(Cn!==o||Jt!==c)&&(Wm=null,sc(o,c)),c=!1;var P=qn;e:do try{if(pn!==0&&Xt!==null){var O=Xt,q=Wr;switch(pn){case 8:w0(),P=6;break e;case 3:case 2:case 9:case 6:cs.current===null&&(c=!0);var ce=pn;if(pn=0,Wr=null,ac(o,O,q,ce),f&&tc){P=0;break e}break;default:ce=pn,pn=0,Wr=null,ac(o,O,q,ce)}}$F(),P=qn;break}catch(Ae){R1(o,Ae)}while(!0);return c&&o.shellSuspendCounter++,Ra=Ul=null,dn=m,z.H=x,z.A=T,Xt===null&&(Cn=null,Jt=0,dm()),P}function $F(){for(;Xt!==null;)P1(Xt)}function XF(o,c){var f=dn;dn|=2;var m=C1(),x=N1();Cn!==o||Jt!==c?(Wm=null,Hm=Ft()+500,sc(o,c)):tc=je(o,c);e:do try{if(pn!==0&&Xt!==null){c=Xt;var T=Wr;t:switch(pn){case 1:pn=0,Wr=null,ac(o,c,T,1);break;case 2:case 9:if(HA(T)){pn=0,Wr=null,D1(c);break}c=function(){pn!==2&&pn!==9||Cn!==o||(pn=7),Ys(o)},T.then(c,c);break e;case 3:pn=7;break e;case 4:pn=5;break e;case 7:HA(T)?(pn=0,Wr=null,D1(c)):(pn=0,Wr=null,ac(o,c,T,7));break;case 5:var P=null;switch(Xt.tag){case 26:P=Xt.memoizedState;case 5:case 27:var O=Xt;if(!P||dR(P)){pn=0,Wr=null;var q=O.sibling;if(q!==null)Xt=q;else{var ce=O.return;ce!==null?(Xt=ce,qm(ce)):Xt=null}break t}}pn=0,Wr=null,ac(o,c,T,5);break;case 6:pn=0,Wr=null,ac(o,c,T,6);break;case 8:w0(),qn=6;break e;default:throw Error(n(462))}}YF();break}catch(Ae){R1(o,Ae)}while(!0);return Ra=Ul=null,z.H=m,z.A=x,dn=f,Xt!==null?0:(Cn=null,Jt=0,dm(),qn)}function YF(){for(;Xt!==null&&!mn();)P1(Xt)}function P1(o){var c=r1(o.alternate,o,Ba);o.memoizedProps=o.pendingProps,c===null?qm(o):Xt=c}function D1(o){var c=o,f=c.alternate;switch(c.tag){case 15:case 0:c=Qw(f,c,c.pendingProps,c.type,void 0,Jt);break;case 11:c=Qw(f,c,c.pendingProps,c.type.render,c.ref,Jt);break;case 5:W_(c);default:a1(f,c),c=Xt=LA(c,Ba),c=r1(f,c,Ba)}o.memoizedProps=o.pendingProps,c===null?qm(o):Xt=c}function ac(o,c,f,m){Ra=Ul=null,W_(c),Zu=null,Mf=0;var x=c.return;try{if(FF(o,x,c,f,Jt)){qn=1,Im(o,as(f,o.current)),Xt=null;return}}catch(T){if(x!==null)throw Xt=x,T;qn=1,Im(o,as(f,o.current)),Xt=null;return}c.flags&32768?(ln||m===1?o=!0:tc||(Jt&536870912)!==0?o=!1:(Lo=o=!0,(m===2||m===9||m===3||m===6)&&(m=cs.current,m!==null&&m.tag===13&&(m.flags|=16384))),L1(c,o)):qm(c)}function qm(o){var c=o;do{if((c.flags&32768)!==0){L1(c,Lo);return}o=c.return;var f=zF(c.alternate,c,Ba);if(f!==null){Xt=f;return}if(c=c.sibling,c!==null){Xt=c;return}Xt=c=o}while(c!==null);qn===0&&(qn=5)}function L1(o,c){do{var f=VF(o.alternate,o);if(f!==null){f.flags&=32767,Xt=f;return}if(f=o.return,f!==null&&(f.flags|=32768,f.subtreeFlags=0,f.deletions=null),!c&&(o=o.sibling,o!==null)){Xt=o;return}Xt=o=f}while(o!==null);qn=6,Xt=null}function U1(o,c,f,m,x,T,P,O,q){o.cancelPendingCommit=null;do $m();while(ki!==0);if((dn&6)!==0)throw Error(n(327));if(c!==null){if(c===o.current)throw Error(n(177));if(T=c.lanes|c.childLanes,T|=__,ze(o,f,T,P,O,q),o===Cn&&(Xt=Cn=null,Jt=0),ic=c,Bo=o,rc=f,M0=T,E0=x,M1=m,(c.subtreeFlags&10256)!==0||(c.flags&10256)!==0?(o.callbackNode=null,o.callbackPriority=0,JF(Pt,function(){return k1(),null})):(o.callbackNode=null,o.callbackPriority=0),m=(c.flags&13878)!==0,(c.subtreeFlags&13878)!==0||m){m=z.T,z.T=null,x=k.p,k.p=2,P=dn,dn|=4;try{GF(o,c,f)}finally{dn=P,k.p=x,z.T=m}}ki=1,O1(),B1(),I1()}}function O1(){if(ki===1){ki=0;var o=Bo,c=ic,f=(c.flags&13878)!==0;if((c.subtreeFlags&13878)!==0||f){f=z.T,z.T=null;var m=k.p;k.p=2;var x=dn;dn|=4;try{y1(c,o);var T=V0,P=TA(o.containerInfo),O=T.focusedElem,q=T.selectionRange;if(P!==O&&O&&O.ownerDocument&&SA(O.ownerDocument.documentElement,O)){if(q!==null&&p_(O)){var ce=q.start,Ae=q.end;if(Ae===void 0&&(Ae=ce),"selectionStart"in O)O.selectionStart=ce,O.selectionEnd=Math.min(Ae,O.value.length);else{var Ne=O.ownerDocument||document,pe=Ne&&Ne.defaultView||window;if(pe.getSelection){var me=pe.getSelection(),St=O.textContent.length,yt=Math.min(q.start,St),vn=q.end===void 0?yt:Math.min(q.end,St);!me.extend&&yt>vn&&(P=vn,vn=yt,yt=P);var te=bA(O,yt),Q=bA(O,vn);if(te&&Q&&(me.rangeCount!==1||me.anchorNode!==te.node||me.anchorOffset!==te.offset||me.focusNode!==Q.node||me.focusOffset!==Q.offset)){var ue=Ne.createRange();ue.setStart(te.node,te.offset),me.removeAllRanges(),yt>vn?(me.addRange(ue),me.extend(Q.node,Q.offset)):(ue.setEnd(Q.node,Q.offset),me.addRange(ue))}}}}for(Ne=[],me=O;me=me.parentNode;)me.nodeType===1&&Ne.push({element:me,left:me.scrollLeft,top:me.scrollTop});for(typeof O.focus=="function"&&O.focus(),O=0;O<Ne.length;O++){var Re=Ne[O];Re.element.scrollLeft=Re.left,Re.element.scrollTop=Re.top}}sg=!!z0,V0=z0=null}finally{dn=x,k.p=m,z.T=f}}o.current=c,ki=2}}function B1(){if(ki===2){ki=0;var o=Bo,c=ic,f=(c.flags&8772)!==0;if((c.subtreeFlags&8772)!==0||f){f=z.T,z.T=null;var m=k.p;k.p=2;var x=dn;dn|=4;try{d1(o,c.alternate,c)}finally{dn=x,k.p=m,z.T=f}}ki=3}}function I1(){if(ki===4||ki===3){ki=0,jt();var o=Bo,c=ic,f=rc,m=M1;(c.subtreeFlags&10256)!==0||(c.flags&10256)!==0?ki=5:(ki=0,ic=Bo=null,F1(o,o.pendingLanes));var x=o.pendingLanes;if(x===0&&(Oo=null),fn(f),c=c.stateNode,Ce&&typeof Ce.onCommitFiberRoot=="function")try{Ce.onCommitFiberRoot(we,c,void 0,(c.current.flags&128)===128)}catch{}if(m!==null){c=z.T,x=k.p,k.p=2,z.T=null;try{for(var T=o.onRecoverableError,P=0;P<m.length;P++){var O=m[P];T(O.value,{componentStack:O.stack})}}finally{z.T=c,k.p=x}}(rc&3)!==0&&$m(),Ys(o),x=o.pendingLanes,(f&4194090)!==0&&(x&42)!==0?o===A0?Lf++:(Lf=0,A0=o):Lf=0,Uf(0)}}function F1(o,c){(o.pooledCacheLanes&=c)===0&&(c=o.pooledCache,c!=null&&(o.pooledCache=null,df(c)))}function $m(o){return O1(),B1(),I1(),k1()}function k1(){if(ki!==5)return!1;var o=Bo,c=M0;M0=0;var f=fn(rc),m=z.T,x=k.p;try{k.p=32>f?32:f,z.T=null,f=E0,E0=null;var T=Bo,P=rc;if(ki=0,ic=Bo=null,rc=0,(dn&6)!==0)throw Error(n(331));var O=dn;if(dn|=4,S1(T.current),_1(T,T.current,P,f),dn=O,Uf(0,!1),Ce&&typeof Ce.onPostCommitFiberRoot=="function")try{Ce.onPostCommitFiberRoot(we,T)}catch{}return!0}finally{k.p=x,z.T=m,F1(o,c)}}function z1(o,c,f){c=as(f,c),c=r0(o.stateNode,c,2),o=Ao(o,c,2),o!==null&&(et(o,2),Ys(o))}function Sn(o,c,f){if(o.tag===3)z1(o,o,f);else for(;c!==null;){if(c.tag===3){z1(c,o,f);break}else if(c.tag===1){var m=c.stateNode;if(typeof c.type.getDerivedStateFromError=="function"||typeof m.componentDidCatch=="function"&&(Oo===null||!Oo.has(m))){o=as(f,o),f=Ww(2),m=Ao(c,f,2),m!==null&&(jw(f,m,c,o),et(m,2),Ys(m));break}}c=c.return}}function N0(o,c,f){var m=o.pingCache;if(m===null){m=o.pingCache=new jF;var x=new Set;m.set(c,x)}else x=m.get(c),x===void 0&&(x=new Set,m.set(c,x));x.has(f)||(x0=!0,x.add(f),o=KF.bind(null,o,c,f),c.then(o,o))}function KF(o,c,f){var m=o.pingCache;m!==null&&m.delete(c),o.pingedLanes|=o.suspendedLanes&f,o.warmLanes&=~f,Cn===o&&(Jt&f)===f&&(qn===4||qn===3&&(Jt&62914560)===Jt&&300>Ft()-T0?(dn&2)===0&&sc(o,0):b0|=f,nc===Jt&&(nc=0)),Ys(o)}function V1(o,c){c===0&&(c=Xe()),o=Vu(o,c),o!==null&&(et(o,c),Ys(o))}function ZF(o){var c=o.memoizedState,f=0;c!==null&&(f=c.retryLane),V1(o,f)}function QF(o,c){var f=0;switch(o.tag){case 13:var m=o.stateNode,x=o.memoizedState;x!==null&&(f=x.retryLane);break;case 19:m=o.stateNode;break;case 22:m=o.stateNode._retryCache;break;default:throw Error(n(314))}m!==null&&m.delete(c),V1(o,f)}function JF(o,c){return Rt(o,c)}var Xm=null,oc=null,P0=!1,Ym=!1,D0=!1,Vl=0;function Ys(o){o!==oc&&o.next===null&&(oc===null?Xm=oc=o:oc=oc.next=o),Ym=!0,P0||(P0=!0,tk())}function Uf(o,c){if(!D0&&Ym){D0=!0;do for(var f=!1,m=Xm;m!==null;){if(o!==0){var x=m.pendingLanes;if(x===0)var T=0;else{var P=m.suspendedLanes,O=m.pingedLanes;T=(1<<31-Qe(42|o)+1)-1,T&=x&~(P&~O),T=T&201326741?T&201326741|1:T?T|2:0}T!==0&&(f=!0,j1(m,T))}else T=Jt,T=dt(m,m===Cn?T:0,m.cancelPendingCommit!==null||m.timeoutHandle!==-1),(T&3)===0||je(m,T)||(f=!0,j1(m,T));m=m.next}while(f);D0=!1}}function ek(){G1()}function G1(){Ym=P0=!1;var o=0;Vl!==0&&(uk()&&(o=Vl),Vl=0);for(var c=Ft(),f=null,m=Xm;m!==null;){var x=m.next,T=H1(m,c);T===0?(m.next=null,f===null?Xm=x:f.next=x,x===null&&(oc=f)):(f=m,(o!==0||(T&3)!==0)&&(Ym=!0)),m=x}Uf(o)}function H1(o,c){for(var f=o.suspendedLanes,m=o.pingedLanes,x=o.expirationTimes,T=o.pendingLanes&-62914561;0<T;){var P=31-Qe(T),O=1<<P,q=x[P];q===-1?((O&f)===0||(O&m)!==0)&&(x[P]=Ct(O,c)):q<=c&&(o.expiredLanes|=O),T&=~O}if(c=Cn,f=Jt,f=dt(o,o===c?f:0,o.cancelPendingCommit!==null||o.timeoutHandle!==-1),m=o.callbackNode,f===0||o===c&&(pn===2||pn===9)||o.cancelPendingCommit!==null)return m!==null&&m!==null&&X(m),o.callbackNode=null,o.callbackPriority=0;if((f&3)===0||je(o,f)){if(c=f&-f,c===o.callbackPriority)return c;switch(m!==null&&X(m),fn(f)){case 2:case 8:f=pt;break;case 32:f=Pt;break;case 268435456:f=H;break;default:f=Pt}return m=W1.bind(null,o),f=Rt(f,m),o.callbackPriority=c,o.callbackNode=f,c}return m!==null&&m!==null&&X(m),o.callbackPriority=2,o.callbackNode=null,2}function W1(o,c){if(ki!==0&&ki!==5)return o.callbackNode=null,o.callbackPriority=0,null;var f=o.callbackNode;if($m()&&o.callbackNode!==f)return null;var m=Jt;return m=dt(o,o===Cn?m:0,o.cancelPendingCommit!==null||o.timeoutHandle!==-1),m===0?null:(A1(o,m,c),H1(o,Ft()),o.callbackNode!=null&&o.callbackNode===f?W1.bind(null,o):null)}function j1(o,c){if($m())return null;A1(o,c,!0)}function tk(){hk(function(){(dn&6)!==0?Rt(Kt,ek):G1()})}function L0(){return Vl===0&&(Vl=J()),Vl}function q1(o){return o==null||typeof o=="symbol"||typeof o=="boolean"?null:typeof o=="function"?o:am(""+o)}function $1(o,c){var f=c.ownerDocument.createElement("input");return f.name=c.name,f.value=c.value,o.id&&f.setAttribute("form",o.id),c.parentNode.insertBefore(f,c),o=new FormData(o),f.parentNode.removeChild(f),o}function nk(o,c,f,m,x){if(c==="submit"&&f&&f.stateNode===x){var T=q1((x[Bi]||null).action),P=m.submitter;P&&(c=(c=P[Bi]||null)?q1(c.formAction):P.getAttribute("formAction"),c!==null&&(T=c,P=null));var O=new cm("action","action",null,m,x);o.push({event:O,listeners:[{instance:null,listener:function(){if(m.defaultPrevented){if(Vl!==0){var q=P?$1(x,P):new FormData(x);J_(f,{pending:!0,data:q,method:x.method,action:T},null,q)}}else typeof T=="function"&&(O.preventDefault(),q=P?$1(x,P):new FormData(x),J_(f,{pending:!0,data:q,method:x.method,action:T},T,q))},currentTarget:x}]})}}for(var U0=0;U0<v_.length;U0++){var O0=v_[U0],ik=O0.toLowerCase(),rk=O0[0].toUpperCase()+O0.slice(1);Es(ik,"on"+rk)}Es(AA,"onAnimationEnd"),Es(wA,"onAnimationIteration"),Es(RA,"onAnimationStart"),Es("dblclick","onDoubleClick"),Es("focusin","onFocus"),Es("focusout","onBlur"),Es(bF,"onTransitionRun"),Es(SF,"onTransitionStart"),Es(TF,"onTransitionCancel"),Es(CA,"onTransitionEnd"),B("onMouseEnter",["mouseout","mouseover"]),B("onMouseLeave",["mouseout","mouseover"]),B("onPointerEnter",["pointerout","pointerover"]),B("onPointerLeave",["pointerout","pointerover"]),ba("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ba("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ba("onBeforeInput",["compositionend","keypress","textInput","paste"]),ba("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ba("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ba("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Of="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),sk=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Of));function X1(o,c){c=(c&4)!==0;for(var f=0;f<o.length;f++){var m=o[f],x=m.event;m=m.listeners;e:{var T=void 0;if(c)for(var P=m.length-1;0<=P;P--){var O=m[P],q=O.instance,ce=O.currentTarget;if(O=O.listener,q!==T&&x.isPropagationStopped())break e;T=O,x.currentTarget=ce;try{T(x)}catch(Ae){Bm(Ae)}x.currentTarget=null,T=q}else for(P=0;P<m.length;P++){if(O=m[P],q=O.instance,ce=O.currentTarget,O=O.listener,q!==T&&x.isPropagationStopped())break e;T=O,x.currentTarget=ce;try{T(x)}catch(Ae){Bm(Ae)}x.currentTarget=null,T=q}}}}function Yt(o,c){var f=c[Tl];f===void 0&&(f=c[Tl]=new Set);var m=o+"__bubble";f.has(m)||(Y1(c,o,2,!1),f.add(m))}function B0(o,c,f){var m=0;c&&(m|=4),Y1(f,o,m,c)}var Km="_reactListening"+Math.random().toString(36).slice(2);function I0(o){if(!o[Km]){o[Km]=!0,rm.forEach(function(f){f!=="selectionchange"&&(sk.has(f)||B0(f,!1,o),B0(f,!0,o))});var c=o.nodeType===9?o:o.ownerDocument;c===null||c[Km]||(c[Km]=!0,B0("selectionchange",!1,c))}}function Y1(o,c,f,m){switch(_R(c)){case 2:var x=Dk;break;case 8:x=Lk;break;default:x=Z0}f=x.bind(null,c,f,o),x=void 0,!s_||c!=="touchstart"&&c!=="touchmove"&&c!=="wheel"||(x=!0),m?x!==void 0?o.addEventListener(c,f,{capture:!0,passive:x}):o.addEventListener(c,f,!0):x!==void 0?o.addEventListener(c,f,{passive:x}):o.addEventListener(c,f,!1)}function F0(o,c,f,m,x){var T=m;if((c&1)===0&&(c&2)===0&&m!==null)e:for(;;){if(m===null)return;var P=m.tag;if(P===3||P===4){var O=m.stateNode.containerInfo;if(O===x)break;if(P===4)for(P=m.return;P!==null;){var q=P.tag;if((q===3||q===4)&&P.stateNode.containerInfo===x)return;P=P.return}for(;O!==null;){if(P=_a(O),P===null)return;if(q=P.tag,q===5||q===6||q===26||q===27){m=T=P;continue e}O=O.parentNode}}m=m.return}nA(function(){var ce=T,Ae=i_(f),Ne=[];e:{var pe=NA.get(o);if(pe!==void 0){var me=cm,St=o;switch(o){case"keypress":if(lm(f)===0)break e;case"keydown":case"keyup":me=J3;break;case"focusin":St="focus",me=u_;break;case"focusout":St="blur",me=u_;break;case"beforeblur":case"afterblur":me=u_;break;case"click":if(f.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":me=sA;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":me=V3;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":me=nF;break;case AA:case wA:case RA:me=W3;break;case CA:me=rF;break;case"scroll":case"scrollend":me=k3;break;case"wheel":me=aF;break;case"copy":case"cut":case"paste":me=q3;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":me=oA;break;case"toggle":case"beforetoggle":me=lF}var yt=(c&4)!==0,vn=!yt&&(o==="scroll"||o==="scrollend"),te=yt?pe!==null?pe+"Capture":null:pe;yt=[];for(var Q=ce,ue;Q!==null;){var Re=Q;if(ue=Re.stateNode,Re=Re.tag,Re!==5&&Re!==26&&Re!==27||ue===null||te===null||(Re=Jh(Q,te),Re!=null&&yt.push(Bf(Q,Re,ue))),vn)break;Q=Q.return}0<yt.length&&(pe=new me(pe,St,null,f,Ae),Ne.push({event:pe,listeners:yt}))}}if((c&7)===0){e:{if(pe=o==="mouseover"||o==="pointerover",me=o==="mouseout"||o==="pointerout",pe&&f!==n_&&(St=f.relatedTarget||f.fromElement)&&(_a(St)||St[Sr]))break e;if((me||pe)&&(pe=Ae.window===Ae?Ae:(pe=Ae.ownerDocument)?pe.defaultView||pe.parentWindow:window,me?(St=f.relatedTarget||f.toElement,me=ce,St=St?_a(St):null,St!==null&&(vn=s(St),yt=St.tag,St!==vn||yt!==5&&yt!==27&&yt!==6)&&(St=null)):(me=null,St=ce),me!==St)){if(yt=sA,Re="onMouseLeave",te="onMouseEnter",Q="mouse",(o==="pointerout"||o==="pointerover")&&(yt=oA,Re="onPointerLeave",te="onPointerEnter",Q="pointer"),vn=me==null?pe:El(me),ue=St==null?pe:El(St),pe=new yt(Re,Q+"leave",me,f,Ae),pe.target=vn,pe.relatedTarget=ue,Re=null,_a(Ae)===ce&&(yt=new yt(te,Q+"enter",St,f,Ae),yt.target=ue,yt.relatedTarget=vn,Re=yt),vn=Re,me&&St)t:{for(yt=me,te=St,Q=0,ue=yt;ue;ue=lc(ue))Q++;for(ue=0,Re=te;Re;Re=lc(Re))ue++;for(;0<Q-ue;)yt=lc(yt),Q--;for(;0<ue-Q;)te=lc(te),ue--;for(;Q--;){if(yt===te||te!==null&&yt===te.alternate)break t;yt=lc(yt),te=lc(te)}yt=null}else yt=null;me!==null&&K1(Ne,pe,me,yt,!1),St!==null&&vn!==null&&K1(Ne,vn,St,yt,!0)}}e:{if(pe=ce?El(ce):window,me=pe.nodeName&&pe.nodeName.toLowerCase(),me==="select"||me==="input"&&pe.type==="file")var it=mA;else if(dA(pe))if(gA)it=vF;else{it=gF;var qt=mF}else me=pe.nodeName,!me||me.toLowerCase()!=="input"||pe.type!=="checkbox"&&pe.type!=="radio"?ce&&t_(ce.elementType)&&(it=mA):it=yF;if(it&&(it=it(o,ce))){pA(Ne,it,f,Ae);break e}qt&&qt(o,pe,ce),o==="focusout"&&ce&&pe.type==="number"&&ce.memoizedProps.value!=null&&$i(pe,"number",pe.value)}switch(qt=ce?El(ce):window,o){case"focusin":(dA(qt)||qt.contentEditable==="true")&&(Fu=qt,m_=ce,lf=null);break;case"focusout":lf=m_=Fu=null;break;case"mousedown":g_=!0;break;case"contextmenu":case"mouseup":case"dragend":g_=!1,MA(Ne,f,Ae);break;case"selectionchange":if(xF)break;case"keydown":case"keyup":MA(Ne,f,Ae)}var ht;if(h_)e:{switch(o){case"compositionstart":var _t="onCompositionStart";break e;case"compositionend":_t="onCompositionEnd";break e;case"compositionupdate":_t="onCompositionUpdate";break e}_t=void 0}else Iu?hA(o,f)&&(_t="onCompositionEnd"):o==="keydown"&&f.keyCode===229&&(_t="onCompositionStart");_t&&(lA&&f.locale!=="ko"&&(Iu||_t!=="onCompositionStart"?_t==="onCompositionEnd"&&Iu&&(ht=iA()):(So=Ae,a_="value"in So?So.value:So.textContent,Iu=!0)),qt=Zm(ce,_t),0<qt.length&&(_t=new aA(_t,o,null,f,Ae),Ne.push({event:_t,listeners:qt}),ht?_t.data=ht:(ht=fA(f),ht!==null&&(_t.data=ht)))),(ht=cF?hF(o,f):fF(o,f))&&(_t=Zm(ce,"onBeforeInput"),0<_t.length&&(qt=new aA("onBeforeInput","beforeinput",null,f,Ae),Ne.push({event:qt,listeners:_t}),qt.data=ht)),nk(Ne,o,ce,f,Ae)}X1(Ne,c)})}function Bf(o,c,f){return{instance:o,listener:c,currentTarget:f}}function Zm(o,c){for(var f=c+"Capture",m=[];o!==null;){var x=o,T=x.stateNode;if(x=x.tag,x!==5&&x!==26&&x!==27||T===null||(x=Jh(o,f),x!=null&&m.unshift(Bf(o,x,T)),x=Jh(o,c),x!=null&&m.push(Bf(o,x,T))),o.tag===3)return m;o=o.return}return[]}function lc(o){if(o===null)return null;do o=o.return;while(o&&o.tag!==5&&o.tag!==27);return o||null}function K1(o,c,f,m,x){for(var T=c._reactName,P=[];f!==null&&f!==m;){var O=f,q=O.alternate,ce=O.stateNode;if(O=O.tag,q!==null&&q===m)break;O!==5&&O!==26&&O!==27||ce===null||(q=ce,x?(ce=Jh(f,T),ce!=null&&P.unshift(Bf(f,ce,q))):x||(ce=Jh(f,T),ce!=null&&P.push(Bf(f,ce,q)))),f=f.return}P.length!==0&&o.push({event:c,listeners:P})}var ak=/\r\n?/g,ok=/\u0000|\uFFFD/g;function Z1(o){return(typeof o=="string"?o:""+o).replace(ak,`
`).replace(ok,"")}function Q1(o,c){return c=Z1(c),Z1(o)===c}function Qm(){}function yn(o,c,f,m,x,T){switch(f){case"children":typeof m=="string"?c==="body"||c==="textarea"&&m===""||Ws(o,m):(typeof m=="number"||typeof m=="bigint")&&c!=="body"&&Ws(o,""+m);break;case"className":qe(o,"class",m);break;case"tabIndex":qe(o,"tabindex",m);break;case"dir":case"role":case"viewBox":case"width":case"height":qe(o,f,m);break;case"style":eA(o,m,T);break;case"data":if(c!=="object"){qe(o,"data",m);break}case"src":case"href":if(m===""&&(c!=="a"||f!=="href")){o.removeAttribute(f);break}if(m==null||typeof m=="function"||typeof m=="symbol"||typeof m=="boolean"){o.removeAttribute(f);break}m=am(""+m),o.setAttribute(f,m);break;case"action":case"formAction":if(typeof m=="function"){o.setAttribute(f,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof T=="function"&&(f==="formAction"?(c!=="input"&&yn(o,c,"name",x.name,x,null),yn(o,c,"formEncType",x.formEncType,x,null),yn(o,c,"formMethod",x.formMethod,x,null),yn(o,c,"formTarget",x.formTarget,x,null)):(yn(o,c,"encType",x.encType,x,null),yn(o,c,"method",x.method,x,null),yn(o,c,"target",x.target,x,null)));if(m==null||typeof m=="symbol"||typeof m=="boolean"){o.removeAttribute(f);break}m=am(""+m),o.setAttribute(f,m);break;case"onClick":m!=null&&(o.onclick=Qm);break;case"onScroll":m!=null&&Yt("scroll",o);break;case"onScrollEnd":m!=null&&Yt("scrollend",o);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(n(61));if(f=m.__html,f!=null){if(x.children!=null)throw Error(n(60));o.innerHTML=f}}break;case"multiple":o.multiple=m&&typeof m!="function"&&typeof m!="symbol";break;case"muted":o.muted=m&&typeof m!="function"&&typeof m!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(m==null||typeof m=="function"||typeof m=="boolean"||typeof m=="symbol"){o.removeAttribute("xlink:href");break}f=am(""+m),o.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",f);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":m!=null&&typeof m!="function"&&typeof m!="symbol"?o.setAttribute(f,""+m):o.removeAttribute(f);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":m&&typeof m!="function"&&typeof m!="symbol"?o.setAttribute(f,""):o.removeAttribute(f);break;case"capture":case"download":m===!0?o.setAttribute(f,""):m!==!1&&m!=null&&typeof m!="function"&&typeof m!="symbol"?o.setAttribute(f,m):o.removeAttribute(f);break;case"cols":case"rows":case"size":case"span":m!=null&&typeof m!="function"&&typeof m!="symbol"&&!isNaN(m)&&1<=m?o.setAttribute(f,m):o.removeAttribute(f);break;case"rowSpan":case"start":m==null||typeof m=="function"||typeof m=="symbol"||isNaN(m)?o.removeAttribute(f):o.setAttribute(f,m);break;case"popover":Yt("beforetoggle",o),Yt("toggle",o),ke(o,"popover",m);break;case"xlinkActuate":Ke(o,"http://www.w3.org/1999/xlink","xlink:actuate",m);break;case"xlinkArcrole":Ke(o,"http://www.w3.org/1999/xlink","xlink:arcrole",m);break;case"xlinkRole":Ke(o,"http://www.w3.org/1999/xlink","xlink:role",m);break;case"xlinkShow":Ke(o,"http://www.w3.org/1999/xlink","xlink:show",m);break;case"xlinkTitle":Ke(o,"http://www.w3.org/1999/xlink","xlink:title",m);break;case"xlinkType":Ke(o,"http://www.w3.org/1999/xlink","xlink:type",m);break;case"xmlBase":Ke(o,"http://www.w3.org/XML/1998/namespace","xml:base",m);break;case"xmlLang":Ke(o,"http://www.w3.org/XML/1998/namespace","xml:lang",m);break;case"xmlSpace":Ke(o,"http://www.w3.org/XML/1998/namespace","xml:space",m);break;case"is":ke(o,"is",m);break;case"innerText":case"textContent":break;default:(!(2<f.length)||f[0]!=="o"&&f[0]!=="O"||f[1]!=="n"&&f[1]!=="N")&&(f=I3.get(f)||f,ke(o,f,m))}}function k0(o,c,f,m,x,T){switch(f){case"style":eA(o,m,T);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(n(61));if(f=m.__html,f!=null){if(x.children!=null)throw Error(n(60));o.innerHTML=f}}break;case"children":typeof m=="string"?Ws(o,m):(typeof m=="number"||typeof m=="bigint")&&Ws(o,""+m);break;case"onScroll":m!=null&&Yt("scroll",o);break;case"onScrollEnd":m!=null&&Yt("scrollend",o);break;case"onClick":m!=null&&(o.onclick=Qm);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!sm.hasOwnProperty(f))e:{if(f[0]==="o"&&f[1]==="n"&&(x=f.endsWith("Capture"),c=f.slice(2,x?f.length-7:void 0),T=o[Bi]||null,T=T!=null?T[f]:null,typeof T=="function"&&o.removeEventListener(c,T,x),typeof m=="function")){typeof T!="function"&&T!==null&&(f in o?o[f]=null:o.hasAttribute(f)&&o.removeAttribute(f)),o.addEventListener(c,m,x);break e}f in o?o[f]=m:m===!0?o.setAttribute(f,""):ke(o,f,m)}}}function zi(o,c,f){switch(c){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Yt("error",o),Yt("load",o);var m=!1,x=!1,T;for(T in f)if(f.hasOwnProperty(T)){var P=f[T];if(P!=null)switch(T){case"src":m=!0;break;case"srcSet":x=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,c));default:yn(o,c,T,P,f,null)}}x&&yn(o,c,"srcSet",f.srcSet,f,null),m&&yn(o,c,"src",f.src,f,null);return;case"input":Yt("invalid",o);var O=T=P=x=null,q=null,ce=null;for(m in f)if(f.hasOwnProperty(m)){var Ae=f[m];if(Ae!=null)switch(m){case"name":x=Ae;break;case"type":P=Ae;break;case"checked":q=Ae;break;case"defaultChecked":ce=Ae;break;case"value":T=Ae;break;case"defaultValue":O=Ae;break;case"children":case"dangerouslySetInnerHTML":if(Ae!=null)throw Error(n(137,c));break;default:yn(o,c,m,Ae,f,null)}}bn(o,T,O,q,ce,P,x,!1),Wn(o);return;case"select":Yt("invalid",o),m=P=T=null;for(x in f)if(f.hasOwnProperty(x)&&(O=f[x],O!=null))switch(x){case"value":T=O;break;case"defaultValue":P=O;break;case"multiple":m=O;default:yn(o,c,x,O,f,null)}c=T,f=P,o.multiple=!!m,c!=null?vi(o,!!m,c,!1):f!=null&&vi(o,!!m,f,!0);return;case"textarea":Yt("invalid",o),T=x=m=null;for(P in f)if(f.hasOwnProperty(P)&&(O=f[P],O!=null))switch(P){case"value":m=O;break;case"defaultValue":x=O;break;case"children":T=O;break;case"dangerouslySetInnerHTML":if(O!=null)throw Error(n(91));break;default:yn(o,c,P,O,f,null)}Ii(o,m,x,T),Wn(o);return;case"option":for(q in f)if(f.hasOwnProperty(q)&&(m=f[q],m!=null))switch(q){case"selected":o.selected=m&&typeof m!="function"&&typeof m!="symbol";break;default:yn(o,c,q,m,f,null)}return;case"dialog":Yt("beforetoggle",o),Yt("toggle",o),Yt("cancel",o),Yt("close",o);break;case"iframe":case"object":Yt("load",o);break;case"video":case"audio":for(m=0;m<Of.length;m++)Yt(Of[m],o);break;case"image":Yt("error",o),Yt("load",o);break;case"details":Yt("toggle",o);break;case"embed":case"source":case"link":Yt("error",o),Yt("load",o);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ce in f)if(f.hasOwnProperty(ce)&&(m=f[ce],m!=null))switch(ce){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,c));default:yn(o,c,ce,m,f,null)}return;default:if(t_(c)){for(Ae in f)f.hasOwnProperty(Ae)&&(m=f[Ae],m!==void 0&&k0(o,c,Ae,m,f,void 0));return}}for(O in f)f.hasOwnProperty(O)&&(m=f[O],m!=null&&yn(o,c,O,m,f,null))}function lk(o,c,f,m){switch(c){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var x=null,T=null,P=null,O=null,q=null,ce=null,Ae=null;for(me in f){var Ne=f[me];if(f.hasOwnProperty(me)&&Ne!=null)switch(me){case"checked":break;case"value":break;case"defaultValue":q=Ne;default:m.hasOwnProperty(me)||yn(o,c,me,null,m,Ne)}}for(var pe in m){var me=m[pe];if(Ne=f[pe],m.hasOwnProperty(pe)&&(me!=null||Ne!=null))switch(pe){case"type":T=me;break;case"name":x=me;break;case"checked":ce=me;break;case"defaultChecked":Ae=me;break;case"value":P=me;break;case"defaultValue":O=me;break;case"children":case"dangerouslySetInnerHTML":if(me!=null)throw Error(n(137,c));break;default:me!==Ne&&yn(o,c,pe,me,m,Ne)}}Sa(o,P,O,q,ce,Ae,T,x);return;case"select":me=P=O=pe=null;for(T in f)if(q=f[T],f.hasOwnProperty(T)&&q!=null)switch(T){case"value":break;case"multiple":me=q;default:m.hasOwnProperty(T)||yn(o,c,T,null,m,q)}for(x in m)if(T=m[x],q=f[x],m.hasOwnProperty(x)&&(T!=null||q!=null))switch(x){case"value":pe=T;break;case"defaultValue":O=T;break;case"multiple":P=T;default:T!==q&&yn(o,c,x,T,m,q)}c=O,f=P,m=me,pe!=null?vi(o,!!f,pe,!1):!!m!=!!f&&(c!=null?vi(o,!!f,c,!0):vi(o,!!f,f?[]:"",!1));return;case"textarea":me=pe=null;for(O in f)if(x=f[O],f.hasOwnProperty(O)&&x!=null&&!m.hasOwnProperty(O))switch(O){case"value":break;case"children":break;default:yn(o,c,O,null,m,x)}for(P in m)if(x=m[P],T=f[P],m.hasOwnProperty(P)&&(x!=null||T!=null))switch(P){case"value":pe=x;break;case"defaultValue":me=x;break;case"children":break;case"dangerouslySetInnerHTML":if(x!=null)throw Error(n(91));break;default:x!==T&&yn(o,c,P,x,m,T)}wi(o,pe,me);return;case"option":for(var St in f)if(pe=f[St],f.hasOwnProperty(St)&&pe!=null&&!m.hasOwnProperty(St))switch(St){case"selected":o.selected=!1;break;default:yn(o,c,St,null,m,pe)}for(q in m)if(pe=m[q],me=f[q],m.hasOwnProperty(q)&&pe!==me&&(pe!=null||me!=null))switch(q){case"selected":o.selected=pe&&typeof pe!="function"&&typeof pe!="symbol";break;default:yn(o,c,q,pe,m,me)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var yt in f)pe=f[yt],f.hasOwnProperty(yt)&&pe!=null&&!m.hasOwnProperty(yt)&&yn(o,c,yt,null,m,pe);for(ce in m)if(pe=m[ce],me=f[ce],m.hasOwnProperty(ce)&&pe!==me&&(pe!=null||me!=null))switch(ce){case"children":case"dangerouslySetInnerHTML":if(pe!=null)throw Error(n(137,c));break;default:yn(o,c,ce,pe,m,me)}return;default:if(t_(c)){for(var vn in f)pe=f[vn],f.hasOwnProperty(vn)&&pe!==void 0&&!m.hasOwnProperty(vn)&&k0(o,c,vn,void 0,m,pe);for(Ae in m)pe=m[Ae],me=f[Ae],!m.hasOwnProperty(Ae)||pe===me||pe===void 0&&me===void 0||k0(o,c,Ae,pe,m,me);return}}for(var te in f)pe=f[te],f.hasOwnProperty(te)&&pe!=null&&!m.hasOwnProperty(te)&&yn(o,c,te,null,m,pe);for(Ne in m)pe=m[Ne],me=f[Ne],!m.hasOwnProperty(Ne)||pe===me||pe==null&&me==null||yn(o,c,Ne,pe,m,me)}var z0=null,V0=null;function Jm(o){return o.nodeType===9?o:o.ownerDocument}function J1(o){switch(o){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function eR(o,c){if(o===0)switch(c){case"svg":return 1;case"math":return 2;default:return 0}return o===1&&c==="foreignObject"?0:o}function G0(o,c){return o==="textarea"||o==="noscript"||typeof c.children=="string"||typeof c.children=="number"||typeof c.children=="bigint"||typeof c.dangerouslySetInnerHTML=="object"&&c.dangerouslySetInnerHTML!==null&&c.dangerouslySetInnerHTML.__html!=null}var H0=null;function uk(){var o=window.event;return o&&o.type==="popstate"?o===H0?!1:(H0=o,!0):(H0=null,!1)}var tR=typeof setTimeout=="function"?setTimeout:void 0,ck=typeof clearTimeout=="function"?clearTimeout:void 0,nR=typeof Promise=="function"?Promise:void 0,hk=typeof queueMicrotask=="function"?queueMicrotask:typeof nR<"u"?function(o){return nR.resolve(null).then(o).catch(fk)}:tR;function fk(o){setTimeout(function(){throw o})}function Fo(o){return o==="head"}function iR(o,c){var f=c,m=0,x=0;do{var T=f.nextSibling;if(o.removeChild(f),T&&T.nodeType===8)if(f=T.data,f==="/$"){if(0<m&&8>m){f=m;var P=o.ownerDocument;if(f&1&&If(P.documentElement),f&2&&If(P.body),f&4)for(f=P.head,If(f),P=f.firstChild;P;){var O=P.nextSibling,q=P.nodeName;P[vo]||q==="SCRIPT"||q==="STYLE"||q==="LINK"&&P.rel.toLowerCase()==="stylesheet"||f.removeChild(P),P=O}}if(x===0){o.removeChild(T),jf(c);return}x--}else f==="$"||f==="$?"||f==="$!"?x++:m=f.charCodeAt(0)-48;else m=0;f=T}while(f);jf(c)}function W0(o){var c=o.firstChild;for(c&&c.nodeType===10&&(c=c.nextSibling);c;){var f=c;switch(c=c.nextSibling,f.nodeName){case"HTML":case"HEAD":case"BODY":W0(f),_o(f);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(f.rel.toLowerCase()==="stylesheet")continue}o.removeChild(f)}}function dk(o,c,f,m){for(;o.nodeType===1;){var x=f;if(o.nodeName.toLowerCase()!==c.toLowerCase()){if(!m&&(o.nodeName!=="INPUT"||o.type!=="hidden"))break}else if(m){if(!o[vo])switch(c){case"meta":if(!o.hasAttribute("itemprop"))break;return o;case"link":if(T=o.getAttribute("rel"),T==="stylesheet"&&o.hasAttribute("data-precedence"))break;if(T!==x.rel||o.getAttribute("href")!==(x.href==null||x.href===""?null:x.href)||o.getAttribute("crossorigin")!==(x.crossOrigin==null?null:x.crossOrigin)||o.getAttribute("title")!==(x.title==null?null:x.title))break;return o;case"style":if(o.hasAttribute("data-precedence"))break;return o;case"script":if(T=o.getAttribute("src"),(T!==(x.src==null?null:x.src)||o.getAttribute("type")!==(x.type==null?null:x.type)||o.getAttribute("crossorigin")!==(x.crossOrigin==null?null:x.crossOrigin))&&T&&o.hasAttribute("async")&&!o.hasAttribute("itemprop"))break;return o;default:return o}}else if(c==="input"&&o.type==="hidden"){var T=x.name==null?null:""+x.name;if(x.type==="hidden"&&o.getAttribute("name")===T)return o}else return o;if(o=ws(o.nextSibling),o===null)break}return null}function pk(o,c,f){if(c==="")return null;for(;o.nodeType!==3;)if((o.nodeType!==1||o.nodeName!=="INPUT"||o.type!=="hidden")&&!f||(o=ws(o.nextSibling),o===null))return null;return o}function j0(o){return o.data==="$!"||o.data==="$?"&&o.ownerDocument.readyState==="complete"}function mk(o,c){var f=o.ownerDocument;if(o.data!=="$?"||f.readyState==="complete")c();else{var m=function(){c(),f.removeEventListener("DOMContentLoaded",m)};f.addEventListener("DOMContentLoaded",m),o._reactRetry=m}}function ws(o){for(;o!=null;o=o.nextSibling){var c=o.nodeType;if(c===1||c===3)break;if(c===8){if(c=o.data,c==="$"||c==="$!"||c==="$?"||c==="F!"||c==="F")break;if(c==="/$")return null}}return o}var q0=null;function rR(o){o=o.previousSibling;for(var c=0;o;){if(o.nodeType===8){var f=o.data;if(f==="$"||f==="$!"||f==="$?"){if(c===0)return o;c--}else f==="/$"&&c++}o=o.previousSibling}return null}function sR(o,c,f){switch(c=Jm(f),o){case"html":if(o=c.documentElement,!o)throw Error(n(452));return o;case"head":if(o=c.head,!o)throw Error(n(453));return o;case"body":if(o=c.body,!o)throw Error(n(454));return o;default:throw Error(n(451))}}function If(o){for(var c=o.attributes;c.length;)o.removeAttributeNode(c[0]);_o(o)}var fs=new Map,aR=new Set;function eg(o){return typeof o.getRootNode=="function"?o.getRootNode():o.nodeType===9?o:o.ownerDocument}var Ia=k.d;k.d={f:gk,r:yk,D:vk,C:_k,L:xk,m:bk,X:Tk,S:Sk,M:Mk};function gk(){var o=Ia.f(),c=jm();return o||c}function yk(o){var c=xa(o);c!==null&&c.tag===5&&c.type==="form"?Aw(c):Ia.r(o)}var uc=typeof document>"u"?null:document;function oR(o,c,f){var m=uc;if(m&&typeof c=="string"&&c){var x=Rn(c);x='link[rel="'+o+'"][href="'+x+'"]',typeof f=="string"&&(x+='[crossorigin="'+f+'"]'),aR.has(x)||(aR.add(x),o={rel:o,crossOrigin:f,href:c},m.querySelector(x)===null&&(c=m.createElement("link"),zi(c,"link",o),ri(c),m.head.appendChild(c)))}}function vk(o){Ia.D(o),oR("dns-prefetch",o,null)}function _k(o,c){Ia.C(o,c),oR("preconnect",o,c)}function xk(o,c,f){Ia.L(o,c,f);var m=uc;if(m&&o&&c){var x='link[rel="preload"][as="'+Rn(c)+'"]';c==="image"&&f&&f.imageSrcSet?(x+='[imagesrcset="'+Rn(f.imageSrcSet)+'"]',typeof f.imageSizes=="string"&&(x+='[imagesizes="'+Rn(f.imageSizes)+'"]')):x+='[href="'+Rn(o)+'"]';var T=x;switch(c){case"style":T=cc(o);break;case"script":T=hc(o)}fs.has(T)||(o=d({rel:"preload",href:c==="image"&&f&&f.imageSrcSet?void 0:o,as:c},f),fs.set(T,o),m.querySelector(x)!==null||c==="style"&&m.querySelector(Ff(T))||c==="script"&&m.querySelector(kf(T))||(c=m.createElement("link"),zi(c,"link",o),ri(c),m.head.appendChild(c)))}}function bk(o,c){Ia.m(o,c);var f=uc;if(f&&o){var m=c&&typeof c.as=="string"?c.as:"script",x='link[rel="modulepreload"][as="'+Rn(m)+'"][href="'+Rn(o)+'"]',T=x;switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":T=hc(o)}if(!fs.has(T)&&(o=d({rel:"modulepreload",href:o},c),fs.set(T,o),f.querySelector(x)===null)){switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(f.querySelector(kf(T)))return}m=f.createElement("link"),zi(m,"link",o),ri(m),f.head.appendChild(m)}}}function Sk(o,c,f){Ia.S(o,c,f);var m=uc;if(m&&o){var x=xo(m).hoistableStyles,T=cc(o);c=c||"default";var P=x.get(T);if(!P){var O={loading:0,preload:null};if(P=m.querySelector(Ff(T)))O.loading=5;else{o=d({rel:"stylesheet",href:o,"data-precedence":c},f),(f=fs.get(T))&&$0(o,f);var q=P=m.createElement("link");ri(q),zi(q,"link",o),q._p=new Promise(function(ce,Ae){q.onload=ce,q.onerror=Ae}),q.addEventListener("load",function(){O.loading|=1}),q.addEventListener("error",function(){O.loading|=2}),O.loading|=4,tg(P,c,m)}P={type:"stylesheet",instance:P,count:1,state:O},x.set(T,P)}}}function Tk(o,c){Ia.X(o,c);var f=uc;if(f&&o){var m=xo(f).hoistableScripts,x=hc(o),T=m.get(x);T||(T=f.querySelector(kf(x)),T||(o=d({src:o,async:!0},c),(c=fs.get(x))&&X0(o,c),T=f.createElement("script"),ri(T),zi(T,"link",o),f.head.appendChild(T)),T={type:"script",instance:T,count:1,state:null},m.set(x,T))}}function Mk(o,c){Ia.M(o,c);var f=uc;if(f&&o){var m=xo(f).hoistableScripts,x=hc(o),T=m.get(x);T||(T=f.querySelector(kf(x)),T||(o=d({src:o,async:!0,type:"module"},c),(c=fs.get(x))&&X0(o,c),T=f.createElement("script"),ri(T),zi(T,"link",o),f.head.appendChild(T)),T={type:"script",instance:T,count:1,state:null},m.set(x,T))}}function lR(o,c,f,m){var x=(x=$.current)?eg(x):null;if(!x)throw Error(n(446));switch(o){case"meta":case"title":return null;case"style":return typeof f.precedence=="string"&&typeof f.href=="string"?(c=cc(f.href),f=xo(x).hoistableStyles,m=f.get(c),m||(m={type:"style",instance:null,count:0,state:null},f.set(c,m)),m):{type:"void",instance:null,count:0,state:null};case"link":if(f.rel==="stylesheet"&&typeof f.href=="string"&&typeof f.precedence=="string"){o=cc(f.href);var T=xo(x).hoistableStyles,P=T.get(o);if(P||(x=x.ownerDocument||x,P={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},T.set(o,P),(T=x.querySelector(Ff(o)))&&!T._p&&(P.instance=T,P.state.loading=5),fs.has(o)||(f={rel:"preload",as:"style",href:f.href,crossOrigin:f.crossOrigin,integrity:f.integrity,media:f.media,hrefLang:f.hrefLang,referrerPolicy:f.referrerPolicy},fs.set(o,f),T||Ek(x,o,f,P.state))),c&&m===null)throw Error(n(528,""));return P}if(c&&m!==null)throw Error(n(529,""));return null;case"script":return c=f.async,f=f.src,typeof f=="string"&&c&&typeof c!="function"&&typeof c!="symbol"?(c=hc(f),f=xo(x).hoistableScripts,m=f.get(c),m||(m={type:"script",instance:null,count:0,state:null},f.set(c,m)),m):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,o))}}function cc(o){return'href="'+Rn(o)+'"'}function Ff(o){return'link[rel="stylesheet"]['+o+"]"}function uR(o){return d({},o,{"data-precedence":o.precedence,precedence:null})}function Ek(o,c,f,m){o.querySelector('link[rel="preload"][as="style"]['+c+"]")?m.loading=1:(c=o.createElement("link"),m.preload=c,c.addEventListener("load",function(){return m.loading|=1}),c.addEventListener("error",function(){return m.loading|=2}),zi(c,"link",f),ri(c),o.head.appendChild(c))}function hc(o){return'[src="'+Rn(o)+'"]'}function kf(o){return"script[async]"+o}function cR(o,c,f){if(c.count++,c.instance===null)switch(c.type){case"style":var m=o.querySelector('style[data-href~="'+Rn(f.href)+'"]');if(m)return c.instance=m,ri(m),m;var x=d({},f,{"data-href":f.href,"data-precedence":f.precedence,href:null,precedence:null});return m=(o.ownerDocument||o).createElement("style"),ri(m),zi(m,"style",x),tg(m,f.precedence,o),c.instance=m;case"stylesheet":x=cc(f.href);var T=o.querySelector(Ff(x));if(T)return c.state.loading|=4,c.instance=T,ri(T),T;m=uR(f),(x=fs.get(x))&&$0(m,x),T=(o.ownerDocument||o).createElement("link"),ri(T);var P=T;return P._p=new Promise(function(O,q){P.onload=O,P.onerror=q}),zi(T,"link",m),c.state.loading|=4,tg(T,f.precedence,o),c.instance=T;case"script":return T=hc(f.src),(x=o.querySelector(kf(T)))?(c.instance=x,ri(x),x):(m=f,(x=fs.get(T))&&(m=d({},f),X0(m,x)),o=o.ownerDocument||o,x=o.createElement("script"),ri(x),zi(x,"link",m),o.head.appendChild(x),c.instance=x);case"void":return null;default:throw Error(n(443,c.type))}else c.type==="stylesheet"&&(c.state.loading&4)===0&&(m=c.instance,c.state.loading|=4,tg(m,f.precedence,o));return c.instance}function tg(o,c,f){for(var m=f.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),x=m.length?m[m.length-1]:null,T=x,P=0;P<m.length;P++){var O=m[P];if(O.dataset.precedence===c)T=O;else if(T!==x)break}T?T.parentNode.insertBefore(o,T.nextSibling):(c=f.nodeType===9?f.head:f,c.insertBefore(o,c.firstChild))}function $0(o,c){o.crossOrigin==null&&(o.crossOrigin=c.crossOrigin),o.referrerPolicy==null&&(o.referrerPolicy=c.referrerPolicy),o.title==null&&(o.title=c.title)}function X0(o,c){o.crossOrigin==null&&(o.crossOrigin=c.crossOrigin),o.referrerPolicy==null&&(o.referrerPolicy=c.referrerPolicy),o.integrity==null&&(o.integrity=c.integrity)}var ng=null;function hR(o,c,f){if(ng===null){var m=new Map,x=ng=new Map;x.set(f,m)}else x=ng,m=x.get(f),m||(m=new Map,x.set(f,m));if(m.has(o))return m;for(m.set(o,null),f=f.getElementsByTagName(o),x=0;x<f.length;x++){var T=f[x];if(!(T[vo]||T[yi]||o==="link"&&T.getAttribute("rel")==="stylesheet")&&T.namespaceURI!=="http://www.w3.org/2000/svg"){var P=T.getAttribute(c)||"";P=o+P;var O=m.get(P);O?O.push(T):m.set(P,[T])}}return m}function fR(o,c,f){o=o.ownerDocument||o,o.head.insertBefore(f,c==="title"?o.querySelector("head > title"):null)}function Ak(o,c,f){if(f===1||c.itemProp!=null)return!1;switch(o){case"meta":case"title":return!0;case"style":if(typeof c.precedence!="string"||typeof c.href!="string"||c.href==="")break;return!0;case"link":if(typeof c.rel!="string"||typeof c.href!="string"||c.href===""||c.onLoad||c.onError)break;switch(c.rel){case"stylesheet":return o=c.disabled,typeof c.precedence=="string"&&o==null;default:return!0}case"script":if(c.async&&typeof c.async!="function"&&typeof c.async!="symbol"&&!c.onLoad&&!c.onError&&c.src&&typeof c.src=="string")return!0}return!1}function dR(o){return!(o.type==="stylesheet"&&(o.state.loading&3)===0)}var zf=null;function wk(){}function Rk(o,c,f){if(zf===null)throw Error(n(475));var m=zf;if(c.type==="stylesheet"&&(typeof f.media!="string"||matchMedia(f.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var x=cc(f.href),T=o.querySelector(Ff(x));if(T){o=T._p,o!==null&&typeof o=="object"&&typeof o.then=="function"&&(m.count++,m=ig.bind(m),o.then(m,m)),c.state.loading|=4,c.instance=T,ri(T);return}T=o.ownerDocument||o,f=uR(f),(x=fs.get(x))&&$0(f,x),T=T.createElement("link"),ri(T);var P=T;P._p=new Promise(function(O,q){P.onload=O,P.onerror=q}),zi(T,"link",f),c.instance=T}m.stylesheets===null&&(m.stylesheets=new Map),m.stylesheets.set(c,o),(o=c.state.preload)&&(c.state.loading&3)===0&&(m.count++,c=ig.bind(m),o.addEventListener("load",c),o.addEventListener("error",c))}}function Ck(){if(zf===null)throw Error(n(475));var o=zf;return o.stylesheets&&o.count===0&&Y0(o,o.stylesheets),0<o.count?function(c){var f=setTimeout(function(){if(o.stylesheets&&Y0(o,o.stylesheets),o.unsuspend){var m=o.unsuspend;o.unsuspend=null,m()}},6e4);return o.unsuspend=c,function(){o.unsuspend=null,clearTimeout(f)}}:null}function ig(){if(this.count--,this.count===0){if(this.stylesheets)Y0(this,this.stylesheets);else if(this.unsuspend){var o=this.unsuspend;this.unsuspend=null,o()}}}var rg=null;function Y0(o,c){o.stylesheets=null,o.unsuspend!==null&&(o.count++,rg=new Map,c.forEach(Nk,o),rg=null,ig.call(o))}function Nk(o,c){if(!(c.state.loading&4)){var f=rg.get(o);if(f)var m=f.get(null);else{f=new Map,rg.set(o,f);for(var x=o.querySelectorAll("link[data-precedence],style[data-precedence]"),T=0;T<x.length;T++){var P=x[T];(P.nodeName==="LINK"||P.getAttribute("media")!=="not all")&&(f.set(P.dataset.precedence,P),m=P)}m&&f.set(null,m)}x=c.instance,P=x.getAttribute("data-precedence"),T=f.get(P)||m,T===m&&f.set(null,x),f.set(P,x),this.count++,m=ig.bind(this),x.addEventListener("load",m),x.addEventListener("error",m),T?T.parentNode.insertBefore(x,T.nextSibling):(o=o.nodeType===9?o.head:o,o.insertBefore(x,o.firstChild)),c.state.loading|=4}}var Vf={$$typeof:M,Provider:null,Consumer:null,_currentValue:G,_currentValue2:G,_threadCount:0};function Pk(o,c,f,m,x,T,P,O){this.tag=1,this.containerInfo=o,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Fe(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Fe(0),this.hiddenUpdates=Fe(null),this.identifierPrefix=m,this.onUncaughtError=x,this.onCaughtError=T,this.onRecoverableError=P,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=O,this.incompleteTransitions=new Map}function pR(o,c,f,m,x,T,P,O,q,ce,Ae,Ne){return o=new Pk(o,c,f,P,O,q,ce,Ne),c=1,T===!0&&(c|=24),T=Vr(3,null,null,c),o.current=T,T.stateNode=o,c=N_(),c.refCount++,o.pooledCache=c,c.refCount++,T.memoizedState={element:m,isDehydrated:f,cache:c},U_(T),o}function mR(o){return o?(o=Gu,o):Gu}function gR(o,c,f,m,x,T){x=mR(x),m.context===null?m.context=x:m.pendingContext=x,m=Eo(c),m.payload={element:f},T=T===void 0?null:T,T!==null&&(m.callback=T),f=Ao(o,m,c),f!==null&&(qr(f,o,c),yf(f,o,c))}function yR(o,c){if(o=o.memoizedState,o!==null&&o.dehydrated!==null){var f=o.retryLane;o.retryLane=f!==0&&f<c?f:c}}function K0(o,c){yR(o,c),(o=o.alternate)&&yR(o,c)}function vR(o){if(o.tag===13){var c=Vu(o,67108864);c!==null&&qr(c,o,67108864),K0(o,67108864)}}var sg=!0;function Dk(o,c,f,m){var x=z.T;z.T=null;var T=k.p;try{k.p=2,Z0(o,c,f,m)}finally{k.p=T,z.T=x}}function Lk(o,c,f,m){var x=z.T;z.T=null;var T=k.p;try{k.p=8,Z0(o,c,f,m)}finally{k.p=T,z.T=x}}function Z0(o,c,f,m){if(sg){var x=Q0(m);if(x===null)F0(o,c,m,ag,f),xR(o,m);else if(Ok(x,o,c,f,m))m.stopPropagation();else if(xR(o,m),c&4&&-1<Uk.indexOf(o)){for(;x!==null;){var T=xa(x);if(T!==null)switch(T.tag){case 3:if(T=T.stateNode,T.current.memoizedState.isDehydrated){var P=ft(T.pendingLanes);if(P!==0){var O=T;for(O.pendingLanes|=2,O.entangledLanes|=2;P;){var q=1<<31-Qe(P);O.entanglements[1]|=q,P&=~q}Ys(T),(dn&6)===0&&(Hm=Ft()+500,Uf(0))}}break;case 13:O=Vu(T,2),O!==null&&qr(O,T,2),jm(),K0(T,2)}if(T=Q0(m),T===null&&F0(o,c,m,ag,f),T===x)break;x=T}x!==null&&m.stopPropagation()}else F0(o,c,m,null,f)}}function Q0(o){return o=i_(o),J0(o)}var ag=null;function J0(o){if(ag=null,o=_a(o),o!==null){var c=s(o);if(c===null)o=null;else{var f=c.tag;if(f===13){if(o=a(c),o!==null)return o;o=null}else if(f===3){if(c.stateNode.current.memoizedState.isDehydrated)return c.tag===3?c.stateNode.containerInfo:null;o=null}else c!==o&&(o=null)}}return ag=o,null}function _R(o){switch(o){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(at()){case Kt:return 2;case pt:return 8;case Pt:case Yn:return 32;case H:return 268435456;default:return 32}default:return 32}}var ex=!1,ko=null,zo=null,Vo=null,Gf=new Map,Hf=new Map,Go=[],Uk="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function xR(o,c){switch(o){case"focusin":case"focusout":ko=null;break;case"dragenter":case"dragleave":zo=null;break;case"mouseover":case"mouseout":Vo=null;break;case"pointerover":case"pointerout":Gf.delete(c.pointerId);break;case"gotpointercapture":case"lostpointercapture":Hf.delete(c.pointerId)}}function Wf(o,c,f,m,x,T){return o===null||o.nativeEvent!==T?(o={blockedOn:c,domEventName:f,eventSystemFlags:m,nativeEvent:T,targetContainers:[x]},c!==null&&(c=xa(c),c!==null&&vR(c)),o):(o.eventSystemFlags|=m,c=o.targetContainers,x!==null&&c.indexOf(x)===-1&&c.push(x),o)}function Ok(o,c,f,m,x){switch(c){case"focusin":return ko=Wf(ko,o,c,f,m,x),!0;case"dragenter":return zo=Wf(zo,o,c,f,m,x),!0;case"mouseover":return Vo=Wf(Vo,o,c,f,m,x),!0;case"pointerover":var T=x.pointerId;return Gf.set(T,Wf(Gf.get(T)||null,o,c,f,m,x)),!0;case"gotpointercapture":return T=x.pointerId,Hf.set(T,Wf(Hf.get(T)||null,o,c,f,m,x)),!0}return!1}function bR(o){var c=_a(o.target);if(c!==null){var f=s(c);if(f!==null){if(c=f.tag,c===13){if(c=a(f),c!==null){o.blockedOn=c,kr(o.priority,function(){if(f.tag===13){var m=jr();m=At(m);var x=Vu(f,m);x!==null&&qr(x,f,m),K0(f,m)}});return}}else if(c===3&&f.stateNode.current.memoizedState.isDehydrated){o.blockedOn=f.tag===3?f.stateNode.containerInfo:null;return}}}o.blockedOn=null}function og(o){if(o.blockedOn!==null)return!1;for(var c=o.targetContainers;0<c.length;){var f=Q0(o.nativeEvent);if(f===null){f=o.nativeEvent;var m=new f.constructor(f.type,f);n_=m,f.target.dispatchEvent(m),n_=null}else return c=xa(f),c!==null&&vR(c),o.blockedOn=f,!1;c.shift()}return!0}function SR(o,c,f){og(o)&&f.delete(c)}function Bk(){ex=!1,ko!==null&&og(ko)&&(ko=null),zo!==null&&og(zo)&&(zo=null),Vo!==null&&og(Vo)&&(Vo=null),Gf.forEach(SR),Hf.forEach(SR)}function lg(o,c){o.blockedOn===c&&(o.blockedOn=null,ex||(ex=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,Bk)))}var ug=null;function TR(o){ug!==o&&(ug=o,i.unstable_scheduleCallback(i.unstable_NormalPriority,function(){ug===o&&(ug=null);for(var c=0;c<o.length;c+=3){var f=o[c],m=o[c+1],x=o[c+2];if(typeof m!="function"){if(J0(m||f)===null)continue;break}var T=xa(f);T!==null&&(o.splice(c,3),c-=3,J_(T,{pending:!0,data:x,method:f.method,action:m},m,x))}}))}function jf(o){function c(q){return lg(q,o)}ko!==null&&lg(ko,o),zo!==null&&lg(zo,o),Vo!==null&&lg(Vo,o),Gf.forEach(c),Hf.forEach(c);for(var f=0;f<Go.length;f++){var m=Go[f];m.blockedOn===o&&(m.blockedOn=null)}for(;0<Go.length&&(f=Go[0],f.blockedOn===null);)bR(f),f.blockedOn===null&&Go.shift();if(f=(o.ownerDocument||o).$$reactFormReplay,f!=null)for(m=0;m<f.length;m+=3){var x=f[m],T=f[m+1],P=x[Bi]||null;if(typeof T=="function")P||TR(f);else if(P){var O=null;if(T&&T.hasAttribute("formAction")){if(x=T,P=T[Bi]||null)O=P.formAction;else if(J0(x)!==null)continue}else O=P.action;typeof O=="function"?f[m+1]=O:(f.splice(m,3),m-=3),TR(f)}}}function tx(o){this._internalRoot=o}cg.prototype.render=tx.prototype.render=function(o){var c=this._internalRoot;if(c===null)throw Error(n(409));var f=c.current,m=jr();gR(f,m,o,c,null,null)},cg.prototype.unmount=tx.prototype.unmount=function(){var o=this._internalRoot;if(o!==null){this._internalRoot=null;var c=o.containerInfo;gR(o.current,2,null,o,null,null),jm(),c[Sr]=null}};function cg(o){this._internalRoot=o}cg.prototype.unstable_scheduleHydration=function(o){if(o){var c=rn();o={blockedOn:null,target:o,priority:c};for(var f=0;f<Go.length&&c!==0&&c<Go[f].priority;f++);Go.splice(f,0,o),f===0&&bR(o)}};var MR=e.version;if(MR!=="19.1.0")throw Error(n(527,MR,"19.1.0"));k.findDOMNode=function(o){var c=o._reactInternals;if(c===void 0)throw typeof o.render=="function"?Error(n(188)):(o=Object.keys(o).join(","),Error(n(268,o)));return o=u(c),o=o!==null?h(o):null,o=o===null?null:o.stateNode,o};var Ik={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:z,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var hg=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!hg.isDisabled&&hg.supportsFiber)try{we=hg.inject(Ik),Ce=hg}catch{}}return $f.createRoot=function(o,c){if(!r(o))throw Error(n(299));var f=!1,m="",x=zw,T=Vw,P=Gw,O=null;return c!=null&&(c.unstable_strictMode===!0&&(f=!0),c.identifierPrefix!==void 0&&(m=c.identifierPrefix),c.onUncaughtError!==void 0&&(x=c.onUncaughtError),c.onCaughtError!==void 0&&(T=c.onCaughtError),c.onRecoverableError!==void 0&&(P=c.onRecoverableError),c.unstable_transitionCallbacks!==void 0&&(O=c.unstable_transitionCallbacks)),c=pR(o,1,!1,null,null,f,m,x,T,P,O,null),o[Sr]=c.current,I0(o),new tx(c)},$f.hydrateRoot=function(o,c,f){if(!r(o))throw Error(n(299));var m=!1,x="",T=zw,P=Vw,O=Gw,q=null,ce=null;return f!=null&&(f.unstable_strictMode===!0&&(m=!0),f.identifierPrefix!==void 0&&(x=f.identifierPrefix),f.onUncaughtError!==void 0&&(T=f.onUncaughtError),f.onCaughtError!==void 0&&(P=f.onCaughtError),f.onRecoverableError!==void 0&&(O=f.onRecoverableError),f.unstable_transitionCallbacks!==void 0&&(q=f.unstable_transitionCallbacks),f.formState!==void 0&&(ce=f.formState)),c=pR(o,1,!0,c,f??null,m,x,T,P,O,q,ce),c.context=mR(null),f=c.current,m=jr(),m=At(m),x=Eo(m),x.callback=null,Ao(f,x,m),f=m,c.current.lanes=f,et(c,f),Ys(c),o[Sr]=c.current,I0(o),new cg(c)},$f.version="19.1.0",$f}var UR;function Xk(){if(UR)return rx.exports;UR=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(e){console.error(e)}}return i(),rx.exports=$k(),rx.exports}var Yk=Xk();const Kk=Up(Yk);Y2();/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Zd(){return Zd=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(i[n]=t[n])}return i},Zd.apply(this,arguments)}var il;(function(i){i.Pop="POP",i.Push="PUSH",i.Replace="REPLACE"})(il||(il={}));const OR="popstate";function Zk(i){i===void 0&&(i={});function e(r,s){let{pathname:a="/",search:l="",hash:u=""}=Ru(r.location.hash.substr(1));return!a.startsWith("/")&&!a.startsWith(".")&&(a="/"+a),mS("",{pathname:a,search:l,hash:u},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function t(r,s){let a=r.document.querySelector("base"),l="";if(a&&a.getAttribute("href")){let u=r.location.href,h=u.indexOf("#");l=h===-1?u:u.slice(0,h)}return l+"#"+(typeof s=="string"?s:Iy(s))}function n(r,s){OT(r.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(s)+")")}return Jk(e,t,n,i)}function di(i,e){if(i===!1||i===null||typeof i>"u")throw new Error(e)}function OT(i,e){if(!i){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function Qk(){return Math.random().toString(36).substr(2,8)}function BR(i,e){return{usr:i.state,key:i.key,idx:e}}function mS(i,e,t,n){return t===void 0&&(t=null),Zd({pathname:typeof i=="string"?i:i.pathname,search:"",hash:""},typeof e=="string"?Ru(e):e,{state:t,key:e&&e.key||n||Qk()})}function Iy(i){let{pathname:e="/",search:t="",hash:n=""}=i;return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),n&&n!=="#"&&(e+=n.charAt(0)==="#"?n:"#"+n),e}function Ru(i){let e={};if(i){let t=i.indexOf("#");t>=0&&(e.hash=i.substr(t),i=i.substr(0,t));let n=i.indexOf("?");n>=0&&(e.search=i.substr(n),i=i.substr(0,n)),i&&(e.pathname=i)}return e}function Jk(i,e,t,n){n===void 0&&(n={});let{window:r=document.defaultView,v5Compat:s=!1}=n,a=r.history,l=il.Pop,u=null,h=d();h==null&&(h=0,a.replaceState(Zd({},a.state,{idx:h}),""));function d(){return(a.state||{idx:null}).idx}function p(){l=il.Pop;let b=d(),_=b==null?null:b-h;h=b,u&&u({action:l,location:S.location,delta:_})}function g(b,_){l=il.Push;let E=mS(S.location,b,_);t&&t(E,b),h=d()+1;let M=BR(E,h),A=S.createHref(E);try{a.pushState(M,"",A)}catch(w){if(w instanceof DOMException&&w.name==="DataCloneError")throw w;r.location.assign(A)}s&&u&&u({action:l,location:S.location,delta:1})}function y(b,_){l=il.Replace;let E=mS(S.location,b,_);t&&t(E,b),h=d();let M=BR(E,h),A=S.createHref(E);a.replaceState(M,"",A),s&&u&&u({action:l,location:S.location,delta:0})}function v(b){let _=r.location.origin!=="null"?r.location.origin:r.location.href,E=typeof b=="string"?b:Iy(b);return E=E.replace(/ $/,"%20"),di(_,"No window.location.(origin|href) available to create URL for href: "+E),new URL(E,_)}let S={get action(){return l},get location(){return i(r,a)},listen(b){if(u)throw new Error("A history only accepts one active listener");return r.addEventListener(OR,p),u=b,()=>{r.removeEventListener(OR,p),u=null}},createHref(b){return e(r,b)},createURL:v,encodeLocation(b){let _=v(b);return{pathname:_.pathname,search:_.search,hash:_.hash}},push:g,replace:y,go(b){return a.go(b)}};return S}var IR;(function(i){i.data="data",i.deferred="deferred",i.redirect="redirect",i.error="error"})(IR||(IR={}));function ez(i,e,t){return t===void 0&&(t="/"),tz(i,e,t)}function tz(i,e,t,n){let r=typeof e=="string"?Ru(e):e,s=BT(r.pathname||"/",t);if(s==null)return null;let a=K2(i);nz(a);let l=null;for(let u=0;l==null&&u<a.length;++u){let h=pz(s);l=hz(a[u],h)}return l}function K2(i,e,t,n){e===void 0&&(e=[]),t===void 0&&(t=[]),n===void 0&&(n="");let r=(s,a,l)=>{let u={relativePath:l===void 0?s.path||"":l,caseSensitive:s.caseSensitive===!0,childrenIndex:a,route:s};u.relativePath.startsWith("/")&&(di(u.relativePath.startsWith(n),'Absolute route path "'+u.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),u.relativePath=u.relativePath.slice(n.length));let h=rl([n,u.relativePath]),d=t.concat(u);s.children&&s.children.length>0&&(di(s.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+h+'".')),K2(s.children,e,d,h)),!(s.path==null&&!s.index)&&e.push({path:h,score:uz(h,s.index),routesMeta:d})};return i.forEach((s,a)=>{var l;if(s.path===""||!((l=s.path)!=null&&l.includes("?")))r(s,a);else for(let u of Z2(s.path))r(s,a,u)}),e}function Z2(i){let e=i.split("/");if(e.length===0)return[];let[t,...n]=e,r=t.endsWith("?"),s=t.replace(/\?$/,"");if(n.length===0)return r?[s,""]:[s];let a=Z2(n.join("/")),l=[];return l.push(...a.map(u=>u===""?s:[s,u].join("/"))),r&&l.push(...a),l.map(u=>i.startsWith("/")&&u===""?"/":u)}function nz(i){i.sort((e,t)=>e.score!==t.score?t.score-e.score:cz(e.routesMeta.map(n=>n.childrenIndex),t.routesMeta.map(n=>n.childrenIndex)))}const iz=/^:[\w-]+$/,rz=3,sz=2,az=1,oz=10,lz=-2,FR=i=>i==="*";function uz(i,e){let t=i.split("/"),n=t.length;return t.some(FR)&&(n+=lz),e&&(n+=sz),t.filter(r=>!FR(r)).reduce((r,s)=>r+(iz.test(s)?rz:s===""?az:oz),n)}function cz(i,e){return i.length===e.length&&i.slice(0,-1).every((n,r)=>n===e[r])?i[i.length-1]-e[e.length-1]:0}function hz(i,e,t){let{routesMeta:n}=i,r={},s="/",a=[];for(let l=0;l<n.length;++l){let u=n[l],h=l===n.length-1,d=s==="/"?e:e.slice(s.length)||"/",p=fz({path:u.relativePath,caseSensitive:u.caseSensitive,end:h},d),g=u.route;if(!p)return null;Object.assign(r,p.params),a.push({params:r,pathname:rl([s,p.pathname]),pathnameBase:vz(rl([s,p.pathnameBase])),route:g}),p.pathnameBase!=="/"&&(s=rl([s,p.pathnameBase]))}return a}function fz(i,e){typeof i=="string"&&(i={path:i,caseSensitive:!1,end:!0});let[t,n]=dz(i.path,i.caseSensitive,i.end),r=e.match(t);if(!r)return null;let s=r[0],a=s.replace(/(.)\/+$/,"$1"),l=r.slice(1);return{params:n.reduce((h,d,p)=>{let{paramName:g,isOptional:y}=d;if(g==="*"){let S=l[p]||"";a=s.slice(0,s.length-S.length).replace(/(.)\/+$/,"$1")}const v=l[p];return y&&!v?h[g]=void 0:h[g]=(v||"").replace(/%2F/g,"/"),h},{}),pathname:s,pathnameBase:a,pattern:i}}function dz(i,e,t){e===void 0&&(e=!1),t===void 0&&(t=!0),OT(i==="*"||!i.endsWith("*")||i.endsWith("/*"),'Route path "'+i+'" will be treated as if it were '+('"'+i.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+i.replace(/\*$/,"/*")+'".'));let n=[],r="^"+i.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,l,u)=>(n.push({paramName:l,isOptional:u!=null}),u?"/?([^\\/]+)?":"/([^\\/]+)"));return i.endsWith("*")?(n.push({paramName:"*"}),r+=i==="*"||i==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?r+="\\/*$":i!==""&&i!=="/"&&(r+="(?:(?=\\/|$))"),[new RegExp(r,e?void 0:"i"),n]}function pz(i){try{return i.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return OT(!1,'The URL path "'+i+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),i}}function BT(i,e){if(e==="/")return i;if(!i.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,n=i.charAt(t);return n&&n!=="/"?null:i.slice(t)||"/"}function mz(i,e){e===void 0&&(e="/");let{pathname:t,search:n="",hash:r=""}=typeof i=="string"?Ru(i):i;return{pathname:t?t.startsWith("/")?t:gz(t,e):e,search:_z(n),hash:xz(r)}}function gz(i,e){let t=e.replace(/\/+$/,"").split("/");return i.split("/").forEach(r=>{r===".."?t.length>1&&t.pop():r!=="."&&t.push(r)}),t.length>1?t.join("/"):"/"}function lx(i,e,t,n){return"Cannot include a '"+i+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(n)+"].  Please separate it out to the ")+("`to."+t+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function yz(i){return i.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function Q2(i,e){let t=yz(i);return e?t.map((n,r)=>r===t.length-1?n.pathname:n.pathnameBase):t.map(n=>n.pathnameBase)}function J2(i,e,t,n){n===void 0&&(n=!1);let r;typeof i=="string"?r=Ru(i):(r=Zd({},i),di(!r.pathname||!r.pathname.includes("?"),lx("?","pathname","search",r)),di(!r.pathname||!r.pathname.includes("#"),lx("#","pathname","hash",r)),di(!r.search||!r.search.includes("#"),lx("#","search","hash",r)));let s=i===""||r.pathname==="",a=s?"/":r.pathname,l;if(a==null)l=t;else{let p=e.length-1;if(!n&&a.startsWith("..")){let g=a.split("/");for(;g[0]==="..";)g.shift(),p-=1;r.pathname=g.join("/")}l=p>=0?e[p]:"/"}let u=mz(r,l),h=a&&a!=="/"&&a.endsWith("/"),d=(s||a===".")&&t.endsWith("/");return!u.pathname.endsWith("/")&&(h||d)&&(u.pathname+="/"),u}const rl=i=>i.join("/").replace(/\/\/+/g,"/"),vz=i=>i.replace(/\/+$/,"").replace(/^\/*/,"/"),_z=i=>!i||i==="?"?"":i.startsWith("?")?i:"?"+i,xz=i=>!i||i==="#"?"":i.startsWith("#")?i:"#"+i;function bz(i){return i!=null&&typeof i.status=="number"&&typeof i.statusText=="string"&&typeof i.internal=="boolean"&&"data"in i}const eL=["post","put","patch","delete"];new Set(eL);const Sz=["get",...eL];new Set(Sz);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Qd(){return Qd=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(i[n]=t[n])}return i},Qd.apply(this,arguments)}const IT=fe.createContext(null),Tz=fe.createContext(null),Cu=fe.createContext(null),dv=fe.createContext(null),gl=fe.createContext({outlet:null,matches:[],isDataRoute:!1}),tL=fe.createContext(null);function Mz(i,e){let{relative:t}=e===void 0?{}:e;Op()||di(!1);let{basename:n,navigator:r}=fe.useContext(Cu),{hash:s,pathname:a,search:l}=rL(i,{relative:t}),u=a;return n!=="/"&&(u=a==="/"?n:rl([n,a])),r.createHref({pathname:u,search:l,hash:s})}function Op(){return fe.useContext(dv)!=null}function pv(){return Op()||di(!1),fe.useContext(dv).location}function nL(i){fe.useContext(Cu).static||fe.useLayoutEffect(i)}function iL(){let{isDataRoute:i}=fe.useContext(gl);return i?Fz():Ez()}function Ez(){Op()||di(!1);let i=fe.useContext(IT),{basename:e,future:t,navigator:n}=fe.useContext(Cu),{matches:r}=fe.useContext(gl),{pathname:s}=pv(),a=JSON.stringify(Q2(r,t.v7_relativeSplatPath)),l=fe.useRef(!1);return nL(()=>{l.current=!0}),fe.useCallback(function(h,d){if(d===void 0&&(d={}),!l.current)return;if(typeof h=="number"){n.go(h);return}let p=J2(h,JSON.parse(a),s,d.relative==="path");i==null&&e!=="/"&&(p.pathname=p.pathname==="/"?e:rl([e,p.pathname])),(d.replace?n.replace:n.push)(p,d.state,d)},[e,n,a,s,i])}function Az(){let{matches:i}=fe.useContext(gl),e=i[i.length-1];return e?e.params:{}}function rL(i,e){let{relative:t}=e===void 0?{}:e,{future:n}=fe.useContext(Cu),{matches:r}=fe.useContext(gl),{pathname:s}=pv(),a=JSON.stringify(Q2(r,n.v7_relativeSplatPath));return fe.useMemo(()=>J2(i,JSON.parse(a),s,t==="path"),[i,a,s,t])}function wz(i,e){return Rz(i,e)}function Rz(i,e,t,n){Op()||di(!1);let{navigator:r}=fe.useContext(Cu),{matches:s}=fe.useContext(gl),a=s[s.length-1],l=a?a.params:{};a&&a.pathname;let u=a?a.pathnameBase:"/";a&&a.route;let h=pv(),d;if(e){var p;let b=typeof e=="string"?Ru(e):e;u==="/"||(p=b.pathname)!=null&&p.startsWith(u)||di(!1),d=b}else d=h;let g=d.pathname||"/",y=g;if(u!=="/"){let b=u.replace(/^\//,"").split("/");y="/"+g.replace(/^\//,"").split("/").slice(b.length).join("/")}let v=ez(i,{pathname:y}),S=Lz(v&&v.map(b=>Object.assign({},b,{params:Object.assign({},l,b.params),pathname:rl([u,r.encodeLocation?r.encodeLocation(b.pathname).pathname:b.pathname]),pathnameBase:b.pathnameBase==="/"?u:rl([u,r.encodeLocation?r.encodeLocation(b.pathnameBase).pathname:b.pathnameBase])})),s,t,n);return e&&S?fe.createElement(dv.Provider,{value:{location:Qd({pathname:"/",search:"",hash:"",state:null,key:"default"},d),navigationType:il.Pop}},S):S}function Cz(){let i=Iz(),e=bz(i)?i.status+" "+i.statusText:i instanceof Error?i.message:JSON.stringify(i),t=i instanceof Error?i.stack:null,r={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return fe.createElement(fe.Fragment,null,fe.createElement("h2",null,"Unexpected Application Error!"),fe.createElement("h3",{style:{fontStyle:"italic"}},e),t?fe.createElement("pre",{style:r},t):null,null)}const Nz=fe.createElement(Cz,null);class Pz extends fe.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error!==void 0?fe.createElement(gl.Provider,{value:this.props.routeContext},fe.createElement(tL.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Dz(i){let{routeContext:e,match:t,children:n}=i,r=fe.useContext(IT);return r&&r.static&&r.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=t.route.id),fe.createElement(gl.Provider,{value:e},n)}function Lz(i,e,t,n){var r;if(e===void 0&&(e=[]),t===void 0&&(t=null),n===void 0&&(n=null),i==null){var s;if(!t)return null;if(t.errors)i=t.matches;else if((s=n)!=null&&s.v7_partialHydration&&e.length===0&&!t.initialized&&t.matches.length>0)i=t.matches;else return null}let a=i,l=(r=t)==null?void 0:r.errors;if(l!=null){let d=a.findIndex(p=>p.route.id&&(l==null?void 0:l[p.route.id])!==void 0);d>=0||di(!1),a=a.slice(0,Math.min(a.length,d+1))}let u=!1,h=-1;if(t&&n&&n.v7_partialHydration)for(let d=0;d<a.length;d++){let p=a[d];if((p.route.HydrateFallback||p.route.hydrateFallbackElement)&&(h=d),p.route.id){let{loaderData:g,errors:y}=t,v=p.route.loader&&g[p.route.id]===void 0&&(!y||y[p.route.id]===void 0);if(p.route.lazy||v){u=!0,h>=0?a=a.slice(0,h+1):a=[a[0]];break}}}return a.reduceRight((d,p,g)=>{let y,v=!1,S=null,b=null;t&&(y=l&&p.route.id?l[p.route.id]:void 0,S=p.route.errorElement||Nz,u&&(h<0&&g===0?(kz("route-fallback"),v=!0,b=null):h===g&&(v=!0,b=p.route.hydrateFallbackElement||null)));let _=e.concat(a.slice(0,g+1)),E=()=>{let M;return y?M=S:v?M=b:p.route.Component?M=fe.createElement(p.route.Component,null):p.route.element?M=p.route.element:M=d,fe.createElement(Dz,{match:p,routeContext:{outlet:d,matches:_,isDataRoute:t!=null},children:M})};return t&&(p.route.ErrorBoundary||p.route.errorElement||g===0)?fe.createElement(Pz,{location:t.location,revalidation:t.revalidation,component:S,error:y,children:E(),routeContext:{outlet:null,matches:_,isDataRoute:!0}}):E()},null)}var sL=function(i){return i.UseBlocker="useBlocker",i.UseRevalidator="useRevalidator",i.UseNavigateStable="useNavigate",i}(sL||{}),aL=function(i){return i.UseBlocker="useBlocker",i.UseLoaderData="useLoaderData",i.UseActionData="useActionData",i.UseRouteError="useRouteError",i.UseNavigation="useNavigation",i.UseRouteLoaderData="useRouteLoaderData",i.UseMatches="useMatches",i.UseRevalidator="useRevalidator",i.UseNavigateStable="useNavigate",i.UseRouteId="useRouteId",i}(aL||{});function Uz(i){let e=fe.useContext(IT);return e||di(!1),e}function Oz(i){let e=fe.useContext(Tz);return e||di(!1),e}function Bz(i){let e=fe.useContext(gl);return e||di(!1),e}function oL(i){let e=Bz(),t=e.matches[e.matches.length-1];return t.route.id||di(!1),t.route.id}function Iz(){var i;let e=fe.useContext(tL),t=Oz(),n=oL();return e!==void 0?e:(i=t.errors)==null?void 0:i[n]}function Fz(){let{router:i}=Uz(sL.UseNavigateStable),e=oL(aL.UseNavigateStable),t=fe.useRef(!1);return nL(()=>{t.current=!0}),fe.useCallback(function(r,s){s===void 0&&(s={}),t.current&&(typeof r=="number"?i.navigate(r):i.navigate(r,Qd({fromRouteId:e},s)))},[i,e])}const kR={};function kz(i,e,t){kR[i]||(kR[i]=!0)}function zz(i,e){i==null||i.v7_startTransition,i==null||i.v7_relativeSplatPath}function gS(i){di(!1)}function Vz(i){let{basename:e="/",children:t=null,location:n,navigationType:r=il.Pop,navigator:s,static:a=!1,future:l}=i;Op()&&di(!1);let u=e.replace(/^\/*/,"/"),h=fe.useMemo(()=>({basename:u,navigator:s,static:a,future:Qd({v7_relativeSplatPath:!1},l)}),[u,l,s,a]);typeof n=="string"&&(n=Ru(n));let{pathname:d="/",search:p="",hash:g="",state:y=null,key:v="default"}=n,S=fe.useMemo(()=>{let b=BT(d,u);return b==null?null:{location:{pathname:b,search:p,hash:g,state:y,key:v},navigationType:r}},[u,d,p,g,y,v,r]);return S==null?null:fe.createElement(Cu.Provider,{value:h},fe.createElement(dv.Provider,{children:t,value:S}))}function Gz(i){let{children:e,location:t}=i;return wz(yS(e),t)}new Promise(()=>{});function yS(i,e){e===void 0&&(e=[]);let t=[];return fe.Children.forEach(i,(n,r)=>{if(!fe.isValidElement(n))return;let s=[...e,r];if(n.type===fe.Fragment){t.push.apply(t,yS(n.props.children,s));return}n.type!==gS&&di(!1),!n.props.index||!n.props.children||di(!1);let a={id:n.props.id||s.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(a.children=yS(n.props.children,s)),t.push(a)}),t}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function vS(){return vS=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(i[n]=t[n])}return i},vS.apply(this,arguments)}function Hz(i,e){if(i==null)return{};var t={},n=Object.keys(i),r,s;for(s=0;s<n.length;s++)r=n[s],!(e.indexOf(r)>=0)&&(t[r]=i[r]);return t}function Wz(i){return!!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)}function jz(i,e){return i.button===0&&(!e||e==="_self")&&!Wz(i)}const qz=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],$z="6";try{window.__reactRouterVersion=$z}catch{}const Xz="startTransition",zR=Hk[Xz];function Yz(i){let{basename:e,children:t,future:n,window:r}=i,s=fe.useRef();s.current==null&&(s.current=Zk({window:r,v5Compat:!0}));let a=s.current,[l,u]=fe.useState({action:a.action,location:a.location}),{v7_startTransition:h}=n||{},d=fe.useCallback(p=>{h&&zR?zR(()=>u(p)):u(p)},[u,h]);return fe.useLayoutEffect(()=>a.listen(d),[a,d]),fe.useEffect(()=>zz(n),[n]),fe.createElement(Vz,{basename:e,children:t,location:l.location,navigationType:l.action,navigator:a,future:n})}const Kz=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Zz=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,_S=fe.forwardRef(function(e,t){let{onClick:n,relative:r,reloadDocument:s,replace:a,state:l,target:u,to:h,preventScrollReset:d,viewTransition:p}=e,g=Hz(e,qz),{basename:y}=fe.useContext(Cu),v,S=!1;if(typeof h=="string"&&Zz.test(h)&&(v=h,Kz))try{let M=new URL(window.location.href),A=h.startsWith("//")?new URL(M.protocol+h):new URL(h),w=BT(A.pathname,y);A.origin===M.origin&&w!=null?h=w+A.search+A.hash:S=!0}catch{}let b=Mz(h,{relative:r}),_=Qz(h,{replace:a,state:l,target:u,preventScrollReset:d,relative:r,viewTransition:p});function E(M){n&&n(M),M.defaultPrevented||_(M)}return fe.createElement("a",vS({},g,{href:v||b,onClick:S||s?n:E,ref:t,target:u}))});var VR;(function(i){i.UseScrollRestoration="useScrollRestoration",i.UseSubmit="useSubmit",i.UseSubmitFetcher="useSubmitFetcher",i.UseFetcher="useFetcher",i.useViewTransitionState="useViewTransitionState"})(VR||(VR={}));var GR;(function(i){i.UseFetcher="useFetcher",i.UseFetchers="useFetchers",i.UseScrollRestoration="useScrollRestoration"})(GR||(GR={}));function Qz(i,e){let{target:t,replace:n,state:r,preventScrollReset:s,relative:a,viewTransition:l}=e===void 0?{}:e,u=iL(),h=pv(),d=rL(i,{relative:a});return fe.useCallback(p=>{if(jz(p,t)){p.preventDefault();let g=n!==void 0?n:Iy(h)===Iy(d);u(i,{replace:g,state:r,preventScrollReset:s,relative:a,viewTransition:l})}},[h,u,d,n,r,t,i,s,a,l])}const FT=fe.createContext({});function kT(i){const e=fe.useRef(null);return e.current===null&&(e.current=i()),e.current}const zT=typeof window<"u",lL=zT?fe.useLayoutEffect:fe.useEffect,mv=fe.createContext(null);function VT(i,e){i.indexOf(e)===-1&&i.push(e)}function GT(i,e){const t=i.indexOf(e);t>-1&&i.splice(t,1)}const uo=(i,e,t)=>t>e?e:t<i?i:t;let HT=()=>{};const co={},uL=i=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(i);function cL(i){return typeof i=="object"&&i!==null}const hL=i=>/^0[^.\s]+$/u.test(i);function WT(i){let e;return()=>(e===void 0&&(e=i()),e)}const xs=i=>i,Jz=(i,e)=>t=>e(i(t)),Bp=(...i)=>i.reduce(Jz),Jd=(i,e,t)=>{const n=e-i;return n===0?1:(t-i)/n};class jT{constructor(){this.subscriptions=[]}add(e){return VT(this.subscriptions,e),()=>GT(this.subscriptions,e)}notify(e,t,n){const r=this.subscriptions.length;if(r)if(r===1)this.subscriptions[0](e,t,n);else for(let s=0;s<r;s++){const a=this.subscriptions[s];a&&a(e,t,n)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const oa=i=>i*1e3,la=i=>i/1e3;function fL(i,e){return e?i*(1e3/e):0}const dL=(i,e,t)=>(((1-3*t+3*e)*i+(3*t-6*e))*i+3*e)*i,eV=1e-7,tV=12;function nV(i,e,t,n,r){let s,a,l=0;do a=e+(t-e)/2,s=dL(a,n,r)-i,s>0?t=a:e=a;while(Math.abs(s)>eV&&++l<tV);return a}function Ip(i,e,t,n){if(i===e&&t===n)return xs;const r=s=>nV(s,0,1,i,t);return s=>s===0||s===1?s:dL(r(s),e,n)}const pL=i=>e=>e<=.5?i(2*e)/2:(2-i(2*(1-e)))/2,mL=i=>e=>1-i(1-e),gL=Ip(.33,1.53,.69,.99),qT=mL(gL),yL=pL(qT),vL=i=>(i*=2)<1?.5*qT(i):.5*(2-Math.pow(2,-10*(i-1))),$T=i=>1-Math.sin(Math.acos(i)),_L=mL($T),xL=pL($T),iV=Ip(.42,0,1,1),rV=Ip(0,0,.58,1),bL=Ip(.42,0,.58,1),sV=i=>Array.isArray(i)&&typeof i[0]!="number",SL=i=>Array.isArray(i)&&typeof i[0]=="number",aV={linear:xs,easeIn:iV,easeInOut:bL,easeOut:rV,circIn:$T,circInOut:xL,circOut:_L,backIn:qT,backInOut:yL,backOut:gL,anticipate:vL},oV=i=>typeof i=="string",HR=i=>{if(SL(i)){HT(i.length===4);const[e,t,n,r]=i;return Ip(e,t,n,r)}else if(oV(i))return aV[i];return i},fg=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"],WR={value:null};function lV(i,e){let t=new Set,n=new Set,r=!1,s=!1;const a=new WeakSet;let l={delta:0,timestamp:0,isProcessing:!1},u=0;function h(p){a.has(p)&&(d.schedule(p),i()),u++,p(l)}const d={schedule:(p,g=!1,y=!1)=>{const S=y&&r?t:n;return g&&a.add(p),S.has(p)||S.add(p),p},cancel:p=>{n.delete(p),a.delete(p)},process:p=>{if(l=p,r){s=!0;return}r=!0,[t,n]=[n,t],t.forEach(h),e&&WR.value&&WR.value.frameloop[e].push(u),u=0,t.clear(),r=!1,s&&(s=!1,d.process(p))}};return d}const uV=40;function TL(i,e){let t=!1,n=!0;const r={delta:0,timestamp:0,isProcessing:!1},s=()=>t=!0,a=fg.reduce((M,A)=>(M[A]=lV(s,e?A:void 0),M),{}),{setup:l,read:u,resolveKeyframes:h,preUpdate:d,update:p,preRender:g,render:y,postRender:v}=a,S=()=>{const M=co.useManualTiming?r.timestamp:performance.now();t=!1,co.useManualTiming||(r.delta=n?1e3/60:Math.max(Math.min(M-r.timestamp,uV),1)),r.timestamp=M,r.isProcessing=!0,l.process(r),u.process(r),h.process(r),d.process(r),p.process(r),g.process(r),y.process(r),v.process(r),r.isProcessing=!1,t&&e&&(n=!1,i(S))},b=()=>{t=!0,n=!0,r.isProcessing||i(S)};return{schedule:fg.reduce((M,A)=>{const w=a[A];return M[A]=(R,C=!1,L=!1)=>(t||b(),w.schedule(R,C,L)),M},{}),cancel:M=>{for(let A=0;A<fg.length;A++)a[fg[A]].cancel(M)},state:r,steps:a}}const{schedule:Hn,cancel:ul,state:Gi,steps:ux}=TL(typeof requestAnimationFrame<"u"?requestAnimationFrame:xs,!0);let by;function cV(){by=void 0}const Cr={now:()=>(by===void 0&&Cr.set(Gi.isProcessing||co.useManualTiming?Gi.timestamp:performance.now()),by),set:i=>{by=i,queueMicrotask(cV)}},ML=i=>e=>typeof e=="string"&&e.startsWith(i),XT=ML("--"),hV=ML("var(--"),YT=i=>hV(i)?fV.test(i.split("/*")[0].trim()):!1,fV=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,zh={test:i=>typeof i=="number",parse:parseFloat,transform:i=>i},ep={...zh,transform:i=>uo(0,1,i)},dg={...zh,default:1},Bd=i=>Math.round(i*1e5)/1e5,KT=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function dV(i){return i==null}const pV=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,ZT=(i,e)=>t=>!!(typeof t=="string"&&pV.test(t)&&t.startsWith(i)||e&&!dV(t)&&Object.prototype.hasOwnProperty.call(t,e)),EL=(i,e,t)=>n=>{if(typeof n!="string")return n;const[r,s,a,l]=n.match(KT);return{[i]:parseFloat(r),[e]:parseFloat(s),[t]:parseFloat(a),alpha:l!==void 0?parseFloat(l):1}},mV=i=>uo(0,255,i),cx={...zh,transform:i=>Math.round(mV(i))},fu={test:ZT("rgb","red"),parse:EL("red","green","blue"),transform:({red:i,green:e,blue:t,alpha:n=1})=>"rgba("+cx.transform(i)+", "+cx.transform(e)+", "+cx.transform(t)+", "+Bd(ep.transform(n))+")"};function gV(i){let e="",t="",n="",r="";return i.length>5?(e=i.substring(1,3),t=i.substring(3,5),n=i.substring(5,7),r=i.substring(7,9)):(e=i.substring(1,2),t=i.substring(2,3),n=i.substring(3,4),r=i.substring(4,5),e+=e,t+=t,n+=n,r+=r),{red:parseInt(e,16),green:parseInt(t,16),blue:parseInt(n,16),alpha:r?parseInt(r,16)/255:1}}const xS={test:ZT("#"),parse:gV,transform:fu.transform},Fp=i=>({test:e=>typeof e=="string"&&e.endsWith(i)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${i}`}),Jo=Fp("deg"),ua=Fp("%"),Tt=Fp("px"),yV=Fp("vh"),vV=Fp("vw"),jR={...ua,parse:i=>ua.parse(i)/100,transform:i=>ua.transform(i*100)},kc={test:ZT("hsl","hue"),parse:EL("hue","saturation","lightness"),transform:({hue:i,saturation:e,lightness:t,alpha:n=1})=>"hsla("+Math.round(i)+", "+ua.transform(Bd(e))+", "+ua.transform(Bd(t))+", "+Bd(ep.transform(n))+")"},li={test:i=>fu.test(i)||xS.test(i)||kc.test(i),parse:i=>fu.test(i)?fu.parse(i):kc.test(i)?kc.parse(i):xS.parse(i),transform:i=>typeof i=="string"?i:i.hasOwnProperty("red")?fu.transform(i):kc.transform(i),getAnimatableNone:i=>{const e=li.parse(i);return e.alpha=0,li.transform(e)}},_V=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function xV(i){var e,t;return isNaN(i)&&typeof i=="string"&&(((e=i.match(KT))==null?void 0:e.length)||0)+(((t=i.match(_V))==null?void 0:t.length)||0)>0}const AL="number",wL="color",bV="var",SV="var(",qR="${}",TV=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function tp(i){const e=i.toString(),t=[],n={color:[],number:[],var:[]},r=[];let s=0;const l=e.replace(TV,u=>(li.test(u)?(n.color.push(s),r.push(wL),t.push(li.parse(u))):u.startsWith(SV)?(n.var.push(s),r.push(bV),t.push(u)):(n.number.push(s),r.push(AL),t.push(parseFloat(u))),++s,qR)).split(qR);return{values:t,split:l,indexes:n,types:r}}function RL(i){return tp(i).values}function CL(i){const{split:e,types:t}=tp(i),n=e.length;return r=>{let s="";for(let a=0;a<n;a++)if(s+=e[a],r[a]!==void 0){const l=t[a];l===AL?s+=Bd(r[a]):l===wL?s+=li.transform(r[a]):s+=r[a]}return s}}const MV=i=>typeof i=="number"?0:li.test(i)?li.getAnimatableNone(i):i;function EV(i){const e=RL(i);return CL(i)(e.map(MV))}const cl={test:xV,parse:RL,createTransformer:CL,getAnimatableNone:EV};function hx(i,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?i+(e-i)*6*t:t<1/2?e:t<2/3?i+(e-i)*(2/3-t)*6:i}function AV({hue:i,saturation:e,lightness:t,alpha:n}){i/=360,e/=100,t/=100;let r=0,s=0,a=0;if(!e)r=s=a=t;else{const l=t<.5?t*(1+e):t+e-t*e,u=2*t-l;r=hx(u,l,i+1/3),s=hx(u,l,i),a=hx(u,l,i-1/3)}return{red:Math.round(r*255),green:Math.round(s*255),blue:Math.round(a*255),alpha:n}}function Fy(i,e){return t=>t>0?e:i}const Vn=(i,e,t)=>i+(e-i)*t,fx=(i,e,t)=>{const n=i*i,r=t*(e*e-n)+n;return r<0?0:Math.sqrt(r)},wV=[xS,fu,kc],RV=i=>wV.find(e=>e.test(i));function $R(i){const e=RV(i);if(!e)return!1;let t=e.parse(i);return e===kc&&(t=AV(t)),t}const XR=(i,e)=>{const t=$R(i),n=$R(e);if(!t||!n)return Fy(i,e);const r={...t};return s=>(r.red=fx(t.red,n.red,s),r.green=fx(t.green,n.green,s),r.blue=fx(t.blue,n.blue,s),r.alpha=Vn(t.alpha,n.alpha,s),fu.transform(r))},bS=new Set(["none","hidden"]);function CV(i,e){return bS.has(i)?t=>t<=0?i:e:t=>t>=1?e:i}function NV(i,e){return t=>Vn(i,e,t)}function QT(i){return typeof i=="number"?NV:typeof i=="string"?YT(i)?Fy:li.test(i)?XR:LV:Array.isArray(i)?NL:typeof i=="object"?li.test(i)?XR:PV:Fy}function NL(i,e){const t=[...i],n=t.length,r=i.map((s,a)=>QT(s)(s,e[a]));return s=>{for(let a=0;a<n;a++)t[a]=r[a](s);return t}}function PV(i,e){const t={...i,...e},n={};for(const r in t)i[r]!==void 0&&e[r]!==void 0&&(n[r]=QT(i[r])(i[r],e[r]));return r=>{for(const s in n)t[s]=n[s](r);return t}}function DV(i,e){const t=[],n={color:0,var:0,number:0};for(let r=0;r<e.values.length;r++){const s=e.types[r],a=i.indexes[s][n[s]],l=i.values[a]??0;t[r]=l,n[s]++}return t}const LV=(i,e)=>{const t=cl.createTransformer(e),n=tp(i),r=tp(e);return n.indexes.var.length===r.indexes.var.length&&n.indexes.color.length===r.indexes.color.length&&n.indexes.number.length>=r.indexes.number.length?bS.has(i)&&!r.values.length||bS.has(e)&&!n.values.length?CV(i,e):Bp(NL(DV(n,r),r.values),t):Fy(i,e)};function PL(i,e,t){return typeof i=="number"&&typeof e=="number"&&typeof t=="number"?Vn(i,e,t):QT(i)(i,e)}const UV=i=>{const e=({timestamp:t})=>i(t);return{start:(t=!0)=>Hn.update(e,t),stop:()=>ul(e),now:()=>Gi.isProcessing?Gi.timestamp:Cr.now()}},DL=(i,e,t=10)=>{let n="";const r=Math.max(Math.round(e/t),2);for(let s=0;s<r;s++)n+=Math.round(i(s/(r-1))*1e4)/1e4+", ";return`linear(${n.substring(0,n.length-2)})`},ky=2e4;function JT(i){let e=0;const t=50;let n=i.next(e);for(;!n.done&&e<ky;)e+=t,n=i.next(e);return e>=ky?1/0:e}function OV(i,e=100,t){const n=t({...i,keyframes:[0,e]}),r=Math.min(JT(n),ky);return{type:"keyframes",ease:s=>n.next(r*s).value/e,duration:la(r)}}const BV=5;function LL(i,e,t){const n=Math.max(e-BV,0);return fL(t-i(n),e-n)}const $n={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},dx=.001;function IV({duration:i=$n.duration,bounce:e=$n.bounce,velocity:t=$n.velocity,mass:n=$n.mass}){let r,s,a=1-e;a=uo($n.minDamping,$n.maxDamping,a),i=uo($n.minDuration,$n.maxDuration,la(i)),a<1?(r=h=>{const d=h*a,p=d*i,g=d-t,y=SS(h,a),v=Math.exp(-p);return dx-g/y*v},s=h=>{const p=h*a*i,g=p*t+t,y=Math.pow(a,2)*Math.pow(h,2)*i,v=Math.exp(-p),S=SS(Math.pow(h,2),a);return(-r(h)+dx>0?-1:1)*((g-y)*v)/S}):(r=h=>{const d=Math.exp(-h*i),p=(h-t)*i+1;return-dx+d*p},s=h=>{const d=Math.exp(-h*i),p=(t-h)*(i*i);return d*p});const l=5/i,u=kV(r,s,l);if(i=oa(i),isNaN(u))return{stiffness:$n.stiffness,damping:$n.damping,duration:i};{const h=Math.pow(u,2)*n;return{stiffness:h,damping:a*2*Math.sqrt(n*h),duration:i}}}const FV=12;function kV(i,e,t){let n=t;for(let r=1;r<FV;r++)n=n-i(n)/e(n);return n}function SS(i,e){return i*Math.sqrt(1-e*e)}const zV=["duration","bounce"],VV=["stiffness","damping","mass"];function YR(i,e){return e.some(t=>i[t]!==void 0)}function GV(i){let e={velocity:$n.velocity,stiffness:$n.stiffness,damping:$n.damping,mass:$n.mass,isResolvedFromDuration:!1,...i};if(!YR(i,VV)&&YR(i,zV))if(i.visualDuration){const t=i.visualDuration,n=2*Math.PI/(t*1.2),r=n*n,s=2*uo(.05,1,1-(i.bounce||0))*Math.sqrt(r);e={...e,mass:$n.mass,stiffness:r,damping:s}}else{const t=IV(i);e={...e,...t,mass:$n.mass},e.isResolvedFromDuration=!0}return e}function zy(i=$n.visualDuration,e=$n.bounce){const t=typeof i!="object"?{visualDuration:i,keyframes:[0,1],bounce:e}:i;let{restSpeed:n,restDelta:r}=t;const s=t.keyframes[0],a=t.keyframes[t.keyframes.length-1],l={done:!1,value:s},{stiffness:u,damping:h,mass:d,duration:p,velocity:g,isResolvedFromDuration:y}=GV({...t,velocity:-la(t.velocity||0)}),v=g||0,S=h/(2*Math.sqrt(u*d)),b=a-s,_=la(Math.sqrt(u/d)),E=Math.abs(b)<5;n||(n=E?$n.restSpeed.granular:$n.restSpeed.default),r||(r=E?$n.restDelta.granular:$n.restDelta.default);let M;if(S<1){const w=SS(_,S);M=R=>{const C=Math.exp(-S*_*R);return a-C*((v+S*_*b)/w*Math.sin(w*R)+b*Math.cos(w*R))}}else if(S===1)M=w=>a-Math.exp(-_*w)*(b+(v+_*b)*w);else{const w=_*Math.sqrt(S*S-1);M=R=>{const C=Math.exp(-S*_*R),L=Math.min(w*R,300);return a-C*((v+S*_*b)*Math.sinh(L)+w*b*Math.cosh(L))/w}}const A={calculatedDuration:y&&p||null,next:w=>{const R=M(w);if(y)l.done=w>=p;else{let C=w===0?v:0;S<1&&(C=w===0?oa(v):LL(M,w,R));const L=Math.abs(C)<=n,N=Math.abs(a-R)<=r;l.done=L&&N}return l.value=l.done?a:R,l},toString:()=>{const w=Math.min(JT(A),ky),R=DL(C=>A.next(w*C).value,w,30);return w+"ms "+R},toTransition:()=>{}};return A}zy.applyToOptions=i=>{const e=OV(i,100,zy);return i.ease=e.ease,i.duration=oa(e.duration),i.type="keyframes",i};function TS({keyframes:i,velocity:e=0,power:t=.8,timeConstant:n=325,bounceDamping:r=10,bounceStiffness:s=500,modifyTarget:a,min:l,max:u,restDelta:h=.5,restSpeed:d}){const p=i[0],g={done:!1,value:p},y=L=>l!==void 0&&L<l||u!==void 0&&L>u,v=L=>l===void 0?u:u===void 0||Math.abs(l-L)<Math.abs(u-L)?l:u;let S=t*e;const b=p+S,_=a===void 0?b:a(b);_!==b&&(S=_-p);const E=L=>-S*Math.exp(-L/n),M=L=>_+E(L),A=L=>{const N=E(L),D=M(L);g.done=Math.abs(N)<=h,g.value=g.done?_:D};let w,R;const C=L=>{y(g.value)&&(w=L,R=zy({keyframes:[g.value,v(g.value)],velocity:LL(M,L,g.value),damping:r,stiffness:s,restDelta:h,restSpeed:d}))};return C(0),{calculatedDuration:null,next:L=>{let N=!1;return!R&&w===void 0&&(N=!0,A(L),C(L)),w!==void 0&&L>=w?R.next(L-w):(!N&&A(L),g)}}}function HV(i,e,t){const n=[],r=t||co.mix||PL,s=i.length-1;for(let a=0;a<s;a++){let l=r(i[a],i[a+1]);if(e){const u=Array.isArray(e)?e[a]||xs:e;l=Bp(u,l)}n.push(l)}return n}function WV(i,e,{clamp:t=!0,ease:n,mixer:r}={}){const s=i.length;if(HT(s===e.length),s===1)return()=>e[0];if(s===2&&e[0]===e[1])return()=>e[1];const a=i[0]===i[1];i[0]>i[s-1]&&(i=[...i].reverse(),e=[...e].reverse());const l=HV(e,n,r),u=l.length,h=d=>{if(a&&d<i[0])return e[0];let p=0;if(u>1)for(;p<i.length-2&&!(d<i[p+1]);p++);const g=Jd(i[p],i[p+1],d);return l[p](g)};return t?d=>h(uo(i[0],i[s-1],d)):h}function jV(i,e){const t=i[i.length-1];for(let n=1;n<=e;n++){const r=Jd(0,e,n);i.push(Vn(t,1,r))}}function qV(i){const e=[0];return jV(e,i.length-1),e}function $V(i,e){return i.map(t=>t*e)}function XV(i,e){return i.map(()=>e||bL).splice(0,i.length-1)}function Id({duration:i=300,keyframes:e,times:t,ease:n="easeInOut"}){const r=sV(n)?n.map(HR):HR(n),s={done:!1,value:e[0]},a=$V(t&&t.length===e.length?t:qV(e),i),l=WV(a,e,{ease:Array.isArray(r)?r:XV(e,r)});return{calculatedDuration:i,next:u=>(s.value=l(u),s.done=u>=i,s)}}const YV=i=>i!==null;function eM(i,{repeat:e,repeatType:t="loop"},n,r=1){const s=i.filter(YV),l=r<0||e&&t!=="loop"&&e%2===1?0:s.length-1;return!l||n===void 0?s[l]:n}const KV={decay:TS,inertia:TS,tween:Id,keyframes:Id,spring:zy};function UL(i){typeof i.type=="string"&&(i.type=KV[i.type])}class tM{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(e=>{this.resolve=e})}notifyFinished(){this.resolve()}then(e,t){return this.finished.then(e,t)}}const ZV=i=>i/100;class nM extends tM{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{var n,r;const{motionValue:t}=this.options;t&&t.updatedAt!==Cr.now()&&this.tick(Cr.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),(r=(n=this.options).onStop)==null||r.call(n))},this.options=e,this.initAnimation(),this.play(),e.autoplay===!1&&this.pause()}initAnimation(){const{options:e}=this;UL(e);const{type:t=Id,repeat:n=0,repeatDelay:r=0,repeatType:s,velocity:a=0}=e;let{keyframes:l}=e;const u=t||Id;u!==Id&&typeof l[0]!="number"&&(this.mixKeyframes=Bp(ZV,PL(l[0],l[1])),l=[0,100]);const h=u({...e,keyframes:l});s==="mirror"&&(this.mirroredGenerator=u({...e,keyframes:[...l].reverse(),velocity:-a})),h.calculatedDuration===null&&(h.calculatedDuration=JT(h));const{calculatedDuration:d}=h;this.calculatedDuration=d,this.resolvedDuration=d+r,this.totalDuration=this.resolvedDuration*(n+1)-r,this.generator=h}updateTime(e){const t=Math.round(e-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=t}tick(e,t=!1){const{generator:n,totalDuration:r,mixKeyframes:s,mirroredGenerator:a,resolvedDuration:l,calculatedDuration:u}=this;if(this.startTime===null)return n.next(0);const{delay:h=0,keyframes:d,repeat:p,repeatType:g,repeatDelay:y,type:v,onUpdate:S,finalKeyframe:b}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-r/this.speed,this.startTime)),t?this.currentTime=e:this.updateTime(e);const _=this.currentTime-h*(this.playbackSpeed>=0?1:-1),E=this.playbackSpeed>=0?_<0:_>r;this.currentTime=Math.max(_,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=r);let M=this.currentTime,A=n;if(p){const L=Math.min(this.currentTime,r)/l;let N=Math.floor(L),D=L%1;!D&&L>=1&&(D=1),D===1&&N--,N=Math.min(N,p+1),!!(N%2)&&(g==="reverse"?(D=1-D,y&&(D-=y/l)):g==="mirror"&&(A=a)),M=uo(0,1,D)*l}const w=E?{done:!1,value:d[0]}:A.next(M);s&&(w.value=s(w.value));let{done:R}=w;!E&&u!==null&&(R=this.playbackSpeed>=0?this.currentTime>=r:this.currentTime<=0);const C=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&R);return C&&v!==TS&&(w.value=eM(d,this.options,b,this.speed)),S&&S(w.value),C&&this.finish(),w}then(e,t){return this.finished.then(e,t)}get duration(){return la(this.calculatedDuration)}get time(){return la(this.currentTime)}set time(e){var t;e=oa(e),this.currentTime=e,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),(t=this.driver)==null||t.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime(Cr.now());const t=this.playbackSpeed!==e;this.playbackSpeed=e,t&&(this.time=la(this.currentTime))}play(){var r,s;if(this.isStopped)return;const{driver:e=UV,startTime:t}=this.options;this.driver||(this.driver=e(a=>this.tick(a))),(s=(r=this.options).onPlay)==null||s.call(r);const n=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=n):this.holdTime!==null?this.startTime=n-this.holdTime:this.startTime||(this.startTime=t??n),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(Cr.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){var e,t;this.notifyFinished(),this.teardown(),this.state="finished",(t=(e=this.options).onComplete)==null||t.call(e)}cancel(){var e,t;this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),(t=(e=this.options).onCancel)==null||t.call(e)}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){var t;return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),(t=this.driver)==null||t.stop(),e.observe(this)}}function QV(i){for(let e=1;e<i.length;e++)i[e]??(i[e]=i[e-1])}const du=i=>i*180/Math.PI,MS=i=>{const e=du(Math.atan2(i[1],i[0]));return ES(e)},JV={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:i=>(Math.abs(i[0])+Math.abs(i[3]))/2,rotate:MS,rotateZ:MS,skewX:i=>du(Math.atan(i[1])),skewY:i=>du(Math.atan(i[2])),skew:i=>(Math.abs(i[1])+Math.abs(i[2]))/2},ES=i=>(i=i%360,i<0&&(i+=360),i),KR=MS,ZR=i=>Math.sqrt(i[0]*i[0]+i[1]*i[1]),QR=i=>Math.sqrt(i[4]*i[4]+i[5]*i[5]),eG={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:ZR,scaleY:QR,scale:i=>(ZR(i)+QR(i))/2,rotateX:i=>ES(du(Math.atan2(i[6],i[5]))),rotateY:i=>ES(du(Math.atan2(-i[2],i[0]))),rotateZ:KR,rotate:KR,skewX:i=>du(Math.atan(i[4])),skewY:i=>du(Math.atan(i[1])),skew:i=>(Math.abs(i[1])+Math.abs(i[4]))/2};function AS(i){return i.includes("scale")?1:0}function wS(i,e){if(!i||i==="none")return AS(e);const t=i.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let n,r;if(t)n=eG,r=t;else{const l=i.match(/^matrix\(([-\d.e\s,]+)\)$/u);n=JV,r=l}if(!r)return AS(e);const s=n[e],a=r[1].split(",").map(nG);return typeof s=="function"?s(a):a[s]}const tG=(i,e)=>{const{transform:t="none"}=getComputedStyle(i);return wS(t,e)};function nG(i){return parseFloat(i.trim())}const Vh=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Gh=new Set(Vh),JR=i=>i===zh||i===Tt,iG=new Set(["x","y","z"]),rG=Vh.filter(i=>!iG.has(i));function sG(i){const e=[];return rG.forEach(t=>{const n=i.getValue(t);n!==void 0&&(e.push([t,n.get()]),n.set(t.startsWith("scale")?1:0))}),e}const pu={width:({x:i},{paddingLeft:e="0",paddingRight:t="0"})=>i.max-i.min-parseFloat(e)-parseFloat(t),height:({y:i},{paddingTop:e="0",paddingBottom:t="0"})=>i.max-i.min-parseFloat(e)-parseFloat(t),top:(i,{top:e})=>parseFloat(e),left:(i,{left:e})=>parseFloat(e),bottom:({y:i},{top:e})=>parseFloat(e)+(i.max-i.min),right:({x:i},{left:e})=>parseFloat(e)+(i.max-i.min),x:(i,{transform:e})=>wS(e,"x"),y:(i,{transform:e})=>wS(e,"y")};pu.translateX=pu.x;pu.translateY=pu.y;const mu=new Set;let RS=!1,CS=!1,NS=!1;function OL(){if(CS){const i=Array.from(mu).filter(n=>n.needsMeasurement),e=new Set(i.map(n=>n.element)),t=new Map;e.forEach(n=>{const r=sG(n);r.length&&(t.set(n,r),n.render())}),i.forEach(n=>n.measureInitialState()),e.forEach(n=>{n.render();const r=t.get(n);r&&r.forEach(([s,a])=>{var l;(l=n.getValue(s))==null||l.set(a)})}),i.forEach(n=>n.measureEndState()),i.forEach(n=>{n.suspendedScrollY!==void 0&&window.scrollTo(0,n.suspendedScrollY)})}CS=!1,RS=!1,mu.forEach(i=>i.complete(NS)),mu.clear()}function BL(){mu.forEach(i=>{i.readKeyframes(),i.needsMeasurement&&(CS=!0)})}function aG(){NS=!0,BL(),OL(),NS=!1}class iM{constructor(e,t,n,r,s,a=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=t,this.name=n,this.motionValue=r,this.element=s,this.isAsync=a}scheduleResolve(){this.state="scheduled",this.isAsync?(mu.add(this),RS||(RS=!0,Hn.read(BL),Hn.resolveKeyframes(OL))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:t,element:n,motionValue:r}=this;if(e[0]===null){const s=r==null?void 0:r.get(),a=e[e.length-1];if(s!==void 0)e[0]=s;else if(n&&t){const l=n.readValue(t,a);l!=null&&(e[0]=l)}e[0]===void 0&&(e[0]=a),r&&s===void 0&&r.set(e[0])}QV(e)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(e=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),mu.delete(this)}cancel(){this.state==="scheduled"&&(mu.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const oG=i=>i.startsWith("--");function lG(i,e,t){oG(e)?i.style.setProperty(e,t):i.style[e]=t}const uG=WT(()=>window.ScrollTimeline!==void 0),cG={};function hG(i,e){const t=WT(i);return()=>cG[e]??t()}const IL=hG(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),Ed=([i,e,t,n])=>`cubic-bezier(${i}, ${e}, ${t}, ${n})`,eC={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Ed([0,.65,.55,1]),circOut:Ed([.55,0,1,.45]),backIn:Ed([.31,.01,.66,-.59]),backOut:Ed([.33,1.53,.69,.99])};function FL(i,e){if(i)return typeof i=="function"?IL()?DL(i,e):"ease-out":SL(i)?Ed(i):Array.isArray(i)?i.map(t=>FL(t,e)||eC.easeOut):eC[i]}function fG(i,e,t,{delay:n=0,duration:r=300,repeat:s=0,repeatType:a="loop",ease:l="easeOut",times:u}={},h=void 0){const d={[e]:t};u&&(d.offset=u);const p=FL(l,r);Array.isArray(p)&&(d.easing=p);const g={delay:n,duration:r,easing:Array.isArray(p)?"linear":p,fill:"both",iterations:s+1,direction:a==="reverse"?"alternate":"normal"};return h&&(g.pseudoElement=h),i.animate(d,g)}function kL(i){return typeof i=="function"&&"applyToOptions"in i}function dG({type:i,...e}){return kL(i)&&IL()?i.applyToOptions(e):(e.duration??(e.duration=300),e.ease??(e.ease="easeOut"),e)}class pG extends tM{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,!e)return;const{element:t,name:n,keyframes:r,pseudoElement:s,allowFlatten:a=!1,finalKeyframe:l,onComplete:u}=e;this.isPseudoElement=!!s,this.allowFlatten=a,this.options=e,HT(typeof e.type!="string");const h=dG(e);this.animation=fG(t,n,r,h,s),h.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!s){const d=eM(r,this.options,l,this.speed);this.updateMotionValue?this.updateMotionValue(d):lG(t,n,d),this.animation.cancel()}u==null||u(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){var e,t;(t=(e=this.animation).finish)==null||t.call(e)}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:e}=this;e==="idle"||e==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){var e,t;this.isPseudoElement||(t=(e=this.animation).commitStyles)==null||t.call(e)}get duration(){var t,n;const e=((n=(t=this.animation.effect)==null?void 0:t.getComputedTiming)==null?void 0:n.call(t).duration)||0;return la(Number(e))}get time(){return la(Number(this.animation.currentTime)||0)}set time(e){this.finishedTime=null,this.animation.currentTime=oa(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(e){this.animation.startTime=e}attachTimeline({timeline:e,observe:t}){var n;return this.allowFlatten&&((n=this.animation.effect)==null||n.updateTiming({easing:"linear"})),this.animation.onfinish=null,e&&uG()?(this.animation.timeline=e,xs):t(this)}}const zL={anticipate:vL,backInOut:yL,circInOut:xL};function mG(i){return i in zL}function gG(i){typeof i.ease=="string"&&mG(i.ease)&&(i.ease=zL[i.ease])}const tC=10;class yG extends pG{constructor(e){gG(e),UL(e),super(e),e.startTime&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){const{motionValue:t,onUpdate:n,onComplete:r,element:s,...a}=this.options;if(!t)return;if(e!==void 0){t.set(e);return}const l=new nM({...a,autoplay:!1}),u=oa(this.finishedTime??this.time);t.setWithVelocity(l.sample(u-tC).value,l.sample(u).value,tC),l.stop()}}const nC=(i,e)=>e==="zIndex"?!1:!!(typeof i=="number"||Array.isArray(i)||typeof i=="string"&&(cl.test(i)||i==="0")&&!i.startsWith("url("));function vG(i){const e=i[0];if(i.length===1)return!0;for(let t=0;t<i.length;t++)if(i[t]!==e)return!0}function _G(i,e,t,n){const r=i[0];if(r===null)return!1;if(e==="display"||e==="visibility")return!0;const s=i[i.length-1],a=nC(r,e),l=nC(s,e);return!a||!l?!1:vG(i)||(t==="spring"||kL(t))&&n}function rM(i){return cL(i)&&"offsetHeight"in i}const xG=new Set(["opacity","clipPath","filter","transform"]),bG=WT(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function SG(i){var h;const{motionValue:e,name:t,repeatDelay:n,repeatType:r,damping:s,type:a}=i;if(!rM((h=e==null?void 0:e.owner)==null?void 0:h.current))return!1;const{onUpdate:l,transformTemplate:u}=e.owner.getProps();return bG()&&t&&xG.has(t)&&(t!=="transform"||!u)&&!l&&!n&&r!=="mirror"&&s!==0&&a!=="inertia"}const TG=40;class MG extends tM{constructor({autoplay:e=!0,delay:t=0,type:n="keyframes",repeat:r=0,repeatDelay:s=0,repeatType:a="loop",keyframes:l,name:u,motionValue:h,element:d,...p}){var v;super(),this.stop=()=>{var S,b;this._animation&&(this._animation.stop(),(S=this.stopTimeline)==null||S.call(this)),(b=this.keyframeResolver)==null||b.cancel()},this.createdAt=Cr.now();const g={autoplay:e,delay:t,type:n,repeat:r,repeatDelay:s,repeatType:a,name:u,motionValue:h,element:d,...p},y=(d==null?void 0:d.KeyframeResolver)||iM;this.keyframeResolver=new y(l,(S,b,_)=>this.onKeyframesResolved(S,b,g,!_),u,h,d),(v=this.keyframeResolver)==null||v.scheduleResolve()}onKeyframesResolved(e,t,n,r){this.keyframeResolver=void 0;const{name:s,type:a,velocity:l,delay:u,isHandoff:h,onUpdate:d}=n;this.resolvedAt=Cr.now(),_G(e,s,a,l)||((co.instantAnimations||!u)&&(d==null||d(eM(e,n,t))),e[0]=e[e.length-1],n.duration=0,n.repeat=0);const g={startTime:r?this.resolvedAt?this.resolvedAt-this.createdAt>TG?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:t,...n,keyframes:e},y=!h&&SG(g)?new yG({...g,element:g.motionValue.owner.current}):new nM(g);y.finished.then(()=>this.notifyFinished()).catch(xs),this.pendingTimeline&&(this.stopTimeline=y.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=y}get finished(){return this._animation?this.animation.finished:this._finished}then(e,t){return this.finished.finally(e).then(()=>{})}get animation(){var e;return this._animation||((e=this.keyframeResolver)==null||e.resume(),aG()),this._animation}get duration(){return this.animation.duration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){var e;this._animation&&this.animation.cancel(),(e=this.keyframeResolver)==null||e.cancel()}}const EG=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function AG(i){const e=EG.exec(i);if(!e)return[,];const[,t,n,r]=e;return[`--${t??n}`,r]}function VL(i,e,t=1){const[n,r]=AG(i);if(!n)return;const s=window.getComputedStyle(e).getPropertyValue(n);if(s){const a=s.trim();return uL(a)?parseFloat(a):a}return YT(r)?VL(r,e,t+1):r}function sM(i,e){return(i==null?void 0:i[e])??(i==null?void 0:i.default)??i}const GL=new Set(["width","height","top","left","right","bottom",...Vh]),wG={test:i=>i==="auto",parse:i=>i},HL=i=>e=>e.test(i),WL=[zh,Tt,ua,Jo,vV,yV,wG],iC=i=>WL.find(HL(i));function RG(i){return typeof i=="number"?i===0:i!==null?i==="none"||i==="0"||hL(i):!0}const CG=new Set(["brightness","contrast","saturate","opacity"]);function NG(i){const[e,t]=i.slice(0,-1).split("(");if(e==="drop-shadow")return i;const[n]=t.match(KT)||[];if(!n)return i;const r=t.replace(n,"");let s=CG.has(e)?1:0;return n!==t&&(s*=100),e+"("+s+r+")"}const PG=/\b([a-z-]*)\(.*?\)/gu,PS={...cl,getAnimatableNone:i=>{const e=i.match(PG);return e?e.map(NG).join(" "):i}},rC={...zh,transform:Math.round},DG={rotate:Jo,rotateX:Jo,rotateY:Jo,rotateZ:Jo,scale:dg,scaleX:dg,scaleY:dg,scaleZ:dg,skew:Jo,skewX:Jo,skewY:Jo,distance:Tt,translateX:Tt,translateY:Tt,translateZ:Tt,x:Tt,y:Tt,z:Tt,perspective:Tt,transformPerspective:Tt,opacity:ep,originX:jR,originY:jR,originZ:Tt},aM={borderWidth:Tt,borderTopWidth:Tt,borderRightWidth:Tt,borderBottomWidth:Tt,borderLeftWidth:Tt,borderRadius:Tt,radius:Tt,borderTopLeftRadius:Tt,borderTopRightRadius:Tt,borderBottomRightRadius:Tt,borderBottomLeftRadius:Tt,width:Tt,maxWidth:Tt,height:Tt,maxHeight:Tt,top:Tt,right:Tt,bottom:Tt,left:Tt,padding:Tt,paddingTop:Tt,paddingRight:Tt,paddingBottom:Tt,paddingLeft:Tt,margin:Tt,marginTop:Tt,marginRight:Tt,marginBottom:Tt,marginLeft:Tt,backgroundPositionX:Tt,backgroundPositionY:Tt,...DG,zIndex:rC,fillOpacity:ep,strokeOpacity:ep,numOctaves:rC},LG={...aM,color:li,backgroundColor:li,outlineColor:li,fill:li,stroke:li,borderColor:li,borderTopColor:li,borderRightColor:li,borderBottomColor:li,borderLeftColor:li,filter:PS,WebkitFilter:PS},jL=i=>LG[i];function qL(i,e){let t=jL(i);return t!==PS&&(t=cl),t.getAnimatableNone?t.getAnimatableNone(e):void 0}const UG=new Set(["auto","none","0"]);function OG(i,e,t){let n=0,r;for(;n<i.length&&!r;){const s=i[n];typeof s=="string"&&!UG.has(s)&&tp(s).values.length&&(r=i[n]),n++}if(r&&t)for(const s of e)i[s]=qL(t,r)}class BG extends iM{constructor(e,t,n,r,s){super(e,t,n,r,s,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:t,name:n}=this;if(!t||!t.current)return;super.readKeyframes();for(let u=0;u<e.length;u++){let h=e[u];if(typeof h=="string"&&(h=h.trim(),YT(h))){const d=VL(h,t.current);d!==void 0&&(e[u]=d),u===e.length-1&&(this.finalKeyframe=h)}}if(this.resolveNoneKeyframes(),!GL.has(n)||e.length!==2)return;const[r,s]=e,a=iC(r),l=iC(s);if(a!==l)if(JR(a)&&JR(l))for(let u=0;u<e.length;u++){const h=e[u];typeof h=="string"&&(e[u]=parseFloat(h))}else pu[n]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:t}=this,n=[];for(let r=0;r<e.length;r++)(e[r]===null||RG(e[r]))&&n.push(r);n.length&&OG(e,n,t)}measureInitialState(){const{element:e,unresolvedKeyframes:t,name:n}=this;if(!e||!e.current)return;n==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=pu[n](e.measureViewportBox(),window.getComputedStyle(e.current)),t[0]=this.measuredOrigin;const r=t[t.length-1];r!==void 0&&e.getValue(n,r).jump(r,!1)}measureEndState(){var l;const{element:e,name:t,unresolvedKeyframes:n}=this;if(!e||!e.current)return;const r=e.getValue(t);r&&r.jump(this.measuredOrigin,!1);const s=n.length-1,a=n[s];n[s]=pu[t](e.measureViewportBox(),window.getComputedStyle(e.current)),a!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=a),(l=this.removedTransforms)!=null&&l.length&&this.removedTransforms.forEach(([u,h])=>{e.getValue(u).set(h)}),this.resolveNoneKeyframes()}}function $L(i,e,t){if(i instanceof EventTarget)return[i];if(typeof i=="string"){const r=document.querySelectorAll(i);return r?Array.from(r):[]}return Array.from(i)}const XL=(i,e)=>e&&typeof i=="number"?e.transform(i):i,sC=30,IG=i=>!isNaN(parseFloat(i));class FG{constructor(e,t={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=(n,r=!0)=>{var a,l;const s=Cr.now();if(this.updatedAt!==s&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(n),this.current!==this.prev&&((a=this.events.change)==null||a.notify(this.current),this.dependents))for(const u of this.dependents)u.dirty();r&&((l=this.events.renderRequest)==null||l.notify(this.current))},this.hasAnimated=!1,this.setCurrent(e),this.owner=t.owner}setCurrent(e){this.current=e,this.updatedAt=Cr.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=IG(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,t){this.events[e]||(this.events[e]=new jT);const n=this.events[e].add(t);return e==="change"?()=>{n(),Hn.read(()=>{this.events.change.getSize()||this.stop()})}:n}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,t){this.passiveEffect=e,this.stopPassiveEffect=t}set(e,t=!0){!t||!this.passiveEffect?this.updateAndNotify(e,t):this.passiveEffect(e,this.updateAndNotify)}setWithVelocity(e,t,n){this.set(t),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-n}jump(e,t=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,t&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){var e;(e=this.events.change)==null||e.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=Cr.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>sC)return 0;const t=Math.min(this.updatedAt-this.prevUpdatedAt,sC);return fL(parseFloat(this.current)-parseFloat(this.prevFrameValue),t)}start(e){return this.stop(),new Promise(t=>{this.hasAnimated=!0,this.animation=e(t),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){var e,t;(e=this.dependents)==null||e.clear(),(t=this.events.destroy)==null||t.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function ah(i,e){return new FG(i,e)}const{schedule:oM}=TL(queueMicrotask,!1),Ls={x:!1,y:!1};function YL(){return Ls.x||Ls.y}function kG(i){return i==="x"||i==="y"?Ls[i]?null:(Ls[i]=!0,()=>{Ls[i]=!1}):Ls.x||Ls.y?null:(Ls.x=Ls.y=!0,()=>{Ls.x=Ls.y=!1})}function KL(i,e){const t=$L(i),n=new AbortController,r={passive:!0,...e,signal:n.signal};return[t,r,()=>n.abort()]}function aC(i){return!(i.pointerType==="touch"||YL())}function zG(i,e,t={}){const[n,r,s]=KL(i,t),a=l=>{if(!aC(l))return;const{target:u}=l,h=e(u,l);if(typeof h!="function"||!u)return;const d=p=>{aC(p)&&(h(p),u.removeEventListener("pointerleave",d))};u.addEventListener("pointerleave",d,r)};return n.forEach(l=>{l.addEventListener("pointerenter",a,r)}),s}const ZL=(i,e)=>e?i===e?!0:ZL(i,e.parentElement):!1,lM=i=>i.pointerType==="mouse"?typeof i.button!="number"||i.button<=0:i.isPrimary!==!1,VG=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function GG(i){return VG.has(i.tagName)||i.tabIndex!==-1}const Sy=new WeakSet;function oC(i){return e=>{e.key==="Enter"&&i(e)}}function px(i,e){i.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const HG=(i,e)=>{const t=i.currentTarget;if(!t)return;const n=oC(()=>{if(Sy.has(t))return;px(t,"down");const r=oC(()=>{px(t,"up")}),s=()=>px(t,"cancel");t.addEventListener("keyup",r,e),t.addEventListener("blur",s,e)});t.addEventListener("keydown",n,e),t.addEventListener("blur",()=>t.removeEventListener("keydown",n),e)};function lC(i){return lM(i)&&!YL()}function WG(i,e,t={}){const[n,r,s]=KL(i,t),a=l=>{const u=l.currentTarget;if(!lC(l))return;Sy.add(u);const h=e(u,l),d=(y,v)=>{window.removeEventListener("pointerup",p),window.removeEventListener("pointercancel",g),Sy.has(u)&&Sy.delete(u),lC(y)&&typeof h=="function"&&h(y,{success:v})},p=y=>{d(y,u===window||u===document||t.useGlobalTarget||ZL(u,y.target))},g=y=>{d(y,!1)};window.addEventListener("pointerup",p,r),window.addEventListener("pointercancel",g,r)};return n.forEach(l=>{(t.useGlobalTarget?window:l).addEventListener("pointerdown",a,r),rM(l)&&(l.addEventListener("focus",h=>HG(h,r)),!GG(l)&&!l.hasAttribute("tabindex")&&(l.tabIndex=0))}),s}function QL(i){return cL(i)&&"ownerSVGElement"in i}function jG(i){return QL(i)&&i.tagName==="svg"}const nr=i=>!!(i&&i.getVelocity),qG=[...WL,li,cl],$G=i=>qG.find(HL(i)),uM=fe.createContext({transformPagePoint:i=>i,isStatic:!1,reducedMotion:"never"});class XG extends fe.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const n=t.offsetParent,r=rM(n)&&n.offsetWidth||0,s=this.props.sizeRef.current;s.height=t.offsetHeight||0,s.width=t.offsetWidth||0,s.top=t.offsetTop,s.left=t.offsetLeft,s.right=r-s.width-s.left}return null}componentDidUpdate(){}render(){return this.props.children}}function YG({children:i,isPresent:e,anchorX:t}){const n=fe.useId(),r=fe.useRef(null),s=fe.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:a}=fe.useContext(uM);return fe.useInsertionEffect(()=>{const{width:l,height:u,top:h,left:d,right:p}=s.current;if(e||!r.current||!l||!u)return;const g=t==="left"?`left: ${d}`:`right: ${p}`;r.current.dataset.motionPopId=n;const y=document.createElement("style");return a&&(y.nonce=a),document.head.appendChild(y),y.sheet&&y.sheet.insertRule(`
          [data-motion-pop-id="${n}"] {
            position: absolute !important;
            width: ${l}px !important;
            height: ${u}px !important;
            ${g}px !important;
            top: ${h}px !important;
          }
        `),()=>{document.head.contains(y)&&document.head.removeChild(y)}},[e]),_e.jsx(XG,{isPresent:e,childRef:r,sizeRef:s,children:fe.cloneElement(i,{ref:r})})}const KG=({children:i,initial:e,isPresent:t,onExitComplete:n,custom:r,presenceAffectsLayout:s,mode:a,anchorX:l})=>{const u=kT(ZG),h=fe.useId();let d=!0,p=fe.useMemo(()=>(d=!1,{id:h,initial:e,isPresent:t,custom:r,onExitComplete:g=>{u.set(g,!0);for(const y of u.values())if(!y)return;n&&n()},register:g=>(u.set(g,!1),()=>u.delete(g))}),[t,u,n]);return s&&d&&(p={...p}),fe.useMemo(()=>{u.forEach((g,y)=>u.set(y,!1))},[t]),fe.useEffect(()=>{!t&&!u.size&&n&&n()},[t]),a==="popLayout"&&(i=_e.jsx(YG,{isPresent:t,anchorX:l,children:i})),_e.jsx(mv.Provider,{value:p,children:i})};function ZG(){return new Map}function JL(i=!0){const e=fe.useContext(mv);if(e===null)return[!0,null];const{isPresent:t,onExitComplete:n,register:r}=e,s=fe.useId();fe.useEffect(()=>{if(i)return r(s)},[i]);const a=fe.useCallback(()=>i&&n&&n(s),[s,n,i]);return!t&&n?[!1,a]:[!0]}const pg=i=>i.key||"";function uC(i){const e=[];return fe.Children.forEach(i,t=>{fe.isValidElement(t)&&e.push(t)}),e}const QG=({children:i,custom:e,initial:t=!0,onExitComplete:n,presenceAffectsLayout:r=!0,mode:s="sync",propagate:a=!1,anchorX:l="left"})=>{const[u,h]=JL(a),d=fe.useMemo(()=>uC(i),[i]),p=a&&!u?[]:d.map(pg),g=fe.useRef(!0),y=fe.useRef(d),v=kT(()=>new Map),[S,b]=fe.useState(d),[_,E]=fe.useState(d);lL(()=>{g.current=!1,y.current=d;for(let w=0;w<_.length;w++){const R=pg(_[w]);p.includes(R)?v.delete(R):v.get(R)!==!0&&v.set(R,!1)}},[_,p.length,p.join("-")]);const M=[];if(d!==S){let w=[...d];for(let R=0;R<_.length;R++){const C=_[R],L=pg(C);p.includes(L)||(w.splice(R,0,C),M.push(C))}return s==="wait"&&M.length&&(w=M),E(uC(w)),b(d),null}const{forceRender:A}=fe.useContext(FT);return _e.jsx(_e.Fragment,{children:_.map(w=>{const R=pg(w),C=a&&!u?!1:d===_||p.includes(R),L=()=>{if(v.has(R))v.set(R,!0);else return;let N=!0;v.forEach(D=>{D||(N=!1)}),N&&(A==null||A(),E(y.current),a&&(h==null||h()),n&&n())};return _e.jsx(KG,{isPresent:C,initial:!g.current||t?void 0:!1,custom:e,presenceAffectsLayout:r,mode:s,onExitComplete:C?void 0:L,anchorX:l,children:w},R)})})},eU=fe.createContext({strict:!1}),cC={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},oh={};for(const i in cC)oh[i]={isEnabled:e=>cC[i].some(t=>!!e[t])};function JG(i){for(const e in i)oh[e]={...oh[e],...i[e]}}const e4=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Vy(i){return i.startsWith("while")||i.startsWith("drag")&&i!=="draggable"||i.startsWith("layout")||i.startsWith("onTap")||i.startsWith("onPan")||i.startsWith("onLayout")||e4.has(i)}let tU=i=>!Vy(i);function t4(i){typeof i=="function"&&(tU=e=>e.startsWith("on")?!Vy(e):i(e))}try{t4(require("@emotion/is-prop-valid").default)}catch{}function n4(i,e,t){const n={};for(const r in i)r==="values"&&typeof i.values=="object"||(tU(r)||t===!0&&Vy(r)||!e&&!Vy(r)||i.draggable&&r.startsWith("onDrag"))&&(n[r]=i[r]);return n}function i4(i){if(typeof Proxy>"u")return i;const e=new Map,t=(...n)=>i(...n);return new Proxy(t,{get:(n,r)=>r==="create"?i:(e.has(r)||e.set(r,i(r)),e.get(r))})}const gv=fe.createContext({});function yv(i){return i!==null&&typeof i=="object"&&typeof i.start=="function"}function np(i){return typeof i=="string"||Array.isArray(i)}const cM=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],hM=["initial",...cM];function vv(i){return yv(i.animate)||hM.some(e=>np(i[e]))}function nU(i){return!!(vv(i)||i.variants)}function r4(i,e){if(vv(i)){const{initial:t,animate:n}=i;return{initial:t===!1||np(t)?t:void 0,animate:np(n)?n:void 0}}return i.inherit!==!1?e:{}}function s4(i){const{initial:e,animate:t}=r4(i,fe.useContext(gv));return fe.useMemo(()=>({initial:e,animate:t}),[hC(e),hC(t)])}function hC(i){return Array.isArray(i)?i.join(" "):i}const a4=Symbol.for("motionComponentSymbol");function zc(i){return i&&typeof i=="object"&&Object.prototype.hasOwnProperty.call(i,"current")}function o4(i,e,t){return fe.useCallback(n=>{n&&i.onMount&&i.onMount(n),e&&(n?e.mount(n):e.unmount()),t&&(typeof t=="function"?t(n):zc(t)&&(t.current=n))},[e])}const fM=i=>i.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),l4="framerAppearId",iU="data-"+fM(l4),rU=fe.createContext({});function u4(i,e,t,n,r){var S,b;const{visualElement:s}=fe.useContext(gv),a=fe.useContext(eU),l=fe.useContext(mv),u=fe.useContext(uM).reducedMotion,h=fe.useRef(null);n=n||a.renderer,!h.current&&n&&(h.current=n(i,{visualState:e,parent:s,props:t,presenceContext:l,blockInitialAnimation:l?l.initial===!1:!1,reducedMotionConfig:u}));const d=h.current,p=fe.useContext(rU);d&&!d.projection&&r&&(d.type==="html"||d.type==="svg")&&c4(h.current,t,r,p);const g=fe.useRef(!1);fe.useInsertionEffect(()=>{d&&g.current&&d.update(t,l)});const y=t[iU],v=fe.useRef(!!y&&!((S=window.MotionHandoffIsComplete)!=null&&S.call(window,y))&&((b=window.MotionHasOptimisedAnimation)==null?void 0:b.call(window,y)));return lL(()=>{d&&(g.current=!0,window.MotionIsMounted=!0,d.updateFeatures(),oM.render(d.render),v.current&&d.animationState&&d.animationState.animateChanges())}),fe.useEffect(()=>{d&&(!v.current&&d.animationState&&d.animationState.animateChanges(),v.current&&(queueMicrotask(()=>{var _;(_=window.MotionHandoffMarkAsComplete)==null||_.call(window,y)}),v.current=!1))}),d}function c4(i,e,t,n){const{layoutId:r,layout:s,drag:a,dragConstraints:l,layoutScroll:u,layoutRoot:h,layoutCrossfade:d}=e;i.projection=new t(i.latestValues,e["data-framer-portal-id"]?void 0:sU(i.parent)),i.projection.setOptions({layoutId:r,layout:s,alwaysMeasureLayout:!!a||l&&zc(l),visualElement:i,animationType:typeof s=="string"?s:"both",initialPromotionConfig:n,crossfade:d,layoutScroll:u,layoutRoot:h})}function sU(i){if(i)return i.options.allowProjection!==!1?i.projection:sU(i.parent)}function h4({preloadedFeatures:i,createVisualElement:e,useRender:t,useVisualState:n,Component:r}){i&&JG(i);function s(l,u){let h;const d={...fe.useContext(uM),...l,layoutId:f4(l)},{isStatic:p}=d,g=s4(l),y=n(l,p);if(!p&&zT){d4();const v=p4(d);h=v.MeasureLayout,g.visualElement=u4(r,y,d,e,v.ProjectionNode)}return _e.jsxs(gv.Provider,{value:g,children:[h&&g.visualElement?_e.jsx(h,{visualElement:g.visualElement,...d}):null,t(r,l,o4(y,g.visualElement,u),y,p,g.visualElement)]})}s.displayName=`motion.${typeof r=="string"?r:`create(${r.displayName??r.name??""})`}`;const a=fe.forwardRef(s);return a[a4]=r,a}function f4({layoutId:i}){const e=fe.useContext(FT).id;return e&&i!==void 0?e+"-"+i:i}function d4(i,e){fe.useContext(eU).strict}function p4(i){const{drag:e,layout:t}=oh;if(!e&&!t)return{};const n={...e,...t};return{MeasureLayout:e!=null&&e.isEnabled(i)||t!=null&&t.isEnabled(i)?n.MeasureLayout:void 0,ProjectionNode:n.ProjectionNode}}const ip={};function m4(i){for(const e in i)ip[e]=i[e],XT(e)&&(ip[e].isCSSVariable=!0)}function aU(i,{layout:e,layoutId:t}){return Gh.has(i)||i.startsWith("origin")||(e||t!==void 0)&&(!!ip[i]||i==="opacity")}const g4={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},y4=Vh.length;function v4(i,e,t){let n="",r=!0;for(let s=0;s<y4;s++){const a=Vh[s],l=i[a];if(l===void 0)continue;let u=!0;if(typeof l=="number"?u=l===(a.startsWith("scale")?1:0):u=parseFloat(l)===0,!u||t){const h=XL(l,aM[a]);if(!u){r=!1;const d=g4[a]||a;n+=`${d}(${h}) `}t&&(e[a]=h)}}return n=n.trim(),t?n=t(e,r?"":n):r&&(n="none"),n}function dM(i,e,t){const{style:n,vars:r,transformOrigin:s}=i;let a=!1,l=!1;for(const u in e){const h=e[u];if(Gh.has(u)){a=!0;continue}else if(XT(u)){r[u]=h;continue}else{const d=XL(h,aM[u]);u.startsWith("origin")?(l=!0,s[u]=d):n[u]=d}}if(e.transform||(a||t?n.transform=v4(e,i.transform,t):n.transform&&(n.transform="none")),l){const{originX:u="50%",originY:h="50%",originZ:d=0}=s;n.transformOrigin=`${u} ${h} ${d}`}}const pM=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function oU(i,e,t){for(const n in e)!nr(e[n])&&!aU(n,t)&&(i[n]=e[n])}function _4({transformTemplate:i},e){return fe.useMemo(()=>{const t=pM();return dM(t,e,i),Object.assign({},t.vars,t.style)},[e])}function x4(i,e){const t=i.style||{},n={};return oU(n,t,i),Object.assign(n,_4(i,e)),n}function b4(i,e){const t={},n=x4(i,e);return i.drag&&i.dragListener!==!1&&(t.draggable=!1,n.userSelect=n.WebkitUserSelect=n.WebkitTouchCallout="none",n.touchAction=i.drag===!0?"none":`pan-${i.drag==="x"?"y":"x"}`),i.tabIndex===void 0&&(i.onTap||i.onTapStart||i.whileTap)&&(t.tabIndex=0),t.style=n,t}const S4={offset:"stroke-dashoffset",array:"stroke-dasharray"},T4={offset:"strokeDashoffset",array:"strokeDasharray"};function M4(i,e,t=1,n=0,r=!0){i.pathLength=1;const s=r?S4:T4;i[s.offset]=Tt.transform(-n);const a=Tt.transform(e),l=Tt.transform(t);i[s.array]=`${a} ${l}`}function lU(i,{attrX:e,attrY:t,attrScale:n,pathLength:r,pathSpacing:s=1,pathOffset:a=0,...l},u,h,d){if(dM(i,l,h),u){i.style.viewBox&&(i.attrs.viewBox=i.style.viewBox);return}i.attrs=i.style,i.style={};const{attrs:p,style:g}=i;p.transform&&(g.transform=p.transform,delete p.transform),(g.transform||p.transformOrigin)&&(g.transformOrigin=p.transformOrigin??"50% 50%",delete p.transformOrigin),g.transform&&(g.transformBox=(d==null?void 0:d.transformBox)??"fill-box",delete p.transformBox),e!==void 0&&(p.x=e),t!==void 0&&(p.y=t),n!==void 0&&(p.scale=n),r!==void 0&&M4(p,r,s,a,!1)}const uU=()=>({...pM(),attrs:{}}),cU=i=>typeof i=="string"&&i.toLowerCase()==="svg";function E4(i,e,t,n){const r=fe.useMemo(()=>{const s=uU();return lU(s,e,cU(n),i.transformTemplate,i.style),{...s.attrs,style:{...s.style}}},[e]);if(i.style){const s={};oU(s,i.style,i),r.style={...s,...r.style}}return r}const A4=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function mM(i){return typeof i!="string"||i.includes("-")?!1:!!(A4.indexOf(i)>-1||/[A-Z]/u.test(i))}function w4(i=!1){return(t,n,r,{latestValues:s},a)=>{const u=(mM(t)?E4:b4)(n,s,a,t),h=n4(n,typeof t=="string",i),d=t!==fe.Fragment?{...h,...u,ref:r}:{},{children:p}=n,g=fe.useMemo(()=>nr(p)?p.get():p,[p]);return fe.createElement(t,{...d,children:g})}}function fC(i){const e=[{},{}];return i==null||i.values.forEach((t,n)=>{e[0][n]=t.get(),e[1][n]=t.getVelocity()}),e}function gM(i,e,t,n){if(typeof e=="function"){const[r,s]=fC(n);e=e(t!==void 0?t:i.custom,r,s)}if(typeof e=="string"&&(e=i.variants&&i.variants[e]),typeof e=="function"){const[r,s]=fC(n);e=e(t!==void 0?t:i.custom,r,s)}return e}function Ty(i){return nr(i)?i.get():i}function R4({scrapeMotionValuesFromProps:i,createRenderState:e},t,n,r){return{latestValues:C4(t,n,r,i),renderState:e()}}const hU=i=>(e,t)=>{const n=fe.useContext(gv),r=fe.useContext(mv),s=()=>R4(i,e,n,r);return t?s():kT(s)};function C4(i,e,t,n){const r={},s=n(i,{});for(const g in s)r[g]=Ty(s[g]);let{initial:a,animate:l}=i;const u=vv(i),h=nU(i);e&&h&&!u&&i.inherit!==!1&&(a===void 0&&(a=e.initial),l===void 0&&(l=e.animate));let d=t?t.initial===!1:!1;d=d||a===!1;const p=d?l:a;if(p&&typeof p!="boolean"&&!yv(p)){const g=Array.isArray(p)?p:[p];for(let y=0;y<g.length;y++){const v=gM(i,g[y]);if(v){const{transitionEnd:S,transition:b,..._}=v;for(const E in _){let M=_[E];if(Array.isArray(M)){const A=d?M.length-1:0;M=M[A]}M!==null&&(r[E]=M)}for(const E in S)r[E]=S[E]}}}return r}function yM(i,e,t){var s;const{style:n}=i,r={};for(const a in n)(nr(n[a])||e.style&&nr(e.style[a])||aU(a,i)||((s=t==null?void 0:t.getValue(a))==null?void 0:s.liveStyle)!==void 0)&&(r[a]=n[a]);return r}const N4={useVisualState:hU({scrapeMotionValuesFromProps:yM,createRenderState:pM})};function fU(i,e,t){const n=yM(i,e,t);for(const r in i)if(nr(i[r])||nr(e[r])){const s=Vh.indexOf(r)!==-1?"attr"+r.charAt(0).toUpperCase()+r.substring(1):r;n[s]=i[r]}return n}const P4={useVisualState:hU({scrapeMotionValuesFromProps:fU,createRenderState:uU})};function D4(i,e){return function(n,{forwardMotionProps:r}={forwardMotionProps:!1}){const a={...mM(n)?P4:N4,preloadedFeatures:i,useRender:w4(r),createVisualElement:e,Component:n};return h4(a)}}function rp(i,e,t){const n=i.getProps();return gM(n,e,t!==void 0?t:n.custom,i)}const DS=i=>Array.isArray(i);function L4(i,e,t){i.hasValue(e)?i.getValue(e).set(t):i.addValue(e,ah(t))}function U4(i){return DS(i)?i[i.length-1]||0:i}function O4(i,e){const t=rp(i,e);let{transitionEnd:n={},transition:r={},...s}=t||{};s={...s,...n};for(const a in s){const l=U4(s[a]);L4(i,a,l)}}function B4(i){return!!(nr(i)&&i.add)}function LS(i,e){const t=i.getValue("willChange");if(B4(t))return t.add(e);if(!t&&co.WillChange){const n=new co.WillChange("auto");i.addValue("willChange",n),n.add(e)}}function dU(i){return i.props[iU]}const I4=i=>i!==null;function F4(i,{repeat:e,repeatType:t="loop"},n){const r=i.filter(I4),s=e&&t!=="loop"&&e%2===1?0:r.length-1;return r[s]}const k4={type:"spring",stiffness:500,damping:25,restSpeed:10},z4=i=>({type:"spring",stiffness:550,damping:i===0?2*Math.sqrt(550):30,restSpeed:10}),V4={type:"keyframes",duration:.8},G4={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},H4=(i,{keyframes:e})=>e.length>2?V4:Gh.has(i)?i.startsWith("scale")?z4(e[1]):k4:G4;function W4({when:i,delay:e,delayChildren:t,staggerChildren:n,staggerDirection:r,repeat:s,repeatType:a,repeatDelay:l,from:u,elapsed:h,...d}){return!!Object.keys(d).length}const vM=(i,e,t,n={},r,s)=>a=>{const l=sM(n,i)||{},u=l.delay||n.delay||0;let{elapsed:h=0}=n;h=h-oa(u);const d={keyframes:Array.isArray(t)?t:[null,t],ease:"easeOut",velocity:e.getVelocity(),...l,delay:-h,onUpdate:g=>{e.set(g),l.onUpdate&&l.onUpdate(g)},onComplete:()=>{a(),l.onComplete&&l.onComplete()},name:i,motionValue:e,element:s?void 0:r};W4(l)||Object.assign(d,H4(i,d)),d.duration&&(d.duration=oa(d.duration)),d.repeatDelay&&(d.repeatDelay=oa(d.repeatDelay)),d.from!==void 0&&(d.keyframes[0]=d.from);let p=!1;if((d.type===!1||d.duration===0&&!d.repeatDelay)&&(d.duration=0,d.delay===0&&(p=!0)),(co.instantAnimations||co.skipAnimations)&&(p=!0,d.duration=0,d.delay=0),d.allowFlatten=!l.type&&!l.ease,p&&!s&&e.get()!==void 0){const g=F4(d.keyframes,l);if(g!==void 0){Hn.update(()=>{d.onUpdate(g),d.onComplete()});return}}return l.isSync?new nM(d):new MG(d)};function j4({protectedKeys:i,needsAnimating:e},t){const n=i.hasOwnProperty(t)&&e[t]!==!0;return e[t]=!1,n}function pU(i,e,{delay:t=0,transitionOverride:n,type:r}={}){let{transition:s=i.getDefaultTransition(),transitionEnd:a,...l}=e;n&&(s=n);const u=[],h=r&&i.animationState&&i.animationState.getState()[r];for(const d in l){const p=i.getValue(d,i.latestValues[d]??null),g=l[d];if(g===void 0||h&&j4(h,d))continue;const y={delay:t,...sM(s||{},d)},v=p.get();if(v!==void 0&&!p.isAnimating&&!Array.isArray(g)&&g===v&&!y.velocity)continue;let S=!1;if(window.MotionHandoffAnimation){const _=dU(i);if(_){const E=window.MotionHandoffAnimation(_,d,Hn);E!==null&&(y.startTime=E,S=!0)}}LS(i,d),p.start(vM(d,p,g,i.shouldReduceMotion&&GL.has(d)?{type:!1}:y,i,S));const b=p.animation;b&&u.push(b)}return a&&Promise.all(u).then(()=>{Hn.update(()=>{a&&O4(i,a)})}),u}function US(i,e,t={}){var u;const n=rp(i,e,t.type==="exit"?(u=i.presenceContext)==null?void 0:u.custom:void 0);let{transition:r=i.getDefaultTransition()||{}}=n||{};t.transitionOverride&&(r=t.transitionOverride);const s=n?()=>Promise.all(pU(i,n,t)):()=>Promise.resolve(),a=i.variantChildren&&i.variantChildren.size?(h=0)=>{const{delayChildren:d=0,staggerChildren:p,staggerDirection:g}=r;return q4(i,e,d+h,p,g,t)}:()=>Promise.resolve(),{when:l}=r;if(l){const[h,d]=l==="beforeChildren"?[s,a]:[a,s];return h().then(()=>d())}else return Promise.all([s(),a(t.delay)])}function q4(i,e,t=0,n=0,r=1,s){const a=[],l=(i.variantChildren.size-1)*n,u=r===1?(h=0)=>h*n:(h=0)=>l-h*n;return Array.from(i.variantChildren).sort($4).forEach((h,d)=>{h.notify("AnimationStart",e),a.push(US(h,e,{...s,delay:t+u(d)}).then(()=>h.notify("AnimationComplete",e)))}),Promise.all(a)}function $4(i,e){return i.sortNodePosition(e)}function X4(i,e,t={}){i.notify("AnimationStart",e);let n;if(Array.isArray(e)){const r=e.map(s=>US(i,s,t));n=Promise.all(r)}else if(typeof e=="string")n=US(i,e,t);else{const r=typeof e=="function"?rp(i,e,t.custom):e;n=Promise.all(pU(i,r,t))}return n.then(()=>{i.notify("AnimationComplete",e)})}function mU(i,e){if(!Array.isArray(e))return!1;const t=e.length;if(t!==i.length)return!1;for(let n=0;n<t;n++)if(e[n]!==i[n])return!1;return!0}const Y4=hM.length;function gU(i){if(!i)return;if(!i.isControllingVariants){const t=i.parent?gU(i.parent)||{}:{};return i.props.initial!==void 0&&(t.initial=i.props.initial),t}const e={};for(let t=0;t<Y4;t++){const n=hM[t],r=i.props[n];(np(r)||r===!1)&&(e[n]=r)}return e}const K4=[...cM].reverse(),Z4=cM.length;function Q4(i){return e=>Promise.all(e.map(({animation:t,options:n})=>X4(i,t,n)))}function J4(i){let e=Q4(i),t=dC(),n=!0;const r=u=>(h,d)=>{var g;const p=rp(i,d,u==="exit"?(g=i.presenceContext)==null?void 0:g.custom:void 0);if(p){const{transition:y,transitionEnd:v,...S}=p;h={...h,...S,...v}}return h};function s(u){e=u(i)}function a(u){const{props:h}=i,d=gU(i.parent)||{},p=[],g=new Set;let y={},v=1/0;for(let b=0;b<Z4;b++){const _=K4[b],E=t[_],M=h[_]!==void 0?h[_]:d[_],A=np(M),w=_===u?E.isActive:null;w===!1&&(v=b);let R=M===d[_]&&M!==h[_]&&A;if(R&&n&&i.manuallyAnimateOnMount&&(R=!1),E.protectedKeys={...y},!E.isActive&&w===null||!M&&!E.prevProp||yv(M)||typeof M=="boolean")continue;const C=eH(E.prevProp,M);let L=C||_===u&&E.isActive&&!R&&A||b>v&&A,N=!1;const D=Array.isArray(M)?M:[M];let I=D.reduce(r(_),{});w===!1&&(I={});const{prevResolvedValues:W={}}=E,Y={...W,...I},oe=k=>{L=!0,g.has(k)&&(N=!0,g.delete(k)),E.needsAnimating[k]=!0;const G=i.getValue(k);G&&(G.liveStyle=!1)};for(const k in Y){const G=I[k],he=W[k];if(y.hasOwnProperty(k))continue;let F=!1;DS(G)&&DS(he)?F=!mU(G,he):F=G!==he,F?G!=null?oe(k):g.add(k):G!==void 0&&g.has(k)?oe(k):E.protectedKeys[k]=!0}E.prevProp=M,E.prevResolvedValues=I,E.isActive&&(y={...y,...I}),n&&i.blockInitialAnimation&&(L=!1),L&&(!(R&&C)||N)&&p.push(...D.map(k=>({animation:k,options:{type:_}})))}if(g.size){const b={};if(typeof h.initial!="boolean"){const _=rp(i,Array.isArray(h.initial)?h.initial[0]:h.initial);_&&_.transition&&(b.transition=_.transition)}g.forEach(_=>{const E=i.getBaseTarget(_),M=i.getValue(_);M&&(M.liveStyle=!0),b[_]=E??null}),p.push({animation:b})}let S=!!p.length;return n&&(h.initial===!1||h.initial===h.animate)&&!i.manuallyAnimateOnMount&&(S=!1),n=!1,S?e(p):Promise.resolve()}function l(u,h){var p;if(t[u].isActive===h)return Promise.resolve();(p=i.variantChildren)==null||p.forEach(g=>{var y;return(y=g.animationState)==null?void 0:y.setActive(u,h)}),t[u].isActive=h;const d=a(u);for(const g in t)t[g].protectedKeys={};return d}return{animateChanges:a,setActive:l,setAnimateFunction:s,getState:()=>t,reset:()=>{t=dC(),n=!0}}}function eH(i,e){return typeof e=="string"?e!==i:Array.isArray(e)?!mU(e,i):!1}function Gl(i=!1){return{isActive:i,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function dC(){return{animate:Gl(!0),whileInView:Gl(),whileHover:Gl(),whileTap:Gl(),whileDrag:Gl(),whileFocus:Gl(),exit:Gl()}}class yl{constructor(e){this.isMounted=!1,this.node=e}update(){}}class tH extends yl{constructor(e){super(e),e.animationState||(e.animationState=J4(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();yv(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:t}=this.node.prevProps||{};e!==t&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),(e=this.unmountControls)==null||e.call(this)}}let nH=0;class iH extends yl{constructor(){super(...arguments),this.id=nH++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:t}=this.node.presenceContext,{isPresent:n}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===n)return;const r=this.node.animationState.setActive("exit",!e);t&&!e&&r.then(()=>{t(this.id)})}mount(){const{register:e,onExitComplete:t}=this.node.presenceContext||{};t&&t(this.id),e&&(this.unmount=e(this.id))}unmount(){}}const rH={animation:{Feature:tH},exit:{Feature:iH}};function sp(i,e,t,n={passive:!0}){return i.addEventListener(e,t,n),()=>i.removeEventListener(e,t)}function kp(i){return{point:{x:i.pageX,y:i.pageY}}}const sH=i=>e=>lM(e)&&i(e,kp(e));function Fd(i,e,t,n){return sp(i,e,sH(t),n)}function yU({top:i,left:e,right:t,bottom:n}){return{x:{min:e,max:t},y:{min:i,max:n}}}function aH({x:i,y:e}){return{top:e.min,right:i.max,bottom:e.max,left:i.min}}function oH(i,e){if(!e)return i;const t=e({x:i.left,y:i.top}),n=e({x:i.right,y:i.bottom});return{top:t.y,left:t.x,bottom:n.y,right:n.x}}const vU=1e-4,lH=1-vU,uH=1+vU,_U=.01,cH=0-_U,hH=0+_U;function yr(i){return i.max-i.min}function fH(i,e,t){return Math.abs(i-e)<=t}function pC(i,e,t,n=.5){i.origin=n,i.originPoint=Vn(e.min,e.max,i.origin),i.scale=yr(t)/yr(e),i.translate=Vn(t.min,t.max,i.origin)-i.originPoint,(i.scale>=lH&&i.scale<=uH||isNaN(i.scale))&&(i.scale=1),(i.translate>=cH&&i.translate<=hH||isNaN(i.translate))&&(i.translate=0)}function kd(i,e,t,n){pC(i.x,e.x,t.x,n?n.originX:void 0),pC(i.y,e.y,t.y,n?n.originY:void 0)}function mC(i,e,t){i.min=t.min+e.min,i.max=i.min+yr(e)}function dH(i,e,t){mC(i.x,e.x,t.x),mC(i.y,e.y,t.y)}function gC(i,e,t){i.min=e.min-t.min,i.max=i.min+yr(e)}function zd(i,e,t){gC(i.x,e.x,t.x),gC(i.y,e.y,t.y)}const yC=()=>({translate:0,scale:1,origin:0,originPoint:0}),Vc=()=>({x:yC(),y:yC()}),vC=()=>({min:0,max:0}),Qn=()=>({x:vC(),y:vC()});function ms(i){return[i("x"),i("y")]}function mx(i){return i===void 0||i===1}function OS({scale:i,scaleX:e,scaleY:t}){return!mx(i)||!mx(e)||!mx(t)}function eu(i){return OS(i)||xU(i)||i.z||i.rotate||i.rotateX||i.rotateY||i.skewX||i.skewY}function xU(i){return _C(i.x)||_C(i.y)}function _C(i){return i&&i!=="0%"}function Gy(i,e,t){const n=i-t,r=e*n;return t+r}function xC(i,e,t,n,r){return r!==void 0&&(i=Gy(i,r,n)),Gy(i,t,n)+e}function BS(i,e=0,t=1,n,r){i.min=xC(i.min,e,t,n,r),i.max=xC(i.max,e,t,n,r)}function bU(i,{x:e,y:t}){BS(i.x,e.translate,e.scale,e.originPoint),BS(i.y,t.translate,t.scale,t.originPoint)}const bC=.999999999999,SC=1.0000000000001;function pH(i,e,t,n=!1){const r=t.length;if(!r)return;e.x=e.y=1;let s,a;for(let l=0;l<r;l++){s=t[l],a=s.projectionDelta;const{visualElement:u}=s.options;u&&u.props.style&&u.props.style.display==="contents"||(n&&s.options.layoutScroll&&s.scroll&&s!==s.root&&Hc(i,{x:-s.scroll.offset.x,y:-s.scroll.offset.y}),a&&(e.x*=a.x.scale,e.y*=a.y.scale,bU(i,a)),n&&eu(s.latestValues)&&Hc(i,s.latestValues))}e.x<SC&&e.x>bC&&(e.x=1),e.y<SC&&e.y>bC&&(e.y=1)}function Gc(i,e){i.min=i.min+e,i.max=i.max+e}function TC(i,e,t,n,r=.5){const s=Vn(i.min,i.max,r);BS(i,e,t,s,n)}function Hc(i,e){TC(i.x,e.x,e.scaleX,e.scale,e.originX),TC(i.y,e.y,e.scaleY,e.scale,e.originY)}function SU(i,e){return yU(oH(i.getBoundingClientRect(),e))}function mH(i,e,t){const n=SU(i,t),{scroll:r}=e;return r&&(Gc(n.x,r.offset.x),Gc(n.y,r.offset.y)),n}const TU=({current:i})=>i?i.ownerDocument.defaultView:null,MC=(i,e)=>Math.abs(i-e);function gH(i,e){const t=MC(i.x,e.x),n=MC(i.y,e.y);return Math.sqrt(t**2+n**2)}class MU{constructor(e,t,{transformPagePoint:n,contextWindow:r,dragSnapToOrigin:s=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const p=yx(this.lastMoveEventInfo,this.history),g=this.startEvent!==null,y=gH(p.offset,{x:0,y:0})>=3;if(!g&&!y)return;const{point:v}=p,{timestamp:S}=Gi;this.history.push({...v,timestamp:S});const{onStart:b,onMove:_}=this.handlers;g||(b&&b(this.lastMoveEvent,p),this.startEvent=this.lastMoveEvent),_&&_(this.lastMoveEvent,p)},this.handlePointerMove=(p,g)=>{this.lastMoveEvent=p,this.lastMoveEventInfo=gx(g,this.transformPagePoint),Hn.update(this.updatePoint,!0)},this.handlePointerUp=(p,g)=>{this.end();const{onEnd:y,onSessionEnd:v,resumeAnimation:S}=this.handlers;if(this.dragSnapToOrigin&&S&&S(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const b=yx(p.type==="pointercancel"?this.lastMoveEventInfo:gx(g,this.transformPagePoint),this.history);this.startEvent&&y&&y(p,b),v&&v(p,b)},!lM(e))return;this.dragSnapToOrigin=s,this.handlers=t,this.transformPagePoint=n,this.contextWindow=r||window;const a=kp(e),l=gx(a,this.transformPagePoint),{point:u}=l,{timestamp:h}=Gi;this.history=[{...u,timestamp:h}];const{onSessionStart:d}=t;d&&d(e,yx(l,this.history)),this.removeListeners=Bp(Fd(this.contextWindow,"pointermove",this.handlePointerMove),Fd(this.contextWindow,"pointerup",this.handlePointerUp),Fd(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),ul(this.updatePoint)}}function gx(i,e){return e?{point:e(i.point)}:i}function EC(i,e){return{x:i.x-e.x,y:i.y-e.y}}function yx({point:i},e){return{point:i,delta:EC(i,EU(e)),offset:EC(i,yH(e)),velocity:vH(e,.1)}}function yH(i){return i[0]}function EU(i){return i[i.length-1]}function vH(i,e){if(i.length<2)return{x:0,y:0};let t=i.length-1,n=null;const r=EU(i);for(;t>=0&&(n=i[t],!(r.timestamp-n.timestamp>oa(e)));)t--;if(!n)return{x:0,y:0};const s=la(r.timestamp-n.timestamp);if(s===0)return{x:0,y:0};const a={x:(r.x-n.x)/s,y:(r.y-n.y)/s};return a.x===1/0&&(a.x=0),a.y===1/0&&(a.y=0),a}function _H(i,{min:e,max:t},n){return e!==void 0&&i<e?i=n?Vn(e,i,n.min):Math.max(i,e):t!==void 0&&i>t&&(i=n?Vn(t,i,n.max):Math.min(i,t)),i}function AC(i,e,t){return{min:e!==void 0?i.min+e:void 0,max:t!==void 0?i.max+t-(i.max-i.min):void 0}}function xH(i,{top:e,left:t,bottom:n,right:r}){return{x:AC(i.x,t,r),y:AC(i.y,e,n)}}function wC(i,e){let t=e.min-i.min,n=e.max-i.max;return e.max-e.min<i.max-i.min&&([t,n]=[n,t]),{min:t,max:n}}function bH(i,e){return{x:wC(i.x,e.x),y:wC(i.y,e.y)}}function SH(i,e){let t=.5;const n=yr(i),r=yr(e);return r>n?t=Jd(e.min,e.max-n,i.min):n>r&&(t=Jd(i.min,i.max-r,e.min)),uo(0,1,t)}function TH(i,e){const t={};return e.min!==void 0&&(t.min=e.min-i.min),e.max!==void 0&&(t.max=e.max-i.min),t}const IS=.35;function MH(i=IS){return i===!1?i=0:i===!0&&(i=IS),{x:RC(i,"left","right"),y:RC(i,"top","bottom")}}function RC(i,e,t){return{min:CC(i,e),max:CC(i,t)}}function CC(i,e){return typeof i=="number"?i:i[e]||0}const EH=new WeakMap;class AH{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Qn(),this.visualElement=e}start(e,{snapToCursor:t=!1}={}){const{presenceContext:n}=this.visualElement;if(n&&n.isPresent===!1)return;const r=d=>{const{dragSnapToOrigin:p}=this.getProps();p?this.pauseAnimation():this.stopAnimation(),t&&this.snapToCursor(kp(d).point)},s=(d,p)=>{const{drag:g,dragPropagation:y,onDragStart:v}=this.getProps();if(g&&!y&&(this.openDragLock&&this.openDragLock(),this.openDragLock=kG(g),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),ms(b=>{let _=this.getAxisMotionValue(b).get()||0;if(ua.test(_)){const{projection:E}=this.visualElement;if(E&&E.layout){const M=E.layout.layoutBox[b];M&&(_=yr(M)*(parseFloat(_)/100))}}this.originPoint[b]=_}),v&&Hn.postRender(()=>v(d,p)),LS(this.visualElement,"transform");const{animationState:S}=this.visualElement;S&&S.setActive("whileDrag",!0)},a=(d,p)=>{const{dragPropagation:g,dragDirectionLock:y,onDirectionLock:v,onDrag:S}=this.getProps();if(!g&&!this.openDragLock)return;const{offset:b}=p;if(y&&this.currentDirection===null){this.currentDirection=wH(b),this.currentDirection!==null&&v&&v(this.currentDirection);return}this.updateAxis("x",p.point,b),this.updateAxis("y",p.point,b),this.visualElement.render(),S&&S(d,p)},l=(d,p)=>this.stop(d,p),u=()=>ms(d=>{var p;return this.getAnimationState(d)==="paused"&&((p=this.getAxisMotionValue(d).animation)==null?void 0:p.play())}),{dragSnapToOrigin:h}=this.getProps();this.panSession=new MU(e,{onSessionStart:r,onStart:s,onMove:a,onSessionEnd:l,resumeAnimation:u},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:h,contextWindow:TU(this.visualElement)})}stop(e,t){const n=this.isDragging;if(this.cancel(),!n)return;const{velocity:r}=t;this.startAnimation(r);const{onDragEnd:s}=this.getProps();s&&Hn.postRender(()=>s(e,t))}cancel(){this.isDragging=!1;const{projection:e,animationState:t}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:n}=this.getProps();!n&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),t&&t.setActive("whileDrag",!1)}updateAxis(e,t,n){const{drag:r}=this.getProps();if(!n||!mg(e,r,this.currentDirection))return;const s=this.getAxisMotionValue(e);let a=this.originPoint[e]+n[e];this.constraints&&this.constraints[e]&&(a=_H(a,this.constraints[e],this.elastic[e])),s.set(a)}resolveConstraints(){var s;const{dragConstraints:e,dragElastic:t}=this.getProps(),n=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(s=this.visualElement.projection)==null?void 0:s.layout,r=this.constraints;e&&zc(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):e&&n?this.constraints=xH(n.layoutBox,e):this.constraints=!1,this.elastic=MH(t),r!==this.constraints&&n&&this.constraints&&!this.hasMutatedConstraints&&ms(a=>{this.constraints!==!1&&this.getAxisMotionValue(a)&&(this.constraints[a]=TH(n.layoutBox[a],this.constraints[a]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:t}=this.getProps();if(!e||!zc(e))return!1;const n=e.current,{projection:r}=this.visualElement;if(!r||!r.layout)return!1;const s=mH(n,r.root,this.visualElement.getTransformPagePoint());let a=bH(r.layout.layoutBox,s);if(t){const l=t(aH(a));this.hasMutatedConstraints=!!l,l&&(a=yU(l))}return a}startAnimation(e){const{drag:t,dragMomentum:n,dragElastic:r,dragTransition:s,dragSnapToOrigin:a,onDragTransitionEnd:l}=this.getProps(),u=this.constraints||{},h=ms(d=>{if(!mg(d,t,this.currentDirection))return;let p=u&&u[d]||{};a&&(p={min:0,max:0});const g=r?200:1e6,y=r?40:1e7,v={type:"inertia",velocity:n?e[d]:0,bounceStiffness:g,bounceDamping:y,timeConstant:750,restDelta:1,restSpeed:10,...s,...p};return this.startAxisValueAnimation(d,v)});return Promise.all(h).then(l)}startAxisValueAnimation(e,t){const n=this.getAxisMotionValue(e);return LS(this.visualElement,e),n.start(vM(e,n,0,t,this.visualElement,!1))}stopAnimation(){ms(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){ms(e=>{var t;return(t=this.getAxisMotionValue(e).animation)==null?void 0:t.pause()})}getAnimationState(e){var t;return(t=this.getAxisMotionValue(e).animation)==null?void 0:t.state}getAxisMotionValue(e){const t=`_drag${e.toUpperCase()}`,n=this.visualElement.getProps(),r=n[t];return r||this.visualElement.getValue(e,(n.initial?n.initial[e]:void 0)||0)}snapToCursor(e){ms(t=>{const{drag:n}=this.getProps();if(!mg(t,n,this.currentDirection))return;const{projection:r}=this.visualElement,s=this.getAxisMotionValue(t);if(r&&r.layout){const{min:a,max:l}=r.layout.layoutBox[t];s.set(e[t]-Vn(a,l,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:t}=this.getProps(),{projection:n}=this.visualElement;if(!zc(t)||!n||!this.constraints)return;this.stopAnimation();const r={x:0,y:0};ms(a=>{const l=this.getAxisMotionValue(a);if(l&&this.constraints!==!1){const u=l.get();r[a]=SH({min:u,max:u},this.constraints[a])}});const{transformTemplate:s}=this.visualElement.getProps();this.visualElement.current.style.transform=s?s({},""):"none",n.root&&n.root.updateScroll(),n.updateLayout(),this.resolveConstraints(),ms(a=>{if(!mg(a,e,null))return;const l=this.getAxisMotionValue(a),{min:u,max:h}=this.constraints[a];l.set(Vn(u,h,r[a]))})}addListeners(){if(!this.visualElement.current)return;EH.set(this.visualElement,this);const e=this.visualElement.current,t=Fd(e,"pointerdown",u=>{const{drag:h,dragListener:d=!0}=this.getProps();h&&d&&this.start(u)}),n=()=>{const{dragConstraints:u}=this.getProps();zc(u)&&u.current&&(this.constraints=this.resolveRefConstraints())},{projection:r}=this.visualElement,s=r.addEventListener("measure",n);r&&!r.layout&&(r.root&&r.root.updateScroll(),r.updateLayout()),Hn.read(n);const a=sp(window,"resize",()=>this.scalePositionWithinConstraints()),l=r.addEventListener("didUpdate",({delta:u,hasLayoutChanged:h})=>{this.isDragging&&h&&(ms(d=>{const p=this.getAxisMotionValue(d);p&&(this.originPoint[d]+=u[d].translate,p.set(p.get()+u[d].translate))}),this.visualElement.render())});return()=>{a(),t(),s(),l&&l()}}getProps(){const e=this.visualElement.getProps(),{drag:t=!1,dragDirectionLock:n=!1,dragPropagation:r=!1,dragConstraints:s=!1,dragElastic:a=IS,dragMomentum:l=!0}=e;return{...e,drag:t,dragDirectionLock:n,dragPropagation:r,dragConstraints:s,dragElastic:a,dragMomentum:l}}}function mg(i,e,t){return(e===!0||e===i)&&(t===null||t===i)}function wH(i,e=10){let t=null;return Math.abs(i.y)>e?t="y":Math.abs(i.x)>e&&(t="x"),t}class RH extends yl{constructor(e){super(e),this.removeGroupControls=xs,this.removeListeners=xs,this.controls=new AH(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||xs}unmount(){this.removeGroupControls(),this.removeListeners()}}const NC=i=>(e,t)=>{i&&Hn.postRender(()=>i(e,t))};class CH extends yl{constructor(){super(...arguments),this.removePointerDownListener=xs}onPointerDown(e){this.session=new MU(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:TU(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:t,onPan:n,onPanEnd:r}=this.node.getProps();return{onSessionStart:NC(e),onStart:NC(t),onMove:n,onEnd:(s,a)=>{delete this.session,r&&Hn.postRender(()=>r(s,a))}}}mount(){this.removePointerDownListener=Fd(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const My={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function PC(i,e){return e.max===e.min?0:i/(e.max-e.min)*100}const Xf={correct:(i,e)=>{if(!e.target)return i;if(typeof i=="string")if(Tt.test(i))i=parseFloat(i);else return i;const t=PC(i,e.target.x),n=PC(i,e.target.y);return`${t}% ${n}%`}},NH={correct:(i,{treeScale:e,projectionDelta:t})=>{const n=i,r=cl.parse(i);if(r.length>5)return n;const s=cl.createTransformer(i),a=typeof r[0]!="number"?1:0,l=t.x.scale*e.x,u=t.y.scale*e.y;r[0+a]/=l,r[1+a]/=u;const h=Vn(l,u,.5);return typeof r[2+a]=="number"&&(r[2+a]/=h),typeof r[3+a]=="number"&&(r[3+a]/=h),s(r)}};class PH extends fe.Component{componentDidMount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:n,layoutId:r}=this.props,{projection:s}=e;m4(DH),s&&(t.group&&t.group.add(s),n&&n.register&&r&&n.register(s),s.root.didUpdate(),s.addEventListener("animationComplete",()=>{this.safeToRemove()}),s.setOptions({...s.options,onExitComplete:()=>this.safeToRemove()})),My.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:t,visualElement:n,drag:r,isPresent:s}=this.props,{projection:a}=n;return a&&(a.isPresent=s,r||e.layoutDependency!==t||t===void 0||e.isPresent!==s?a.willUpdate():this.safeToRemove(),e.isPresent!==s&&(s?a.promote():a.relegate()||Hn.postRender(()=>{const l=a.getStack();(!l||!l.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),oM.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:n}=this.props,{projection:r}=e;r&&(r.scheduleCheckAfterUnmount(),t&&t.group&&t.group.remove(r),n&&n.deregister&&n.deregister(r))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function AU(i){const[e,t]=JL(),n=fe.useContext(FT);return _e.jsx(PH,{...i,layoutGroup:n,switchLayoutGroup:fe.useContext(rU),isPresent:e,safeToRemove:t})}const DH={borderRadius:{...Xf,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Xf,borderTopRightRadius:Xf,borderBottomLeftRadius:Xf,borderBottomRightRadius:Xf,boxShadow:NH};function LH(i,e,t){const n=nr(i)?i:ah(i);return n.start(vM("",n,e,t)),n.animation}const UH=(i,e)=>i.depth-e.depth;class OH{constructor(){this.children=[],this.isDirty=!1}add(e){VT(this.children,e),this.isDirty=!0}remove(e){GT(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(UH),this.isDirty=!1,this.children.forEach(e)}}function BH(i,e){const t=Cr.now(),n=({timestamp:r})=>{const s=r-t;s>=e&&(ul(n),i(s-e))};return Hn.setup(n,!0),()=>ul(n)}const wU=["TopLeft","TopRight","BottomLeft","BottomRight"],IH=wU.length,DC=i=>typeof i=="string"?parseFloat(i):i,LC=i=>typeof i=="number"||Tt.test(i);function FH(i,e,t,n,r,s){r?(i.opacity=Vn(0,t.opacity??1,kH(n)),i.opacityExit=Vn(e.opacity??1,0,zH(n))):s&&(i.opacity=Vn(e.opacity??1,t.opacity??1,n));for(let a=0;a<IH;a++){const l=`border${wU[a]}Radius`;let u=UC(e,l),h=UC(t,l);if(u===void 0&&h===void 0)continue;u||(u=0),h||(h=0),u===0||h===0||LC(u)===LC(h)?(i[l]=Math.max(Vn(DC(u),DC(h),n),0),(ua.test(h)||ua.test(u))&&(i[l]+="%")):i[l]=h}(e.rotate||t.rotate)&&(i.rotate=Vn(e.rotate||0,t.rotate||0,n))}function UC(i,e){return i[e]!==void 0?i[e]:i.borderRadius}const kH=RU(0,.5,_L),zH=RU(.5,.95,xs);function RU(i,e,t){return n=>n<i?0:n>e?1:t(Jd(i,e,n))}function OC(i,e){i.min=e.min,i.max=e.max}function ds(i,e){OC(i.x,e.x),OC(i.y,e.y)}function BC(i,e){i.translate=e.translate,i.scale=e.scale,i.originPoint=e.originPoint,i.origin=e.origin}function IC(i,e,t,n,r){return i-=e,i=Gy(i,1/t,n),r!==void 0&&(i=Gy(i,1/r,n)),i}function VH(i,e=0,t=1,n=.5,r,s=i,a=i){if(ua.test(e)&&(e=parseFloat(e),e=Vn(a.min,a.max,e/100)-a.min),typeof e!="number")return;let l=Vn(s.min,s.max,n);i===s&&(l-=e),i.min=IC(i.min,e,t,l,r),i.max=IC(i.max,e,t,l,r)}function FC(i,e,[t,n,r],s,a){VH(i,e[t],e[n],e[r],e.scale,s,a)}const GH=["x","scaleX","originX"],HH=["y","scaleY","originY"];function kC(i,e,t,n){FC(i.x,e,GH,t?t.x:void 0,n?n.x:void 0),FC(i.y,e,HH,t?t.y:void 0,n?n.y:void 0)}function zC(i){return i.translate===0&&i.scale===1}function CU(i){return zC(i.x)&&zC(i.y)}function VC(i,e){return i.min===e.min&&i.max===e.max}function WH(i,e){return VC(i.x,e.x)&&VC(i.y,e.y)}function GC(i,e){return Math.round(i.min)===Math.round(e.min)&&Math.round(i.max)===Math.round(e.max)}function NU(i,e){return GC(i.x,e.x)&&GC(i.y,e.y)}function HC(i){return yr(i.x)/yr(i.y)}function WC(i,e){return i.translate===e.translate&&i.scale===e.scale&&i.originPoint===e.originPoint}class jH{constructor(){this.members=[]}add(e){VT(this.members,e),e.scheduleRender()}remove(e){if(GT(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const t=this.members[this.members.length-1];t&&this.promote(t)}}relegate(e){const t=this.members.findIndex(r=>e===r);if(t===0)return!1;let n;for(let r=t;r>=0;r--){const s=this.members[r];if(s.isPresent!==!1){n=s;break}}return n?(this.promote(n),!0):!1}promote(e,t){const n=this.lead;if(e!==n&&(this.prevLead=n,this.lead=e,e.show(),n)){n.instance&&n.scheduleRender(),e.scheduleRender(),e.resumeFrom=n,t&&(e.resumeFrom.preserveOpacity=!0),n.snapshot&&(e.snapshot=n.snapshot,e.snapshot.latestValues=n.animationValues||n.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:r}=e.options;r===!1&&n.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:t,resumingFrom:n}=e;t.onExitComplete&&t.onExitComplete(),n&&n.options.onExitComplete&&n.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function qH(i,e,t){let n="";const r=i.x.translate/e.x,s=i.y.translate/e.y,a=(t==null?void 0:t.z)||0;if((r||s||a)&&(n=`translate3d(${r}px, ${s}px, ${a}px) `),(e.x!==1||e.y!==1)&&(n+=`scale(${1/e.x}, ${1/e.y}) `),t){const{transformPerspective:h,rotate:d,rotateX:p,rotateY:g,skewX:y,skewY:v}=t;h&&(n=`perspective(${h}px) ${n}`),d&&(n+=`rotate(${d}deg) `),p&&(n+=`rotateX(${p}deg) `),g&&(n+=`rotateY(${g}deg) `),y&&(n+=`skewX(${y}deg) `),v&&(n+=`skewY(${v}deg) `)}const l=i.x.scale*e.x,u=i.y.scale*e.y;return(l!==1||u!==1)&&(n+=`scale(${l}, ${u})`),n||"none"}const vx=["","X","Y","Z"],$H={visibility:"hidden"},XH=1e3;let YH=0;function _x(i,e,t,n){const{latestValues:r}=e;r[i]&&(t[i]=r[i],e.setStaticValue(i,0),n&&(n[i]=0))}function PU(i){if(i.hasCheckedOptimisedAppear=!0,i.root===i)return;const{visualElement:e}=i.options;if(!e)return;const t=dU(e);if(window.MotionHasOptimisedAnimation(t,"transform")){const{layout:r,layoutId:s}=i.options;window.MotionCancelOptimisedAnimation(t,"transform",Hn,!(r||s))}const{parent:n}=i;n&&!n.hasCheckedOptimisedAppear&&PU(n)}function DU({attachResizeListener:i,defaultParent:e,measureScroll:t,checkIsScrollRoot:n,resetTransform:r}){return class{constructor(a={},l=e==null?void 0:e()){this.id=YH++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(QH),this.nodes.forEach(i5),this.nodes.forEach(r5),this.nodes.forEach(JH)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=a,this.root=l?l.root||l:this,this.path=l?[...l.path,l]:[],this.parent=l,this.depth=l?l.depth+1:0;for(let u=0;u<this.path.length;u++)this.path[u].shouldResetTransform=!0;this.root===this&&(this.nodes=new OH)}addEventListener(a,l){return this.eventHandlers.has(a)||this.eventHandlers.set(a,new jT),this.eventHandlers.get(a).add(l)}notifyListeners(a,...l){const u=this.eventHandlers.get(a);u&&u.notify(...l)}hasListeners(a){return this.eventHandlers.has(a)}mount(a){if(this.instance)return;this.isSVG=QL(a)&&!jG(a),this.instance=a;const{layoutId:l,layout:u,visualElement:h}=this.options;if(h&&!h.current&&h.mount(a),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(u||l)&&(this.isLayoutDirty=!0),i){let d;const p=()=>this.root.updateBlockedByResize=!1;i(a,()=>{this.root.updateBlockedByResize=!0,d&&d(),d=BH(p,250),My.hasAnimatedSinceResize&&(My.hasAnimatedSinceResize=!1,this.nodes.forEach(qC))})}l&&this.root.registerSharedNode(l,this),this.options.animate!==!1&&h&&(l||u)&&this.addEventListener("didUpdate",({delta:d,hasLayoutChanged:p,hasRelativeLayoutChanged:g,layout:y})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const v=this.options.transition||h.getDefaultTransition()||u5,{onLayoutAnimationStart:S,onLayoutAnimationComplete:b}=h.getProps(),_=!this.targetLayout||!NU(this.targetLayout,y),E=!p&&g;if(this.options.layoutRoot||this.resumeFrom||E||p&&(_||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const M={...sM(v,"layout"),onPlay:S,onComplete:b};(h.shouldReduceMotion||this.options.layoutRoot)&&(M.delay=0,M.type=!1),this.startAnimation(M),this.setAnimationOrigin(d,E)}else p||qC(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=y})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const a=this.getStack();a&&a.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),ul(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(s5),this.animationId++)}getTransformTemplate(){const{visualElement:a}=this.options;return a&&a.getProps().transformTemplate}willUpdate(a=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&PU(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let d=0;d<this.path.length;d++){const p=this.path[d];p.shouldResetTransform=!0,p.updateScroll("snapshot"),p.options.layoutRoot&&p.willUpdate(!1)}const{layoutId:l,layout:u}=this.options;if(l===void 0&&!u)return;const h=this.getTransformTemplate();this.prevTransformTemplateValue=h?h(this.latestValues,""):void 0,this.updateSnapshot(),a&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(jC);return}this.isUpdating||this.nodes.forEach(t5),this.isUpdating=!1,this.nodes.forEach(n5),this.nodes.forEach(KH),this.nodes.forEach(ZH),this.clearAllSnapshots();const l=Cr.now();Gi.delta=uo(0,1e3/60,l-Gi.timestamp),Gi.timestamp=l,Gi.isProcessing=!0,ux.update.process(Gi),ux.preRender.process(Gi),ux.render.process(Gi),Gi.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,oM.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(e5),this.sharedNodes.forEach(a5)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Hn.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Hn.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!yr(this.snapshot.measuredBox.x)&&!yr(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let u=0;u<this.path.length;u++)this.path[u].updateScroll();const a=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Qn(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:l}=this.options;l&&l.notify("LayoutMeasure",this.layout.layoutBox,a?a.layoutBox:void 0)}updateScroll(a="measure"){let l=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===a&&(l=!1),l&&this.instance){const u=n(this.instance);this.scroll={animationId:this.root.animationId,phase:a,isRoot:u,offset:t(this.instance),wasRoot:this.scroll?this.scroll.isRoot:u}}}resetTransform(){if(!r)return;const a=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,l=this.projectionDelta&&!CU(this.projectionDelta),u=this.getTransformTemplate(),h=u?u(this.latestValues,""):void 0,d=h!==this.prevTransformTemplateValue;a&&this.instance&&(l||eu(this.latestValues)||d)&&(r(this.instance,h),this.shouldResetTransform=!1,this.scheduleRender())}measure(a=!0){const l=this.measurePageBox();let u=this.removeElementScroll(l);return a&&(u=this.removeTransform(u)),c5(u),{animationId:this.root.animationId,measuredBox:l,layoutBox:u,latestValues:{},source:this.id}}measurePageBox(){var h;const{visualElement:a}=this.options;if(!a)return Qn();const l=a.measureViewportBox();if(!(((h=this.scroll)==null?void 0:h.wasRoot)||this.path.some(h5))){const{scroll:d}=this.root;d&&(Gc(l.x,d.offset.x),Gc(l.y,d.offset.y))}return l}removeElementScroll(a){var u;const l=Qn();if(ds(l,a),(u=this.scroll)!=null&&u.wasRoot)return l;for(let h=0;h<this.path.length;h++){const d=this.path[h],{scroll:p,options:g}=d;d!==this.root&&p&&g.layoutScroll&&(p.wasRoot&&ds(l,a),Gc(l.x,p.offset.x),Gc(l.y,p.offset.y))}return l}applyTransform(a,l=!1){const u=Qn();ds(u,a);for(let h=0;h<this.path.length;h++){const d=this.path[h];!l&&d.options.layoutScroll&&d.scroll&&d!==d.root&&Hc(u,{x:-d.scroll.offset.x,y:-d.scroll.offset.y}),eu(d.latestValues)&&Hc(u,d.latestValues)}return eu(this.latestValues)&&Hc(u,this.latestValues),u}removeTransform(a){const l=Qn();ds(l,a);for(let u=0;u<this.path.length;u++){const h=this.path[u];if(!h.instance||!eu(h.latestValues))continue;OS(h.latestValues)&&h.updateSnapshot();const d=Qn(),p=h.measurePageBox();ds(d,p),kC(l,h.latestValues,h.snapshot?h.snapshot.layoutBox:void 0,d)}return eu(this.latestValues)&&kC(l,this.latestValues),l}setTargetDelta(a){this.targetDelta=a,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(a){this.options={...this.options,...a,crossfade:a.crossfade!==void 0?a.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Gi.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(a=!1){var g;const l=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=l.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=l.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=l.isSharedProjectionDirty);const u=!!this.resumingFrom||this!==l;if(!(a||u&&this.isSharedProjectionDirty||this.isProjectionDirty||(g=this.parent)!=null&&g.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:d,layoutId:p}=this.options;if(!(!this.layout||!(d||p))){if(this.resolvedRelativeTargetAt=Gi.timestamp,!this.targetDelta&&!this.relativeTarget){const y=this.getClosestProjectingParent();y&&y.layout&&this.animationProgress!==1?(this.relativeParent=y,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Qn(),this.relativeTargetOrigin=Qn(),zd(this.relativeTargetOrigin,this.layout.layoutBox,y.layout.layoutBox),ds(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=Qn(),this.targetWithTransforms=Qn()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),dH(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):ds(this.target,this.layout.layoutBox),bU(this.target,this.targetDelta)):ds(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget)){this.attemptToResolveRelativeTarget=!1;const y=this.getClosestProjectingParent();y&&!!y.resumingFrom==!!this.resumingFrom&&!y.options.layoutScroll&&y.target&&this.animationProgress!==1?(this.relativeParent=y,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Qn(),this.relativeTargetOrigin=Qn(),zd(this.relativeTargetOrigin,this.target,y.target),ds(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}}}getClosestProjectingParent(){if(!(!this.parent||OS(this.parent.latestValues)||xU(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var v;const a=this.getLead(),l=!!this.resumingFrom||this!==a;let u=!0;if((this.isProjectionDirty||(v=this.parent)!=null&&v.isProjectionDirty)&&(u=!1),l&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(u=!1),this.resolvedRelativeTargetAt===Gi.timestamp&&(u=!1),u)return;const{layout:h,layoutId:d}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(h||d))return;ds(this.layoutCorrected,this.layout.layoutBox);const p=this.treeScale.x,g=this.treeScale.y;pH(this.layoutCorrected,this.treeScale,this.path,l),a.layout&&!a.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(a.target=a.layout.layoutBox,a.targetWithTransforms=Qn());const{target:y}=a;if(!y){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(BC(this.prevProjectionDelta.x,this.projectionDelta.x),BC(this.prevProjectionDelta.y,this.projectionDelta.y)),kd(this.projectionDelta,this.layoutCorrected,y,this.latestValues),(this.treeScale.x!==p||this.treeScale.y!==g||!WC(this.projectionDelta.x,this.prevProjectionDelta.x)||!WC(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",y))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(a=!0){var l;if((l=this.options.visualElement)==null||l.scheduleRender(),a){const u=this.getStack();u&&u.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Vc(),this.projectionDelta=Vc(),this.projectionDeltaWithTransform=Vc()}setAnimationOrigin(a,l=!1){const u=this.snapshot,h=u?u.latestValues:{},d={...this.latestValues},p=Vc();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!l;const g=Qn(),y=u?u.source:void 0,v=this.layout?this.layout.source:void 0,S=y!==v,b=this.getStack(),_=!b||b.members.length<=1,E=!!(S&&!_&&this.options.crossfade===!0&&!this.path.some(l5));this.animationProgress=0;let M;this.mixTargetDelta=A=>{const w=A/1e3;$C(p.x,a.x,w),$C(p.y,a.y,w),this.setTargetDelta(p),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(zd(g,this.layout.layoutBox,this.relativeParent.layout.layoutBox),o5(this.relativeTarget,this.relativeTargetOrigin,g,w),M&&WH(this.relativeTarget,M)&&(this.isProjectionDirty=!1),M||(M=Qn()),ds(M,this.relativeTarget)),S&&(this.animationValues=d,FH(d,h,this.latestValues,w,E,_)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=w},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(a){var l,u,h;this.notifyListeners("animationStart"),(l=this.currentAnimation)==null||l.stop(),(h=(u=this.resumingFrom)==null?void 0:u.currentAnimation)==null||h.stop(),this.pendingAnimation&&(ul(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Hn.update(()=>{My.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=ah(0)),this.currentAnimation=LH(this.motionValue,[0,1e3],{...a,velocity:0,isSync:!0,onUpdate:d=>{this.mixTargetDelta(d),a.onUpdate&&a.onUpdate(d)},onStop:()=>{},onComplete:()=>{a.onComplete&&a.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const a=this.getStack();a&&a.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(XH),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const a=this.getLead();let{targetWithTransforms:l,target:u,layout:h,latestValues:d}=a;if(!(!l||!u||!h)){if(this!==a&&this.layout&&h&&LU(this.options.animationType,this.layout.layoutBox,h.layoutBox)){u=this.target||Qn();const p=yr(this.layout.layoutBox.x);u.x.min=a.target.x.min,u.x.max=u.x.min+p;const g=yr(this.layout.layoutBox.y);u.y.min=a.target.y.min,u.y.max=u.y.min+g}ds(l,u),Hc(l,d),kd(this.projectionDeltaWithTransform,this.layoutCorrected,l,d)}}registerSharedNode(a,l){this.sharedNodes.has(a)||this.sharedNodes.set(a,new jH),this.sharedNodes.get(a).add(l);const h=l.options.initialPromotionConfig;l.promote({transition:h?h.transition:void 0,preserveFollowOpacity:h&&h.shouldPreserveFollowOpacity?h.shouldPreserveFollowOpacity(l):void 0})}isLead(){const a=this.getStack();return a?a.lead===this:!0}getLead(){var l;const{layoutId:a}=this.options;return a?((l=this.getStack())==null?void 0:l.lead)||this:this}getPrevLead(){var l;const{layoutId:a}=this.options;return a?(l=this.getStack())==null?void 0:l.prevLead:void 0}getStack(){const{layoutId:a}=this.options;if(a)return this.root.sharedNodes.get(a)}promote({needsReset:a,transition:l,preserveFollowOpacity:u}={}){const h=this.getStack();h&&h.promote(this,u),a&&(this.projectionDelta=void 0,this.needsReset=!0),l&&this.setOptions({transition:l})}relegate(){const a=this.getStack();return a?a.relegate(this):!1}resetSkewAndRotation(){const{visualElement:a}=this.options;if(!a)return;let l=!1;const{latestValues:u}=a;if((u.z||u.rotate||u.rotateX||u.rotateY||u.rotateZ||u.skewX||u.skewY)&&(l=!0),!l)return;const h={};u.z&&_x("z",a,h,this.animationValues);for(let d=0;d<vx.length;d++)_x(`rotate${vx[d]}`,a,h,this.animationValues),_x(`skew${vx[d]}`,a,h,this.animationValues);a.render();for(const d in h)a.setStaticValue(d,h[d]),this.animationValues&&(this.animationValues[d]=h[d]);a.scheduleRender()}getProjectionStyles(a){if(!this.instance||this.isSVG)return;if(!this.isVisible)return $H;const l={visibility:""},u=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,l.opacity="",l.pointerEvents=Ty(a==null?void 0:a.pointerEvents)||"",l.transform=u?u(this.latestValues,""):"none",l;const h=this.getLead();if(!this.projectionDelta||!this.layout||!h.target){const y={};return this.options.layoutId&&(y.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,y.pointerEvents=Ty(a==null?void 0:a.pointerEvents)||""),this.hasProjected&&!eu(this.latestValues)&&(y.transform=u?u({},""):"none",this.hasProjected=!1),y}const d=h.animationValues||h.latestValues;this.applyTransformsToTarget(),l.transform=qH(this.projectionDeltaWithTransform,this.treeScale,d),u&&(l.transform=u(d,l.transform));const{x:p,y:g}=this.projectionDelta;l.transformOrigin=`${p.origin*100}% ${g.origin*100}% 0`,h.animationValues?l.opacity=h===this?d.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:d.opacityExit:l.opacity=h===this?d.opacity!==void 0?d.opacity:"":d.opacityExit!==void 0?d.opacityExit:0;for(const y in ip){if(d[y]===void 0)continue;const{correct:v,applyTo:S,isCSSVariable:b}=ip[y],_=l.transform==="none"?d[y]:v(d[y],h);if(S){const E=S.length;for(let M=0;M<E;M++)l[S[M]]=_}else b?this.options.visualElement.renderState.vars[y]=_:l[y]=_}return this.options.layoutId&&(l.pointerEvents=h===this?Ty(a==null?void 0:a.pointerEvents)||"":"none"),l}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(a=>{var l;return(l=a.currentAnimation)==null?void 0:l.stop()}),this.root.nodes.forEach(jC),this.root.sharedNodes.clear()}}}function KH(i){i.updateLayout()}function ZH(i){var t;const e=((t=i.resumeFrom)==null?void 0:t.snapshot)||i.snapshot;if(i.isLead()&&i.layout&&e&&i.hasListeners("didUpdate")){const{layoutBox:n,measuredBox:r}=i.layout,{animationType:s}=i.options,a=e.source!==i.layout.source;s==="size"?ms(p=>{const g=a?e.measuredBox[p]:e.layoutBox[p],y=yr(g);g.min=n[p].min,g.max=g.min+y}):LU(s,e.layoutBox,n)&&ms(p=>{const g=a?e.measuredBox[p]:e.layoutBox[p],y=yr(n[p]);g.max=g.min+y,i.relativeTarget&&!i.currentAnimation&&(i.isProjectionDirty=!0,i.relativeTarget[p].max=i.relativeTarget[p].min+y)});const l=Vc();kd(l,n,e.layoutBox);const u=Vc();a?kd(u,i.applyTransform(r,!0),e.measuredBox):kd(u,n,e.layoutBox);const h=!CU(l);let d=!1;if(!i.resumeFrom){const p=i.getClosestProjectingParent();if(p&&!p.resumeFrom){const{snapshot:g,layout:y}=p;if(g&&y){const v=Qn();zd(v,e.layoutBox,g.layoutBox);const S=Qn();zd(S,n,y.layoutBox),NU(v,S)||(d=!0),p.options.layoutRoot&&(i.relativeTarget=S,i.relativeTargetOrigin=v,i.relativeParent=p)}}}i.notifyListeners("didUpdate",{layout:n,snapshot:e,delta:u,layoutDelta:l,hasLayoutChanged:h,hasRelativeLayoutChanged:d})}else if(i.isLead()){const{onExitComplete:n}=i.options;n&&n()}i.options.transition=void 0}function QH(i){i.parent&&(i.isProjecting()||(i.isProjectionDirty=i.parent.isProjectionDirty),i.isSharedProjectionDirty||(i.isSharedProjectionDirty=!!(i.isProjectionDirty||i.parent.isProjectionDirty||i.parent.isSharedProjectionDirty)),i.isTransformDirty||(i.isTransformDirty=i.parent.isTransformDirty))}function JH(i){i.isProjectionDirty=i.isSharedProjectionDirty=i.isTransformDirty=!1}function e5(i){i.clearSnapshot()}function jC(i){i.clearMeasurements()}function t5(i){i.isLayoutDirty=!1}function n5(i){const{visualElement:e}=i.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),i.resetTransform()}function qC(i){i.finishAnimation(),i.targetDelta=i.relativeTarget=i.target=void 0,i.isProjectionDirty=!0}function i5(i){i.resolveTargetDelta()}function r5(i){i.calcProjection()}function s5(i){i.resetSkewAndRotation()}function a5(i){i.removeLeadSnapshot()}function $C(i,e,t){i.translate=Vn(e.translate,0,t),i.scale=Vn(e.scale,1,t),i.origin=e.origin,i.originPoint=e.originPoint}function XC(i,e,t,n){i.min=Vn(e.min,t.min,n),i.max=Vn(e.max,t.max,n)}function o5(i,e,t,n){XC(i.x,e.x,t.x,n),XC(i.y,e.y,t.y,n)}function l5(i){return i.animationValues&&i.animationValues.opacityExit!==void 0}const u5={duration:.45,ease:[.4,0,.1,1]},YC=i=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(i),KC=YC("applewebkit/")&&!YC("chrome/")?Math.round:xs;function ZC(i){i.min=KC(i.min),i.max=KC(i.max)}function c5(i){ZC(i.x),ZC(i.y)}function LU(i,e,t){return i==="position"||i==="preserve-aspect"&&!fH(HC(e),HC(t),.2)}function h5(i){var e;return i!==i.root&&((e=i.scroll)==null?void 0:e.wasRoot)}const f5=DU({attachResizeListener:(i,e)=>sp(i,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),xx={current:void 0},UU=DU({measureScroll:i=>({x:i.scrollLeft,y:i.scrollTop}),defaultParent:()=>{if(!xx.current){const i=new f5({});i.mount(window),i.setOptions({layoutScroll:!0}),xx.current=i}return xx.current},resetTransform:(i,e)=>{i.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:i=>window.getComputedStyle(i).position==="fixed"}),d5={pan:{Feature:CH},drag:{Feature:RH,ProjectionNode:UU,MeasureLayout:AU}};function QC(i,e,t){const{props:n}=i;i.animationState&&n.whileHover&&i.animationState.setActive("whileHover",t==="Start");const r="onHover"+t,s=n[r];s&&Hn.postRender(()=>s(e,kp(e)))}class p5 extends yl{mount(){const{current:e}=this.node;e&&(this.unmount=zG(e,(t,n)=>(QC(this.node,n,"Start"),r=>QC(this.node,r,"End"))))}unmount(){}}class m5 extends yl{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Bp(sp(this.node.current,"focus",()=>this.onFocus()),sp(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function JC(i,e,t){const{props:n}=i;if(i.current instanceof HTMLButtonElement&&i.current.disabled)return;i.animationState&&n.whileTap&&i.animationState.setActive("whileTap",t==="Start");const r="onTap"+(t==="End"?"":t),s=n[r];s&&Hn.postRender(()=>s(e,kp(e)))}class g5 extends yl{mount(){const{current:e}=this.node;e&&(this.unmount=WG(e,(t,n)=>(JC(this.node,n,"Start"),(r,{success:s})=>JC(this.node,r,s?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const FS=new WeakMap,bx=new WeakMap,y5=i=>{const e=FS.get(i.target);e&&e(i)},v5=i=>{i.forEach(y5)};function _5({root:i,...e}){const t=i||document;bx.has(t)||bx.set(t,{});const n=bx.get(t),r=JSON.stringify(e);return n[r]||(n[r]=new IntersectionObserver(v5,{root:i,...e})),n[r]}function x5(i,e,t){const n=_5(e);return FS.set(i,t),n.observe(i),()=>{FS.delete(i),n.unobserve(i)}}const b5={some:0,all:1};class S5 extends yl{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:t,margin:n,amount:r="some",once:s}=e,a={root:t?t.current:void 0,rootMargin:n,threshold:typeof r=="number"?r:b5[r]},l=u=>{const{isIntersecting:h}=u;if(this.isInView===h||(this.isInView=h,s&&!h&&this.hasEnteredView))return;h&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",h);const{onViewportEnter:d,onViewportLeave:p}=this.node.getProps(),g=h?d:p;g&&g(u)};return x5(this.node.current,a,l)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:t}=this.node;["amount","margin","root"].some(T5(e,t))&&this.startObserver()}unmount(){}}function T5({viewport:i={}},{viewport:e={}}={}){return t=>i[t]!==e[t]}const M5={inView:{Feature:S5},tap:{Feature:g5},focus:{Feature:m5},hover:{Feature:p5}},E5={layout:{ProjectionNode:UU,MeasureLayout:AU}},kS={current:null},OU={current:!1};function A5(){if(OU.current=!0,!!zT)if(window.matchMedia){const i=window.matchMedia("(prefers-reduced-motion)"),e=()=>kS.current=i.matches;i.addListener(e),e()}else kS.current=!1}const w5=new WeakMap;function R5(i,e,t){for(const n in e){const r=e[n],s=t[n];if(nr(r))i.addValue(n,r);else if(nr(s))i.addValue(n,ah(r,{owner:i}));else if(s!==r)if(i.hasValue(n)){const a=i.getValue(n);a.liveStyle===!0?a.jump(r):a.hasAnimated||a.set(r)}else{const a=i.getStaticValue(n);i.addValue(n,ah(a!==void 0?a:r,{owner:i}))}}for(const n in t)e[n]===void 0&&i.removeValue(n);return e}const eN=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class C5{scrapeMotionValuesFromProps(e,t,n){return{}}constructor({parent:e,props:t,presenceContext:n,reducedMotionConfig:r,blockInitialAnimation:s,visualState:a},l={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=iM,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const g=Cr.now();this.renderScheduledAt<g&&(this.renderScheduledAt=g,Hn.render(this.render,!1,!0))};const{latestValues:u,renderState:h}=a;this.latestValues=u,this.baseTarget={...u},this.initialValues=t.initial?{...u}:{},this.renderState=h,this.parent=e,this.props=t,this.presenceContext=n,this.depth=e?e.depth+1:0,this.reducedMotionConfig=r,this.options=l,this.blockInitialAnimation=!!s,this.isControllingVariants=vv(t),this.isVariantNode=nU(t),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:d,...p}=this.scrapeMotionValuesFromProps(t,{},this);for(const g in p){const y=p[g];u[g]!==void 0&&nr(y)&&y.set(u[g],!1)}}mount(e){this.current=e,w5.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((t,n)=>this.bindToMotionValue(n,t)),OU.current||A5(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:kS.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),ul(this.notifyUpdate),ul(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const t=this.features[e];t&&(t.unmount(),t.isMounted=!1)}this.current=null}bindToMotionValue(e,t){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const n=Gh.has(e);n&&this.onBindTransform&&this.onBindTransform();const r=t.on("change",l=>{this.latestValues[e]=l,this.props.onUpdate&&Hn.preRender(this.notifyUpdate),n&&this.projection&&(this.projection.isTransformDirty=!0)}),s=t.on("renderRequest",this.scheduleRender);let a;window.MotionCheckAppearSync&&(a=window.MotionCheckAppearSync(this,e,t)),this.valueSubscriptions.set(e,()=>{r(),s(),a&&a(),t.owner&&t.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in oh){const t=oh[e];if(!t)continue;const{isEnabled:n,Feature:r}=t;if(!this.features[e]&&r&&n(this.props)&&(this.features[e]=new r(this)),this.features[e]){const s=this.features[e];s.isMounted?s.update():(s.mount(),s.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Qn()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,t){this.latestValues[e]=t}update(e,t){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=t;for(let n=0;n<eN.length;n++){const r=eN[n];this.propEventSubscriptions[r]&&(this.propEventSubscriptions[r](),delete this.propEventSubscriptions[r]);const s="on"+r,a=e[s];a&&(this.propEventSubscriptions[r]=this.on(r,a))}this.prevMotionValues=R5(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const t=this.getClosestVariantNode();if(t)return t.variantChildren&&t.variantChildren.add(e),()=>t.variantChildren.delete(e)}addValue(e,t){const n=this.values.get(e);t!==n&&(n&&this.removeValue(e),this.bindToMotionValue(e,t),this.values.set(e,t),this.latestValues[e]=t.get())}removeValue(e){this.values.delete(e);const t=this.valueSubscriptions.get(e);t&&(t(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,t){if(this.props.values&&this.props.values[e])return this.props.values[e];let n=this.values.get(e);return n===void 0&&t!==void 0&&(n=ah(t===null?void 0:t,{owner:this}),this.addValue(e,n)),n}readValue(e,t){let n=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:this.getBaseTargetFromProps(this.props,e)??this.readValueFromInstance(this.current,e,this.options);return n!=null&&(typeof n=="string"&&(uL(n)||hL(n))?n=parseFloat(n):!$G(n)&&cl.test(t)&&(n=qL(e,t)),this.setBaseTarget(e,nr(n)?n.get():n)),nr(n)?n.get():n}setBaseTarget(e,t){this.baseTarget[e]=t}getBaseTarget(e){var s;const{initial:t}=this.props;let n;if(typeof t=="string"||typeof t=="object"){const a=gM(this.props,t,(s=this.presenceContext)==null?void 0:s.custom);a&&(n=a[e])}if(t&&n!==void 0)return n;const r=this.getBaseTargetFromProps(this.props,e);return r!==void 0&&!nr(r)?r:this.initialValues[e]!==void 0&&n===void 0?void 0:this.baseTarget[e]}on(e,t){return this.events[e]||(this.events[e]=new jT),this.events[e].add(t)}notify(e,...t){this.events[e]&&this.events[e].notify(...t)}}class BU extends C5{constructor(){super(...arguments),this.KeyframeResolver=BG}sortInstanceNodePosition(e,t){return e.compareDocumentPosition(t)&2?1:-1}getBaseTargetFromProps(e,t){return e.style?e.style[t]:void 0}removeValueFromRenderState(e,{vars:t,style:n}){delete t[e],delete n[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;nr(e)&&(this.childSubscription=e.on("change",t=>{this.current&&(this.current.textContent=`${t}`)}))}}function IU(i,{style:e,vars:t},n,r){Object.assign(i.style,e,r&&r.getProjectionStyles(n));for(const s in t)i.style.setProperty(s,t[s])}function N5(i){return window.getComputedStyle(i)}class P5 extends BU{constructor(){super(...arguments),this.type="html",this.renderInstance=IU}readValueFromInstance(e,t){var n;if(Gh.has(t))return(n=this.projection)!=null&&n.isProjecting?AS(t):tG(e,t);{const r=N5(e),s=(XT(t)?r.getPropertyValue(t):r[t])||0;return typeof s=="string"?s.trim():s}}measureInstanceViewportBox(e,{transformPagePoint:t}){return SU(e,t)}build(e,t,n){dM(e,t,n.transformTemplate)}scrapeMotionValuesFromProps(e,t,n){return yM(e,t,n)}}const FU=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function D5(i,e,t,n){IU(i,e,void 0,n);for(const r in e.attrs)i.setAttribute(FU.has(r)?r:fM(r),e.attrs[r])}class L5 extends BU{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Qn}getBaseTargetFromProps(e,t){return e[t]}readValueFromInstance(e,t){if(Gh.has(t)){const n=jL(t);return n&&n.default||0}return t=FU.has(t)?t:fM(t),e.getAttribute(t)}scrapeMotionValuesFromProps(e,t,n){return fU(e,t,n)}build(e,t,n){lU(e,t,this.isSVGTag,n.transformTemplate,n.style)}renderInstance(e,t,n,r){D5(e,t,n,r)}mount(e){this.isSVGTag=cU(e.tagName),super.mount(e)}}const U5=(i,e)=>mM(i)?new L5(e):new P5(e,{allowProjection:i!==fe.Fragment}),O5=D4({...rH,...M5,...d5,...E5},U5),fr=i4(O5),B5={some:0,all:1};function I5(i,e,{root:t,margin:n,amount:r="some"}={}){const s=$L(i),a=new WeakMap,l=h=>{h.forEach(d=>{const p=a.get(d.target);if(d.isIntersecting!==!!p)if(d.isIntersecting){const g=e(d.target,d);typeof g=="function"?a.set(d.target,g):u.unobserve(d.target)}else typeof p=="function"&&(p(d),a.delete(d.target))})},u=new IntersectionObserver(l,{root:t,rootMargin:n,threshold:typeof r=="number"?r:B5[r]});return s.forEach(h=>u.observe(h)),()=>u.disconnect()}function Yf(i,{root:e,margin:t,amount:n,once:r=!1,initial:s=!1}={}){const[a,l]=fe.useState(s);return fe.useEffect(()=>{if(!i.current||r&&a)return;const u=()=>(l(!0),r?void 0:()=>l(!1)),h={root:e&&e.current||void 0,margin:t,amount:n};return I5(i.current,u,h)},[e,i,t,r,n]),a}const zS={en:{explore:"Explore my mind",nodes:[{id:"Mind",group:0,description:"The central node"},{id:"MAC",group:1,description:"A research framework exploring post-postmodern phenomena and the shaping of post-human culture, society, and education through artistic practice, digital resistance, and ethical design."},{id:"Interfacial Thinking",group:1,description:"Treating interfaces as spaces of cultural negotiation — where meaning, structure, and identity are enacted."},{id:"Languages",group:1,description:"Where linguistic fluency and computational fluency meet: human languages, programming languages, and the patterns they shape in thought."},{id:"Experiments",group:1,description:"Prototypes, essays, and creative outputs."},{id:"Research",group:1,description:"My inquiries, frameworks, and what I question, test, or want to reimagine."},{id:"Poetic UX",group:2,description:"Interfaces that spark emotion, reflection, and calm — poetic not just in content, but in how they care, support, and resonate."},{id:"Multimodal",group:2,description:"Working across text, sound, visuals, interaction, and motion."},{id:"Cultural Code",group:2,description:"Code as memory, identity, and resistance shaped by who writes it, and for whom."},{id:"Synesthetic Design",group:2,description:"Translating between senses — from sound to color, language to motion, feeling to interface."},{id:"Ethical Aesthetics",group:2,description:"Design guided by care, consent, and context — where aesthetics carry responsibility."},{id:"Conversational Interfaces",group:3,description:"Designing systems for written and spoken interaction — accessible, emotional, human."},{id:"Language Models as Collaborators",group:3,description:"Working with AI as creative colleagues."},{id:"Embedded Interaction",group:3,description:"Interfaces embedded in bodies, lives, and routines."},{id:"Visual Narratives",group:3,description:"Stories told through structure, space, and motion — meaning made visual."},{id:"Voice UI",group:3,description:"Voice as input and output — accessible, affective, and immediate."},{id:"Text-to-Feeling Translation",group:3,description:"Systems that turn language into emotion, visuals, or sensation — bridging meaning and affect."},{id:"Hungarian",group:4,description:"Mother tongue - language of emotion, memory, and intimacy."},{id:"Italian",group:4,description:"Language of  aesthetic nuance and emotional expression."},{id:"English",group:4,description:"Language of research, connection, and global discourse."},{id:"HTML & CSS",group:4,description:"Structure and surface of the web."},{id:"JavaScript",group:4,description:"Logical, chaotic, poetic."},{id:"Vue & React",group:4,description:"My expressive frontend frameworks."},{id:"GlucoLogs",group:5,description:"A tool for diabetics — blending glucose tracking, reflection, and ethical data management."},{id:"Hymn of Resistance",group:5,description:"A multilingual, multisensory digital poem — music, movement, and protest as interface."},{id:"Vocabulary of Resistance",group:5,description:'A map exploring vocabulary connected to the word "resistance".'},{id:"Towards a Grammar of Resistance",group:5,description:"The theoretical foundation of MAC — an academic paper."},{id:"Learn to Resist",group:5,description:"A reflection on post-human education."},{id:"The First Cyborgs",group:5,description:"A poetic-critical essay on diabetes tech, exploitative devices, and cyberbodily autonomy."},{id:"Ada Lovelace",group:5,description:"A storytelling website and chatbot — about the birth of algorithms."},{id:"Wearable Paintings",group:6,description:"Hand-painted, upcycled clothing."},{id:"Patches & Ceramics",group:6,description:"Small crafted pieces —  stitched patches, hand-glazed clay."},{id:"Knits & Crochets",group:6,description:"Loops — warmth and handmade garments."},{id:"Collage & Drawing",group:6,description:"Analog storytelling — layering memory, media, and form."},{id:"Interactive Collage Book",group:6,description:'A physical book entitled "Holiday to the Moon."'},{id:"Scotty",group:6,description:"My four-legged sidekick — the one closest to my heart."},{id:"✶",group:99,decorative:!0},{id:"∞",group:99,decorative:!0},{id:"↺",group:99,decorative:!0},{id:"夢",group:99,decorative:!0},{id:"♡",group:99,decorative:!0},{id:"✶",group:99,decorative:!0},{id:"∞",group:99,decorative:!0},{id:"↺",group:99,decorative:!0},{id:"夢",group:99,decorative:!0},{id:"♡",group:99,decorative:!0},{id:"✶",group:99,decorative:!0},{id:"∞",group:99,decorative:!0},{id:"↺",group:99,decorative:!0},{id:"夢",group:99,decorative:!0},{id:"♡",group:99,decorative:!0},{id:"✶",group:99,decorative:!0},{id:"∞",group:99,decorative:!0},{id:"↺",group:99,decorative:!0},{id:"夢",group:99,decorative:!0},{id:"♡",group:99,decorative:!0}],links:[{source:"Mind",target:"MAC"},{source:"Mind",target:"Interfacial Thinking"},{source:"Mind",target:"Languages"},{source:"Mind",target:"Experiments"},{source:"Mind",target:"Research"},{source:"MAC",target:"Poetic UX"},{source:"MAC",target:"Ethical Aesthetics"},{source:"MAC",target:"Cultural Code"},{source:"MAC",target:"Text-to-Feeling Translation"},{source:"Interfacial Thinking",target:"Voice UI"},{source:"Interfacial Thinking",target:"Conversational Interfaces"},{source:"Interfacial Thinking",target:"Visual Narratives"},{source:"Languages",target:"Hungarian"},{source:"Languages",target:"Italian"},{source:"Languages",target:"English"},{source:"Languages",target:"HTML & CSS"},{source:"Languages",target:"JavaScript"},{source:"Languages",target:"Vue & React"},{source:"Experiments",target:"GlucoLogs"},{source:"Experiments",target:"Hymn of Resistance"},{source:"Experiments",target:"Ada Lovelace"},{source:"Research",target:"Towards a Grammar of Resistance"},{source:"Research",target:"Learn to Resist"},{source:"Research",target:"The First Cyborgs"},{source:"Research",target:"Vocabulary of Resistance"},{source:"Scotty",target:"Mind"},{source:"Poetic UX",target:"Synesthetic Design"},{source:"Multimodal",target:"Visual Narratives"}]},it:{explore:"Esplora la mia mente.",nodes:{Mind:{id:"Mente",description:"Il nodo centrale: un connettore vivente — codice, memoria, resistenza e cura."},MAC:{id:"MAC",description:"Un quadro di ricerca che esplora i fenomeni post-postmoderni e la formazione della cultura, società ed educazione post-umana — attraverso la pratica artistica, la resistenza digitale e il design etico."},"Interfacial Thinking":{id:"Pensiero Interfacciale",description:"Considerare le interfacce come spazi di negoziazione culturale — dove il significato, la struttura e l'identità non sono solo mostrati, ma messi in atto."},Languages:{id:"Linguaggi",description:"Dove la fluidità linguistica e quella computazionale si incontrano: lingue umane, linguaggi di programmazione e i modelli che formano nel pensiero."},Experiments:{id:"Esperimenti",description:"Prototipi, saggi e creazioni — momenti in cui la teoria incontra il codice e le idee prendono forma."},Research:{id:"Ricerca",description:"Le tue domande, strutture e provocazioni — ciò che metti in discussione, testi o desideri ripensare."},"Poetic UX":{id:"UX Poetica",description:"Interfacce che suscitano emozione, riflessione e calma — poetiche non solo nei contenuti, ma anche nel modo in cui si prendono cura, supportano e risuonano."},Multimodal:{id:"Multimodale",description:"Lavorare attraverso testo, suono, immagini, interazione e movimento — il significato nasce dall’intreccio, non dal singolo filo."},"Cultural Code":{id:"Codice Culturale",description:"Il codice come memoria, identità e resistenza — plasmato da chi lo scrive e per chi viene scritto."},"Synesthetic Design":{id:"Design Sinetesico",description:"Tradurre tra i sensi — dal suono al colore, dal linguaggio al movimento, dalla sensazione all’interfaccia."},"Ethical Aesthetics":{id:"Estetica Etica",description:"Design guidato da cura, consenso e contesto — dove l'estetica porta responsabilità."},"Conversational Interfaces":{id:"Interfacce Conversazionali",description:"Progettare sistemi per l’interazione scritta e parlata — accessibili, emozionali, umani."},"Language Models as Collaborators":{id:"Modelli Linguistici come Collaboratori",description:"Lavorare con l'IA come colleghi creativi — plasmare il linguaggio attraverso empatia e prompt."},"Embedded Interaction":{id:"Interazione Incorporata",description:"Interfacce incorporate nei corpi, nelle vite e nelle routine — ambientali, intuitive, urgenti."},"Visual Narratives":{id:"Narrazioni Visive",description:"Storie raccontate attraverso struttura, spazio e movimento — significato reso visibile."},"Voice UI":{id:"Interfaccia Vocale",description:"La voce come input e output — accessibile, affettiva e immediata."},"Text-to-Feeling Translation":{id:"Traduzione da Testo a Emozione",description:"Sistemi che trasformano il linguaggio in emozione, immagini o sensazioni — colmando il divario tra significato ed effetto."},Hungarian:{id:"Ungherese",description:"Lingua madre di emozione, memoria e intimità."},Italian:{id:"Italiano",description:"Lingua della maturità, della sfumatura estetica e dell’espressione emotiva."},English:{id:"Inglese",description:"Lingua della ricerca, della connessione e del discorso globale."},"HTML & CSS":{id:"HTML & CSS",description:"Struttura e superficie del web — minimale, espressiva, essenziale."},JavaScript:{id:"JavaScript",description:"Logico, caotico, poetico — la danza in evoluzione tra struttura e sorpresa."},"Vue & React":{id:"Vue & React",description:"I tuoi framework frontend espressivi — flessibili e reattivi, strutturati e vivi."},GlucoReflect:{id:"GlucoReflect",description:"Uno strumento per diabetici — che unisce monitoraggio glicemico, riflessione e supporto emotivo."},"Hymn of Resistance":{id:"Inno della Resistenza",description:"Un poema digitale multilingue e multisensoriale — musica, movimento e protesta come interfaccia."},"Vocabulary of Resistance":{id:"Vocabolario della Resistenza",description:"Una mappa che esplora come si scrive, si dice e si condivide la resistenza."},"Towards a Grammar of Resistance":{id:"Verso una Grammatica della Resistenza",description:"La base teorica di MAC — un saggio accademico."},"Learn to Resist":{id:"Imparare a Resistere",description:"Una riflessione sull’educazione post-umana."},"The First Cyborgs":{id:"I Primi Cyborg",description:"Un saggio poetico-critico sulla tecnologia per il diabete, dispositivi sfruttatori e autonomia cibernetica del corpo."},"Ada Lovelace":{id:"Ada Lovelace",description:"Un sito narrativo e chatbot — sulla nascita degli algoritmi."},"Wearable Paintings":{id:"Dipinti Indossabili",description:"Abiti dipinti a mano — luminosi, metallici e atti espressivi unici di resistenza vissuta."},"Patches & Ceramics":{id:"Toppe e Ceramiche",description:"Piccoli oggetti artigianali — da toppe cucite a ceramiche smaltate a mano."},"Knits & Crochets":{id:"Maglieria e Uncinetto",description:"Linguaggio intrecciato — calore e cura resi materia."},"Collage & Drawing":{id:"Collage e Disegno",description:"Narrazione analogica — stratificando memoria, media e forma."},"Interactive Collage Book":{id:"Libro Collage Interattivo",description:"Un ibrido fisico/digitale — interfaccia come memoria, esplorazione e movimento poetico."},Scotty:{id:"Scotty",description:"Il mio compagno a quattro zampe — quello più vicino al mio cuore."}}}},kU=()=>{const[i,e]=fe.useState("en");return{t:n=>zS[i][n]||n,lang:i,setLang:e}};function F5(i,e){var t=i==null?null:typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(t!=null){var n,r,s,a,l=[],u=!0,h=!1;try{if(s=(t=t.call(i)).next,e===0){if(Object(t)!==t)return;u=!1}else for(;!(u=(n=s.call(t)).done)&&(l.push(n.value),l.length!==e);u=!0);}catch(d){h=!0,r=d}finally{try{if(!u&&t.return!=null&&(a=t.return(),Object(a)!==a))return}finally{if(h)throw r}}return l}}function k5(i,e,t){return e=$5(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function tN(i,e){return G5(i)||F5(i,e)||zU(i,e)||j5()}function z5(i){return V5(i)||H5(i)||zU(i)||W5()}function V5(i){if(Array.isArray(i))return VS(i)}function G5(i){if(Array.isArray(i))return i}function H5(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function zU(i,e){if(i){if(typeof i=="string")return VS(i,e);var t=Object.prototype.toString.call(i).slice(8,-1);if(t==="Object"&&i.constructor&&(t=i.constructor.name),t==="Map"||t==="Set")return Array.from(i);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return VS(i,e)}}function VS(i,e){(e==null||e>i.length)&&(e=i.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=i[t];return n}function W5(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function j5(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function q5(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var n=t.call(i,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function $5(i){var e=q5(i,"string");return typeof e=="symbol"?e:String(e)}var X5=function(e,t){var n=new Set(t);return Object.assign.apply(Object,[{}].concat(z5(Object.entries(e).filter(function(r){var s=tN(r,1),a=s[0];return!n.has(a)}).map(function(r){var s=tN(r,2),a=s[0],l=s[1];return k5({},a,l)}))))};function GS(i,e){(e==null||e>i.length)&&(e=i.length);for(var t=0,n=Array(e);t<e;t++)n[t]=i[t];return n}function Y5(i){if(Array.isArray(i))return i}function K5(i){if(Array.isArray(i))return GS(i)}function Z5(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function Q5(i,e){var t=i==null?null:typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(t!=null){var n,r,s,a,l=[],u=!0,h=!1;try{if(s=(t=t.call(i)).next,e!==0)for(;!(u=(n=s.call(t)).done)&&(l.push(n.value),l.length!==e);u=!0);}catch(d){h=!0,r=d}finally{try{if(!u&&t.return!=null&&(a=t.return(),Object(a)!==a))return}finally{if(h)throw r}}return l}}function J5(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function e6(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function t6(i,e){return Y5(i)||Q5(i,e)||VU(i,e)||J5()}function nN(i){return K5(i)||Z5(i)||VU(i)||e6()}function VU(i,e){if(i){if(typeof i=="string")return GS(i,e);var t={}.toString.call(i).slice(8,-1);return t==="Object"&&i.constructor&&(t=i.constructor.name),t==="Map"||t==="Set"?Array.from(i):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?GS(i,e):void 0}}function n6(i){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=e.wrapperElementType,n=t===void 0?"div":t,r=e.nodeMapper,s=r===void 0?function(d){return d}:r,a=e.methodNames,l=a===void 0?[]:a,u=e.initPropNames,h=u===void 0?[]:u;return fe.forwardRef(function(d,p){var g=fe.useRef(),y=fe.useMemo(function(){var b=Object.fromEntries(h.filter(function(_){return d.hasOwnProperty(_)}).map(function(_){return[_,d[_]]}));return i(b)},[]);iN(function(){y(s(g.current))},fe.useLayoutEffect),iN(function(){return y._destructor instanceof Function?y._destructor:void 0});var v=fe.useCallback(function(b){for(var _=arguments.length,E=new Array(_>1?_-1:0),M=1;M<_;M++)E[M-1]=arguments[M];return y[b]instanceof Function?y[b].apply(y,E):void 0},[y]),S=fe.useRef({});return Object.keys(X5(d,[].concat(nN(l),nN(h)))).filter(function(b){return S.current[b]!==d[b]}).forEach(function(b){return v(b,d[b])}),S.current=d,fe.useImperativeHandle(p,function(){return Object.fromEntries(l.map(function(b){return[b,function(){for(var _=arguments.length,E=new Array(_),M=0;M<_;M++)E[M]=arguments[M];return v.apply(void 0,[b].concat(E))}]}))},[v]),UT.createElement(n,{ref:g})})}function iN(i){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:fe.useEffect,t=fe.useRef(),n=fe.useRef(!1),r=fe.useRef(!1),s=fe.useState(0),a=t6(s,2);a[0];var l=a[1];n.current&&(r.current=!0),e(function(){return n.current||(t.current=i(),n.current=!0),l(function(u){return u+1}),function(){r.current&&t.current&&t.current()}},[])}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Hh="177",Hi={ROTATE:0,DOLLY:1,PAN:2},Ja={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},GU=0,HS=1,HU=2,i6=0,_M=1,r6=2,Jr=3,Lr=0,An=1,dr=2,Ur=0,es=1,lh=2,uh=3,ch=4,Zc=5,er=100,xM=101,bM=102,WU=103,jU=104,qa=200,SM=201,TM=202,MM=203,ap=204,op=205,EM=206,AM=207,wM=208,RM=209,CM=210,s6=211,a6=212,o6=213,l6=214,lp=0,up=1,cp=2,hl=3,hp=4,fp=5,dp=6,pp=7,zp=0,qU=1,$U=2,Or=0,XU=1,YU=2,KU=3,ZU=4,u6=5,QU=6,JU=7,NM=300,ha=301,fa=302,hh=303,fh=304,Su=306,Tu=1e3,ra=1001,Mu=1002,Pn=1003,PM=1004,eo=1005,Ti=1006,Qc=1007,Nr=1008,Gn=1009,gu=1010,yu=1011,ks=1012,Li=1013,En=1014,Jn=1015,Oi=1016,_v=1017,xv=1018,ts=1020,bv=35902,DM=1021,Vp=1022,Xn=1023,ns=1026,is=1027,Gp=1028,Wh=1029,to=1030,jh=1031,c6=1032,qh=1033,vu=33776,sl=33777,al=33778,ol=33779,mp=35840,gp=35841,yp=35842,vp=35843,_p=36196,dh=37492,ph=37496,mh=37808,gh=37809,yh=37810,vh=37811,_h=37812,xh=37813,bh=37814,Sh=37815,Th=37816,Mh=37817,Eh=37818,Ah=37819,wh=37820,Rh=37821,_u=36492,WS=36494,jS=36495,LM=36283,xp=36284,bp=36285,Sp=36286,h6=3200,f6=3201,ho=0,eO=1,pr="",Ji="srgb",ca="srgb-linear",Ch="linear",Ze="srgb",d6=0,tu=7680,p6=7681,m6=7682,g6=7683,y6=34055,v6=34056,_6=5386,x6=512,b6=513,S6=514,T6=515,M6=516,E6=517,A6=518,qS=519,UM=512,Sv=513,OM=514,Tv=515,BM=516,IM=517,FM=518,kM=519,Hy=35044,Wc=35048,rN="300 es",vr=2e3,fl=2001;class po{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){const n=this._listeners;return n===void 0?!1:n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){const n=this._listeners;if(n===void 0)return;const r=n[e];if(r!==void 0){const s=r.indexOf(t);s!==-1&&r.splice(s,1)}}dispatchEvent(e){const t=this._listeners;if(t===void 0)return;const n=t[e.type];if(n!==void 0){e.target=this;const r=n.slice(0);for(let s=0,a=r.length;s<a;s++)r[s].call(this,e);e.target=null}}}const Ki=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let sN=1234567;const Vd=Math.PI/180,Eu=180/Math.PI;function ro(){const i=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(Ki[i&255]+Ki[i>>8&255]+Ki[i>>16&255]+Ki[i>>24&255]+"-"+Ki[e&255]+Ki[e>>8&255]+"-"+Ki[e>>16&15|64]+Ki[e>>24&255]+"-"+Ki[t&63|128]+Ki[t>>8&255]+"-"+Ki[t>>16&255]+Ki[t>>24&255]+Ki[n&255]+Ki[n>>8&255]+Ki[n>>16&255]+Ki[n>>24&255]).toLowerCase()}function It(i,e,t){return Math.max(e,Math.min(t,i))}function zM(i,e){return(i%e+e)%e}function w6(i,e,t,n,r){return n+(i-e)*(r-n)/(t-e)}function R6(i,e,t){return i!==e?(t-i)/(e-i):0}function Gd(i,e,t){return(1-t)*i+t*e}function C6(i,e,t,n){return Gd(i,e,1-Math.exp(-t*n))}function N6(i,e=1){return e-Math.abs(zM(i,e*2)-e)}function P6(i,e,t){return i<=e?0:i>=t?1:(i=(i-e)/(t-e),i*i*(3-2*i))}function D6(i,e,t){return i<=e?0:i>=t?1:(i=(i-e)/(t-e),i*i*i*(i*(i*6-15)+10))}function L6(i,e){return i+Math.floor(Math.random()*(e-i+1))}function U6(i,e){return i+Math.random()*(e-i)}function O6(i){return i*(.5-Math.random())}function B6(i){i!==void 0&&(sN=i);let e=sN+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function I6(i){return i*Vd}function F6(i){return i*Eu}function k6(i){return(i&i-1)===0&&i!==0}function z6(i){return Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function V6(i){return Math.pow(2,Math.floor(Math.log(i)/Math.LN2))}function G6(i,e,t,n,r){const s=Math.cos,a=Math.sin,l=s(t/2),u=a(t/2),h=s((e+n)/2),d=a((e+n)/2),p=s((e-n)/2),g=a((e-n)/2),y=s((n-e)/2),v=a((n-e)/2);switch(r){case"XYX":i.set(l*d,u*p,u*g,l*h);break;case"YZY":i.set(u*g,l*d,u*p,l*h);break;case"ZXZ":i.set(u*p,u*g,l*d,l*h);break;case"XZX":i.set(l*d,u*v,u*y,l*h);break;case"YXY":i.set(u*y,l*d,u*v,l*h);break;case"ZYZ":i.set(u*v,u*y,l*d,l*h);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}function mr(i,e){switch(e.constructor){case Float32Array:return i;case Uint32Array:return i/4294967295;case Uint16Array:return i/65535;case Uint8Array:return i/255;case Int32Array:return Math.max(i/2147483647,-1);case Int16Array:return Math.max(i/32767,-1);case Int8Array:return Math.max(i/127,-1);default:throw new Error("Invalid component type.")}}function Bt(i,e){switch(e.constructor){case Float32Array:return i;case Uint32Array:return Math.round(i*4294967295);case Uint16Array:return Math.round(i*65535);case Uint8Array:return Math.round(i*255);case Int32Array:return Math.round(i*2147483647);case Int16Array:return Math.round(i*32767);case Int8Array:return Math.round(i*127);default:throw new Error("Invalid component type.")}}const Wy={DEG2RAD:Vd,RAD2DEG:Eu,generateUUID:ro,clamp:It,euclideanModulo:zM,mapLinear:w6,inverseLerp:R6,lerp:Gd,damp:C6,pingpong:N6,smoothstep:P6,smootherstep:D6,randInt:L6,randFloat:U6,randFloatSpread:O6,seededRandom:B6,degToRad:I6,radToDeg:F6,isPowerOfTwo:k6,ceilPowerOfTwo:z6,floorPowerOfTwo:V6,setQuaternionFromProperEuler:G6,normalize:Bt,denormalize:mr};class Le{constructor(e=0,t=0){Le.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=It(this.x,e.x,t.x),this.y=It(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=It(this.x,e,t),this.y=It(this.y,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(It(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(It(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),r=Math.sin(t),s=this.x-e.x,a=this.y-e.y;return this.x=s*n-a*r+e.x,this.y=s*r+a*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Vs{constructor(e=0,t=0,n=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=r}static slerpFlat(e,t,n,r,s,a,l){let u=n[r+0],h=n[r+1],d=n[r+2],p=n[r+3];const g=s[a+0],y=s[a+1],v=s[a+2],S=s[a+3];if(l===0){e[t+0]=u,e[t+1]=h,e[t+2]=d,e[t+3]=p;return}if(l===1){e[t+0]=g,e[t+1]=y,e[t+2]=v,e[t+3]=S;return}if(p!==S||u!==g||h!==y||d!==v){let b=1-l;const _=u*g+h*y+d*v+p*S,E=_>=0?1:-1,M=1-_*_;if(M>Number.EPSILON){const w=Math.sqrt(M),R=Math.atan2(w,_*E);b=Math.sin(b*R)/w,l=Math.sin(l*R)/w}const A=l*E;if(u=u*b+g*A,h=h*b+y*A,d=d*b+v*A,p=p*b+S*A,b===1-l){const w=1/Math.sqrt(u*u+h*h+d*d+p*p);u*=w,h*=w,d*=w,p*=w}}e[t]=u,e[t+1]=h,e[t+2]=d,e[t+3]=p}static multiplyQuaternionsFlat(e,t,n,r,s,a){const l=n[r],u=n[r+1],h=n[r+2],d=n[r+3],p=s[a],g=s[a+1],y=s[a+2],v=s[a+3];return e[t]=l*v+d*p+u*y-h*g,e[t+1]=u*v+d*g+h*p-l*y,e[t+2]=h*v+d*y+l*g-u*p,e[t+3]=d*v-l*p-u*g-h*y,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const n=e._x,r=e._y,s=e._z,a=e._order,l=Math.cos,u=Math.sin,h=l(n/2),d=l(r/2),p=l(s/2),g=u(n/2),y=u(r/2),v=u(s/2);switch(a){case"XYZ":this._x=g*d*p+h*y*v,this._y=h*y*p-g*d*v,this._z=h*d*v+g*y*p,this._w=h*d*p-g*y*v;break;case"YXZ":this._x=g*d*p+h*y*v,this._y=h*y*p-g*d*v,this._z=h*d*v-g*y*p,this._w=h*d*p+g*y*v;break;case"ZXY":this._x=g*d*p-h*y*v,this._y=h*y*p+g*d*v,this._z=h*d*v+g*y*p,this._w=h*d*p-g*y*v;break;case"ZYX":this._x=g*d*p-h*y*v,this._y=h*y*p+g*d*v,this._z=h*d*v-g*y*p,this._w=h*d*p+g*y*v;break;case"YZX":this._x=g*d*p+h*y*v,this._y=h*y*p+g*d*v,this._z=h*d*v-g*y*p,this._w=h*d*p-g*y*v;break;case"XZY":this._x=g*d*p-h*y*v,this._y=h*y*p-g*d*v,this._z=h*d*v+g*y*p,this._w=h*d*p+g*y*v;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],r=t[4],s=t[8],a=t[1],l=t[5],u=t[9],h=t[2],d=t[6],p=t[10],g=n+l+p;if(g>0){const y=.5/Math.sqrt(g+1);this._w=.25/y,this._x=(d-u)*y,this._y=(s-h)*y,this._z=(a-r)*y}else if(n>l&&n>p){const y=2*Math.sqrt(1+n-l-p);this._w=(d-u)/y,this._x=.25*y,this._y=(r+a)/y,this._z=(s+h)/y}else if(l>p){const y=2*Math.sqrt(1+l-n-p);this._w=(s-h)/y,this._x=(r+a)/y,this._y=.25*y,this._z=(u+d)/y}else{const y=2*Math.sqrt(1+p-n-l);this._w=(a-r)/y,this._x=(s+h)/y,this._y=(u+d)/y,this._z=.25*y}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(It(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(n===0)return this;const r=Math.min(1,t/n);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,r=e._y,s=e._z,a=e._w,l=t._x,u=t._y,h=t._z,d=t._w;return this._x=n*d+a*l+r*h-s*u,this._y=r*d+a*u+s*l-n*h,this._z=s*d+a*h+n*u-r*l,this._w=a*d-n*l-r*u-s*h,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const n=this._x,r=this._y,s=this._z,a=this._w;let l=a*e._w+n*e._x+r*e._y+s*e._z;if(l<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,l=-l):this.copy(e),l>=1)return this._w=a,this._x=n,this._y=r,this._z=s,this;const u=1-l*l;if(u<=Number.EPSILON){const y=1-t;return this._w=y*a+t*this._w,this._x=y*n+t*this._x,this._y=y*r+t*this._y,this._z=y*s+t*this._z,this.normalize(),this}const h=Math.sqrt(u),d=Math.atan2(h,l),p=Math.sin((1-t)*d)/h,g=Math.sin(t*d)/h;return this._w=a*p+this._w*g,this._x=n*p+this._x*g,this._y=r*p+this._y*g,this._z=s*p+this._z*g,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),n=Math.random(),r=Math.sqrt(1-n),s=Math.sqrt(n);return this.set(r*Math.sin(e),r*Math.cos(e),s*Math.sin(t),s*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class V{constructor(e=0,t=0,n=0){V.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return n===void 0&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(aN.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(aN.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[3]*n+s[6]*r,this.y=s[1]*t+s[4]*n+s[7]*r,this.z=s[2]*t+s[5]*n+s[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,s=e.elements,a=1/(s[3]*t+s[7]*n+s[11]*r+s[15]);return this.x=(s[0]*t+s[4]*n+s[8]*r+s[12])*a,this.y=(s[1]*t+s[5]*n+s[9]*r+s[13])*a,this.z=(s[2]*t+s[6]*n+s[10]*r+s[14])*a,this}applyQuaternion(e){const t=this.x,n=this.y,r=this.z,s=e.x,a=e.y,l=e.z,u=e.w,h=2*(a*r-l*n),d=2*(l*t-s*r),p=2*(s*n-a*t);return this.x=t+u*h+a*p-l*d,this.y=n+u*d+l*h-s*p,this.z=r+u*p+s*d-a*h,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[4]*n+s[8]*r,this.y=s[1]*t+s[5]*n+s[9]*r,this.z=s[2]*t+s[6]*n+s[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=It(this.x,e.x,t.x),this.y=It(this.y,e.y,t.y),this.z=It(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=It(this.x,e,t),this.y=It(this.y,e,t),this.z=It(this.z,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(It(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,r=e.y,s=e.z,a=t.x,l=t.y,u=t.z;return this.x=r*u-s*l,this.y=s*a-n*u,this.z=n*l-r*a,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return Sx.copy(this).projectOnVector(e),this.sub(Sx)}reflect(e){return this.sub(Sx.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(It(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,n=Math.sqrt(1-t*t);return this.x=n*Math.cos(e),this.y=t,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Sx=new V,aN=new Vs;class Nt{constructor(e,t,n,r,s,a,l,u,h){Nt.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,n,r,s,a,l,u,h)}set(e,t,n,r,s,a,l,u,h){const d=this.elements;return d[0]=e,d[1]=r,d[2]=l,d[3]=t,d[4]=s,d[5]=u,d[6]=n,d[7]=a,d[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,s=this.elements,a=n[0],l=n[3],u=n[6],h=n[1],d=n[4],p=n[7],g=n[2],y=n[5],v=n[8],S=r[0],b=r[3],_=r[6],E=r[1],M=r[4],A=r[7],w=r[2],R=r[5],C=r[8];return s[0]=a*S+l*E+u*w,s[3]=a*b+l*M+u*R,s[6]=a*_+l*A+u*C,s[1]=h*S+d*E+p*w,s[4]=h*b+d*M+p*R,s[7]=h*_+d*A+p*C,s[2]=g*S+y*E+v*w,s[5]=g*b+y*M+v*R,s[8]=g*_+y*A+v*C,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],r=e[2],s=e[3],a=e[4],l=e[5],u=e[6],h=e[7],d=e[8];return t*a*d-t*l*h-n*s*d+n*l*u+r*s*h-r*a*u}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],s=e[3],a=e[4],l=e[5],u=e[6],h=e[7],d=e[8],p=d*a-l*h,g=l*u-d*s,y=h*s-a*u,v=t*p+n*g+r*y;if(v===0)return this.set(0,0,0,0,0,0,0,0,0);const S=1/v;return e[0]=p*S,e[1]=(r*h-d*n)*S,e[2]=(l*n-r*a)*S,e[3]=g*S,e[4]=(d*t-r*u)*S,e[5]=(r*s-l*t)*S,e[6]=y*S,e[7]=(n*u-h*t)*S,e[8]=(a*t-n*s)*S,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,r,s,a,l){const u=Math.cos(s),h=Math.sin(s);return this.set(n*u,n*h,-n*(u*a+h*l)+a+e,-r*h,r*u,-r*(-h*a+u*l)+l+t,0,0,1),this}scale(e,t){return this.premultiply(Tx.makeScale(e,t)),this}rotate(e){return this.premultiply(Tx.makeRotation(-e)),this}translate(e,t){return this.premultiply(Tx.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let r=0;r<9;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const Tx=new Nt;function VM(i){for(let e=i.length-1;e>=0;--e)if(i[e]>=65535)return!0;return!1}function Tp(i){return document.createElementNS("http://www.w3.org/1999/xhtml",i)}function tO(){const i=Tp("canvas");return i.style.display="block",i}const oN={};function rs(i){i in oN||(oN[i]=!0,console.warn(i))}function H6(i,e,t){return new Promise(function(n,r){function s(){switch(i.clientWaitSync(e,i.SYNC_FLUSH_COMMANDS_BIT,0)){case i.WAIT_FAILED:r();break;case i.TIMEOUT_EXPIRED:setTimeout(s,t);break;default:n()}}setTimeout(s,t)})}function W6(i){const e=i.elements;e[2]=.5*e[2]+.5*e[3],e[6]=.5*e[6]+.5*e[7],e[10]=.5*e[10]+.5*e[11],e[14]=.5*e[14]+.5*e[15]}function j6(i){const e=i.elements;e[11]===-1?(e[10]=-e[10]-1,e[14]=-e[14]):(e[10]=-e[10],e[14]=-e[14]+1)}const lN=new Nt().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),uN=new Nt().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function q6(){const i={enabled:!0,workingColorSpace:ca,spaces:{},convert:function(r,s,a){return this.enabled===!1||s===a||!s||!a||(this.spaces[s].transfer===Ze&&(r.r=so(r.r),r.g=so(r.g),r.b=so(r.b)),this.spaces[s].primaries!==this.spaces[a].primaries&&(r.applyMatrix3(this.spaces[s].toXYZ),r.applyMatrix3(this.spaces[a].fromXYZ)),this.spaces[a].transfer===Ze&&(r.r=Jc(r.r),r.g=Jc(r.g),r.b=Jc(r.b))),r},workingToColorSpace:function(r,s){return this.convert(r,this.workingColorSpace,s)},colorSpaceToWorking:function(r,s){return this.convert(r,s,this.workingColorSpace)},getPrimaries:function(r){return this.spaces[r].primaries},getTransfer:function(r){return r===pr?Ch:this.spaces[r].transfer},getLuminanceCoefficients:function(r,s=this.workingColorSpace){return r.fromArray(this.spaces[s].luminanceCoefficients)},define:function(r){Object.assign(this.spaces,r)},_getMatrix:function(r,s,a){return r.copy(this.spaces[s].toXYZ).multiply(this.spaces[a].fromXYZ)},_getDrawingBufferColorSpace:function(r){return this.spaces[r].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(r=this.workingColorSpace){return this.spaces[r].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(r,s){return rs("THREE.ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),i.workingToColorSpace(r,s)},toWorkingColorSpace:function(r,s){return rs("THREE.ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),i.colorSpaceToWorking(r,s)}},e=[.64,.33,.3,.6,.15,.06],t=[.2126,.7152,.0722],n=[.3127,.329];return i.define({[ca]:{primaries:e,whitePoint:n,transfer:Ch,toXYZ:lN,fromXYZ:uN,luminanceCoefficients:t,workingColorSpaceConfig:{unpackColorSpace:Ji},outputColorSpaceConfig:{drawingBufferColorSpace:Ji}},[Ji]:{primaries:e,whitePoint:n,transfer:Ze,toXYZ:lN,fromXYZ:uN,luminanceCoefficients:t,outputColorSpaceConfig:{drawingBufferColorSpace:Ji}}}),i}const wt=q6();function so(i){return i<.04045?i*.0773993808:Math.pow(i*.9478672986+.0521327014,2.4)}function Jc(i){return i<.0031308?i*12.92:1.055*Math.pow(i,.41666)-.055}let fc;class $6{static getDataURL(e,t="image/png"){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let n;if(e instanceof HTMLCanvasElement)n=e;else{fc===void 0&&(fc=Tp("canvas")),fc.width=e.width,fc.height=e.height;const r=fc.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),n=fc}return n.toDataURL(t)}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=Tp("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const r=n.getImageData(0,0,e.width,e.height),s=r.data;for(let a=0;a<s.length;a++)s[a]=so(s[a]/255)*255;return n.putImageData(r,0,0),t}else if(e.data){const t=e.data.slice(0);for(let n=0;n<t.length;n++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[n]=Math.floor(so(t[n]/255)*255):t[n]=so(t[n]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let X6=0;class GM{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:X6++}),this.uuid=ro(),this.data=e,this.dataReady=!0,this.version=0}getSize(e){const t=this.data;return t instanceof HTMLVideoElement?e.set(t.videoWidth,t.videoHeight):t!==null?e.set(t.width,t.height,t.depth||0):e.set(0,0,0),e}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const n={uuid:this.uuid,url:""},r=this.data;if(r!==null){let s;if(Array.isArray(r)){s=[];for(let a=0,l=r.length;a<l;a++)r[a].isDataTexture?s.push(Mx(r[a].image)):s.push(Mx(r[a]))}else s=Mx(r);n.url=s}return t||(e.images[this.uuid]=n),n}}function Mx(i){return typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&i instanceof ImageBitmap?$6.getDataURL(i):i.data?{data:Array.from(i.data),width:i.width,height:i.height,type:i.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Y6=0;const Ex=new V;class ei extends po{constructor(e=ei.DEFAULT_IMAGE,t=ei.DEFAULT_MAPPING,n=ra,r=ra,s=Ti,a=Nr,l=Xn,u=Gn,h=ei.DEFAULT_ANISOTROPY,d=pr){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Y6++}),this.uuid=ro(),this.name="",this.source=new GM(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=r,this.magFilter=s,this.minFilter=a,this.anisotropy=h,this.format=l,this.internalFormat=null,this.type=u,this.offset=new Le(0,0),this.repeat=new Le(1,1),this.center=new Le(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Nt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=d,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(e&&e.depth&&e.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(Ex).x}get height(){return this.source.getSize(Ex).y}get depth(){return this.source.getSize(Ex).z}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.isArrayTexture=e.isArrayTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}setValues(e){for(const t in e){const n=e[t];if(n===void 0){console.warn(`THREE.Texture.setValues(): parameter '${t}' has value of undefined.`);continue}const r=this[t];if(r===void 0){console.warn(`THREE.Texture.setValues(): property '${t}' does not exist.`);continue}r&&n&&r.isVector2&&n.isVector2||r&&n&&r.isVector3&&n.isVector3||r&&n&&r.isMatrix3&&n.isMatrix3?r.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==NM)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Tu:e.x=e.x-Math.floor(e.x);break;case ra:e.x=e.x<0?0:1;break;case Mu:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Tu:e.y=e.y-Math.floor(e.y);break;case ra:e.y=e.y<0?0:1;break;case Mu:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}ei.DEFAULT_IMAGE=null;ei.DEFAULT_MAPPING=NM;ei.DEFAULT_ANISOTROPY=1;class bt{constructor(e=0,t=0,n=0,r=1){bt.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,s=this.w,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*r+a[12]*s,this.y=a[1]*t+a[5]*n+a[9]*r+a[13]*s,this.z=a[2]*t+a[6]*n+a[10]*r+a[14]*s,this.w=a[3]*t+a[7]*n+a[11]*r+a[15]*s,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,r,s;const u=e.elements,h=u[0],d=u[4],p=u[8],g=u[1],y=u[5],v=u[9],S=u[2],b=u[6],_=u[10];if(Math.abs(d-g)<.01&&Math.abs(p-S)<.01&&Math.abs(v-b)<.01){if(Math.abs(d+g)<.1&&Math.abs(p+S)<.1&&Math.abs(v+b)<.1&&Math.abs(h+y+_-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const M=(h+1)/2,A=(y+1)/2,w=(_+1)/2,R=(d+g)/4,C=(p+S)/4,L=(v+b)/4;return M>A&&M>w?M<.01?(n=0,r=.707106781,s=.707106781):(n=Math.sqrt(M),r=R/n,s=C/n):A>w?A<.01?(n=.707106781,r=0,s=.707106781):(r=Math.sqrt(A),n=R/r,s=L/r):w<.01?(n=.707106781,r=.707106781,s=0):(s=Math.sqrt(w),n=C/s,r=L/s),this.set(n,r,s,t),this}let E=Math.sqrt((b-v)*(b-v)+(p-S)*(p-S)+(g-d)*(g-d));return Math.abs(E)<.001&&(E=1),this.x=(b-v)/E,this.y=(p-S)/E,this.z=(g-d)/E,this.w=Math.acos((h+y+_-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=It(this.x,e.x,t.x),this.y=It(this.y,e.y,t.y),this.z=It(this.z,e.z,t.z),this.w=It(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=It(this.x,e,t),this.y=It(this.y,e,t),this.z=It(this.z,e,t),this.w=It(this.w,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(It(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Nu extends po{constructor(e=1,t=1,n={}){super(),n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Ti,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},n),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=n.depth,this.scissor=new bt(0,0,e,t),this.scissorTest=!1,this.viewport=new bt(0,0,e,t);const r={width:e,height:t,depth:n.depth},s=new ei(r);this.textures=[];const a=n.count;for(let l=0;l<a;l++)this.textures[l]=s.clone(),this.textures[l].isRenderTargetTexture=!0,this.textures[l].renderTarget=this;this._setTextureOptions(n),this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=n.depthTexture,this.samples=n.samples,this.multiview=n.multiview}_setTextureOptions(e={}){const t={minFilter:Ti,generateMipmaps:!1,flipY:!1,internalFormat:null};e.mapping!==void 0&&(t.mapping=e.mapping),e.wrapS!==void 0&&(t.wrapS=e.wrapS),e.wrapT!==void 0&&(t.wrapT=e.wrapT),e.wrapR!==void 0&&(t.wrapR=e.wrapR),e.magFilter!==void 0&&(t.magFilter=e.magFilter),e.minFilter!==void 0&&(t.minFilter=e.minFilter),e.format!==void 0&&(t.format=e.format),e.type!==void 0&&(t.type=e.type),e.anisotropy!==void 0&&(t.anisotropy=e.anisotropy),e.colorSpace!==void 0&&(t.colorSpace=e.colorSpace),e.flipY!==void 0&&(t.flipY=e.flipY),e.generateMipmaps!==void 0&&(t.generateMipmaps=e.generateMipmaps),e.internalFormat!==void 0&&(t.internalFormat=e.internalFormat);for(let n=0;n<this.textures.length;n++)this.textures[n].setValues(t)}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),e!==null&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let r=0,s=this.textures.length;r<s;r++)this.textures[r].image.width=e,this.textures[r].image.height=t,this.textures[r].image.depth=n,this.textures[r].isArrayTexture=this.textures[r].image.depth>1;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let t=0,n=e.textures.length;t<n;t++){this.textures[t]=e.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0,this.textures[t].renderTarget=this;const r=Object.assign({},e.textures[t].image);this.textures[t].source=new GM(r)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class dl extends Nu{constructor(e=1,t=1,n={}){super(e,t,n),this.isWebGLRenderTarget=!0}}class HM extends ei{constructor(e=null,t=1,n=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=Pn,this.minFilter=Pn,this.wrapR=ra,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class K6 extends ei{constructor(e=null,t=1,n=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=Pn,this.minFilter=Pn,this.wrapR=ra,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Pu{constructor(e=new V(1/0,1/0,1/0),t=new V(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(Rs.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(Rs.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Rs.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(n!==void 0){const s=n.getAttribute("position");if(t===!0&&s!==void 0&&e.isInstancedMesh!==!0)for(let a=0,l=s.count;a<l;a++)e.isMesh===!0?e.getVertexPosition(a,Rs):Rs.fromBufferAttribute(s,a),Rs.applyMatrix4(e.matrixWorld),this.expandByPoint(Rs);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),gg.copy(e.boundingBox)):(n.boundingBox===null&&n.computeBoundingBox(),gg.copy(n.boundingBox)),gg.applyMatrix4(e.matrixWorld),this.union(gg)}const r=e.children;for(let s=0,a=r.length;s<a;s++)this.expandByObject(r[s],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,Rs),Rs.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Kf),yg.subVectors(this.max,Kf),dc.subVectors(e.a,Kf),pc.subVectors(e.b,Kf),mc.subVectors(e.c,Kf),Wo.subVectors(pc,dc),jo.subVectors(mc,pc),Hl.subVectors(dc,mc);let t=[0,-Wo.z,Wo.y,0,-jo.z,jo.y,0,-Hl.z,Hl.y,Wo.z,0,-Wo.x,jo.z,0,-jo.x,Hl.z,0,-Hl.x,-Wo.y,Wo.x,0,-jo.y,jo.x,0,-Hl.y,Hl.x,0];return!Ax(t,dc,pc,mc,yg)||(t=[1,0,0,0,1,0,0,0,1],!Ax(t,dc,pc,mc,yg))?!1:(vg.crossVectors(Wo,jo),t=[vg.x,vg.y,vg.z],Ax(t,dc,pc,mc,yg))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Rs).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Rs).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Fa[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Fa[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Fa[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Fa[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Fa[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Fa[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Fa[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Fa[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Fa),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(e){return this.min.fromArray(e.min),this.max.fromArray(e.max),this}}const Fa=[new V,new V,new V,new V,new V,new V,new V,new V],Rs=new V,gg=new Pu,dc=new V,pc=new V,mc=new V,Wo=new V,jo=new V,Hl=new V,Kf=new V,yg=new V,vg=new V,Wl=new V;function Ax(i,e,t,n,r){for(let s=0,a=i.length-3;s<=a;s+=3){Wl.fromArray(i,s);const l=r.x*Math.abs(Wl.x)+r.y*Math.abs(Wl.y)+r.z*Math.abs(Wl.z),u=e.dot(Wl),h=t.dot(Wl),d=n.dot(Wl);if(Math.max(-Math.max(u,h,d),Math.min(u,h,d))>l)return!1}return!0}const Z6=new Pu,Zf=new V,wx=new V;class Hp{constructor(e=new V,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;t!==void 0?n.copy(t):Z6.setFromPoints(e).getCenter(n);let r=0;for(let s=0,a=e.length;s<a;s++)r=Math.max(r,n.distanceToSquared(e[s]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Zf.subVectors(e,this.center);const t=Zf.lengthSq();if(t>this.radius*this.radius){const n=Math.sqrt(t),r=(n-this.radius)*.5;this.center.addScaledVector(Zf,r/n),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(wx.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Zf.copy(e.center).add(wx)),this.expandByPoint(Zf.copy(e.center).sub(wx))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(e){return this.radius=e.radius,this.center.fromArray(e.center),this}}const ka=new V,Rx=new V,_g=new V,qo=new V,Cx=new V,xg=new V,Nx=new V;class Mv{constructor(e=new V,t=new V(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,ka)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=ka.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(ka.copy(this.origin).addScaledVector(this.direction,t),ka.distanceToSquared(e))}distanceSqToSegment(e,t,n,r){Rx.copy(e).add(t).multiplyScalar(.5),_g.copy(t).sub(e).normalize(),qo.copy(this.origin).sub(Rx);const s=e.distanceTo(t)*.5,a=-this.direction.dot(_g),l=qo.dot(this.direction),u=-qo.dot(_g),h=qo.lengthSq(),d=Math.abs(1-a*a);let p,g,y,v;if(d>0)if(p=a*u-l,g=a*l-u,v=s*d,p>=0)if(g>=-v)if(g<=v){const S=1/d;p*=S,g*=S,y=p*(p+a*g+2*l)+g*(a*p+g+2*u)+h}else g=s,p=Math.max(0,-(a*g+l)),y=-p*p+g*(g+2*u)+h;else g=-s,p=Math.max(0,-(a*g+l)),y=-p*p+g*(g+2*u)+h;else g<=-v?(p=Math.max(0,-(-a*s+l)),g=p>0?-s:Math.min(Math.max(-s,-u),s),y=-p*p+g*(g+2*u)+h):g<=v?(p=0,g=Math.min(Math.max(-s,-u),s),y=g*(g+2*u)+h):(p=Math.max(0,-(a*s+l)),g=p>0?s:Math.min(Math.max(-s,-u),s),y=-p*p+g*(g+2*u)+h);else g=a>0?-s:s,p=Math.max(0,-(a*g+l)),y=-p*p+g*(g+2*u)+h;return n&&n.copy(this.origin).addScaledVector(this.direction,p),r&&r.copy(Rx).addScaledVector(_g,g),y}intersectSphere(e,t){ka.subVectors(e.center,this.origin);const n=ka.dot(this.direction),r=ka.dot(ka)-n*n,s=e.radius*e.radius;if(r>s)return null;const a=Math.sqrt(s-r),l=n-a,u=n+a;return u<0?null:l<0?this.at(u,t):this.at(l,t)}intersectsSphere(e){return e.radius<0?!1:this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return n===null?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,r,s,a,l,u;const h=1/this.direction.x,d=1/this.direction.y,p=1/this.direction.z,g=this.origin;return h>=0?(n=(e.min.x-g.x)*h,r=(e.max.x-g.x)*h):(n=(e.max.x-g.x)*h,r=(e.min.x-g.x)*h),d>=0?(s=(e.min.y-g.y)*d,a=(e.max.y-g.y)*d):(s=(e.max.y-g.y)*d,a=(e.min.y-g.y)*d),n>a||s>r||((s>n||isNaN(n))&&(n=s),(a<r||isNaN(r))&&(r=a),p>=0?(l=(e.min.z-g.z)*p,u=(e.max.z-g.z)*p):(l=(e.max.z-g.z)*p,u=(e.min.z-g.z)*p),n>u||l>r)||((l>n||n!==n)&&(n=l),(u<r||r!==r)&&(r=u),r<0)?null:this.at(n>=0?n:r,t)}intersectsBox(e){return this.intersectBox(e,ka)!==null}intersectTriangle(e,t,n,r,s){Cx.subVectors(t,e),xg.subVectors(n,e),Nx.crossVectors(Cx,xg);let a=this.direction.dot(Nx),l;if(a>0){if(r)return null;l=1}else if(a<0)l=-1,a=-a;else return null;qo.subVectors(this.origin,e);const u=l*this.direction.dot(xg.crossVectors(qo,xg));if(u<0)return null;const h=l*this.direction.dot(Cx.cross(qo));if(h<0||u+h>a)return null;const d=-l*qo.dot(Nx);return d<0?null:this.at(d/a,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Wt{constructor(e,t,n,r,s,a,l,u,h,d,p,g,y,v,S,b){Wt.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,n,r,s,a,l,u,h,d,p,g,y,v,S,b)}set(e,t,n,r,s,a,l,u,h,d,p,g,y,v,S,b){const _=this.elements;return _[0]=e,_[4]=t,_[8]=n,_[12]=r,_[1]=s,_[5]=a,_[9]=l,_[13]=u,_[2]=h,_[6]=d,_[10]=p,_[14]=g,_[3]=y,_[7]=v,_[11]=S,_[15]=b,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Wt().fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,r=1/gc.setFromMatrixColumn(e,0).length(),s=1/gc.setFromMatrixColumn(e,1).length(),a=1/gc.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*s,t[5]=n[5]*s,t[6]=n[6]*s,t[7]=0,t[8]=n[8]*a,t[9]=n[9]*a,t[10]=n[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,r=e.y,s=e.z,a=Math.cos(n),l=Math.sin(n),u=Math.cos(r),h=Math.sin(r),d=Math.cos(s),p=Math.sin(s);if(e.order==="XYZ"){const g=a*d,y=a*p,v=l*d,S=l*p;t[0]=u*d,t[4]=-u*p,t[8]=h,t[1]=y+v*h,t[5]=g-S*h,t[9]=-l*u,t[2]=S-g*h,t[6]=v+y*h,t[10]=a*u}else if(e.order==="YXZ"){const g=u*d,y=u*p,v=h*d,S=h*p;t[0]=g+S*l,t[4]=v*l-y,t[8]=a*h,t[1]=a*p,t[5]=a*d,t[9]=-l,t[2]=y*l-v,t[6]=S+g*l,t[10]=a*u}else if(e.order==="ZXY"){const g=u*d,y=u*p,v=h*d,S=h*p;t[0]=g-S*l,t[4]=-a*p,t[8]=v+y*l,t[1]=y+v*l,t[5]=a*d,t[9]=S-g*l,t[2]=-a*h,t[6]=l,t[10]=a*u}else if(e.order==="ZYX"){const g=a*d,y=a*p,v=l*d,S=l*p;t[0]=u*d,t[4]=v*h-y,t[8]=g*h+S,t[1]=u*p,t[5]=S*h+g,t[9]=y*h-v,t[2]=-h,t[6]=l*u,t[10]=a*u}else if(e.order==="YZX"){const g=a*u,y=a*h,v=l*u,S=l*h;t[0]=u*d,t[4]=S-g*p,t[8]=v*p+y,t[1]=p,t[5]=a*d,t[9]=-l*d,t[2]=-h*d,t[6]=y*p+v,t[10]=g-S*p}else if(e.order==="XZY"){const g=a*u,y=a*h,v=l*u,S=l*h;t[0]=u*d,t[4]=-p,t[8]=h*d,t[1]=g*p+S,t[5]=a*d,t[9]=y*p-v,t[2]=v*p-y,t[6]=l*d,t[10]=S*p+g}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Q6,e,J6)}lookAt(e,t,n){const r=this.elements;return $r.subVectors(e,t),$r.lengthSq()===0&&($r.z=1),$r.normalize(),$o.crossVectors(n,$r),$o.lengthSq()===0&&(Math.abs(n.z)===1?$r.x+=1e-4:$r.z+=1e-4,$r.normalize(),$o.crossVectors(n,$r)),$o.normalize(),bg.crossVectors($r,$o),r[0]=$o.x,r[4]=bg.x,r[8]=$r.x,r[1]=$o.y,r[5]=bg.y,r[9]=$r.y,r[2]=$o.z,r[6]=bg.z,r[10]=$r.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,s=this.elements,a=n[0],l=n[4],u=n[8],h=n[12],d=n[1],p=n[5],g=n[9],y=n[13],v=n[2],S=n[6],b=n[10],_=n[14],E=n[3],M=n[7],A=n[11],w=n[15],R=r[0],C=r[4],L=r[8],N=r[12],D=r[1],I=r[5],W=r[9],Y=r[13],oe=r[2],le=r[6],z=r[10],k=r[14],G=r[3],he=r[7],F=r[11],se=r[15];return s[0]=a*R+l*D+u*oe+h*G,s[4]=a*C+l*I+u*le+h*he,s[8]=a*L+l*W+u*z+h*F,s[12]=a*N+l*Y+u*k+h*se,s[1]=d*R+p*D+g*oe+y*G,s[5]=d*C+p*I+g*le+y*he,s[9]=d*L+p*W+g*z+y*F,s[13]=d*N+p*Y+g*k+y*se,s[2]=v*R+S*D+b*oe+_*G,s[6]=v*C+S*I+b*le+_*he,s[10]=v*L+S*W+b*z+_*F,s[14]=v*N+S*Y+b*k+_*se,s[3]=E*R+M*D+A*oe+w*G,s[7]=E*C+M*I+A*le+w*he,s[11]=E*L+M*W+A*z+w*F,s[15]=E*N+M*Y+A*k+w*se,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],r=e[8],s=e[12],a=e[1],l=e[5],u=e[9],h=e[13],d=e[2],p=e[6],g=e[10],y=e[14],v=e[3],S=e[7],b=e[11],_=e[15];return v*(+s*u*p-r*h*p-s*l*g+n*h*g+r*l*y-n*u*y)+S*(+t*u*y-t*h*g+s*a*g-r*a*y+r*h*d-s*u*d)+b*(+t*h*p-t*l*y-s*a*p+n*a*y+s*l*d-n*h*d)+_*(-r*l*d-t*u*p+t*l*g+r*a*p-n*a*g+n*u*d)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],s=e[3],a=e[4],l=e[5],u=e[6],h=e[7],d=e[8],p=e[9],g=e[10],y=e[11],v=e[12],S=e[13],b=e[14],_=e[15],E=p*b*h-S*g*h+S*u*y-l*b*y-p*u*_+l*g*_,M=v*g*h-d*b*h-v*u*y+a*b*y+d*u*_-a*g*_,A=d*S*h-v*p*h+v*l*y-a*S*y-d*l*_+a*p*_,w=v*p*u-d*S*u-v*l*g+a*S*g+d*l*b-a*p*b,R=t*E+n*M+r*A+s*w;if(R===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const C=1/R;return e[0]=E*C,e[1]=(S*g*s-p*b*s-S*r*y+n*b*y+p*r*_-n*g*_)*C,e[2]=(l*b*s-S*u*s+S*r*h-n*b*h-l*r*_+n*u*_)*C,e[3]=(p*u*s-l*g*s-p*r*h+n*g*h+l*r*y-n*u*y)*C,e[4]=M*C,e[5]=(d*b*s-v*g*s+v*r*y-t*b*y-d*r*_+t*g*_)*C,e[6]=(v*u*s-a*b*s-v*r*h+t*b*h+a*r*_-t*u*_)*C,e[7]=(a*g*s-d*u*s+d*r*h-t*g*h-a*r*y+t*u*y)*C,e[8]=A*C,e[9]=(v*p*s-d*S*s-v*n*y+t*S*y+d*n*_-t*p*_)*C,e[10]=(a*S*s-v*l*s+v*n*h-t*S*h-a*n*_+t*l*_)*C,e[11]=(d*l*s-a*p*s-d*n*h+t*p*h+a*n*y-t*l*y)*C,e[12]=w*C,e[13]=(d*S*r-v*p*r+v*n*g-t*S*g-d*n*b+t*p*b)*C,e[14]=(v*l*r-a*S*r-v*n*u+t*S*u+a*n*b-t*l*b)*C,e[15]=(a*p*r-d*l*r+d*n*u-t*p*u-a*n*g+t*l*g)*C,this}scale(e){const t=this.elements,n=e.x,r=e.y,s=e.z;return t[0]*=n,t[4]*=r,t[8]*=s,t[1]*=n,t[5]*=r,t[9]*=s,t[2]*=n,t[6]*=r,t[10]*=s,t[3]*=n,t[7]*=r,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),r=Math.sin(t),s=1-n,a=e.x,l=e.y,u=e.z,h=s*a,d=s*l;return this.set(h*a+n,h*l-r*u,h*u+r*l,0,h*l+r*u,d*l+n,d*u-r*a,0,h*u-r*l,d*u+r*a,s*u*u+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,r,s,a){return this.set(1,n,s,0,e,1,a,0,t,r,1,0,0,0,0,1),this}compose(e,t,n){const r=this.elements,s=t._x,a=t._y,l=t._z,u=t._w,h=s+s,d=a+a,p=l+l,g=s*h,y=s*d,v=s*p,S=a*d,b=a*p,_=l*p,E=u*h,M=u*d,A=u*p,w=n.x,R=n.y,C=n.z;return r[0]=(1-(S+_))*w,r[1]=(y+A)*w,r[2]=(v-M)*w,r[3]=0,r[4]=(y-A)*R,r[5]=(1-(g+_))*R,r[6]=(b+E)*R,r[7]=0,r[8]=(v+M)*C,r[9]=(b-E)*C,r[10]=(1-(g+S))*C,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,n){const r=this.elements;let s=gc.set(r[0],r[1],r[2]).length();const a=gc.set(r[4],r[5],r[6]).length(),l=gc.set(r[8],r[9],r[10]).length();this.determinant()<0&&(s=-s),e.x=r[12],e.y=r[13],e.z=r[14],Cs.copy(this);const h=1/s,d=1/a,p=1/l;return Cs.elements[0]*=h,Cs.elements[1]*=h,Cs.elements[2]*=h,Cs.elements[4]*=d,Cs.elements[5]*=d,Cs.elements[6]*=d,Cs.elements[8]*=p,Cs.elements[9]*=p,Cs.elements[10]*=p,t.setFromRotationMatrix(Cs),n.x=s,n.y=a,n.z=l,this}makePerspective(e,t,n,r,s,a,l=vr){const u=this.elements,h=2*s/(t-e),d=2*s/(n-r),p=(t+e)/(t-e),g=(n+r)/(n-r);let y,v;if(l===vr)y=-(a+s)/(a-s),v=-2*a*s/(a-s);else if(l===fl)y=-a/(a-s),v=-a*s/(a-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+l);return u[0]=h,u[4]=0,u[8]=p,u[12]=0,u[1]=0,u[5]=d,u[9]=g,u[13]=0,u[2]=0,u[6]=0,u[10]=y,u[14]=v,u[3]=0,u[7]=0,u[11]=-1,u[15]=0,this}makeOrthographic(e,t,n,r,s,a,l=vr){const u=this.elements,h=1/(t-e),d=1/(n-r),p=1/(a-s),g=(t+e)*h,y=(n+r)*d;let v,S;if(l===vr)v=(a+s)*p,S=-2*p;else if(l===fl)v=s*p,S=-1*p;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+l);return u[0]=2*h,u[4]=0,u[8]=0,u[12]=-g,u[1]=0,u[5]=2*d,u[9]=0,u[13]=-y,u[2]=0,u[6]=0,u[10]=S,u[14]=-v,u[3]=0,u[7]=0,u[11]=0,u[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let r=0;r<16;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const gc=new V,Cs=new Wt,Q6=new V(0,0,0),J6=new V(1,1,1),$o=new V,bg=new V,$r=new V,cN=new Wt,hN=new Vs;class Br{constructor(e=0,t=0,n=0,r=Br.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,r=this._order){return this._x=e,this._y=t,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const r=e.elements,s=r[0],a=r[4],l=r[8],u=r[1],h=r[5],d=r[9],p=r[2],g=r[6],y=r[10];switch(t){case"XYZ":this._y=Math.asin(It(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-d,y),this._z=Math.atan2(-a,s)):(this._x=Math.atan2(g,h),this._z=0);break;case"YXZ":this._x=Math.asin(-It(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(l,y),this._z=Math.atan2(u,h)):(this._y=Math.atan2(-p,s),this._z=0);break;case"ZXY":this._x=Math.asin(It(g,-1,1)),Math.abs(g)<.9999999?(this._y=Math.atan2(-p,y),this._z=Math.atan2(-a,h)):(this._y=0,this._z=Math.atan2(u,s));break;case"ZYX":this._y=Math.asin(-It(p,-1,1)),Math.abs(p)<.9999999?(this._x=Math.atan2(g,y),this._z=Math.atan2(u,s)):(this._x=0,this._z=Math.atan2(-a,h));break;case"YZX":this._z=Math.asin(It(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(-d,h),this._y=Math.atan2(-p,s)):(this._x=0,this._y=Math.atan2(l,y));break;case"XZY":this._z=Math.asin(-It(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(g,h),this._y=Math.atan2(l,s)):(this._x=Math.atan2(-d,y),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return cN.makeRotationFromQuaternion(e),this.setFromRotationMatrix(cN,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return hN.setFromEuler(this),this.setFromQuaternion(hN,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Br.DEFAULT_ORDER="XYZ";class WM{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let e8=0;const fN=new V,yc=new Vs,za=new Wt,Sg=new V,Qf=new V,t8=new V,n8=new Vs,dN=new V(1,0,0),pN=new V(0,1,0),mN=new V(0,0,1),gN={type:"added"},i8={type:"removed"},vc={type:"childadded",child:null},Px={type:"childremoved",child:null};class ti extends po{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:e8++}),this.uuid=ro(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=ti.DEFAULT_UP.clone();const e=new V,t=new Br,n=new Vs,r=new V(1,1,1);function s(){n.setFromEuler(t,!1)}function a(){t.setFromQuaternion(n,void 0,!1)}t._onChange(s),n._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Wt},normalMatrix:{value:new Nt}}),this.matrix=new Wt,this.matrixWorld=new Wt,this.matrixAutoUpdate=ti.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=ti.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new WM,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return yc.setFromAxisAngle(e,t),this.quaternion.multiply(yc),this}rotateOnWorldAxis(e,t){return yc.setFromAxisAngle(e,t),this.quaternion.premultiply(yc),this}rotateX(e){return this.rotateOnAxis(dN,e)}rotateY(e){return this.rotateOnAxis(pN,e)}rotateZ(e){return this.rotateOnAxis(mN,e)}translateOnAxis(e,t){return fN.copy(e).applyQuaternion(this.quaternion),this.position.add(fN.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(dN,e)}translateY(e){return this.translateOnAxis(pN,e)}translateZ(e){return this.translateOnAxis(mN,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(za.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?Sg.copy(e):Sg.set(e,t,n);const r=this.parent;this.updateWorldMatrix(!0,!1),Qf.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?za.lookAt(Qf,Sg,this.up):za.lookAt(Sg,Qf,this.up),this.quaternion.setFromRotationMatrix(za),r&&(za.extractRotation(r.matrixWorld),yc.setFromRotationMatrix(za),this.quaternion.premultiply(yc.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(gN),vc.child=e,this.dispatchEvent(vc),vc.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(i8),Px.child=e,this.dispatchEvent(Px),Px.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),za.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),za.multiply(e.parent.matrixWorld)),e.applyMatrix4(za),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(gN),vc.child=e,this.dispatchEvent(vc),vc.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,r=this.children.length;n<r;n++){const a=this.children[n].getObjectByProperty(e,t);if(a!==void 0)return a}}getObjectsByProperty(e,t,n=[]){this[e]===t&&n.push(this);const r=this.children;for(let s=0,a=r.length;s<a;s++)r[s].getObjectsByProperty(e,t,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Qf,e,t8),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Qf,n8,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].updateMatrixWorld(e)}updateWorldMatrix(e,t){const n=this.parent;if(e===!0&&n!==null&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const r=this.children;for(let s=0,a=r.length;s<a;s++)r[s].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.geometryInfo=this._geometryInfo.map(l=>({...l,boundingBox:l.boundingBox?l.boundingBox.toJSON():void 0,boundingSphere:l.boundingSphere?l.boundingSphere.toJSON():void 0})),r.instanceInfo=this._instanceInfo.map(l=>({...l})),r.availableInstanceIds=this._availableInstanceIds.slice(),r.availableGeometryIds=this._availableGeometryIds.slice(),r.nextIndexStart=this._nextIndexStart,r.nextVertexStart=this._nextVertexStart,r.geometryCount=this._geometryCount,r.maxInstanceCount=this._maxInstanceCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.matricesTexture=this._matricesTexture.toJSON(e),r.indirectTexture=this._indirectTexture.toJSON(e),this._colorsTexture!==null&&(r.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(r.boundingSphere=this.boundingSphere.toJSON()),this.boundingBox!==null&&(r.boundingBox=this.boundingBox.toJSON()));function s(l,u){return l[u.uuid]===void 0&&(l[u.uuid]=u.toJSON(e)),u.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=s(e.geometries,this.geometry);const l=this.geometry.parameters;if(l!==void 0&&l.shapes!==void 0){const u=l.shapes;if(Array.isArray(u))for(let h=0,d=u.length;h<d;h++){const p=u[h];s(e.shapes,p)}else s(e.shapes,u)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const l=[];for(let u=0,h=this.material.length;u<h;u++)l.push(s(e.materials,this.material[u]));r.material=l}else r.material=s(e.materials,this.material);if(this.children.length>0){r.children=[];for(let l=0;l<this.children.length;l++)r.children.push(this.children[l].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let l=0;l<this.animations.length;l++){const u=this.animations[l];r.animations.push(s(e.animations,u))}}if(t){const l=a(e.geometries),u=a(e.materials),h=a(e.textures),d=a(e.images),p=a(e.shapes),g=a(e.skeletons),y=a(e.animations),v=a(e.nodes);l.length>0&&(n.geometries=l),u.length>0&&(n.materials=u),h.length>0&&(n.textures=h),d.length>0&&(n.images=d),p.length>0&&(n.shapes=p),g.length>0&&(n.skeletons=g),y.length>0&&(n.animations=y),v.length>0&&(n.nodes=v)}return n.object=r,n;function a(l){const u=[];for(const h in l){const d=l[h];delete d.metadata,u.push(d)}return u}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let n=0;n<e.children.length;n++){const r=e.children[n];this.add(r.clone())}return this}}ti.DEFAULT_UP=new V(0,1,0);ti.DEFAULT_MATRIX_AUTO_UPDATE=!0;ti.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Ns=new V,Va=new V,Dx=new V,Ga=new V,_c=new V,xc=new V,yN=new V,Lx=new V,Ux=new V,Ox=new V,Bx=new bt,Ix=new bt,Fx=new bt;class vs{constructor(e=new V,t=new V,n=new V){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,r){r.subVectors(n,t),Ns.subVectors(e,t),r.cross(Ns);const s=r.lengthSq();return s>0?r.multiplyScalar(1/Math.sqrt(s)):r.set(0,0,0)}static getBarycoord(e,t,n,r,s){Ns.subVectors(r,t),Va.subVectors(n,t),Dx.subVectors(e,t);const a=Ns.dot(Ns),l=Ns.dot(Va),u=Ns.dot(Dx),h=Va.dot(Va),d=Va.dot(Dx),p=a*h-l*l;if(p===0)return s.set(0,0,0),null;const g=1/p,y=(h*u-l*d)*g,v=(a*d-l*u)*g;return s.set(1-y-v,v,y)}static containsPoint(e,t,n,r){return this.getBarycoord(e,t,n,r,Ga)===null?!1:Ga.x>=0&&Ga.y>=0&&Ga.x+Ga.y<=1}static getInterpolation(e,t,n,r,s,a,l,u){return this.getBarycoord(e,t,n,r,Ga)===null?(u.x=0,u.y=0,"z"in u&&(u.z=0),"w"in u&&(u.w=0),null):(u.setScalar(0),u.addScaledVector(s,Ga.x),u.addScaledVector(a,Ga.y),u.addScaledVector(l,Ga.z),u)}static getInterpolatedAttribute(e,t,n,r,s,a){return Bx.setScalar(0),Ix.setScalar(0),Fx.setScalar(0),Bx.fromBufferAttribute(e,t),Ix.fromBufferAttribute(e,n),Fx.fromBufferAttribute(e,r),a.setScalar(0),a.addScaledVector(Bx,s.x),a.addScaledVector(Ix,s.y),a.addScaledVector(Fx,s.z),a}static isFrontFacing(e,t,n,r){return Ns.subVectors(n,t),Va.subVectors(e,t),Ns.cross(Va).dot(r)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,n,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Ns.subVectors(this.c,this.b),Va.subVectors(this.a,this.b),Ns.cross(Va).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return vs.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return vs.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,n,r,s){return vs.getInterpolation(e,this.a,this.b,this.c,t,n,r,s)}containsPoint(e){return vs.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return vs.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,r=this.b,s=this.c;let a,l;_c.subVectors(r,n),xc.subVectors(s,n),Lx.subVectors(e,n);const u=_c.dot(Lx),h=xc.dot(Lx);if(u<=0&&h<=0)return t.copy(n);Ux.subVectors(e,r);const d=_c.dot(Ux),p=xc.dot(Ux);if(d>=0&&p<=d)return t.copy(r);const g=u*p-d*h;if(g<=0&&u>=0&&d<=0)return a=u/(u-d),t.copy(n).addScaledVector(_c,a);Ox.subVectors(e,s);const y=_c.dot(Ox),v=xc.dot(Ox);if(v>=0&&y<=v)return t.copy(s);const S=y*h-u*v;if(S<=0&&h>=0&&v<=0)return l=h/(h-v),t.copy(n).addScaledVector(xc,l);const b=d*v-y*p;if(b<=0&&p-d>=0&&y-v>=0)return yN.subVectors(s,r),l=(p-d)/(p-d+(y-v)),t.copy(r).addScaledVector(yN,l);const _=1/(b+S+g);return a=S*_,l=g*_,t.copy(n).addScaledVector(_c,a).addScaledVector(xc,l)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const nO={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Xo={h:0,s:0,l:0},Tg={h:0,s:0,l:0};function kx(i,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?i+(e-i)*6*t:t<1/2?e:t<2/3?i+(e-i)*6*(2/3-t):i}class ot{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(t===void 0&&n===void 0){const r=e;r&&r.isColor?this.copy(r):typeof r=="number"?this.setHex(r):typeof r=="string"&&this.setStyle(r)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Ji){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,wt.colorSpaceToWorking(this,t),this}setRGB(e,t,n,r=wt.workingColorSpace){return this.r=e,this.g=t,this.b=n,wt.colorSpaceToWorking(this,r),this}setHSL(e,t,n,r=wt.workingColorSpace){if(e=zM(e,1),t=It(t,0,1),n=It(n,0,1),t===0)this.r=this.g=this.b=n;else{const s=n<=.5?n*(1+t):n+t-n*t,a=2*n-s;this.r=kx(a,s,e+1/3),this.g=kx(a,s,e),this.b=kx(a,s,e-1/3)}return wt.colorSpaceToWorking(this,r),this}setStyle(e,t=Ji){function n(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const a=r[1],l=r[2];switch(a){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return n(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,t);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return n(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,t);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return n(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=r[1],a=s.length;if(a===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,t);if(a===6)return this.setHex(parseInt(s,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Ji){const n=nO[e.toLowerCase()];return n!==void 0?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=so(e.r),this.g=so(e.g),this.b=so(e.b),this}copyLinearToSRGB(e){return this.r=Jc(e.r),this.g=Jc(e.g),this.b=Jc(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Ji){return wt.workingToColorSpace(Zi.copy(this),e),Math.round(It(Zi.r*255,0,255))*65536+Math.round(It(Zi.g*255,0,255))*256+Math.round(It(Zi.b*255,0,255))}getHexString(e=Ji){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=wt.workingColorSpace){wt.workingToColorSpace(Zi.copy(this),t);const n=Zi.r,r=Zi.g,s=Zi.b,a=Math.max(n,r,s),l=Math.min(n,r,s);let u,h;const d=(l+a)/2;if(l===a)u=0,h=0;else{const p=a-l;switch(h=d<=.5?p/(a+l):p/(2-a-l),a){case n:u=(r-s)/p+(r<s?6:0);break;case r:u=(s-n)/p+2;break;case s:u=(n-r)/p+4;break}u/=6}return e.h=u,e.s=h,e.l=d,e}getRGB(e,t=wt.workingColorSpace){return wt.workingToColorSpace(Zi.copy(this),t),e.r=Zi.r,e.g=Zi.g,e.b=Zi.b,e}getStyle(e=Ji){wt.workingToColorSpace(Zi.copy(this),e);const t=Zi.r,n=Zi.g,r=Zi.b;return e!==Ji?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(n*255)},${Math.round(r*255)})`}offsetHSL(e,t,n){return this.getHSL(Xo),this.setHSL(Xo.h+e,Xo.s+t,Xo.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Xo),e.getHSL(Tg);const n=Gd(Xo.h,Tg.h,t),r=Gd(Xo.s,Tg.s,t),s=Gd(Xo.l,Tg.l,t);return this.setHSL(n,r,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,r=this.b,s=e.elements;return this.r=s[0]*t+s[3]*n+s[6]*r,this.g=s[1]*t+s[4]*n+s[7]*r,this.b=s[2]*t+s[5]*n+s[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Zi=new ot;ot.NAMES=nO;let r8=0;class rr extends po{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:r8++}),this.uuid=ro(),this.name="",this.type="Material",this.blending=es,this.side=Lr,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=ap,this.blendDst=op,this.blendEquation=er,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new ot(0,0,0),this.blendAlpha=0,this.depthFunc=hl,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=qS,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=tu,this.stencilZFail=tu,this.stencilZPass=tu,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const n=e[t];if(n===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const r=this[t];if(r===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const n={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(n.dispersion=this.dispersion),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(n.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapRotation!==void 0&&(n.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==es&&(n.blending=this.blending),this.side!==Lr&&(n.side=this.side),this.vertexColors===!0&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=!0),this.blendSrc!==ap&&(n.blendSrc=this.blendSrc),this.blendDst!==op&&(n.blendDst=this.blendDst),this.blendEquation!==er&&(n.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(n.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(n.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==hl&&(n.depthFunc=this.depthFunc),this.depthTest===!1&&(n.depthTest=this.depthTest),this.depthWrite===!1&&(n.depthWrite=this.depthWrite),this.colorWrite===!1&&(n.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==qS&&(n.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(n.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==tu&&(n.stencilFail=this.stencilFail),this.stencilZFail!==tu&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==tu&&(n.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(n.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaHash===!0&&(n.alphaHash=!0),this.alphaToCoverage===!0&&(n.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=!0),this.forceSinglePass===!0&&(n.forceSinglePass=!0),this.wireframe===!0&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=!0),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData);function r(s){const a=[];for(const l in s){const u=s[l];delete u.metadata,a.push(u)}return a}if(t){const s=r(e.textures),a=r(e.images);s.length>0&&(n.textures=s),a.length>0&&(n.images=a)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(t!==null){const r=t.length;n=new Array(r);for(let s=0;s!==r;++s)n[s]=t[s].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class na extends rr{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new ot(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Br,this.combine=zp,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Ya=s8();function s8(){const i=new ArrayBuffer(4),e=new Float32Array(i),t=new Uint32Array(i),n=new Uint32Array(512),r=new Uint32Array(512);for(let u=0;u<256;++u){const h=u-127;h<-27?(n[u]=0,n[u|256]=32768,r[u]=24,r[u|256]=24):h<-14?(n[u]=1024>>-h-14,n[u|256]=1024>>-h-14|32768,r[u]=-h-1,r[u|256]=-h-1):h<=15?(n[u]=h+15<<10,n[u|256]=h+15<<10|32768,r[u]=13,r[u|256]=13):h<128?(n[u]=31744,n[u|256]=64512,r[u]=24,r[u|256]=24):(n[u]=31744,n[u|256]=64512,r[u]=13,r[u|256]=13)}const s=new Uint32Array(2048),a=new Uint32Array(64),l=new Uint32Array(64);for(let u=1;u<1024;++u){let h=u<<13,d=0;for(;(h&8388608)===0;)h<<=1,d-=8388608;h&=-8388609,d+=947912704,s[u]=h|d}for(let u=1024;u<2048;++u)s[u]=939524096+(u-1024<<13);for(let u=1;u<31;++u)a[u]=u<<23;a[31]=1199570944,a[32]=2147483648;for(let u=33;u<63;++u)a[u]=2147483648+(u-32<<23);a[63]=3347054592;for(let u=1;u<64;++u)u!==32&&(l[u]=1024);return{floatView:e,uint32View:t,baseTable:n,shiftTable:r,mantissaTable:s,exponentTable:a,offsetTable:l}}function Xr(i){Math.abs(i)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),i=It(i,-65504,65504),Ya.floatView[0]=i;const e=Ya.uint32View[0],t=e>>23&511;return Ya.baseTable[t]+((e&8388607)>>Ya.shiftTable[t])}function Mg(i){const e=i>>10;return Ya.uint32View[0]=Ya.mantissaTable[Ya.offsetTable[e]+(i&1023)]+Ya.exponentTable[e],Ya.floatView[0]}const oi=new V,Eg=new Le;let a8=0;class Wi{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:a8++}),this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=n,this.usage=Hy,this.updateRanges=[],this.gpuType=Jn,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let r=0,s=this.itemSize;r<s;r++)this.array[e+r]=t.array[n+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,n=this.count;t<n;t++)Eg.fromBufferAttribute(this,t),Eg.applyMatrix3(e),this.setXY(t,Eg.x,Eg.y);else if(this.itemSize===3)for(let t=0,n=this.count;t<n;t++)oi.fromBufferAttribute(this,t),oi.applyMatrix3(e),this.setXYZ(t,oi.x,oi.y,oi.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)oi.fromBufferAttribute(this,t),oi.applyMatrix4(e),this.setXYZ(t,oi.x,oi.y,oi.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)oi.fromBufferAttribute(this,t),oi.applyNormalMatrix(e),this.setXYZ(t,oi.x,oi.y,oi.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)oi.fromBufferAttribute(this,t),oi.transformDirection(e),this.setXYZ(t,oi.x,oi.y,oi.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=mr(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=Bt(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=mr(t,this.array)),t}setX(e,t){return this.normalized&&(t=Bt(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=mr(t,this.array)),t}setY(e,t){return this.normalized&&(t=Bt(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=mr(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Bt(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=mr(t,this.array)),t}setW(e,t){return this.normalized&&(t=Bt(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=Bt(t,this.array),n=Bt(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,r){return e*=this.itemSize,this.normalized&&(t=Bt(t,this.array),n=Bt(n,this.array),r=Bt(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this}setXYZW(e,t,n,r,s){return e*=this.itemSize,this.normalized&&(t=Bt(t,this.array),n=Bt(n,this.array),r=Bt(r,this.array),s=Bt(s,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==Hy&&(e.usage=this.usage),e}}class jM extends Wi{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class qM extends Wi{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class iO extends Wi{constructor(e,t,n){super(new Uint16Array(e),t,n),this.isFloat16BufferAttribute=!0}getX(e){let t=Mg(this.array[e*this.itemSize]);return this.normalized&&(t=mr(t,this.array)),t}setX(e,t){return this.normalized&&(t=Bt(t,this.array)),this.array[e*this.itemSize]=Xr(t),this}getY(e){let t=Mg(this.array[e*this.itemSize+1]);return this.normalized&&(t=mr(t,this.array)),t}setY(e,t){return this.normalized&&(t=Bt(t,this.array)),this.array[e*this.itemSize+1]=Xr(t),this}getZ(e){let t=Mg(this.array[e*this.itemSize+2]);return this.normalized&&(t=mr(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Bt(t,this.array)),this.array[e*this.itemSize+2]=Xr(t),this}getW(e){let t=Mg(this.array[e*this.itemSize+3]);return this.normalized&&(t=mr(t,this.array)),t}setW(e,t){return this.normalized&&(t=Bt(t,this.array)),this.array[e*this.itemSize+3]=Xr(t),this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=Bt(t,this.array),n=Bt(n,this.array)),this.array[e+0]=Xr(t),this.array[e+1]=Xr(n),this}setXYZ(e,t,n,r){return e*=this.itemSize,this.normalized&&(t=Bt(t,this.array),n=Bt(n,this.array),r=Bt(r,this.array)),this.array[e+0]=Xr(t),this.array[e+1]=Xr(n),this.array[e+2]=Xr(r),this}setXYZW(e,t,n,r,s){return e*=this.itemSize,this.normalized&&(t=Bt(t,this.array),n=Bt(n,this.array),r=Bt(r,this.array),s=Bt(s,this.array)),this.array[e+0]=Xr(t),this.array[e+1]=Xr(n),this.array[e+2]=Xr(r),this.array[e+3]=Xr(s),this}}class ni extends Wi{constructor(e,t,n){super(new Float32Array(e),t,n)}}let o8=0;const ps=new Wt,zx=new ti,bc=new V,Yr=new Pu,Jf=new Pu,Pi=new V;class ar extends po{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:o8++}),this.uuid=ro(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(VM(e)?qM:jM)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const s=new Nt().getNormalMatrix(e);n.applyNormalMatrix(s),n.needsUpdate=!0}const r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return ps.makeRotationFromQuaternion(e),this.applyMatrix4(ps),this}rotateX(e){return ps.makeRotationX(e),this.applyMatrix4(ps),this}rotateY(e){return ps.makeRotationY(e),this.applyMatrix4(ps),this}rotateZ(e){return ps.makeRotationZ(e),this.applyMatrix4(ps),this}translate(e,t,n){return ps.makeTranslation(e,t,n),this.applyMatrix4(ps),this}scale(e,t,n){return ps.makeScale(e,t,n),this.applyMatrix4(ps),this}lookAt(e){return zx.lookAt(e),zx.updateMatrix(),this.applyMatrix4(zx.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(bc).negate(),this.translate(bc.x,bc.y,bc.z),this}setFromPoints(e){const t=this.getAttribute("position");if(t===void 0){const n=[];for(let r=0,s=e.length;r<s;r++){const a=e[r];n.push(a.x,a.y,a.z||0)}this.setAttribute("position",new ni(n,3))}else{const n=Math.min(e.length,t.count);for(let r=0;r<n;r++){const s=e[r];t.setXYZ(r,s.x,s.y,s.z||0)}e.length>t.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Pu);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new V(-1/0,-1/0,-1/0),new V(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,r=t.length;n<r;n++){const s=t[n];Yr.setFromBufferAttribute(s),this.morphTargetsRelative?(Pi.addVectors(this.boundingBox.min,Yr.min),this.boundingBox.expandByPoint(Pi),Pi.addVectors(this.boundingBox.max,Yr.max),this.boundingBox.expandByPoint(Pi)):(this.boundingBox.expandByPoint(Yr.min),this.boundingBox.expandByPoint(Yr.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Hp);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new V,1/0);return}if(e){const n=this.boundingSphere.center;if(Yr.setFromBufferAttribute(e),t)for(let s=0,a=t.length;s<a;s++){const l=t[s];Jf.setFromBufferAttribute(l),this.morphTargetsRelative?(Pi.addVectors(Yr.min,Jf.min),Yr.expandByPoint(Pi),Pi.addVectors(Yr.max,Jf.max),Yr.expandByPoint(Pi)):(Yr.expandByPoint(Jf.min),Yr.expandByPoint(Jf.max))}Yr.getCenter(n);let r=0;for(let s=0,a=e.count;s<a;s++)Pi.fromBufferAttribute(e,s),r=Math.max(r,n.distanceToSquared(Pi));if(t)for(let s=0,a=t.length;s<a;s++){const l=t[s],u=this.morphTargetsRelative;for(let h=0,d=l.count;h<d;h++)Pi.fromBufferAttribute(l,h),u&&(bc.fromBufferAttribute(e,h),Pi.add(bc)),r=Math.max(r,n.distanceToSquared(Pi))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=t.position,r=t.normal,s=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Wi(new Float32Array(4*n.count),4));const a=this.getAttribute("tangent"),l=[],u=[];for(let L=0;L<n.count;L++)l[L]=new V,u[L]=new V;const h=new V,d=new V,p=new V,g=new Le,y=new Le,v=new Le,S=new V,b=new V;function _(L,N,D){h.fromBufferAttribute(n,L),d.fromBufferAttribute(n,N),p.fromBufferAttribute(n,D),g.fromBufferAttribute(s,L),y.fromBufferAttribute(s,N),v.fromBufferAttribute(s,D),d.sub(h),p.sub(h),y.sub(g),v.sub(g);const I=1/(y.x*v.y-v.x*y.y);isFinite(I)&&(S.copy(d).multiplyScalar(v.y).addScaledVector(p,-y.y).multiplyScalar(I),b.copy(p).multiplyScalar(y.x).addScaledVector(d,-v.x).multiplyScalar(I),l[L].add(S),l[N].add(S),l[D].add(S),u[L].add(b),u[N].add(b),u[D].add(b))}let E=this.groups;E.length===0&&(E=[{start:0,count:e.count}]);for(let L=0,N=E.length;L<N;++L){const D=E[L],I=D.start,W=D.count;for(let Y=I,oe=I+W;Y<oe;Y+=3)_(e.getX(Y+0),e.getX(Y+1),e.getX(Y+2))}const M=new V,A=new V,w=new V,R=new V;function C(L){w.fromBufferAttribute(r,L),R.copy(w);const N=l[L];M.copy(N),M.sub(w.multiplyScalar(w.dot(N))).normalize(),A.crossVectors(R,N);const I=A.dot(u[L])<0?-1:1;a.setXYZW(L,M.x,M.y,M.z,I)}for(let L=0,N=E.length;L<N;++L){const D=E[L],I=D.start,W=D.count;for(let Y=I,oe=I+W;Y<oe;Y+=3)C(e.getX(Y+0)),C(e.getX(Y+1)),C(e.getX(Y+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new Wi(new Float32Array(t.count*3),3),this.setAttribute("normal",n);else for(let g=0,y=n.count;g<y;g++)n.setXYZ(g,0,0,0);const r=new V,s=new V,a=new V,l=new V,u=new V,h=new V,d=new V,p=new V;if(e)for(let g=0,y=e.count;g<y;g+=3){const v=e.getX(g+0),S=e.getX(g+1),b=e.getX(g+2);r.fromBufferAttribute(t,v),s.fromBufferAttribute(t,S),a.fromBufferAttribute(t,b),d.subVectors(a,s),p.subVectors(r,s),d.cross(p),l.fromBufferAttribute(n,v),u.fromBufferAttribute(n,S),h.fromBufferAttribute(n,b),l.add(d),u.add(d),h.add(d),n.setXYZ(v,l.x,l.y,l.z),n.setXYZ(S,u.x,u.y,u.z),n.setXYZ(b,h.x,h.y,h.z)}else for(let g=0,y=t.count;g<y;g+=3)r.fromBufferAttribute(t,g+0),s.fromBufferAttribute(t,g+1),a.fromBufferAttribute(t,g+2),d.subVectors(a,s),p.subVectors(r,s),d.cross(p),n.setXYZ(g+0,d.x,d.y,d.z),n.setXYZ(g+1,d.x,d.y,d.z),n.setXYZ(g+2,d.x,d.y,d.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)Pi.fromBufferAttribute(e,t),Pi.normalize(),e.setXYZ(t,Pi.x,Pi.y,Pi.z)}toNonIndexed(){function e(l,u){const h=l.array,d=l.itemSize,p=l.normalized,g=new h.constructor(u.length*d);let y=0,v=0;for(let S=0,b=u.length;S<b;S++){l.isInterleavedBufferAttribute?y=u[S]*l.data.stride+l.offset:y=u[S]*d;for(let _=0;_<d;_++)g[v++]=h[y++]}return new Wi(g,d,p)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new ar,n=this.index.array,r=this.attributes;for(const l in r){const u=r[l],h=e(u,n);t.setAttribute(l,h)}const s=this.morphAttributes;for(const l in s){const u=[],h=s[l];for(let d=0,p=h.length;d<p;d++){const g=h[d],y=e(g,n);u.push(y)}t.morphAttributes[l]=u}t.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let l=0,u=a.length;l<u;l++){const h=a[l];t.addGroup(h.start,h.count,h.materialIndex)}return t}toJSON(){const e={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const u=this.parameters;for(const h in u)u[h]!==void 0&&(e[h]=u[h]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const u in n){const h=n[u];e.data.attributes[u]=h.toJSON(e.data)}const r={};let s=!1;for(const u in this.morphAttributes){const h=this.morphAttributes[u],d=[];for(let p=0,g=h.length;p<g;p++){const y=h[p];d.push(y.toJSON(e.data))}d.length>0&&(r[u]=d,s=!0)}s&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));const l=this.boundingSphere;return l!==null&&(e.data.boundingSphere=l.toJSON()),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone());const r=e.attributes;for(const h in r){const d=r[h];this.setAttribute(h,d.clone(t))}const s=e.morphAttributes;for(const h in s){const d=[],p=s[h];for(let g=0,y=p.length;g<y;g++)d.push(p[g].clone(t));this.morphAttributes[h]=d}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups;for(let h=0,d=a.length;h<d;h++){const p=a[h];this.addGroup(p.start,p.count,p.materialIndex)}const l=e.boundingBox;l!==null&&(this.boundingBox=l.clone());const u=e.boundingSphere;return u!==null&&(this.boundingSphere=u.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const vN=new Wt,jl=new Mv,Ag=new Hp,_N=new V,wg=new V,Rg=new V,Cg=new V,Vx=new V,Ng=new V,xN=new V,Pg=new V;class fi extends ti{constructor(e=new ar,t=new na){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const r=t[n[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=r.length;s<a;s++){const l=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[l]=s}}}}getVertexPosition(e,t){const n=this.geometry,r=n.attributes.position,s=n.morphAttributes.position,a=n.morphTargetsRelative;t.fromBufferAttribute(r,e);const l=this.morphTargetInfluences;if(s&&l){Ng.set(0,0,0);for(let u=0,h=s.length;u<h;u++){const d=l[u],p=s[u];d!==0&&(Vx.fromBufferAttribute(p,e),a?Ng.addScaledVector(Vx,d):Ng.addScaledVector(Vx.sub(t),d))}t.add(Ng)}return t}raycast(e,t){const n=this.geometry,r=this.material,s=this.matrixWorld;r!==void 0&&(n.boundingSphere===null&&n.computeBoundingSphere(),Ag.copy(n.boundingSphere),Ag.applyMatrix4(s),jl.copy(e.ray).recast(e.near),!(Ag.containsPoint(jl.origin)===!1&&(jl.intersectSphere(Ag,_N)===null||jl.origin.distanceToSquared(_N)>(e.far-e.near)**2))&&(vN.copy(s).invert(),jl.copy(e.ray).applyMatrix4(vN),!(n.boundingBox!==null&&jl.intersectsBox(n.boundingBox)===!1)&&this._computeIntersections(e,t,jl)))}_computeIntersections(e,t,n){let r;const s=this.geometry,a=this.material,l=s.index,u=s.attributes.position,h=s.attributes.uv,d=s.attributes.uv1,p=s.attributes.normal,g=s.groups,y=s.drawRange;if(l!==null)if(Array.isArray(a))for(let v=0,S=g.length;v<S;v++){const b=g[v],_=a[b.materialIndex],E=Math.max(b.start,y.start),M=Math.min(l.count,Math.min(b.start+b.count,y.start+y.count));for(let A=E,w=M;A<w;A+=3){const R=l.getX(A),C=l.getX(A+1),L=l.getX(A+2);r=Dg(this,_,e,n,h,d,p,R,C,L),r&&(r.faceIndex=Math.floor(A/3),r.face.materialIndex=b.materialIndex,t.push(r))}}else{const v=Math.max(0,y.start),S=Math.min(l.count,y.start+y.count);for(let b=v,_=S;b<_;b+=3){const E=l.getX(b),M=l.getX(b+1),A=l.getX(b+2);r=Dg(this,a,e,n,h,d,p,E,M,A),r&&(r.faceIndex=Math.floor(b/3),t.push(r))}}else if(u!==void 0)if(Array.isArray(a))for(let v=0,S=g.length;v<S;v++){const b=g[v],_=a[b.materialIndex],E=Math.max(b.start,y.start),M=Math.min(u.count,Math.min(b.start+b.count,y.start+y.count));for(let A=E,w=M;A<w;A+=3){const R=A,C=A+1,L=A+2;r=Dg(this,_,e,n,h,d,p,R,C,L),r&&(r.faceIndex=Math.floor(A/3),r.face.materialIndex=b.materialIndex,t.push(r))}}else{const v=Math.max(0,y.start),S=Math.min(u.count,y.start+y.count);for(let b=v,_=S;b<_;b+=3){const E=b,M=b+1,A=b+2;r=Dg(this,a,e,n,h,d,p,E,M,A),r&&(r.faceIndex=Math.floor(b/3),t.push(r))}}}}function l8(i,e,t,n,r,s,a,l){let u;if(e.side===An?u=n.intersectTriangle(a,s,r,!0,l):u=n.intersectTriangle(r,s,a,e.side===Lr,l),u===null)return null;Pg.copy(l),Pg.applyMatrix4(i.matrixWorld);const h=t.ray.origin.distanceTo(Pg);return h<t.near||h>t.far?null:{distance:h,point:Pg.clone(),object:i}}function Dg(i,e,t,n,r,s,a,l,u,h){i.getVertexPosition(l,wg),i.getVertexPosition(u,Rg),i.getVertexPosition(h,Cg);const d=l8(i,e,t,n,wg,Rg,Cg,xN);if(d){const p=new V;vs.getBarycoord(xN,wg,Rg,Cg,p),r&&(d.uv=vs.getInterpolatedAttribute(r,l,u,h,p,new Le)),s&&(d.uv1=vs.getInterpolatedAttribute(s,l,u,h,p,new Le)),a&&(d.normal=vs.getInterpolatedAttribute(a,l,u,h,p,new V),d.normal.dot(n.direction)>0&&d.normal.multiplyScalar(-1));const g={a:l,b:u,c:h,normal:new V,materialIndex:0};vs.getNormal(wg,Rg,Cg,g.normal),d.face=g,d.barycoord=p}return d}class Du extends ar{constructor(e=1,t=1,n=1,r=1,s=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:s,depthSegments:a};const l=this;r=Math.floor(r),s=Math.floor(s),a=Math.floor(a);const u=[],h=[],d=[],p=[];let g=0,y=0;v("z","y","x",-1,-1,n,t,e,a,s,0),v("z","y","x",1,-1,n,t,-e,a,s,1),v("x","z","y",1,1,e,n,t,r,a,2),v("x","z","y",1,-1,e,n,-t,r,a,3),v("x","y","z",1,-1,e,t,n,r,s,4),v("x","y","z",-1,-1,e,t,-n,r,s,5),this.setIndex(u),this.setAttribute("position",new ni(h,3)),this.setAttribute("normal",new ni(d,3)),this.setAttribute("uv",new ni(p,2));function v(S,b,_,E,M,A,w,R,C,L,N){const D=A/C,I=w/L,W=A/2,Y=w/2,oe=R/2,le=C+1,z=L+1;let k=0,G=0;const he=new V;for(let F=0;F<z;F++){const se=F*I-Y;for(let Me=0;Me<le;Me++){const De=Me*D-W;he[S]=De*E,he[b]=se*M,he[_]=oe,h.push(he.x,he.y,he.z),he[S]=0,he[b]=0,he[_]=R>0?1:-1,d.push(he.x,he.y,he.z),p.push(Me/C),p.push(1-F/L),k+=1}}for(let F=0;F<L;F++)for(let se=0;se<C;se++){const Me=g+se+le*F,De=g+se+le*(F+1),j=g+(se+1)+le*(F+1),Z=g+(se+1)+le*F;u.push(Me,De,Z),u.push(De,j,Z),G+=6}l.addGroup(y,G,N),y+=G,g+=k}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Du(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Nh(i){const e={};for(const t in i){e[t]={};for(const n in i[t]){const r=i[t][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][n]=null):e[t][n]=r.clone():Array.isArray(r)?e[t][n]=r.slice():e[t][n]=r}}return e}function ur(i){const e={};for(let t=0;t<i.length;t++){const n=Nh(i[t]);for(const r in n)e[r]=n[r]}return e}function u8(i){const e=[];for(let t=0;t<i.length;t++)e.push(i[t].clone());return e}function rO(i){const e=i.getRenderTarget();return e===null?i.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:wt.workingColorSpace}const sO={clone:Nh,merge:ur};var c8=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,h8=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class da extends rr{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=c8,this.fragmentShader=h8,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Nh(e.uniforms),this.uniformsGroups=u8(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const a=this.uniforms[r].value;a&&a.isTexture?t.uniforms[r]={type:"t",value:a.toJSON(e).uuid}:a&&a.isColor?t.uniforms[r]={type:"c",value:a.getHex()}:a&&a.isVector2?t.uniforms[r]={type:"v2",value:a.toArray()}:a&&a.isVector3?t.uniforms[r]={type:"v3",value:a.toArray()}:a&&a.isVector4?t.uniforms[r]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?t.uniforms[r]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?t.uniforms[r]={type:"m4",value:a.toArray()}:t.uniforms[r]={value:a}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const r in this.extensions)this.extensions[r]===!0&&(n[r]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class $M extends ti{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Wt,this.projectionMatrix=new Wt,this.projectionMatrixInverse=new Wt,this.coordinateSystem=vr}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const Yo=new V,bN=new Le,SN=new Le;class Ui extends $M{constructor(e=50,t=1,n=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=Eu*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Vd*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return Eu*2*Math.atan(Math.tan(Vd*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,n){Yo.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(Yo.x,Yo.y).multiplyScalar(-e/Yo.z),Yo.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(Yo.x,Yo.y).multiplyScalar(-e/Yo.z)}getViewSize(e,t){return this.getViewBounds(e,bN,SN),t.subVectors(SN,bN)}setViewOffset(e,t,n,r,s,a){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(Vd*.5*this.fov)/this.zoom,n=2*t,r=this.aspect*n,s=-.5*r;const a=this.view;if(this.view!==null&&this.view.enabled){const u=a.fullWidth,h=a.fullHeight;s+=a.offsetX*r/u,t-=a.offsetY*n/h,r*=a.width/u,n*=a.height/h}const l=this.filmOffset;l!==0&&(s+=e*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+r,t,t-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const Sc=-90,Tc=1;class aO extends ti{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const r=new Ui(Sc,Tc,e,t);r.layers=this.layers,this.add(r);const s=new Ui(Sc,Tc,e,t);s.layers=this.layers,this.add(s);const a=new Ui(Sc,Tc,e,t);a.layers=this.layers,this.add(a);const l=new Ui(Sc,Tc,e,t);l.layers=this.layers,this.add(l);const u=new Ui(Sc,Tc,e,t);u.layers=this.layers,this.add(u);const h=new Ui(Sc,Tc,e,t);h.layers=this.layers,this.add(h)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,r,s,a,l,u]=t;for(const h of t)this.remove(h);if(e===vr)n.up.set(0,1,0),n.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),l.up.set(0,1,0),l.lookAt(0,0,1),u.up.set(0,1,0),u.lookAt(0,0,-1);else if(e===fl)n.up.set(0,-1,0),n.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),l.up.set(0,-1,0),l.lookAt(0,0,1),u.up.set(0,-1,0),u.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const h of t)this.add(h),h.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:r}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,a,l,u,h,d]=this.children,p=e.getRenderTarget(),g=e.getActiveCubeFace(),y=e.getActiveMipmapLevel(),v=e.xr.enabled;e.xr.enabled=!1;const S=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,r),e.render(t,s),e.setRenderTarget(n,1,r),e.render(t,a),e.setRenderTarget(n,2,r),e.render(t,l),e.setRenderTarget(n,3,r),e.render(t,u),e.setRenderTarget(n,4,r),e.render(t,h),n.texture.generateMipmaps=S,e.setRenderTarget(n,5,r),e.render(t,d),e.setRenderTarget(p,g,y),e.xr.enabled=v,n.texture.needsPMREMUpdate=!0}}class Wp extends ei{constructor(e=[],t=ha,n,r,s,a,l,u,h,d){super(e,t,n,r,s,a,l,u,h,d),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class oO extends dl{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},r=[n,n,n,n,n,n];this.texture=new Wp(r),this._setTextureOptions(t),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new Du(5,5,5),s=new da({name:"CubemapFromEquirect",uniforms:Nh(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:An,blending:Ur});s.uniforms.tEquirect.value=t;const a=new fi(r,s),l=t.minFilter;return t.minFilter===Nr&&(t.minFilter=Ti),new aO(1,10,this).update(e,a),t.minFilter=l,a.geometry.dispose(),a.material.dispose(),this}clear(e,t=!0,n=!0,r=!0){const s=e.getRenderTarget();for(let a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(t,n,r);e.setRenderTarget(s)}}let jc=class extends ti{constructor(){super(),this.isGroup=!0,this.type="Group"}};const f8={type:"move"};class Ey{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new jc,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new jc,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new V,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new V),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new jc,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new V,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new V),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,n){let r=null,s=null,a=null;const l=this._targetRay,u=this._grip,h=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(h&&e.hand){a=!0;for(const S of e.hand.values()){const b=t.getJointPose(S,n),_=this._getHandJoint(h,S);b!==null&&(_.matrix.fromArray(b.transform.matrix),_.matrix.decompose(_.position,_.rotation,_.scale),_.matrixWorldNeedsUpdate=!0,_.jointRadius=b.radius),_.visible=b!==null}const d=h.joints["index-finger-tip"],p=h.joints["thumb-tip"],g=d.position.distanceTo(p.position),y=.02,v=.005;h.inputState.pinching&&g>y+v?(h.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!h.inputState.pinching&&g<=y-v&&(h.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else u!==null&&e.gripSpace&&(s=t.getPose(e.gripSpace,n),s!==null&&(u.matrix.fromArray(s.transform.matrix),u.matrix.decompose(u.position,u.rotation,u.scale),u.matrixWorldNeedsUpdate=!0,s.linearVelocity?(u.hasLinearVelocity=!0,u.linearVelocity.copy(s.linearVelocity)):u.hasLinearVelocity=!1,s.angularVelocity?(u.hasAngularVelocity=!0,u.angularVelocity.copy(s.angularVelocity)):u.hasAngularVelocity=!1));l!==null&&(r=t.getPose(e.targetRaySpace,n),r===null&&s!==null&&(r=s),r!==null&&(l.matrix.fromArray(r.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,r.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(r.linearVelocity)):l.hasLinearVelocity=!1,r.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(r.angularVelocity)):l.hasAngularVelocity=!1,this.dispatchEvent(f8)))}return l!==null&&(l.visible=r!==null),u!==null&&(u.visible=s!==null),h!==null&&(h.visible=a!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const n=new jc;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class Ev extends ti{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Br,this.environmentIntensity=1,this.environmentRotation=new Br,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class XM{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=Hy,this.updateRanges=[],this.version=0,this.uuid=ro()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let r=0,s=this.stride;r<s;r++)this.array[e+r]=t.array[n+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=ro()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=ro()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const lr=new V;class Mp{constructor(e,t,n,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)lr.fromBufferAttribute(this,t),lr.applyMatrix4(e),this.setXYZ(t,lr.x,lr.y,lr.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)lr.fromBufferAttribute(this,t),lr.applyNormalMatrix(e),this.setXYZ(t,lr.x,lr.y,lr.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)lr.fromBufferAttribute(this,t),lr.transformDirection(e),this.setXYZ(t,lr.x,lr.y,lr.z);return this}getComponent(e,t){let n=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(n=mr(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=Bt(n,this.array)),this.data.array[e*this.data.stride+this.offset+t]=n,this}setX(e,t){return this.normalized&&(t=Bt(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=Bt(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=Bt(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=Bt(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=mr(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=mr(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=mr(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=mr(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=Bt(t,this.array),n=Bt(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=Bt(t,this.array),n=Bt(n,this.array),r=Bt(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this}setXYZW(e,t,n,r,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=Bt(t,this.array),n=Bt(n,this.array),r=Bt(r,this.array),s=Bt(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=s,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const r=n*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[r+s])}return new Wi(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Mp(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const r=n*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[r+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class YM extends rr{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new ot(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let Mc;const ed=new V,Ec=new V,Ac=new V,wc=new Le,td=new Le,lO=new Wt,Lg=new V,nd=new V,Ug=new V,TN=new Le,Gx=new Le,MN=new Le;class d8 extends ti{constructor(e=new YM){if(super(),this.isSprite=!0,this.type="Sprite",Mc===void 0){Mc=new ar;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),n=new XM(t,5);Mc.setIndex([0,1,2,0,2,3]),Mc.setAttribute("position",new Mp(n,3,0,!1)),Mc.setAttribute("uv",new Mp(n,2,3,!1))}this.geometry=Mc,this.material=e,this.center=new Le(.5,.5),this.count=1}raycast(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Ec.setFromMatrixScale(this.matrixWorld),lO.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Ac.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Ec.multiplyScalar(-Ac.z);const n=this.material.rotation;let r,s;n!==0&&(s=Math.cos(n),r=Math.sin(n));const a=this.center;Og(Lg.set(-.5,-.5,0),Ac,a,Ec,r,s),Og(nd.set(.5,-.5,0),Ac,a,Ec,r,s),Og(Ug.set(.5,.5,0),Ac,a,Ec,r,s),TN.set(0,0),Gx.set(1,0),MN.set(1,1);let l=e.ray.intersectTriangle(Lg,nd,Ug,!1,ed);if(l===null&&(Og(nd.set(-.5,.5,0),Ac,a,Ec,r,s),Gx.set(0,1),l=e.ray.intersectTriangle(Lg,Ug,nd,!1,ed),l===null))return;const u=e.ray.origin.distanceTo(ed);u<e.near||u>e.far||t.push({distance:u,point:ed.clone(),uv:vs.getInterpolation(ed,Lg,nd,Ug,TN,Gx,MN,new Le),face:null,object:this})}copy(e,t){return super.copy(e,t),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function Og(i,e,t,n,r,s){wc.subVectors(i,t).addScalar(.5).multiply(n),r!==void 0?(td.x=s*wc.x-r*wc.y,td.y=r*wc.x+s*wc.y):td.copy(wc),i.copy(e),i.x+=td.x,i.y+=td.y,i.applyMatrix4(lO)}class p8 extends ei{constructor(e=null,t=1,n=1,r,s,a,l,u,h=Pn,d=Pn,p,g){super(null,a,l,u,h,d,r,s,p,g),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class m8 extends Wi{constructor(e,t,n,r=1){super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Hx=new V,g8=new V,y8=new Nt;class Bs{constructor(e=new V(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const r=Hx.subVectors(n,t).cross(g8.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(Hx),r=this.normal.dot(n);if(r===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/r;return s<0||s>1?null:t.copy(e.start).addScaledVector(n,s)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||y8.getNormalMatrix(e),r=this.coplanarPoint(Hx).applyMatrix4(e),s=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const ql=new Hp,Bg=new V;class jp{constructor(e=new Bs,t=new Bs,n=new Bs,r=new Bs,s=new Bs,a=new Bs){this.planes=[e,t,n,r,s,a]}set(e,t,n,r,s,a){const l=this.planes;return l[0].copy(e),l[1].copy(t),l[2].copy(n),l[3].copy(r),l[4].copy(s),l[5].copy(a),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,t=vr){const n=this.planes,r=e.elements,s=r[0],a=r[1],l=r[2],u=r[3],h=r[4],d=r[5],p=r[6],g=r[7],y=r[8],v=r[9],S=r[10],b=r[11],_=r[12],E=r[13],M=r[14],A=r[15];if(n[0].setComponents(u-s,g-h,b-y,A-_).normalize(),n[1].setComponents(u+s,g+h,b+y,A+_).normalize(),n[2].setComponents(u+a,g+d,b+v,A+E).normalize(),n[3].setComponents(u-a,g-d,b-v,A-E).normalize(),n[4].setComponents(u-l,g-p,b-S,A-M).normalize(),t===vr)n[5].setComponents(u+l,g+p,b+S,A+M).normalize();else if(t===fl)n[5].setComponents(l,p,S,M).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),ql.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),ql.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(ql)}intersectsSprite(e){return ql.center.set(0,0,0),ql.radius=.7071067811865476,ql.applyMatrix4(e.matrixWorld),this.intersectsSphere(ql)}intersectsSphere(e){const t=this.planes,n=e.center,r=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(n)<r)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const r=t[n];if(Bg.x=r.normal.x>0?e.max.x:e.min.x,Bg.y=r.normal.y>0?e.max.y:e.min.y,Bg.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(Bg)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}const Ks=new Wt,Zs=new jp;class KM{constructor(){this.coordinateSystem=vr}intersectsObject(e,t){if(!t.isArrayCamera||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const r=t.cameras[n];if(Ks.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),Zs.setFromProjectionMatrix(Ks,this.coordinateSystem),Zs.intersectsObject(e))return!0}return!1}intersectsSprite(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const r=t.cameras[n];if(Ks.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),Zs.setFromProjectionMatrix(Ks,this.coordinateSystem),Zs.intersectsSprite(e))return!0}return!1}intersectsSphere(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const r=t.cameras[n];if(Ks.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),Zs.setFromProjectionMatrix(Ks,this.coordinateSystem),Zs.intersectsSphere(e))return!0}return!1}intersectsBox(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const r=t.cameras[n];if(Ks.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),Zs.setFromProjectionMatrix(Ks,this.coordinateSystem),Zs.intersectsBox(e))return!0}return!1}containsPoint(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const r=t.cameras[n];if(Ks.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),Zs.setFromProjectionMatrix(Ks,this.coordinateSystem),Zs.containsPoint(e))return!0}return!1}clone(){return new KM}}class Av extends rr{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new ot(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const jy=new V,qy=new V,EN=new Wt,id=new Mv,Ig=new Hp,Wx=new V,AN=new V;class v8 extends ti{constructor(e=new ar,t=new Av){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[0];for(let r=1,s=t.count;r<s;r++)jy.fromBufferAttribute(t,r-1),qy.fromBufferAttribute(t,r),n[r]=n[r-1],n[r]+=jy.distanceTo(qy);e.setAttribute("lineDistance",new ni(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,s=e.params.Line.threshold,a=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),Ig.copy(n.boundingSphere),Ig.applyMatrix4(r),Ig.radius+=s,e.ray.intersectsSphere(Ig)===!1)return;EN.copy(r).invert(),id.copy(e.ray).applyMatrix4(EN);const l=s/((this.scale.x+this.scale.y+this.scale.z)/3),u=l*l,h=this.isLineSegments?2:1,d=n.index,g=n.attributes.position;if(d!==null){const y=Math.max(0,a.start),v=Math.min(d.count,a.start+a.count);for(let S=y,b=v-1;S<b;S+=h){const _=d.getX(S),E=d.getX(S+1),M=Fg(this,e,id,u,_,E,S);M&&t.push(M)}if(this.isLineLoop){const S=d.getX(v-1),b=d.getX(y),_=Fg(this,e,id,u,S,b,v-1);_&&t.push(_)}}else{const y=Math.max(0,a.start),v=Math.min(g.count,a.start+a.count);for(let S=y,b=v-1;S<b;S+=h){const _=Fg(this,e,id,u,S,S+1,S);_&&t.push(_)}if(this.isLineLoop){const S=Fg(this,e,id,u,v-1,y,v-1);S&&t.push(S)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const r=t[n[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=r.length;s<a;s++){const l=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[l]=s}}}}}function Fg(i,e,t,n,r,s,a){const l=i.geometry.attributes.position;if(jy.fromBufferAttribute(l,r),qy.fromBufferAttribute(l,s),t.distanceSqToSegment(jy,qy,Wx,AN)>n)return;Wx.applyMatrix4(i.matrixWorld);const h=e.ray.origin.distanceTo(Wx);if(!(h<e.near||h>e.far))return{distance:h,point:AN.clone().applyMatrix4(i.matrixWorld),index:a,face:null,faceIndex:null,barycoord:null,object:i}}class _8 extends rr{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new ot(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}class x8 extends ei{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=Pn,this.minFilter=Pn,this.generateMipmaps=!1,this.needsUpdate=!0}}class b8 extends ei{constructor(e,t,n,r,s,a,l,u,h){super(e,t,n,r,s,a,l,u,h),this.isCanvasTexture=!0,this.needsUpdate=!0}}class bs extends ei{constructor(e,t,n=En,r,s,a,l=Pn,u=Pn,h,d=ns,p=1){if(d!==ns&&d!==is)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");const g={width:e,height:t,depth:p};super(g,r,s,a,l,u,d,n,h),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new GM(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}class qp extends ar{constructor(e=1,t=1,n=1,r=32,s=1,a=!1,l=0,u=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:s,openEnded:a,thetaStart:l,thetaLength:u};const h=this;r=Math.floor(r),s=Math.floor(s);const d=[],p=[],g=[],y=[];let v=0;const S=[],b=n/2;let _=0;E(),a===!1&&(e>0&&M(!0),t>0&&M(!1)),this.setIndex(d),this.setAttribute("position",new ni(p,3)),this.setAttribute("normal",new ni(g,3)),this.setAttribute("uv",new ni(y,2));function E(){const A=new V,w=new V;let R=0;const C=(t-e)/n;for(let L=0;L<=s;L++){const N=[],D=L/s,I=D*(t-e)+e;for(let W=0;W<=r;W++){const Y=W/r,oe=Y*u+l,le=Math.sin(oe),z=Math.cos(oe);w.x=I*le,w.y=-D*n+b,w.z=I*z,p.push(w.x,w.y,w.z),A.set(le,C,z).normalize(),g.push(A.x,A.y,A.z),y.push(Y,1-D),N.push(v++)}S.push(N)}for(let L=0;L<r;L++)for(let N=0;N<s;N++){const D=S[N][L],I=S[N+1][L],W=S[N+1][L+1],Y=S[N][L+1];(e>0||N!==0)&&(d.push(D,I,Y),R+=3),(t>0||N!==s-1)&&(d.push(I,W,Y),R+=3)}h.addGroup(_,R,0),_+=R}function M(A){const w=v,R=new Le,C=new V;let L=0;const N=A===!0?e:t,D=A===!0?1:-1;for(let W=1;W<=r;W++)p.push(0,b*D,0),g.push(0,D,0),y.push(.5,.5),v++;const I=v;for(let W=0;W<=r;W++){const oe=W/r*u+l,le=Math.cos(oe),z=Math.sin(oe);C.x=N*z,C.y=b*D,C.z=N*le,p.push(C.x,C.y,C.z),g.push(0,D,0),R.x=le*.5+.5,R.y=z*.5*D+.5,y.push(R.x,R.y),v++}for(let W=0;W<r;W++){const Y=w+W,oe=I+W;A===!0?d.push(oe,oe+1,Y):d.push(oe+1,oe,Y),L+=3}h.addGroup(_,L,A===!0?1:2),_+=L}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new qp(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class ZM extends qp{constructor(e=1,t=1,n=32,r=1,s=!1,a=0,l=Math.PI*2){super(0,e,t,n,r,s,a,l),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:r,openEnded:s,thetaStart:a,thetaLength:l}}static fromJSON(e){return new ZM(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class mo{constructor(){this.type="Curve",this.arcLengthDivisions=200,this.needsUpdate=!1,this.cacheArcLengths=null}getPoint(){console.warn("THREE.Curve: .getPoint() not implemented.")}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,r=this.getPoint(0),s=0;t.push(0);for(let a=1;a<=e;a++)n=this.getPoint(a/e),s+=n.distanceTo(r),t.push(s),r=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t=null){const n=this.getLengths();let r=0;const s=n.length;let a;t?a=t:a=e*n[s-1];let l=0,u=s-1,h;for(;l<=u;)if(r=Math.floor(l+(u-l)/2),h=n[r]-a,h<0)l=r+1;else if(h>0)u=r-1;else{u=r;break}if(r=u,n[r]===a)return r/(s-1);const d=n[r],g=n[r+1]-d,y=(a-d)/g;return(r+y)/(s-1)}getTangent(e,t){let r=e-1e-4,s=e+1e-4;r<0&&(r=0),s>1&&(s=1);const a=this.getPoint(r),l=this.getPoint(s),u=t||(a.isVector2?new Le:new V);return u.copy(l).sub(a).normalize(),u}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t=!1){const n=new V,r=[],s=[],a=[],l=new V,u=new Wt;for(let y=0;y<=e;y++){const v=y/e;r[y]=this.getTangentAt(v,new V)}s[0]=new V,a[0]=new V;let h=Number.MAX_VALUE;const d=Math.abs(r[0].x),p=Math.abs(r[0].y),g=Math.abs(r[0].z);d<=h&&(h=d,n.set(1,0,0)),p<=h&&(h=p,n.set(0,1,0)),g<=h&&n.set(0,0,1),l.crossVectors(r[0],n).normalize(),s[0].crossVectors(r[0],l),a[0].crossVectors(r[0],s[0]);for(let y=1;y<=e;y++){if(s[y]=s[y-1].clone(),a[y]=a[y-1].clone(),l.crossVectors(r[y-1],r[y]),l.length()>Number.EPSILON){l.normalize();const v=Math.acos(It(r[y-1].dot(r[y]),-1,1));s[y].applyMatrix4(u.makeRotationAxis(l,v))}a[y].crossVectors(r[y],s[y])}if(t===!0){let y=Math.acos(It(s[0].dot(s[e]),-1,1));y/=e,r[0].dot(l.crossVectors(s[0],s[e]))>0&&(y=-y);for(let v=1;v<=e;v++)s[v].applyMatrix4(u.makeRotationAxis(r[v],y*v)),a[v].crossVectors(r[v],s[v])}return{tangents:r,normals:s,binormals:a}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.7,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class uO extends mo{constructor(e=0,t=0,n=1,r=1,s=0,a=Math.PI*2,l=!1,u=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=r,this.aStartAngle=s,this.aEndAngle=a,this.aClockwise=l,this.aRotation=u}getPoint(e,t=new Le){const n=t,r=Math.PI*2;let s=this.aEndAngle-this.aStartAngle;const a=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=r;for(;s>r;)s-=r;s<Number.EPSILON&&(a?s=0:s=r),this.aClockwise===!0&&!a&&(s===r?s=-r:s=s-r);const l=this.aStartAngle+e*s;let u=this.aX+this.xRadius*Math.cos(l),h=this.aY+this.yRadius*Math.sin(l);if(this.aRotation!==0){const d=Math.cos(this.aRotation),p=Math.sin(this.aRotation),g=u-this.aX,y=h-this.aY;u=g*d-y*p+this.aX,h=g*p+y*d+this.aY}return n.set(u,h)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class S8 extends uO{constructor(e,t,n,r,s,a){super(e,t,n,n,r,s,a),this.isArcCurve=!0,this.type="ArcCurve"}}function QM(){let i=0,e=0,t=0,n=0;function r(s,a,l,u){i=s,e=l,t=-3*s+3*a-2*l-u,n=2*s-2*a+l+u}return{initCatmullRom:function(s,a,l,u,h){r(a,l,h*(l-s),h*(u-a))},initNonuniformCatmullRom:function(s,a,l,u,h,d,p){let g=(a-s)/h-(l-s)/(h+d)+(l-a)/d,y=(l-a)/d-(u-a)/(d+p)+(u-l)/p;g*=d,y*=d,r(a,l,g,y)},calc:function(s){const a=s*s,l=a*s;return i+e*s+t*a+n*l}}}const kg=new V,jx=new QM,qx=new QM,$x=new QM;class T8 extends mo{constructor(e=[],t=!1,n="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=r}getPoint(e,t=new V){const n=t,r=this.points,s=r.length,a=(s-(this.closed?0:1))*e;let l=Math.floor(a),u=a-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/s)+1)*s:u===0&&l===s-1&&(l=s-2,u=1);let h,d;this.closed||l>0?h=r[(l-1)%s]:(kg.subVectors(r[0],r[1]).add(r[0]),h=kg);const p=r[l%s],g=r[(l+1)%s];if(this.closed||l+2<s?d=r[(l+2)%s]:(kg.subVectors(r[s-1],r[s-2]).add(r[s-1]),d=kg),this.curveType==="centripetal"||this.curveType==="chordal"){const y=this.curveType==="chordal"?.5:.25;let v=Math.pow(h.distanceToSquared(p),y),S=Math.pow(p.distanceToSquared(g),y),b=Math.pow(g.distanceToSquared(d),y);S<1e-4&&(S=1),v<1e-4&&(v=S),b<1e-4&&(b=S),jx.initNonuniformCatmullRom(h.x,p.x,g.x,d.x,v,S,b),qx.initNonuniformCatmullRom(h.y,p.y,g.y,d.y,v,S,b),$x.initNonuniformCatmullRom(h.z,p.z,g.z,d.z,v,S,b)}else this.curveType==="catmullrom"&&(jx.initCatmullRom(h.x,p.x,g.x,d.x,this.tension),qx.initCatmullRom(h.y,p.y,g.y,d.y,this.tension),$x.initCatmullRom(h.z,p.z,g.z,d.z,this.tension));return n.set(jx.calc(u),qx.calc(u),$x.calc(u)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const r=e.points[t];this.points.push(new V().fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function wN(i,e,t,n,r){const s=(n-e)*.5,a=(r-t)*.5,l=i*i,u=i*l;return(2*t-2*n+s+a)*u+(-3*t+3*n-2*s-a)*l+s*i+t}function M8(i,e){const t=1-i;return t*t*e}function E8(i,e){return 2*(1-i)*i*e}function A8(i,e){return i*i*e}function Hd(i,e,t,n){return M8(i,e)+E8(i,t)+A8(i,n)}function w8(i,e){const t=1-i;return t*t*t*e}function R8(i,e){const t=1-i;return 3*t*t*i*e}function C8(i,e){return 3*(1-i)*i*i*e}function N8(i,e){return i*i*i*e}function Wd(i,e,t,n,r){return w8(i,e)+R8(i,t)+C8(i,n)+N8(i,r)}class P8 extends mo{constructor(e=new Le,t=new Le,n=new Le,r=new Le){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e,t=new Le){const n=t,r=this.v0,s=this.v1,a=this.v2,l=this.v3;return n.set(Wd(e,r.x,s.x,a.x,l.x),Wd(e,r.y,s.y,a.y,l.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class cO extends mo{constructor(e=new V,t=new V,n=new V,r=new V){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e,t=new V){const n=t,r=this.v0,s=this.v1,a=this.v2,l=this.v3;return n.set(Wd(e,r.x,s.x,a.x,l.x),Wd(e,r.y,s.y,a.y,l.y),Wd(e,r.z,s.z,a.z,l.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class D8 extends mo{constructor(e=new Le,t=new Le){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new Le){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new Le){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class L8 extends mo{constructor(e=new V,t=new V){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new V){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new V){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class U8 extends mo{constructor(e=new Le,t=new Le,n=new Le){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new Le){const n=t,r=this.v0,s=this.v1,a=this.v2;return n.set(Hd(e,r.x,s.x,a.x),Hd(e,r.y,s.y,a.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class JM extends mo{constructor(e=new V,t=new V,n=new V){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new V){const n=t,r=this.v0,s=this.v1,a=this.v2;return n.set(Hd(e,r.x,s.x,a.x),Hd(e,r.y,s.y,a.y),Hd(e,r.z,s.z,a.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class O8 extends mo{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new Le){const n=t,r=this.points,s=(r.length-1)*e,a=Math.floor(s),l=s-a,u=r[a===0?a:a-1],h=r[a],d=r[a>r.length-2?r.length-1:a+1],p=r[a>r.length-3?r.length-1:a+2];return n.set(wN(l,u.x,h.x,d.x,p.x),wN(l,u.y,h.y,d.y,p.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const r=e.points[t];this.points.push(r.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const r=this.points[t];e.points.push(r.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const r=e.points[t];this.points.push(new Le().fromArray(r))}return this}}var B8=Object.freeze({__proto__:null,ArcCurve:S8,CatmullRomCurve3:T8,CubicBezierCurve:P8,CubicBezierCurve3:cO,EllipseCurve:uO,LineCurve:D8,LineCurve3:L8,QuadraticBezierCurve:U8,QuadraticBezierCurve3:JM,SplineCurve:O8});class $p extends ar{constructor(e=1,t=1,n=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};const s=e/2,a=t/2,l=Math.floor(n),u=Math.floor(r),h=l+1,d=u+1,p=e/l,g=t/u,y=[],v=[],S=[],b=[];for(let _=0;_<d;_++){const E=_*g-a;for(let M=0;M<h;M++){const A=M*p-s;v.push(A,-E,0),S.push(0,0,1),b.push(M/l),b.push(1-_/u)}}for(let _=0;_<u;_++)for(let E=0;E<l;E++){const M=E+h*_,A=E+h*(_+1),w=E+1+h*(_+1),R=E+1+h*_;y.push(M,A,R),y.push(A,w,R)}this.setIndex(y),this.setAttribute("position",new ni(v,3)),this.setAttribute("normal",new ni(S,3)),this.setAttribute("uv",new ni(b,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new $p(e.width,e.height,e.widthSegments,e.heightSegments)}}class Xp extends ar{constructor(e=1,t=32,n=16,r=0,s=Math.PI*2,a=0,l=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:s,thetaStart:a,thetaLength:l},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const u=Math.min(a+l,Math.PI);let h=0;const d=[],p=new V,g=new V,y=[],v=[],S=[],b=[];for(let _=0;_<=n;_++){const E=[],M=_/n;let A=0;_===0&&a===0?A=.5/t:_===n&&u===Math.PI&&(A=-.5/t);for(let w=0;w<=t;w++){const R=w/t;p.x=-e*Math.cos(r+R*s)*Math.sin(a+M*l),p.y=e*Math.cos(a+M*l),p.z=e*Math.sin(r+R*s)*Math.sin(a+M*l),v.push(p.x,p.y,p.z),g.copy(p).normalize(),S.push(g.x,g.y,g.z),b.push(R+A,1-M),E.push(h++)}d.push(E)}for(let _=0;_<n;_++)for(let E=0;E<t;E++){const M=d[_][E+1],A=d[_][E],w=d[_+1][E],R=d[_+1][E+1];(_!==0||a>0)&&y.push(M,A,R),(_!==n-1||u<Math.PI)&&y.push(A,w,R)}this.setIndex(y),this.setAttribute("position",new ni(v,3)),this.setAttribute("normal",new ni(S,3)),this.setAttribute("uv",new ni(b,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Xp(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class eE extends ar{constructor(e=new JM(new V(-1,-1,0),new V(-1,1,0),new V(1,1,0)),t=64,n=1,r=8,s=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:r,closed:s};const a=e.computeFrenetFrames(t,s);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;const l=new V,u=new V,h=new Le;let d=new V;const p=[],g=[],y=[],v=[];S(),this.setIndex(v),this.setAttribute("position",new ni(p,3)),this.setAttribute("normal",new ni(g,3)),this.setAttribute("uv",new ni(y,2));function S(){for(let M=0;M<t;M++)b(M);b(s===!1?t:0),E(),_()}function b(M){d=e.getPointAt(M/t,d);const A=a.normals[M],w=a.binormals[M];for(let R=0;R<=r;R++){const C=R/r*Math.PI*2,L=Math.sin(C),N=-Math.cos(C);u.x=N*A.x+L*w.x,u.y=N*A.y+L*w.y,u.z=N*A.z+L*w.z,u.normalize(),g.push(u.x,u.y,u.z),l.x=d.x+n*u.x,l.y=d.y+n*u.y,l.z=d.z+n*u.z,p.push(l.x,l.y,l.z)}}function _(){for(let M=1;M<=t;M++)for(let A=1;A<=r;A++){const w=(r+1)*(M-1)+(A-1),R=(r+1)*M+(A-1),C=(r+1)*M+A,L=(r+1)*(M-1)+A;v.push(w,R,L),v.push(R,C,L)}}function E(){for(let M=0;M<=t;M++)for(let A=0;A<=r;A++)h.x=M/t,h.y=A/r,y.push(h.x,h.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new eE(new B8[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class I8 extends rr{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new ot(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class hO extends rr{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new ot(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ot(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ho,this.normalScale=new Le(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Br,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class F8 extends hO{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Le(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return It(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new ot(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new ot(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new ot(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class k8 extends rr{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new ot(16777215),this.specular=new ot(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ot(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ho,this.normalScale=new Le(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Br,this.combine=zp,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class z8 extends rr{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new ot(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ot(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ho,this.normalScale=new Le(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class V8 extends rr{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ho,this.normalScale=new Le(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class fO extends rr{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new ot(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ot(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ho,this.normalScale=new Le(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Br,this.combine=zp,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class G8 extends rr{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=h6,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class H8 extends rr{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}class W8 extends rr{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new ot(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ho,this.normalScale=new Le(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class j8 extends Av{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}const RN={enabled:!1,files:{},add:function(i,e){this.enabled!==!1&&(this.files[i]=e)},get:function(i){if(this.enabled!==!1)return this.files[i]},remove:function(i){delete this.files[i]},clear:function(){this.files={}}};class q8{constructor(e,t,n){const r=this;let s=!1,a=0,l=0,u;const h=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(d){l++,s===!1&&r.onStart!==void 0&&r.onStart(d,a,l),s=!0},this.itemEnd=function(d){a++,r.onProgress!==void 0&&r.onProgress(d,a,l),a===l&&(s=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(d){r.onError!==void 0&&r.onError(d)},this.resolveURL=function(d){return u?u(d):d},this.setURLModifier=function(d){return u=d,this},this.addHandler=function(d,p){return h.push(d,p),this},this.removeHandler=function(d){const p=h.indexOf(d);return p!==-1&&h.splice(p,2),this},this.getHandler=function(d){for(let p=0,g=h.length;p<g;p+=2){const y=h[p],v=h[p+1];if(y.global&&(y.lastIndex=0),y.test(d))return v}return null}}}const $8=new q8;class tE{constructor(e){this.manager=e!==void 0?e:$8,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise(function(r,s){n.load(e,r,t,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}tE.DEFAULT_MATERIAL_NAME="__DEFAULT";class X8 extends tE{constructor(e){super(e)}load(e,t,n,r){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,a=RN.get(e);if(a!==void 0)return s.manager.itemStart(e),setTimeout(function(){t&&t(a),s.manager.itemEnd(e)},0),a;const l=Tp("img");function u(){d(),RN.add(e,this),t&&t(this),s.manager.itemEnd(e)}function h(p){d(),r&&r(p),s.manager.itemError(e),s.manager.itemEnd(e)}function d(){l.removeEventListener("load",u,!1),l.removeEventListener("error",h,!1)}return l.addEventListener("load",u,!1),l.addEventListener("error",h,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(l.crossOrigin=this.crossOrigin),s.manager.itemStart(e),l.src=e,l}}class Y8 extends tE{constructor(e){super(e)}load(e,t,n,r){const s=new ei,a=new X8(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(l){s.image=l,s.needsUpdate=!0,t!==void 0&&t(s)},n,r),s}}class Lu extends ti{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new ot(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(t.object.target=this.target.uuid),t}}class K8 extends Lu{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(ti.DEFAULT_UP),this.updateMatrix(),this.groundColor=new ot(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const Xx=new Wt,CN=new V,NN=new V;class nE{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Le(512,512),this.mapType=Gn,this.map=null,this.mapPass=null,this.matrix=new Wt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new jp,this._frameExtents=new Le(1,1),this._viewportCount=1,this._viewports=[new bt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;CN.setFromMatrixPosition(e.matrixWorld),t.position.copy(CN),NN.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(NN),t.updateMatrixWorld(),Xx.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Xx),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(Xx)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.autoUpdate=e.autoUpdate,this.needsUpdate=e.needsUpdate,this.normalBias=e.normalBias,this.blurSamples=e.blurSamples,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class Z8 extends nE{constructor(){super(new Ui(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1,this.aspect=1}updateMatrices(e){const t=this.camera,n=Eu*2*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height*this.aspect,s=e.distance||t.far;(n!==t.fov||r!==t.aspect||s!==t.far)&&(t.fov=n,t.aspect=r,t.far=s,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class iE extends Lu{constructor(e,t,n=0,r=Math.PI/3,s=0,a=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(ti.DEFAULT_UP),this.updateMatrix(),this.target=new ti,this.distance=n,this.angle=r,this.penumbra=s,this.decay=a,this.map=null,this.shadow=new Z8}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const PN=new Wt,rd=new V,Yx=new V;class Q8 extends nE{constructor(){super(new Ui(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Le(4,2),this._viewportCount=6,this._viewports=[new bt(2,1,1,1),new bt(0,1,1,1),new bt(3,1,1,1),new bt(1,1,1,1),new bt(3,0,1,1),new bt(1,0,1,1)],this._cubeDirections=[new V(1,0,0),new V(-1,0,0),new V(0,0,1),new V(0,0,-1),new V(0,1,0),new V(0,-1,0)],this._cubeUps=[new V(0,1,0),new V(0,1,0),new V(0,1,0),new V(0,1,0),new V(0,0,1),new V(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,r=this.matrix,s=e.distance||n.far;s!==n.far&&(n.far=s,n.updateProjectionMatrix()),rd.setFromMatrixPosition(e.matrixWorld),n.position.copy(rd),Yx.copy(n.position),Yx.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(Yx),n.updateMatrixWorld(),r.makeTranslation(-rd.x,-rd.y,-rd.z),PN.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(PN)}}class J8 extends Lu{constructor(e,t,n=0,r=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=r,this.shadow=new Q8}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class Yp extends $M{constructor(e=-1,t=1,n=1,r=-1,s=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=s,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,n,r,s,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let s=n-e,a=n+e,l=r+t,u=r-t;if(this.view!==null&&this.view.enabled){const h=(this.right-this.left)/this.view.fullWidth/this.zoom,d=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=h*this.view.offsetX,a=s+h*this.view.width,l-=d*this.view.offsetY,u=l-d*this.view.height}this.projectionMatrix.makeOrthographic(s,a,l,u,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}class eW extends nE{constructor(){super(new Yp(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class dO extends Lu{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(ti.DEFAULT_UP),this.updateMatrix(),this.target=new ti,this.shadow=new eW}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class pO extends Lu{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class tW extends Lu{constructor(e,t,n=10,r=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class nW{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new V)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,r=e.y,s=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.282095),t.addScaledVector(a[1],.488603*r),t.addScaledVector(a[2],.488603*s),t.addScaledVector(a[3],.488603*n),t.addScaledVector(a[4],1.092548*(n*r)),t.addScaledVector(a[5],1.092548*(r*s)),t.addScaledVector(a[6],.315392*(3*s*s-1)),t.addScaledVector(a[7],1.092548*(n*s)),t.addScaledVector(a[8],.546274*(n*n-r*r)),t}getIrradianceAt(e,t){const n=e.x,r=e.y,s=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.886227),t.addScaledVector(a[1],2*.511664*r),t.addScaledVector(a[2],2*.511664*s),t.addScaledVector(a[3],2*.511664*n),t.addScaledVector(a[4],2*.429043*n*r),t.addScaledVector(a[5],2*.429043*r*s),t.addScaledVector(a[6],.743125*s*s-.247708),t.addScaledVector(a[7],2*.429043*n*s),t.addScaledVector(a[8],.429043*(n*n-r*r)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].fromArray(e,t+r*3);return this}toArray(e=[],t=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].toArray(e,t+r*3);return e}static getBasisAt(e,t){const n=e.x,r=e.y,s=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*s,t[3]=.488603*n,t[4]=1.092548*n*r,t[5]=1.092548*r*s,t[6]=.315392*(3*s*s-1),t[7]=1.092548*n*s,t[8]=.546274*(n*n-r*r)}}class iW extends Lu{constructor(e=new nW,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class mO extends Ui{constructor(e=[]){super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=e}}class gO{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=DN(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=DN();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function DN(){return performance.now()}class rW extends XM{constructor(e,t,n=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}const LN=new Wt;class yO{constructor(e,t,n=0,r=1/0){this.ray=new Mv(e,t),this.near=n,this.far=r,this.camera=null,this.layers=new WM,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return LN.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(LN),this}intersectObject(e,t=!0,n=[]){return $S(e,this,n,t),n.sort(UN),n}intersectObjects(e,t=!0,n=[]){for(let r=0,s=e.length;r<s;r++)$S(e[r],this,n,t);return n.sort(UN),n}}function UN(i,e){return i.distance-e.distance}function $S(i,e,t,n){let r=!0;if(i.layers.test(e.layers)&&i.raycast(e,t)===!1&&(r=!1),r===!0&&n===!0){const s=i.children;for(let a=0,l=s.length;a<l;a++)$S(s[a],e,t,!0)}}class ON{constructor(e=1,t=0,n=0){this.radius=e,this.phi=t,this.theta=n}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=It(this.phi,1e-6,Math.PI-1e-6),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(It(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class wv{constructor(e,t,n,r){wv.prototype.isMatrix2=!0,this.elements=[1,0,0,1],e!==void 0&&this.set(e,t,n,r)}identity(){return this.set(1,0,0,1),this}fromArray(e,t=0){for(let n=0;n<4;n++)this.elements[n]=e[n+t];return this}set(e,t,n,r){const s=this.elements;return s[0]=e,s[2]=t,s[1]=n,s[3]=r,this}}class Rv extends po{constructor(e,t=null){super(),this.object=e,this.domElement=t,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(e){if(e===void 0){console.warn("THREE.Controls: connect() now requires an element.");return}this.domElement!==null&&this.disconnect(),this.domElement=e}disconnect(){}dispose(){}update(){}}function BN(i,e,t,n){const r=sW(n);switch(t){case DM:return i*e;case Gp:return i*e/r.components*r.byteLength;case Wh:return i*e/r.components*r.byteLength;case to:return i*e*2/r.components*r.byteLength;case jh:return i*e*2/r.components*r.byteLength;case Vp:return i*e*3/r.components*r.byteLength;case Xn:return i*e*4/r.components*r.byteLength;case qh:return i*e*4/r.components*r.byteLength;case vu:case sl:return Math.floor((i+3)/4)*Math.floor((e+3)/4)*8;case al:case ol:return Math.floor((i+3)/4)*Math.floor((e+3)/4)*16;case gp:case vp:return Math.max(i,16)*Math.max(e,8)/4;case mp:case yp:return Math.max(i,8)*Math.max(e,8)/2;case _p:case dh:return Math.floor((i+3)/4)*Math.floor((e+3)/4)*8;case ph:return Math.floor((i+3)/4)*Math.floor((e+3)/4)*16;case mh:return Math.floor((i+3)/4)*Math.floor((e+3)/4)*16;case gh:return Math.floor((i+4)/5)*Math.floor((e+3)/4)*16;case yh:return Math.floor((i+4)/5)*Math.floor((e+4)/5)*16;case vh:return Math.floor((i+5)/6)*Math.floor((e+4)/5)*16;case _h:return Math.floor((i+5)/6)*Math.floor((e+5)/6)*16;case xh:return Math.floor((i+7)/8)*Math.floor((e+4)/5)*16;case bh:return Math.floor((i+7)/8)*Math.floor((e+5)/6)*16;case Sh:return Math.floor((i+7)/8)*Math.floor((e+7)/8)*16;case Th:return Math.floor((i+9)/10)*Math.floor((e+4)/5)*16;case Mh:return Math.floor((i+9)/10)*Math.floor((e+5)/6)*16;case Eh:return Math.floor((i+9)/10)*Math.floor((e+7)/8)*16;case Ah:return Math.floor((i+9)/10)*Math.floor((e+9)/10)*16;case wh:return Math.floor((i+11)/12)*Math.floor((e+9)/10)*16;case Rh:return Math.floor((i+11)/12)*Math.floor((e+11)/12)*16;case _u:case WS:case jS:return Math.ceil(i/4)*Math.ceil(e/4)*16;case LM:case xp:return Math.ceil(i/4)*Math.ceil(e/4)*8;case bp:case Sp:return Math.ceil(i/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${t} format.`)}function sW(i){switch(i){case Gn:case gu:return{byteLength:1,components:1};case ks:case yu:case Oi:return{byteLength:2,components:1};case _v:case xv:return{byteLength:2,components:4};case En:case Li:case Jn:return{byteLength:4,components:1};case bv:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${i}.`)}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Hh}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Hh);/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */function vO(){let i=null,e=!1,t=null,n=null;function r(s,a){t(s,a),n=i.requestAnimationFrame(r)}return{start:function(){e!==!0&&t!==null&&(n=i.requestAnimationFrame(r),e=!0)},stop:function(){i.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(s){t=s},setContext:function(s){i=s}}}function aW(i){const e=new WeakMap;function t(l,u){const h=l.array,d=l.usage,p=h.byteLength,g=i.createBuffer();i.bindBuffer(u,g),i.bufferData(u,h,d),l.onUploadCallback();let y;if(h instanceof Float32Array)y=i.FLOAT;else if(h instanceof Uint16Array)l.isFloat16BufferAttribute?y=i.HALF_FLOAT:y=i.UNSIGNED_SHORT;else if(h instanceof Int16Array)y=i.SHORT;else if(h instanceof Uint32Array)y=i.UNSIGNED_INT;else if(h instanceof Int32Array)y=i.INT;else if(h instanceof Int8Array)y=i.BYTE;else if(h instanceof Uint8Array)y=i.UNSIGNED_BYTE;else if(h instanceof Uint8ClampedArray)y=i.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+h);return{buffer:g,type:y,bytesPerElement:h.BYTES_PER_ELEMENT,version:l.version,size:p}}function n(l,u,h){const d=u.array,p=u.updateRanges;if(i.bindBuffer(h,l),p.length===0)i.bufferSubData(h,0,d);else{p.sort((y,v)=>y.start-v.start);let g=0;for(let y=1;y<p.length;y++){const v=p[g],S=p[y];S.start<=v.start+v.count+1?v.count=Math.max(v.count,S.start+S.count-v.start):(++g,p[g]=S)}p.length=g+1;for(let y=0,v=p.length;y<v;y++){const S=p[y];i.bufferSubData(h,S.start*d.BYTES_PER_ELEMENT,d,S.start,S.count)}u.clearUpdateRanges()}u.onUploadCallback()}function r(l){return l.isInterleavedBufferAttribute&&(l=l.data),e.get(l)}function s(l){l.isInterleavedBufferAttribute&&(l=l.data);const u=e.get(l);u&&(i.deleteBuffer(u.buffer),e.delete(l))}function a(l,u){if(l.isInterleavedBufferAttribute&&(l=l.data),l.isGLBufferAttribute){const d=e.get(l);(!d||d.version<l.version)&&e.set(l,{buffer:l.buffer,type:l.type,bytesPerElement:l.elementSize,version:l.version});return}const h=e.get(l);if(h===void 0)e.set(l,t(l,u));else if(h.version<l.version){if(h.size!==l.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");n(h.buffer,l,u),h.version=l.version}}return{get:r,remove:s,update:a}}var oW=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,lW=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,uW=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,cW=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,hW=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,fW=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,dW=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,pW=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,mW=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,gW=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,yW=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,vW=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,_W=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,xW=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,bW=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,SW=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,TW=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,MW=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,EW=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,AW=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,wW=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,RW=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,CW=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,NW=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,PW=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,DW=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,LW=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,UW=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,OW=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,BW=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,IW="gl_FragColor = linearToOutputTexel( gl_FragColor );",FW=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,kW=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,zW=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,VW=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,GW=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,HW=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,WW=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,jW=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,qW=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,$W=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,XW=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,YW=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,KW=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,ZW=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,QW=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,JW=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,ej=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,tj=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,nj=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,ij=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,rj=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,sj=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,aj=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,oj=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,lj=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,uj=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,cj=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,hj=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,fj=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,dj=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,pj=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,mj=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,gj=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,yj=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,vj=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,_j=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,xj=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,bj=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,Sj=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,Tj=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,Mj=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,Ej=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,Aj=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,wj=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Rj=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,Cj=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,Nj=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,Pj=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,Dj=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,Lj=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,Uj=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,Oj=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,Bj=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,Ij=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,Fj=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,kj=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,zj=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,Vj=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,Gj=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,Hj=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,Wj=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,jj=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,qj=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,$j=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,Xj=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,Yj=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,Kj=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,Zj=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,Qj=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,Jj=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,e9=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,t9=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,n9=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,i9=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,r9=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,s9=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const a9=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,o9=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,l9=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,u9=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,c9=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,h9=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,f9=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,d9=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,p9=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,m9=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,g9=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,y9=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,v9=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,_9=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,x9=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,b9=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,S9=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,T9=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,M9=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,E9=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,A9=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,w9=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,R9=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,C9=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,N9=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,P9=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,D9=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,L9=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,U9=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,O9=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,B9=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,I9=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,F9=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,k9=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,zt={alphahash_fragment:oW,alphahash_pars_fragment:lW,alphamap_fragment:uW,alphamap_pars_fragment:cW,alphatest_fragment:hW,alphatest_pars_fragment:fW,aomap_fragment:dW,aomap_pars_fragment:pW,batching_pars_vertex:mW,batching_vertex:gW,begin_vertex:yW,beginnormal_vertex:vW,bsdfs:_W,iridescence_fragment:xW,bumpmap_pars_fragment:bW,clipping_planes_fragment:SW,clipping_planes_pars_fragment:TW,clipping_planes_pars_vertex:MW,clipping_planes_vertex:EW,color_fragment:AW,color_pars_fragment:wW,color_pars_vertex:RW,color_vertex:CW,common:NW,cube_uv_reflection_fragment:PW,defaultnormal_vertex:DW,displacementmap_pars_vertex:LW,displacementmap_vertex:UW,emissivemap_fragment:OW,emissivemap_pars_fragment:BW,colorspace_fragment:IW,colorspace_pars_fragment:FW,envmap_fragment:kW,envmap_common_pars_fragment:zW,envmap_pars_fragment:VW,envmap_pars_vertex:GW,envmap_physical_pars_fragment:JW,envmap_vertex:HW,fog_vertex:WW,fog_pars_vertex:jW,fog_fragment:qW,fog_pars_fragment:$W,gradientmap_pars_fragment:XW,lightmap_pars_fragment:YW,lights_lambert_fragment:KW,lights_lambert_pars_fragment:ZW,lights_pars_begin:QW,lights_toon_fragment:ej,lights_toon_pars_fragment:tj,lights_phong_fragment:nj,lights_phong_pars_fragment:ij,lights_physical_fragment:rj,lights_physical_pars_fragment:sj,lights_fragment_begin:aj,lights_fragment_maps:oj,lights_fragment_end:lj,logdepthbuf_fragment:uj,logdepthbuf_pars_fragment:cj,logdepthbuf_pars_vertex:hj,logdepthbuf_vertex:fj,map_fragment:dj,map_pars_fragment:pj,map_particle_fragment:mj,map_particle_pars_fragment:gj,metalnessmap_fragment:yj,metalnessmap_pars_fragment:vj,morphinstance_vertex:_j,morphcolor_vertex:xj,morphnormal_vertex:bj,morphtarget_pars_vertex:Sj,morphtarget_vertex:Tj,normal_fragment_begin:Mj,normal_fragment_maps:Ej,normal_pars_fragment:Aj,normal_pars_vertex:wj,normal_vertex:Rj,normalmap_pars_fragment:Cj,clearcoat_normal_fragment_begin:Nj,clearcoat_normal_fragment_maps:Pj,clearcoat_pars_fragment:Dj,iridescence_pars_fragment:Lj,opaque_fragment:Uj,packing:Oj,premultiplied_alpha_fragment:Bj,project_vertex:Ij,dithering_fragment:Fj,dithering_pars_fragment:kj,roughnessmap_fragment:zj,roughnessmap_pars_fragment:Vj,shadowmap_pars_fragment:Gj,shadowmap_pars_vertex:Hj,shadowmap_vertex:Wj,shadowmask_pars_fragment:jj,skinbase_vertex:qj,skinning_pars_vertex:$j,skinning_vertex:Xj,skinnormal_vertex:Yj,specularmap_fragment:Kj,specularmap_pars_fragment:Zj,tonemapping_fragment:Qj,tonemapping_pars_fragment:Jj,transmission_fragment:e9,transmission_pars_fragment:t9,uv_pars_fragment:n9,uv_pars_vertex:i9,uv_vertex:r9,worldpos_vertex:s9,background_vert:a9,background_frag:o9,backgroundCube_vert:l9,backgroundCube_frag:u9,cube_vert:c9,cube_frag:h9,depth_vert:f9,depth_frag:d9,distanceRGBA_vert:p9,distanceRGBA_frag:m9,equirect_vert:g9,equirect_frag:y9,linedashed_vert:v9,linedashed_frag:_9,meshbasic_vert:x9,meshbasic_frag:b9,meshlambert_vert:S9,meshlambert_frag:T9,meshmatcap_vert:M9,meshmatcap_frag:E9,meshnormal_vert:A9,meshnormal_frag:w9,meshphong_vert:R9,meshphong_frag:C9,meshphysical_vert:N9,meshphysical_frag:P9,meshtoon_vert:D9,meshtoon_frag:L9,points_vert:U9,points_frag:O9,shadow_vert:B9,shadow_frag:I9,sprite_vert:F9,sprite_frag:k9},Ye={common:{diffuse:{value:new ot(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Nt},alphaMap:{value:null},alphaMapTransform:{value:new Nt},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Nt}},envmap:{envMap:{value:null},envMapRotation:{value:new Nt},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Nt}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Nt}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Nt},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Nt},normalScale:{value:new Le(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Nt},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Nt}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Nt}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Nt}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ot(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new ot(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Nt},alphaTest:{value:0},uvTransform:{value:new Nt}},sprite:{diffuse:{value:new ot(16777215)},opacity:{value:1},center:{value:new Le(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Nt},alphaMap:{value:null},alphaMapTransform:{value:new Nt},alphaTest:{value:0}}},ta={basic:{uniforms:ur([Ye.common,Ye.specularmap,Ye.envmap,Ye.aomap,Ye.lightmap,Ye.fog]),vertexShader:zt.meshbasic_vert,fragmentShader:zt.meshbasic_frag},lambert:{uniforms:ur([Ye.common,Ye.specularmap,Ye.envmap,Ye.aomap,Ye.lightmap,Ye.emissivemap,Ye.bumpmap,Ye.normalmap,Ye.displacementmap,Ye.fog,Ye.lights,{emissive:{value:new ot(0)}}]),vertexShader:zt.meshlambert_vert,fragmentShader:zt.meshlambert_frag},phong:{uniforms:ur([Ye.common,Ye.specularmap,Ye.envmap,Ye.aomap,Ye.lightmap,Ye.emissivemap,Ye.bumpmap,Ye.normalmap,Ye.displacementmap,Ye.fog,Ye.lights,{emissive:{value:new ot(0)},specular:{value:new ot(1118481)},shininess:{value:30}}]),vertexShader:zt.meshphong_vert,fragmentShader:zt.meshphong_frag},standard:{uniforms:ur([Ye.common,Ye.envmap,Ye.aomap,Ye.lightmap,Ye.emissivemap,Ye.bumpmap,Ye.normalmap,Ye.displacementmap,Ye.roughnessmap,Ye.metalnessmap,Ye.fog,Ye.lights,{emissive:{value:new ot(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:zt.meshphysical_vert,fragmentShader:zt.meshphysical_frag},toon:{uniforms:ur([Ye.common,Ye.aomap,Ye.lightmap,Ye.emissivemap,Ye.bumpmap,Ye.normalmap,Ye.displacementmap,Ye.gradientmap,Ye.fog,Ye.lights,{emissive:{value:new ot(0)}}]),vertexShader:zt.meshtoon_vert,fragmentShader:zt.meshtoon_frag},matcap:{uniforms:ur([Ye.common,Ye.bumpmap,Ye.normalmap,Ye.displacementmap,Ye.fog,{matcap:{value:null}}]),vertexShader:zt.meshmatcap_vert,fragmentShader:zt.meshmatcap_frag},points:{uniforms:ur([Ye.points,Ye.fog]),vertexShader:zt.points_vert,fragmentShader:zt.points_frag},dashed:{uniforms:ur([Ye.common,Ye.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:zt.linedashed_vert,fragmentShader:zt.linedashed_frag},depth:{uniforms:ur([Ye.common,Ye.displacementmap]),vertexShader:zt.depth_vert,fragmentShader:zt.depth_frag},normal:{uniforms:ur([Ye.common,Ye.bumpmap,Ye.normalmap,Ye.displacementmap,{opacity:{value:1}}]),vertexShader:zt.meshnormal_vert,fragmentShader:zt.meshnormal_frag},sprite:{uniforms:ur([Ye.sprite,Ye.fog]),vertexShader:zt.sprite_vert,fragmentShader:zt.sprite_frag},background:{uniforms:{uvTransform:{value:new Nt},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:zt.background_vert,fragmentShader:zt.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Nt}},vertexShader:zt.backgroundCube_vert,fragmentShader:zt.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:zt.cube_vert,fragmentShader:zt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:zt.equirect_vert,fragmentShader:zt.equirect_frag},distanceRGBA:{uniforms:ur([Ye.common,Ye.displacementmap,{referencePosition:{value:new V},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:zt.distanceRGBA_vert,fragmentShader:zt.distanceRGBA_frag},shadow:{uniforms:ur([Ye.lights,Ye.fog,{color:{value:new ot(0)},opacity:{value:1}}]),vertexShader:zt.shadow_vert,fragmentShader:zt.shadow_frag}};ta.physical={uniforms:ur([ta.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Nt},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Nt},clearcoatNormalScale:{value:new Le(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Nt},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Nt},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Nt},sheen:{value:0},sheenColor:{value:new ot(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Nt},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Nt},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Nt},transmissionSamplerSize:{value:new Le},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Nt},attenuationDistance:{value:0},attenuationColor:{value:new ot(0)},specularColor:{value:new ot(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Nt},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Nt},anisotropyVector:{value:new Le},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Nt}}]),vertexShader:zt.meshphysical_vert,fragmentShader:zt.meshphysical_frag};const zg={r:0,b:0,g:0},$l=new Br,z9=new Wt;function V9(i,e,t,n,r,s,a){const l=new ot(0);let u=s===!0?0:1,h,d,p=null,g=0,y=null;function v(M){let A=M.isScene===!0?M.background:null;return A&&A.isTexture&&(A=(M.backgroundBlurriness>0?t:e).get(A)),A}function S(M){let A=!1;const w=v(M);w===null?_(l,u):w&&w.isColor&&(_(w,1),A=!0);const R=i.xr.getEnvironmentBlendMode();R==="additive"?n.buffers.color.setClear(0,0,0,1,a):R==="alpha-blend"&&n.buffers.color.setClear(0,0,0,0,a),(i.autoClear||A)&&(n.buffers.depth.setTest(!0),n.buffers.depth.setMask(!0),n.buffers.color.setMask(!0),i.clear(i.autoClearColor,i.autoClearDepth,i.autoClearStencil))}function b(M,A){const w=v(A);w&&(w.isCubeTexture||w.mapping===Su)?(d===void 0&&(d=new fi(new Du(1,1,1),new da({name:"BackgroundCubeMaterial",uniforms:Nh(ta.backgroundCube.uniforms),vertexShader:ta.backgroundCube.vertexShader,fragmentShader:ta.backgroundCube.fragmentShader,side:An,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),d.geometry.deleteAttribute("normal"),d.geometry.deleteAttribute("uv"),d.onBeforeRender=function(R,C,L){this.matrixWorld.copyPosition(L.matrixWorld)},Object.defineProperty(d.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(d)),$l.copy(A.backgroundRotation),$l.x*=-1,$l.y*=-1,$l.z*=-1,w.isCubeTexture&&w.isRenderTargetTexture===!1&&($l.y*=-1,$l.z*=-1),d.material.uniforms.envMap.value=w,d.material.uniforms.flipEnvMap.value=w.isCubeTexture&&w.isRenderTargetTexture===!1?-1:1,d.material.uniforms.backgroundBlurriness.value=A.backgroundBlurriness,d.material.uniforms.backgroundIntensity.value=A.backgroundIntensity,d.material.uniforms.backgroundRotation.value.setFromMatrix4(z9.makeRotationFromEuler($l)),d.material.toneMapped=wt.getTransfer(w.colorSpace)!==Ze,(p!==w||g!==w.version||y!==i.toneMapping)&&(d.material.needsUpdate=!0,p=w,g=w.version,y=i.toneMapping),d.layers.enableAll(),M.unshift(d,d.geometry,d.material,0,0,null)):w&&w.isTexture&&(h===void 0&&(h=new fi(new $p(2,2),new da({name:"BackgroundMaterial",uniforms:Nh(ta.background.uniforms),vertexShader:ta.background.vertexShader,fragmentShader:ta.background.fragmentShader,side:Lr,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),h.geometry.deleteAttribute("normal"),Object.defineProperty(h.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(h)),h.material.uniforms.t2D.value=w,h.material.uniforms.backgroundIntensity.value=A.backgroundIntensity,h.material.toneMapped=wt.getTransfer(w.colorSpace)!==Ze,w.matrixAutoUpdate===!0&&w.updateMatrix(),h.material.uniforms.uvTransform.value.copy(w.matrix),(p!==w||g!==w.version||y!==i.toneMapping)&&(h.material.needsUpdate=!0,p=w,g=w.version,y=i.toneMapping),h.layers.enableAll(),M.unshift(h,h.geometry,h.material,0,0,null))}function _(M,A){M.getRGB(zg,rO(i)),n.buffers.color.setClear(zg.r,zg.g,zg.b,A,a)}function E(){d!==void 0&&(d.geometry.dispose(),d.material.dispose(),d=void 0),h!==void 0&&(h.geometry.dispose(),h.material.dispose(),h=void 0)}return{getClearColor:function(){return l},setClearColor:function(M,A=1){l.set(M),u=A,_(l,u)},getClearAlpha:function(){return u},setClearAlpha:function(M){u=M,_(l,u)},render:S,addToRenderList:b,dispose:E}}function G9(i,e){const t=i.getParameter(i.MAX_VERTEX_ATTRIBS),n={},r=g(null);let s=r,a=!1;function l(D,I,W,Y,oe){let le=!1;const z=p(Y,W,I);s!==z&&(s=z,h(s.object)),le=y(D,Y,W,oe),le&&v(D,Y,W,oe),oe!==null&&e.update(oe,i.ELEMENT_ARRAY_BUFFER),(le||a)&&(a=!1,A(D,I,W,Y),oe!==null&&i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,e.get(oe).buffer))}function u(){return i.createVertexArray()}function h(D){return i.bindVertexArray(D)}function d(D){return i.deleteVertexArray(D)}function p(D,I,W){const Y=W.wireframe===!0;let oe=n[D.id];oe===void 0&&(oe={},n[D.id]=oe);let le=oe[I.id];le===void 0&&(le={},oe[I.id]=le);let z=le[Y];return z===void 0&&(z=g(u()),le[Y]=z),z}function g(D){const I=[],W=[],Y=[];for(let oe=0;oe<t;oe++)I[oe]=0,W[oe]=0,Y[oe]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:I,enabledAttributes:W,attributeDivisors:Y,object:D,attributes:{},index:null}}function y(D,I,W,Y){const oe=s.attributes,le=I.attributes;let z=0;const k=W.getAttributes();for(const G in k)if(k[G].location>=0){const F=oe[G];let se=le[G];if(se===void 0&&(G==="instanceMatrix"&&D.instanceMatrix&&(se=D.instanceMatrix),G==="instanceColor"&&D.instanceColor&&(se=D.instanceColor)),F===void 0||F.attribute!==se||se&&F.data!==se.data)return!0;z++}return s.attributesNum!==z||s.index!==Y}function v(D,I,W,Y){const oe={},le=I.attributes;let z=0;const k=W.getAttributes();for(const G in k)if(k[G].location>=0){let F=le[G];F===void 0&&(G==="instanceMatrix"&&D.instanceMatrix&&(F=D.instanceMatrix),G==="instanceColor"&&D.instanceColor&&(F=D.instanceColor));const se={};se.attribute=F,F&&F.data&&(se.data=F.data),oe[G]=se,z++}s.attributes=oe,s.attributesNum=z,s.index=Y}function S(){const D=s.newAttributes;for(let I=0,W=D.length;I<W;I++)D[I]=0}function b(D){_(D,0)}function _(D,I){const W=s.newAttributes,Y=s.enabledAttributes,oe=s.attributeDivisors;W[D]=1,Y[D]===0&&(i.enableVertexAttribArray(D),Y[D]=1),oe[D]!==I&&(i.vertexAttribDivisor(D,I),oe[D]=I)}function E(){const D=s.newAttributes,I=s.enabledAttributes;for(let W=0,Y=I.length;W<Y;W++)I[W]!==D[W]&&(i.disableVertexAttribArray(W),I[W]=0)}function M(D,I,W,Y,oe,le,z){z===!0?i.vertexAttribIPointer(D,I,W,oe,le):i.vertexAttribPointer(D,I,W,Y,oe,le)}function A(D,I,W,Y){S();const oe=Y.attributes,le=W.getAttributes(),z=I.defaultAttributeValues;for(const k in le){const G=le[k];if(G.location>=0){let he=oe[k];if(he===void 0&&(k==="instanceMatrix"&&D.instanceMatrix&&(he=D.instanceMatrix),k==="instanceColor"&&D.instanceColor&&(he=D.instanceColor)),he!==void 0){const F=he.normalized,se=he.itemSize,Me=e.get(he);if(Me===void 0)continue;const De=Me.buffer,j=Me.type,Z=Me.bytesPerElement,$=j===i.INT||j===i.UNSIGNED_INT||he.gpuType===Li;if(he.isInterleavedBufferAttribute){const ne=he.data,ve=ne.stride,He=he.offset;if(ne.isInstancedInterleavedBuffer){for(let Ve=0;Ve<G.locationSize;Ve++)_(G.location+Ve,ne.meshPerAttribute);D.isInstancedMesh!==!0&&Y._maxInstanceCount===void 0&&(Y._maxInstanceCount=ne.meshPerAttribute*ne.count)}else for(let Ve=0;Ve<G.locationSize;Ve++)b(G.location+Ve);i.bindBuffer(i.ARRAY_BUFFER,De);for(let Ve=0;Ve<G.locationSize;Ve++)M(G.location+Ve,se/G.locationSize,j,F,ve*Z,(He+se/G.locationSize*Ve)*Z,$)}else{if(he.isInstancedBufferAttribute){for(let ne=0;ne<G.locationSize;ne++)_(G.location+ne,he.meshPerAttribute);D.isInstancedMesh!==!0&&Y._maxInstanceCount===void 0&&(Y._maxInstanceCount=he.meshPerAttribute*he.count)}else for(let ne=0;ne<G.locationSize;ne++)b(G.location+ne);i.bindBuffer(i.ARRAY_BUFFER,De);for(let ne=0;ne<G.locationSize;ne++)M(G.location+ne,se/G.locationSize,j,F,se*Z,se/G.locationSize*ne*Z,$)}}else if(z!==void 0){const F=z[k];if(F!==void 0)switch(F.length){case 2:i.vertexAttrib2fv(G.location,F);break;case 3:i.vertexAttrib3fv(G.location,F);break;case 4:i.vertexAttrib4fv(G.location,F);break;default:i.vertexAttrib1fv(G.location,F)}}}}E()}function w(){L();for(const D in n){const I=n[D];for(const W in I){const Y=I[W];for(const oe in Y)d(Y[oe].object),delete Y[oe];delete I[W]}delete n[D]}}function R(D){if(n[D.id]===void 0)return;const I=n[D.id];for(const W in I){const Y=I[W];for(const oe in Y)d(Y[oe].object),delete Y[oe];delete I[W]}delete n[D.id]}function C(D){for(const I in n){const W=n[I];if(W[D.id]===void 0)continue;const Y=W[D.id];for(const oe in Y)d(Y[oe].object),delete Y[oe];delete W[D.id]}}function L(){N(),a=!0,s!==r&&(s=r,h(s.object))}function N(){r.geometry=null,r.program=null,r.wireframe=!1}return{setup:l,reset:L,resetDefaultState:N,dispose:w,releaseStatesOfGeometry:R,releaseStatesOfProgram:C,initAttributes:S,enableAttribute:b,disableUnusedAttributes:E}}function H9(i,e,t){let n;function r(h){n=h}function s(h,d){i.drawArrays(n,h,d),t.update(d,n,1)}function a(h,d,p){p!==0&&(i.drawArraysInstanced(n,h,d,p),t.update(d,n,p))}function l(h,d,p){if(p===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(n,h,0,d,0,p);let y=0;for(let v=0;v<p;v++)y+=d[v];t.update(y,n,1)}function u(h,d,p,g){if(p===0)return;const y=e.get("WEBGL_multi_draw");if(y===null)for(let v=0;v<h.length;v++)a(h[v],d[v],g[v]);else{y.multiDrawArraysInstancedWEBGL(n,h,0,d,0,g,0,p);let v=0;for(let S=0;S<p;S++)v+=d[S]*g[S];t.update(v,n,1)}}this.setMode=r,this.render=s,this.renderInstances=a,this.renderMultiDraw=l,this.renderMultiDrawInstances=u}function W9(i,e,t,n){let r;function s(){if(r!==void 0)return r;if(e.has("EXT_texture_filter_anisotropic")===!0){const C=e.get("EXT_texture_filter_anisotropic");r=i.getParameter(C.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function a(C){return!(C!==Xn&&n.convert(C)!==i.getParameter(i.IMPLEMENTATION_COLOR_READ_FORMAT))}function l(C){const L=C===Oi&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(C!==Gn&&n.convert(C)!==i.getParameter(i.IMPLEMENTATION_COLOR_READ_TYPE)&&C!==Jn&&!L)}function u(C){if(C==="highp"){if(i.getShaderPrecisionFormat(i.VERTEX_SHADER,i.HIGH_FLOAT).precision>0&&i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT).precision>0)return"highp";C="mediump"}return C==="mediump"&&i.getShaderPrecisionFormat(i.VERTEX_SHADER,i.MEDIUM_FLOAT).precision>0&&i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let h=t.precision!==void 0?t.precision:"highp";const d=u(h);d!==h&&(console.warn("THREE.WebGLRenderer:",h,"not supported, using",d,"instead."),h=d);const p=t.logarithmicDepthBuffer===!0,g=t.reverseDepthBuffer===!0&&e.has("EXT_clip_control"),y=i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS),v=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS),S=i.getParameter(i.MAX_TEXTURE_SIZE),b=i.getParameter(i.MAX_CUBE_MAP_TEXTURE_SIZE),_=i.getParameter(i.MAX_VERTEX_ATTRIBS),E=i.getParameter(i.MAX_VERTEX_UNIFORM_VECTORS),M=i.getParameter(i.MAX_VARYING_VECTORS),A=i.getParameter(i.MAX_FRAGMENT_UNIFORM_VECTORS),w=v>0,R=i.getParameter(i.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:s,getMaxPrecision:u,textureFormatReadable:a,textureTypeReadable:l,precision:h,logarithmicDepthBuffer:p,reverseDepthBuffer:g,maxTextures:y,maxVertexTextures:v,maxTextureSize:S,maxCubemapSize:b,maxAttributes:_,maxVertexUniforms:E,maxVaryings:M,maxFragmentUniforms:A,vertexTextures:w,maxSamples:R}}function j9(i){const e=this;let t=null,n=0,r=!1,s=!1;const a=new Bs,l=new Nt,u={value:null,needsUpdate:!1};this.uniform=u,this.numPlanes=0,this.numIntersection=0,this.init=function(p,g){const y=p.length!==0||g||n!==0||r;return r=g,n=p.length,y},this.beginShadows=function(){s=!0,d(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(p,g){t=d(p,g,0)},this.setState=function(p,g,y){const v=p.clippingPlanes,S=p.clipIntersection,b=p.clipShadows,_=i.get(p);if(!r||v===null||v.length===0||s&&!b)s?d(null):h();else{const E=s?0:n,M=E*4;let A=_.clippingState||null;u.value=A,A=d(v,g,M,y);for(let w=0;w!==M;++w)A[w]=t[w];_.clippingState=A,this.numIntersection=S?this.numPlanes:0,this.numPlanes+=E}};function h(){u.value!==t&&(u.value=t,u.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function d(p,g,y,v){const S=p!==null?p.length:0;let b=null;if(S!==0){if(b=u.value,v!==!0||b===null){const _=y+S*4,E=g.matrixWorldInverse;l.getNormalMatrix(E),(b===null||b.length<_)&&(b=new Float32Array(_));for(let M=0,A=y;M!==S;++M,A+=4)a.copy(p[M]).applyMatrix4(E,l),a.normal.toArray(b,A),b[A+3]=a.constant}u.value=b,u.needsUpdate=!0}return e.numPlanes=S,e.numIntersection=0,b}}function q9(i){let e=new WeakMap;function t(a,l){return l===hh?a.mapping=ha:l===fh&&(a.mapping=fa),a}function n(a){if(a&&a.isTexture){const l=a.mapping;if(l===hh||l===fh)if(e.has(a)){const u=e.get(a).texture;return t(u,a.mapping)}else{const u=a.image;if(u&&u.height>0){const h=new oO(u.height);return h.fromEquirectangularTexture(i,a),e.set(a,h),a.addEventListener("dispose",r),t(h.texture,a.mapping)}else return null}}return a}function r(a){const l=a.target;l.removeEventListener("dispose",r);const u=e.get(l);u!==void 0&&(e.delete(l),u.dispose())}function s(){e=new WeakMap}return{get:n,dispose:s}}const qc=4,IN=[.125,.215,.35,.446,.526,.582],au=20,Kx=new Yp,FN=new ot;let Zx=null,Qx=0,Jx=0,eb=!1;const nu=(1+Math.sqrt(5))/2,Rc=1/nu,kN=[new V(-nu,Rc,0),new V(nu,Rc,0),new V(-Rc,0,nu),new V(Rc,0,nu),new V(0,nu,-Rc),new V(0,nu,Rc),new V(-1,1,-1),new V(1,1,-1),new V(-1,1,1),new V(1,1,1)],$9=new V;let zN=class{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,r=100,s={}){const{size:a=256,position:l=$9}=s;Zx=this._renderer.getRenderTarget(),Qx=this._renderer.getActiveCubeFace(),Jx=this._renderer.getActiveMipmapLevel(),eb=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(a);const u=this._allocateTargets();return u.depthBuffer=!0,this._sceneToCubeUV(e,n,r,u,l),t>0&&this._blur(u,0,0,t),this._applyPMREM(u),this._cleanup(u),u}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=HN(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=GN(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(Zx,Qx,Jx),this._renderer.xr.enabled=eb,e.scissorTest=!1,Vg(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===ha||e.mapping===fa?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),Zx=this._renderer.getRenderTarget(),Qx=this._renderer.getActiveCubeFace(),Jx=this._renderer.getActiveMipmapLevel(),eb=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:Ti,minFilter:Ti,generateMipmaps:!1,type:Oi,format:Xn,colorSpace:ca,depthBuffer:!1},r=VN(e,t,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=VN(e,t,n);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=X9(s)),this._blurMaterial=Y9(s,e,t)}return r}_compileMaterial(e){const t=new fi(this._lodPlanes[0],e);this._renderer.compile(t,Kx)}_sceneToCubeUV(e,t,n,r,s){const u=new Ui(90,1,t,n),h=[1,-1,1,1,1,1],d=[1,1,1,-1,-1,-1],p=this._renderer,g=p.autoClear,y=p.toneMapping;p.getClearColor(FN),p.toneMapping=Or,p.autoClear=!1;const v=new na({name:"PMREM.Background",side:An,depthWrite:!1,depthTest:!1}),S=new fi(new Du,v);let b=!1;const _=e.background;_?_.isColor&&(v.color.copy(_),e.background=null,b=!0):(v.color.copy(FN),b=!0);for(let E=0;E<6;E++){const M=E%3;M===0?(u.up.set(0,h[E],0),u.position.set(s.x,s.y,s.z),u.lookAt(s.x+d[E],s.y,s.z)):M===1?(u.up.set(0,0,h[E]),u.position.set(s.x,s.y,s.z),u.lookAt(s.x,s.y+d[E],s.z)):(u.up.set(0,h[E],0),u.position.set(s.x,s.y,s.z),u.lookAt(s.x,s.y,s.z+d[E]));const A=this._cubeSize;Vg(r,M*A,E>2?A:0,A,A),p.setRenderTarget(r),b&&p.render(S,u),p.render(e,u)}S.geometry.dispose(),S.material.dispose(),p.toneMapping=y,p.autoClear=g,e.background=_}_textureToCubeUV(e,t){const n=this._renderer,r=e.mapping===ha||e.mapping===fa;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=HN()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=GN());const s=r?this._cubemapMaterial:this._equirectMaterial,a=new fi(this._lodPlanes[0],s),l=s.uniforms;l.envMap.value=e;const u=this._cubeSize;Vg(t,0,0,3*u,2*u),n.setRenderTarget(t),n.render(a,Kx)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;const r=this._lodPlanes.length;for(let s=1;s<r;s++){const a=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),l=kN[(r-s-1)%kN.length];this._blur(e,s-1,s,a,l)}t.autoClear=n}_blur(e,t,n,r,s){const a=this._pingPongRenderTarget;this._halfBlur(e,a,t,n,r,"latitudinal",s),this._halfBlur(a,e,n,n,r,"longitudinal",s)}_halfBlur(e,t,n,r,s,a,l){const u=this._renderer,h=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const d=3,p=new fi(this._lodPlanes[r],h),g=h.uniforms,y=this._sizeLods[n]-1,v=isFinite(s)?Math.PI/(2*y):2*Math.PI/(2*au-1),S=s/v,b=isFinite(s)?1+Math.floor(d*S):au;b>au&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${b} samples when the maximum is set to ${au}`);const _=[];let E=0;for(let C=0;C<au;++C){const L=C/S,N=Math.exp(-L*L/2);_.push(N),C===0?E+=N:C<b&&(E+=2*N)}for(let C=0;C<_.length;C++)_[C]=_[C]/E;g.envMap.value=e.texture,g.samples.value=b,g.weights.value=_,g.latitudinal.value=a==="latitudinal",l&&(g.poleAxis.value=l);const{_lodMax:M}=this;g.dTheta.value=v,g.mipInt.value=M-n;const A=this._sizeLods[r],w=3*A*(r>M-qc?r-M+qc:0),R=4*(this._cubeSize-A);Vg(t,w,R,3*A,2*A),u.setRenderTarget(t),u.render(p,Kx)}};function X9(i){const e=[],t=[],n=[];let r=i;const s=i-qc+1+IN.length;for(let a=0;a<s;a++){const l=Math.pow(2,r);t.push(l);let u=1/l;a>i-qc?u=IN[a-i+qc-1]:a===0&&(u=0),n.push(u);const h=1/(l-2),d=-h,p=1+h,g=[d,d,p,d,p,p,d,d,p,p,d,p],y=6,v=6,S=3,b=2,_=1,E=new Float32Array(S*v*y),M=new Float32Array(b*v*y),A=new Float32Array(_*v*y);for(let R=0;R<y;R++){const C=R%3*2/3-1,L=R>2?0:-1,N=[C,L,0,C+2/3,L,0,C+2/3,L+1,0,C,L,0,C+2/3,L+1,0,C,L+1,0];E.set(N,S*v*R),M.set(g,b*v*R);const D=[R,R,R,R,R,R];A.set(D,_*v*R)}const w=new ar;w.setAttribute("position",new Wi(E,S)),w.setAttribute("uv",new Wi(M,b)),w.setAttribute("faceIndex",new Wi(A,_)),e.push(w),r>qc&&r--}return{lodPlanes:e,sizeLods:t,sigmas:n}}function VN(i,e,t){const n=new dl(i,e,t);return n.texture.mapping=Su,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function Vg(i,e,t,n,r){i.viewport.set(e,t,n,r),i.scissor.set(e,t,n,r)}function Y9(i,e,t){const n=new Float32Array(au),r=new V(0,1,0);return new da({name:"SphericalGaussianBlur",defines:{n:au,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${i}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:rE(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Ur,depthTest:!1,depthWrite:!1})}function GN(){return new da({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:rE(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Ur,depthTest:!1,depthWrite:!1})}function HN(){return new da({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:rE(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Ur,depthTest:!1,depthWrite:!1})}function rE(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function K9(i){let e=new WeakMap,t=null;function n(l){if(l&&l.isTexture){const u=l.mapping,h=u===hh||u===fh,d=u===ha||u===fa;if(h||d){let p=e.get(l);const g=p!==void 0?p.texture.pmremVersion:0;if(l.isRenderTargetTexture&&l.pmremVersion!==g)return t===null&&(t=new zN(i)),p=h?t.fromEquirectangular(l,p):t.fromCubemap(l,p),p.texture.pmremVersion=l.pmremVersion,e.set(l,p),p.texture;if(p!==void 0)return p.texture;{const y=l.image;return h&&y&&y.height>0||d&&y&&r(y)?(t===null&&(t=new zN(i)),p=h?t.fromEquirectangular(l):t.fromCubemap(l),p.texture.pmremVersion=l.pmremVersion,e.set(l,p),l.addEventListener("dispose",s),p.texture):null}}}return l}function r(l){let u=0;const h=6;for(let d=0;d<h;d++)l[d]!==void 0&&u++;return u===h}function s(l){const u=l.target;u.removeEventListener("dispose",s);const h=e.get(u);h!==void 0&&(e.delete(u),h.dispose())}function a(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:n,dispose:a}}function Z9(i){const e={};function t(n){if(e[n]!==void 0)return e[n];let r;switch(n){case"WEBGL_depth_texture":r=i.getExtension("WEBGL_depth_texture")||i.getExtension("MOZ_WEBGL_depth_texture")||i.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=i.getExtension("WEBGL_compressed_texture_s3tc")||i.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=i.getExtension("WEBGL_compressed_texture_pvrtc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=i.getExtension(n)}return e[n]=r,r}return{has:function(n){return t(n)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(n){const r=t(n);return r===null&&rs("THREE.WebGLRenderer: "+n+" extension not supported."),r}}}function Q9(i,e,t,n){const r={},s=new WeakMap;function a(p){const g=p.target;g.index!==null&&e.remove(g.index);for(const v in g.attributes)e.remove(g.attributes[v]);g.removeEventListener("dispose",a),delete r[g.id];const y=s.get(g);y&&(e.remove(y),s.delete(g)),n.releaseStatesOfGeometry(g),g.isInstancedBufferGeometry===!0&&delete g._maxInstanceCount,t.memory.geometries--}function l(p,g){return r[g.id]===!0||(g.addEventListener("dispose",a),r[g.id]=!0,t.memory.geometries++),g}function u(p){const g=p.attributes;for(const y in g)e.update(g[y],i.ARRAY_BUFFER)}function h(p){const g=[],y=p.index,v=p.attributes.position;let S=0;if(y!==null){const E=y.array;S=y.version;for(let M=0,A=E.length;M<A;M+=3){const w=E[M+0],R=E[M+1],C=E[M+2];g.push(w,R,R,C,C,w)}}else if(v!==void 0){const E=v.array;S=v.version;for(let M=0,A=E.length/3-1;M<A;M+=3){const w=M+0,R=M+1,C=M+2;g.push(w,R,R,C,C,w)}}else return;const b=new(VM(g)?qM:jM)(g,1);b.version=S;const _=s.get(p);_&&e.remove(_),s.set(p,b)}function d(p){const g=s.get(p);if(g){const y=p.index;y!==null&&g.version<y.version&&h(p)}else h(p);return s.get(p)}return{get:l,update:u,getWireframeAttribute:d}}function J9(i,e,t){let n;function r(g){n=g}let s,a;function l(g){s=g.type,a=g.bytesPerElement}function u(g,y){i.drawElements(n,y,s,g*a),t.update(y,n,1)}function h(g,y,v){v!==0&&(i.drawElementsInstanced(n,y,s,g*a,v),t.update(y,n,v))}function d(g,y,v){if(v===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(n,y,0,s,g,0,v);let b=0;for(let _=0;_<v;_++)b+=y[_];t.update(b,n,1)}function p(g,y,v,S){if(v===0)return;const b=e.get("WEBGL_multi_draw");if(b===null)for(let _=0;_<g.length;_++)h(g[_]/a,y[_],S[_]);else{b.multiDrawElementsInstancedWEBGL(n,y,0,s,g,0,S,0,v);let _=0;for(let E=0;E<v;E++)_+=y[E]*S[E];t.update(_,n,1)}}this.setMode=r,this.setIndex=l,this.render=u,this.renderInstances=h,this.renderMultiDraw=d,this.renderMultiDrawInstances=p}function eq(i){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function n(s,a,l){switch(t.calls++,a){case i.TRIANGLES:t.triangles+=l*(s/3);break;case i.LINES:t.lines+=l*(s/2);break;case i.LINE_STRIP:t.lines+=l*(s-1);break;case i.LINE_LOOP:t.lines+=l*s;break;case i.POINTS:t.points+=l*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);break}}function r(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:r,update:n}}function tq(i,e,t){const n=new WeakMap,r=new bt;function s(a,l,u){const h=a.morphTargetInfluences,d=l.morphAttributes.position||l.morphAttributes.normal||l.morphAttributes.color,p=d!==void 0?d.length:0;let g=n.get(l);if(g===void 0||g.count!==p){let D=function(){L.dispose(),n.delete(l),l.removeEventListener("dispose",D)};var y=D;g!==void 0&&g.texture.dispose();const v=l.morphAttributes.position!==void 0,S=l.morphAttributes.normal!==void 0,b=l.morphAttributes.color!==void 0,_=l.morphAttributes.position||[],E=l.morphAttributes.normal||[],M=l.morphAttributes.color||[];let A=0;v===!0&&(A=1),S===!0&&(A=2),b===!0&&(A=3);let w=l.attributes.position.count*A,R=1;w>e.maxTextureSize&&(R=Math.ceil(w/e.maxTextureSize),w=e.maxTextureSize);const C=new Float32Array(w*R*4*p),L=new HM(C,w,R,p);L.type=Jn,L.needsUpdate=!0;const N=A*4;for(let I=0;I<p;I++){const W=_[I],Y=E[I],oe=M[I],le=w*R*4*I;for(let z=0;z<W.count;z++){const k=z*N;v===!0&&(r.fromBufferAttribute(W,z),C[le+k+0]=r.x,C[le+k+1]=r.y,C[le+k+2]=r.z,C[le+k+3]=0),S===!0&&(r.fromBufferAttribute(Y,z),C[le+k+4]=r.x,C[le+k+5]=r.y,C[le+k+6]=r.z,C[le+k+7]=0),b===!0&&(r.fromBufferAttribute(oe,z),C[le+k+8]=r.x,C[le+k+9]=r.y,C[le+k+10]=r.z,C[le+k+11]=oe.itemSize===4?r.w:1)}}g={count:p,texture:L,size:new Le(w,R)},n.set(l,g),l.addEventListener("dispose",D)}if(a.isInstancedMesh===!0&&a.morphTexture!==null)u.getUniforms().setValue(i,"morphTexture",a.morphTexture,t);else{let v=0;for(let b=0;b<h.length;b++)v+=h[b];const S=l.morphTargetsRelative?1:1-v;u.getUniforms().setValue(i,"morphTargetBaseInfluence",S),u.getUniforms().setValue(i,"morphTargetInfluences",h)}u.getUniforms().setValue(i,"morphTargetsTexture",g.texture,t),u.getUniforms().setValue(i,"morphTargetsTextureSize",g.size)}return{update:s}}function nq(i,e,t,n){let r=new WeakMap;function s(u){const h=n.render.frame,d=u.geometry,p=e.get(u,d);if(r.get(p)!==h&&(e.update(p),r.set(p,h)),u.isInstancedMesh&&(u.hasEventListener("dispose",l)===!1&&u.addEventListener("dispose",l),r.get(u)!==h&&(t.update(u.instanceMatrix,i.ARRAY_BUFFER),u.instanceColor!==null&&t.update(u.instanceColor,i.ARRAY_BUFFER),r.set(u,h))),u.isSkinnedMesh){const g=u.skeleton;r.get(g)!==h&&(g.update(),r.set(g,h))}return p}function a(){r=new WeakMap}function l(u){const h=u.target;h.removeEventListener("dispose",l),t.remove(h.instanceMatrix),h.instanceColor!==null&&t.remove(h.instanceColor)}return{update:s,dispose:a}}const _O=new ei,WN=new bs(1,1),xO=new HM,bO=new K6,SO=new Wp,jN=[],qN=[],$N=new Float32Array(16),XN=new Float32Array(9),YN=new Float32Array(4);function $h(i,e,t){const n=i[0];if(n<=0||n>0)return i;const r=e*t;let s=jN[r];if(s===void 0&&(s=new Float32Array(r),jN[r]=s),e!==0){n.toArray(s,0);for(let a=1,l=0;a!==e;++a)l+=t,i[a].toArray(s,l)}return s}function Mi(i,e){if(i.length!==e.length)return!1;for(let t=0,n=i.length;t<n;t++)if(i[t]!==e[t])return!1;return!0}function Ei(i,e){for(let t=0,n=e.length;t<n;t++)i[t]=e[t]}function Cv(i,e){let t=qN[e];t===void 0&&(t=new Int32Array(e),qN[e]=t);for(let n=0;n!==e;++n)t[n]=i.allocateTextureUnit();return t}function iq(i,e){const t=this.cache;t[0]!==e&&(i.uniform1f(this.addr,e),t[0]=e)}function rq(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Mi(t,e))return;i.uniform2fv(this.addr,e),Ei(t,e)}}function sq(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(i.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(Mi(t,e))return;i.uniform3fv(this.addr,e),Ei(t,e)}}function aq(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Mi(t,e))return;i.uniform4fv(this.addr,e),Ei(t,e)}}function oq(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(Mi(t,e))return;i.uniformMatrix2fv(this.addr,!1,e),Ei(t,e)}else{if(Mi(t,n))return;YN.set(n),i.uniformMatrix2fv(this.addr,!1,YN),Ei(t,n)}}function lq(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(Mi(t,e))return;i.uniformMatrix3fv(this.addr,!1,e),Ei(t,e)}else{if(Mi(t,n))return;XN.set(n),i.uniformMatrix3fv(this.addr,!1,XN),Ei(t,n)}}function uq(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(Mi(t,e))return;i.uniformMatrix4fv(this.addr,!1,e),Ei(t,e)}else{if(Mi(t,n))return;$N.set(n),i.uniformMatrix4fv(this.addr,!1,$N),Ei(t,n)}}function cq(i,e){const t=this.cache;t[0]!==e&&(i.uniform1i(this.addr,e),t[0]=e)}function hq(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Mi(t,e))return;i.uniform2iv(this.addr,e),Ei(t,e)}}function fq(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Mi(t,e))return;i.uniform3iv(this.addr,e),Ei(t,e)}}function dq(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Mi(t,e))return;i.uniform4iv(this.addr,e),Ei(t,e)}}function pq(i,e){const t=this.cache;t[0]!==e&&(i.uniform1ui(this.addr,e),t[0]=e)}function mq(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Mi(t,e))return;i.uniform2uiv(this.addr,e),Ei(t,e)}}function gq(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Mi(t,e))return;i.uniform3uiv(this.addr,e),Ei(t,e)}}function yq(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Mi(t,e))return;i.uniform4uiv(this.addr,e),Ei(t,e)}}function vq(i,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r);let s;this.type===i.SAMPLER_2D_SHADOW?(WN.compareFunction=Tv,s=WN):s=_O,t.setTexture2D(e||s,r)}function _q(i,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r),t.setTexture3D(e||bO,r)}function xq(i,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r),t.setTextureCube(e||SO,r)}function bq(i,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r),t.setTexture2DArray(e||xO,r)}function Sq(i){switch(i){case 5126:return iq;case 35664:return rq;case 35665:return sq;case 35666:return aq;case 35674:return oq;case 35675:return lq;case 35676:return uq;case 5124:case 35670:return cq;case 35667:case 35671:return hq;case 35668:case 35672:return fq;case 35669:case 35673:return dq;case 5125:return pq;case 36294:return mq;case 36295:return gq;case 36296:return yq;case 35678:case 36198:case 36298:case 36306:case 35682:return vq;case 35679:case 36299:case 36307:return _q;case 35680:case 36300:case 36308:case 36293:return xq;case 36289:case 36303:case 36311:case 36292:return bq}}function Tq(i,e){i.uniform1fv(this.addr,e)}function Mq(i,e){const t=$h(e,this.size,2);i.uniform2fv(this.addr,t)}function Eq(i,e){const t=$h(e,this.size,3);i.uniform3fv(this.addr,t)}function Aq(i,e){const t=$h(e,this.size,4);i.uniform4fv(this.addr,t)}function wq(i,e){const t=$h(e,this.size,4);i.uniformMatrix2fv(this.addr,!1,t)}function Rq(i,e){const t=$h(e,this.size,9);i.uniformMatrix3fv(this.addr,!1,t)}function Cq(i,e){const t=$h(e,this.size,16);i.uniformMatrix4fv(this.addr,!1,t)}function Nq(i,e){i.uniform1iv(this.addr,e)}function Pq(i,e){i.uniform2iv(this.addr,e)}function Dq(i,e){i.uniform3iv(this.addr,e)}function Lq(i,e){i.uniform4iv(this.addr,e)}function Uq(i,e){i.uniform1uiv(this.addr,e)}function Oq(i,e){i.uniform2uiv(this.addr,e)}function Bq(i,e){i.uniform3uiv(this.addr,e)}function Iq(i,e){i.uniform4uiv(this.addr,e)}function Fq(i,e,t){const n=this.cache,r=e.length,s=Cv(t,r);Mi(n,s)||(i.uniform1iv(this.addr,s),Ei(n,s));for(let a=0;a!==r;++a)t.setTexture2D(e[a]||_O,s[a])}function kq(i,e,t){const n=this.cache,r=e.length,s=Cv(t,r);Mi(n,s)||(i.uniform1iv(this.addr,s),Ei(n,s));for(let a=0;a!==r;++a)t.setTexture3D(e[a]||bO,s[a])}function zq(i,e,t){const n=this.cache,r=e.length,s=Cv(t,r);Mi(n,s)||(i.uniform1iv(this.addr,s),Ei(n,s));for(let a=0;a!==r;++a)t.setTextureCube(e[a]||SO,s[a])}function Vq(i,e,t){const n=this.cache,r=e.length,s=Cv(t,r);Mi(n,s)||(i.uniform1iv(this.addr,s),Ei(n,s));for(let a=0;a!==r;++a)t.setTexture2DArray(e[a]||xO,s[a])}function Gq(i){switch(i){case 5126:return Tq;case 35664:return Mq;case 35665:return Eq;case 35666:return Aq;case 35674:return wq;case 35675:return Rq;case 35676:return Cq;case 5124:case 35670:return Nq;case 35667:case 35671:return Pq;case 35668:case 35672:return Dq;case 35669:case 35673:return Lq;case 5125:return Uq;case 36294:return Oq;case 36295:return Bq;case 36296:return Iq;case 35678:case 36198:case 36298:case 36306:case 35682:return Fq;case 35679:case 36299:case 36307:return kq;case 35680:case 36300:case 36308:case 36293:return zq;case 36289:case 36303:case 36311:case 36292:return Vq}}class Hq{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.setValue=Sq(t.type)}}class Wq{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=Gq(t.type)}}class jq{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const r=this.seq;for(let s=0,a=r.length;s!==a;++s){const l=r[s];l.setValue(e,t[l.id],n)}}}const tb=/(\w+)(\])?(\[|\.)?/g;function KN(i,e){i.seq.push(e),i.map[e.id]=e}function qq(i,e,t){const n=i.name,r=n.length;for(tb.lastIndex=0;;){const s=tb.exec(n),a=tb.lastIndex;let l=s[1];const u=s[2]==="]",h=s[3];if(u&&(l=l|0),h===void 0||h==="["&&a+2===r){KN(t,h===void 0?new Hq(l,i,e):new Wq(l,i,e));break}else{let p=t.map[l];p===void 0&&(p=new jq(l),KN(t,p)),t=p}}}class Ay{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let r=0;r<n;++r){const s=e.getActiveUniform(t,r),a=e.getUniformLocation(t,s.name);qq(s,a,this)}}setValue(e,t,n,r){const s=this.map[t];s!==void 0&&s.setValue(e,n,r)}setOptional(e,t,n){const r=t[n];r!==void 0&&this.setValue(e,n,r)}static upload(e,t,n,r){for(let s=0,a=t.length;s!==a;++s){const l=t[s],u=n[l.id];u.needsUpdate!==!1&&l.setValue(e,u.value,r)}}static seqWithValue(e,t){const n=[];for(let r=0,s=e.length;r!==s;++r){const a=e[r];a.id in t&&n.push(a)}return n}}function ZN(i,e,t){const n=i.createShader(e);return i.shaderSource(n,t),i.compileShader(n),n}const $q=37297;let Xq=0;function Yq(i,e){const t=i.split(`
`),n=[],r=Math.max(e-6,0),s=Math.min(e+6,t.length);for(let a=r;a<s;a++){const l=a+1;n.push(`${l===e?">":" "} ${l}: ${t[a]}`)}return n.join(`
`)}const QN=new Nt;function Kq(i){wt._getMatrix(QN,wt.workingColorSpace,i);const e=`mat3( ${QN.elements.map(t=>t.toFixed(4))} )`;switch(wt.getTransfer(i)){case Ch:return[e,"LinearTransferOETF"];case Ze:return[e,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",i),[e,"LinearTransferOETF"]}}function JN(i,e,t){const n=i.getShaderParameter(e,i.COMPILE_STATUS),r=i.getShaderInfoLog(e).trim();if(n&&r==="")return"";const s=/ERROR: 0:(\d+)/.exec(r);if(s){const a=parseInt(s[1]);return t.toUpperCase()+`

`+r+`

`+Yq(i.getShaderSource(e),a)}else return r}function Zq(i,e){const t=Kq(e);return[`vec4 ${i}( vec4 value ) {`,`	return ${t[1]}( vec4( value.rgb * ${t[0]}, value.a ) );`,"}"].join(`
`)}function Qq(i,e){let t;switch(e){case XU:t="Linear";break;case YU:t="Reinhard";break;case KU:t="Cineon";break;case ZU:t="ACESFilmic";break;case QU:t="AgX";break;case JU:t="Neutral";break;case u6:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+i+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}const Gg=new V;function Jq(){wt.getLuminanceCoefficients(Gg);const i=Gg.x.toFixed(4),e=Gg.y.toFixed(4),t=Gg.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${i}, ${e}, ${t} );`,"	return dot( weights, rgb );","}"].join(`
`)}function e$(i){return[i.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",i.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(Ad).join(`
`)}function t$(i){const e=[];for(const t in i){const n=i[t];n!==!1&&e.push("#define "+t+" "+n)}return e.join(`
`)}function n$(i,e){const t={},n=i.getProgramParameter(e,i.ACTIVE_ATTRIBUTES);for(let r=0;r<n;r++){const s=i.getActiveAttrib(e,r),a=s.name;let l=1;s.type===i.FLOAT_MAT2&&(l=2),s.type===i.FLOAT_MAT3&&(l=3),s.type===i.FLOAT_MAT4&&(l=4),t[a]={type:s.type,location:i.getAttribLocation(e,a),locationSize:l}}return t}function Ad(i){return i!==""}function eP(i,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return i.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function tP(i,e){return i.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const i$=/^[ \t]*#include +<([\w\d./]+)>/gm;function XS(i){return i.replace(i$,s$)}const r$=new Map;function s$(i,e){let t=zt[e];if(t===void 0){const n=r$.get(e);if(n!==void 0)t=zt[n],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,n);else throw new Error("Can not resolve #include <"+e+">")}return XS(t)}const a$=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function nP(i){return i.replace(a$,o$)}function o$(i,e,t,n){let r="";for(let s=parseInt(e);s<parseInt(t);s++)r+=n.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return r}function iP(i){let e=`precision ${i.precision} float;
	precision ${i.precision} int;
	precision ${i.precision} sampler2D;
	precision ${i.precision} samplerCube;
	precision ${i.precision} sampler3D;
	precision ${i.precision} sampler2DArray;
	precision ${i.precision} sampler2DShadow;
	precision ${i.precision} samplerCubeShadow;
	precision ${i.precision} sampler2DArrayShadow;
	precision ${i.precision} isampler2D;
	precision ${i.precision} isampler3D;
	precision ${i.precision} isamplerCube;
	precision ${i.precision} isampler2DArray;
	precision ${i.precision} usampler2D;
	precision ${i.precision} usampler3D;
	precision ${i.precision} usamplerCube;
	precision ${i.precision} usampler2DArray;
	`;return i.precision==="highp"?e+=`
#define HIGH_PRECISION`:i.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:i.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function l$(i){let e="SHADOWMAP_TYPE_BASIC";return i.shadowMapType===_M?e="SHADOWMAP_TYPE_PCF":i.shadowMapType===r6?e="SHADOWMAP_TYPE_PCF_SOFT":i.shadowMapType===Jr&&(e="SHADOWMAP_TYPE_VSM"),e}function u$(i){let e="ENVMAP_TYPE_CUBE";if(i.envMap)switch(i.envMapMode){case ha:case fa:e="ENVMAP_TYPE_CUBE";break;case Su:e="ENVMAP_TYPE_CUBE_UV";break}return e}function c$(i){let e="ENVMAP_MODE_REFLECTION";if(i.envMap)switch(i.envMapMode){case fa:e="ENVMAP_MODE_REFRACTION";break}return e}function h$(i){let e="ENVMAP_BLENDING_NONE";if(i.envMap)switch(i.combine){case zp:e="ENVMAP_BLENDING_MULTIPLY";break;case qU:e="ENVMAP_BLENDING_MIX";break;case $U:e="ENVMAP_BLENDING_ADD";break}return e}function f$(i){const e=i.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:n,maxMip:t}}function d$(i,e,t,n){const r=i.getContext(),s=t.defines;let a=t.vertexShader,l=t.fragmentShader;const u=l$(t),h=u$(t),d=c$(t),p=h$(t),g=f$(t),y=e$(t),v=t$(s),S=r.createProgram();let b,_,E=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(b=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,v].filter(Ad).join(`
`),b.length>0&&(b+=`
`),_=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,v].filter(Ad).join(`
`),_.length>0&&(_+=`
`)):(b=[iP(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,v,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.batchingColor?"#define USE_BATCHING_COLOR":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+d:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+u:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Ad).join(`
`),_=[iP(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,v,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+h:"",t.envMap?"#define "+d:"",t.envMap?"#define "+p:"",g?"#define CUBEUV_TEXEL_WIDTH "+g.texelWidth:"",g?"#define CUBEUV_TEXEL_HEIGHT "+g.texelHeight:"",g?"#define CUBEUV_MAX_MIP "+g.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor||t.batchingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+u:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==Or?"#define TONE_MAPPING":"",t.toneMapping!==Or?zt.tonemapping_pars_fragment:"",t.toneMapping!==Or?Qq("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",zt.colorspace_pars_fragment,Zq("linearToOutputTexel",t.outputColorSpace),Jq(),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(Ad).join(`
`)),a=XS(a),a=eP(a,t),a=tP(a,t),l=XS(l),l=eP(l,t),l=tP(l,t),a=nP(a),l=nP(l),t.isRawShaderMaterial!==!0&&(E=`#version 300 es
`,b=[y,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+b,_=["#define varying in",t.glslVersion===rN?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===rN?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+_);const M=E+b+a,A=E+_+l,w=ZN(r,r.VERTEX_SHADER,M),R=ZN(r,r.FRAGMENT_SHADER,A);r.attachShader(S,w),r.attachShader(S,R),t.index0AttributeName!==void 0?r.bindAttribLocation(S,0,t.index0AttributeName):t.morphTargets===!0&&r.bindAttribLocation(S,0,"position"),r.linkProgram(S);function C(I){if(i.debug.checkShaderErrors){const W=r.getProgramInfoLog(S).trim(),Y=r.getShaderInfoLog(w).trim(),oe=r.getShaderInfoLog(R).trim();let le=!0,z=!0;if(r.getProgramParameter(S,r.LINK_STATUS)===!1)if(le=!1,typeof i.debug.onShaderError=="function")i.debug.onShaderError(r,S,w,R);else{const k=JN(r,w,"vertex"),G=JN(r,R,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(S,r.VALIDATE_STATUS)+`

Material Name: `+I.name+`
Material Type: `+I.type+`

Program Info Log: `+W+`
`+k+`
`+G)}else W!==""?console.warn("THREE.WebGLProgram: Program Info Log:",W):(Y===""||oe==="")&&(z=!1);z&&(I.diagnostics={runnable:le,programLog:W,vertexShader:{log:Y,prefix:b},fragmentShader:{log:oe,prefix:_}})}r.deleteShader(w),r.deleteShader(R),L=new Ay(r,S),N=n$(r,S)}let L;this.getUniforms=function(){return L===void 0&&C(this),L};let N;this.getAttributes=function(){return N===void 0&&C(this),N};let D=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return D===!1&&(D=r.getProgramParameter(S,$q)),D},this.destroy=function(){n.releaseStatesOfProgram(this),r.deleteProgram(S),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=Xq++,this.cacheKey=e,this.usedTimes=1,this.program=S,this.vertexShader=w,this.fragmentShader=R,this}let p$=0;class m${constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,r=this._getShaderStage(t),s=this._getShaderStage(n),a=this._getShaderCacheForMaterial(e);return a.has(r)===!1&&(a.add(r),r.usedTimes++),a.has(s)===!1&&(a.add(s),s.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return n===void 0&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return n===void 0&&(n=new g$(e),t.set(e,n)),n}}class g${constructor(e){this.id=p$++,this.code=e,this.usedTimes=0}}function y$(i,e,t,n,r,s,a){const l=new WM,u=new m$,h=new Set,d=[],p=r.logarithmicDepthBuffer,g=r.vertexTextures;let y=r.precision;const v={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function S(N){return h.add(N),N===0?"uv":`uv${N}`}function b(N,D,I,W,Y){const oe=W.fog,le=Y.geometry,z=N.isMeshStandardMaterial?W.environment:null,k=(N.isMeshStandardMaterial?t:e).get(N.envMap||z),G=k&&k.mapping===Su?k.image.height:null,he=v[N.type];N.precision!==null&&(y=r.getMaxPrecision(N.precision),y!==N.precision&&console.warn("THREE.WebGLProgram.getParameters:",N.precision,"not supported, using",y,"instead."));const F=le.morphAttributes.position||le.morphAttributes.normal||le.morphAttributes.color,se=F!==void 0?F.length:0;let Me=0;le.morphAttributes.position!==void 0&&(Me=1),le.morphAttributes.normal!==void 0&&(Me=2),le.morphAttributes.color!==void 0&&(Me=3);let De,j,Z,$;if(he){const rn=ta[he];De=rn.vertexShader,j=rn.fragmentShader}else De=N.vertexShader,j=N.fragmentShader,u.update(N),Z=u.getVertexShaderID(N),$=u.getFragmentShaderID(N);const ne=i.getRenderTarget(),ve=i.state.buffers.depth.getReversed(),He=Y.isInstancedMesh===!0,Ve=Y.isBatchedMesh===!0,st=!!N.map,Lt=!!N.matcap,Rt=!!k,X=!!N.aoMap,mn=!!N.lightMap,jt=!!N.bumpMap,Ft=!!N.normalMap,at=!!N.displacementMap,Kt=!!N.emissiveMap,pt=!!N.metalnessMap,Pt=!!N.roughnessMap,Yn=N.anisotropy>0,H=N.clearcoat>0,U=N.dispersion>0,de=N.iridescence>0,we=N.sheen>0,Ce=N.transmission>0,Se=Yn&&!!N.anisotropyMap,Qe=H&&!!N.clearcoatMap,$e=H&&!!N.clearcoatNormalMap,rt=H&&!!N.clearcoatRoughnessMap,lt=de&&!!N.iridescenceMap,Be=de&&!!N.iridescenceThicknessMap,Je=we&&!!N.sheenColorMap,ft=we&&!!N.sheenRoughnessMap,dt=!!N.specularMap,je=!!N.specularColorMap,Ct=!!N.specularIntensityMap,J=Ce&&!!N.transmissionMap,Xe=Ce&&!!N.thicknessMap,Fe=!!N.gradientMap,et=!!N.alphaMap,ze=N.alphaTest>0,Pe=!!N.alphaHash,nt=!!N.extensions;let At=Or;N.toneMapped&&(ne===null||ne.isXRRenderTarget===!0)&&(At=i.toneMapping);const fn={shaderID:he,shaderType:N.type,shaderName:N.name,vertexShader:De,fragmentShader:j,defines:N.defines,customVertexShaderID:Z,customFragmentShaderID:$,isRawShaderMaterial:N.isRawShaderMaterial===!0,glslVersion:N.glslVersion,precision:y,batching:Ve,batchingColor:Ve&&Y._colorsTexture!==null,instancing:He,instancingColor:He&&Y.instanceColor!==null,instancingMorph:He&&Y.morphTexture!==null,supportsVertexTextures:g,outputColorSpace:ne===null?i.outputColorSpace:ne.isXRRenderTarget===!0?ne.texture.colorSpace:ca,alphaToCoverage:!!N.alphaToCoverage,map:st,matcap:Lt,envMap:Rt,envMapMode:Rt&&k.mapping,envMapCubeUVHeight:G,aoMap:X,lightMap:mn,bumpMap:jt,normalMap:Ft,displacementMap:g&&at,emissiveMap:Kt,normalMapObjectSpace:Ft&&N.normalMapType===eO,normalMapTangentSpace:Ft&&N.normalMapType===ho,metalnessMap:pt,roughnessMap:Pt,anisotropy:Yn,anisotropyMap:Se,clearcoat:H,clearcoatMap:Qe,clearcoatNormalMap:$e,clearcoatRoughnessMap:rt,dispersion:U,iridescence:de,iridescenceMap:lt,iridescenceThicknessMap:Be,sheen:we,sheenColorMap:Je,sheenRoughnessMap:ft,specularMap:dt,specularColorMap:je,specularIntensityMap:Ct,transmission:Ce,transmissionMap:J,thicknessMap:Xe,gradientMap:Fe,opaque:N.transparent===!1&&N.blending===es&&N.alphaToCoverage===!1,alphaMap:et,alphaTest:ze,alphaHash:Pe,combine:N.combine,mapUv:st&&S(N.map.channel),aoMapUv:X&&S(N.aoMap.channel),lightMapUv:mn&&S(N.lightMap.channel),bumpMapUv:jt&&S(N.bumpMap.channel),normalMapUv:Ft&&S(N.normalMap.channel),displacementMapUv:at&&S(N.displacementMap.channel),emissiveMapUv:Kt&&S(N.emissiveMap.channel),metalnessMapUv:pt&&S(N.metalnessMap.channel),roughnessMapUv:Pt&&S(N.roughnessMap.channel),anisotropyMapUv:Se&&S(N.anisotropyMap.channel),clearcoatMapUv:Qe&&S(N.clearcoatMap.channel),clearcoatNormalMapUv:$e&&S(N.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:rt&&S(N.clearcoatRoughnessMap.channel),iridescenceMapUv:lt&&S(N.iridescenceMap.channel),iridescenceThicknessMapUv:Be&&S(N.iridescenceThicknessMap.channel),sheenColorMapUv:Je&&S(N.sheenColorMap.channel),sheenRoughnessMapUv:ft&&S(N.sheenRoughnessMap.channel),specularMapUv:dt&&S(N.specularMap.channel),specularColorMapUv:je&&S(N.specularColorMap.channel),specularIntensityMapUv:Ct&&S(N.specularIntensityMap.channel),transmissionMapUv:J&&S(N.transmissionMap.channel),thicknessMapUv:Xe&&S(N.thicknessMap.channel),alphaMapUv:et&&S(N.alphaMap.channel),vertexTangents:!!le.attributes.tangent&&(Ft||Yn),vertexColors:N.vertexColors,vertexAlphas:N.vertexColors===!0&&!!le.attributes.color&&le.attributes.color.itemSize===4,pointsUvs:Y.isPoints===!0&&!!le.attributes.uv&&(st||et),fog:!!oe,useFog:N.fog===!0,fogExp2:!!oe&&oe.isFogExp2,flatShading:N.flatShading===!0,sizeAttenuation:N.sizeAttenuation===!0,logarithmicDepthBuffer:p,reverseDepthBuffer:ve,skinning:Y.isSkinnedMesh===!0,morphTargets:le.morphAttributes.position!==void 0,morphNormals:le.morphAttributes.normal!==void 0,morphColors:le.morphAttributes.color!==void 0,morphTargetsCount:se,morphTextureStride:Me,numDirLights:D.directional.length,numPointLights:D.point.length,numSpotLights:D.spot.length,numSpotLightMaps:D.spotLightMap.length,numRectAreaLights:D.rectArea.length,numHemiLights:D.hemi.length,numDirLightShadows:D.directionalShadowMap.length,numPointLightShadows:D.pointShadowMap.length,numSpotLightShadows:D.spotShadowMap.length,numSpotLightShadowsWithMaps:D.numSpotLightShadowsWithMaps,numLightProbes:D.numLightProbes,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:N.dithering,shadowMapEnabled:i.shadowMap.enabled&&I.length>0,shadowMapType:i.shadowMap.type,toneMapping:At,decodeVideoTexture:st&&N.map.isVideoTexture===!0&&wt.getTransfer(N.map.colorSpace)===Ze,decodeVideoTextureEmissive:Kt&&N.emissiveMap.isVideoTexture===!0&&wt.getTransfer(N.emissiveMap.colorSpace)===Ze,premultipliedAlpha:N.premultipliedAlpha,doubleSided:N.side===dr,flipSided:N.side===An,useDepthPacking:N.depthPacking>=0,depthPacking:N.depthPacking||0,index0AttributeName:N.index0AttributeName,extensionClipCullDistance:nt&&N.extensions.clipCullDistance===!0&&n.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(nt&&N.extensions.multiDraw===!0||Ve)&&n.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:n.has("KHR_parallel_shader_compile"),customProgramCacheKey:N.customProgramCacheKey()};return fn.vertexUv1s=h.has(1),fn.vertexUv2s=h.has(2),fn.vertexUv3s=h.has(3),h.clear(),fn}function _(N){const D=[];if(N.shaderID?D.push(N.shaderID):(D.push(N.customVertexShaderID),D.push(N.customFragmentShaderID)),N.defines!==void 0)for(const I in N.defines)D.push(I),D.push(N.defines[I]);return N.isRawShaderMaterial===!1&&(E(D,N),M(D,N),D.push(i.outputColorSpace)),D.push(N.customProgramCacheKey),D.join()}function E(N,D){N.push(D.precision),N.push(D.outputColorSpace),N.push(D.envMapMode),N.push(D.envMapCubeUVHeight),N.push(D.mapUv),N.push(D.alphaMapUv),N.push(D.lightMapUv),N.push(D.aoMapUv),N.push(D.bumpMapUv),N.push(D.normalMapUv),N.push(D.displacementMapUv),N.push(D.emissiveMapUv),N.push(D.metalnessMapUv),N.push(D.roughnessMapUv),N.push(D.anisotropyMapUv),N.push(D.clearcoatMapUv),N.push(D.clearcoatNormalMapUv),N.push(D.clearcoatRoughnessMapUv),N.push(D.iridescenceMapUv),N.push(D.iridescenceThicknessMapUv),N.push(D.sheenColorMapUv),N.push(D.sheenRoughnessMapUv),N.push(D.specularMapUv),N.push(D.specularColorMapUv),N.push(D.specularIntensityMapUv),N.push(D.transmissionMapUv),N.push(D.thicknessMapUv),N.push(D.combine),N.push(D.fogExp2),N.push(D.sizeAttenuation),N.push(D.morphTargetsCount),N.push(D.morphAttributeCount),N.push(D.numDirLights),N.push(D.numPointLights),N.push(D.numSpotLights),N.push(D.numSpotLightMaps),N.push(D.numHemiLights),N.push(D.numRectAreaLights),N.push(D.numDirLightShadows),N.push(D.numPointLightShadows),N.push(D.numSpotLightShadows),N.push(D.numSpotLightShadowsWithMaps),N.push(D.numLightProbes),N.push(D.shadowMapType),N.push(D.toneMapping),N.push(D.numClippingPlanes),N.push(D.numClipIntersection),N.push(D.depthPacking)}function M(N,D){l.disableAll(),D.supportsVertexTextures&&l.enable(0),D.instancing&&l.enable(1),D.instancingColor&&l.enable(2),D.instancingMorph&&l.enable(3),D.matcap&&l.enable(4),D.envMap&&l.enable(5),D.normalMapObjectSpace&&l.enable(6),D.normalMapTangentSpace&&l.enable(7),D.clearcoat&&l.enable(8),D.iridescence&&l.enable(9),D.alphaTest&&l.enable(10),D.vertexColors&&l.enable(11),D.vertexAlphas&&l.enable(12),D.vertexUv1s&&l.enable(13),D.vertexUv2s&&l.enable(14),D.vertexUv3s&&l.enable(15),D.vertexTangents&&l.enable(16),D.anisotropy&&l.enable(17),D.alphaHash&&l.enable(18),D.batching&&l.enable(19),D.dispersion&&l.enable(20),D.batchingColor&&l.enable(21),N.push(l.mask),l.disableAll(),D.fog&&l.enable(0),D.useFog&&l.enable(1),D.flatShading&&l.enable(2),D.logarithmicDepthBuffer&&l.enable(3),D.reverseDepthBuffer&&l.enable(4),D.skinning&&l.enable(5),D.morphTargets&&l.enable(6),D.morphNormals&&l.enable(7),D.morphColors&&l.enable(8),D.premultipliedAlpha&&l.enable(9),D.shadowMapEnabled&&l.enable(10),D.doubleSided&&l.enable(11),D.flipSided&&l.enable(12),D.useDepthPacking&&l.enable(13),D.dithering&&l.enable(14),D.transmission&&l.enable(15),D.sheen&&l.enable(16),D.opaque&&l.enable(17),D.pointsUvs&&l.enable(18),D.decodeVideoTexture&&l.enable(19),D.decodeVideoTextureEmissive&&l.enable(20),D.alphaToCoverage&&l.enable(21),N.push(l.mask)}function A(N){const D=v[N.type];let I;if(D){const W=ta[D];I=sO.clone(W.uniforms)}else I=N.uniforms;return I}function w(N,D){let I;for(let W=0,Y=d.length;W<Y;W++){const oe=d[W];if(oe.cacheKey===D){I=oe,++I.usedTimes;break}}return I===void 0&&(I=new d$(i,D,N,s),d.push(I)),I}function R(N){if(--N.usedTimes===0){const D=d.indexOf(N);d[D]=d[d.length-1],d.pop(),N.destroy()}}function C(N){u.remove(N)}function L(){u.dispose()}return{getParameters:b,getProgramCacheKey:_,getUniforms:A,acquireProgram:w,releaseProgram:R,releaseShaderCache:C,programs:d,dispose:L}}function v$(){let i=new WeakMap;function e(a){return i.has(a)}function t(a){let l=i.get(a);return l===void 0&&(l={},i.set(a,l)),l}function n(a){i.delete(a)}function r(a,l,u){i.get(a)[l]=u}function s(){i=new WeakMap}return{has:e,get:t,remove:n,update:r,dispose:s}}function _$(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.material.id!==e.material.id?i.material.id-e.material.id:i.z!==e.z?i.z-e.z:i.id-e.id}function rP(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.z!==e.z?e.z-i.z:i.id-e.id}function sP(){const i=[];let e=0;const t=[],n=[],r=[];function s(){e=0,t.length=0,n.length=0,r.length=0}function a(p,g,y,v,S,b){let _=i[e];return _===void 0?(_={id:p.id,object:p,geometry:g,material:y,groupOrder:v,renderOrder:p.renderOrder,z:S,group:b},i[e]=_):(_.id=p.id,_.object=p,_.geometry=g,_.material=y,_.groupOrder=v,_.renderOrder=p.renderOrder,_.z=S,_.group=b),e++,_}function l(p,g,y,v,S,b){const _=a(p,g,y,v,S,b);y.transmission>0?n.push(_):y.transparent===!0?r.push(_):t.push(_)}function u(p,g,y,v,S,b){const _=a(p,g,y,v,S,b);y.transmission>0?n.unshift(_):y.transparent===!0?r.unshift(_):t.unshift(_)}function h(p,g){t.length>1&&t.sort(p||_$),n.length>1&&n.sort(g||rP),r.length>1&&r.sort(g||rP)}function d(){for(let p=e,g=i.length;p<g;p++){const y=i[p];if(y.id===null)break;y.id=null,y.object=null,y.geometry=null,y.material=null,y.group=null}}return{opaque:t,transmissive:n,transparent:r,init:s,push:l,unshift:u,finish:d,sort:h}}function x$(){let i=new WeakMap;function e(n,r){const s=i.get(n);let a;return s===void 0?(a=new sP,i.set(n,[a])):r>=s.length?(a=new sP,s.push(a)):a=s[r],a}function t(){i=new WeakMap}return{get:e,dispose:t}}function b$(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new V,color:new ot};break;case"SpotLight":t={position:new V,direction:new V,color:new ot,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new V,color:new ot,distance:0,decay:0};break;case"HemisphereLight":t={direction:new V,skyColor:new ot,groundColor:new ot};break;case"RectAreaLight":t={color:new ot,position:new V,halfWidth:new V,halfHeight:new V};break}return i[e.id]=t,t}}}function S$(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Le};break;case"SpotLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Le};break;case"PointLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Le,shadowCameraNear:1,shadowCameraFar:1e3};break}return i[e.id]=t,t}}}let T$=0;function M$(i,e){return(e.castShadow?2:0)-(i.castShadow?2:0)+(e.map?1:0)-(i.map?1:0)}function E$(i){const e=new b$,t=S$(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let h=0;h<9;h++)n.probe.push(new V);const r=new V,s=new Wt,a=new Wt;function l(h){let d=0,p=0,g=0;for(let N=0;N<9;N++)n.probe[N].set(0,0,0);let y=0,v=0,S=0,b=0,_=0,E=0,M=0,A=0,w=0,R=0,C=0;h.sort(M$);for(let N=0,D=h.length;N<D;N++){const I=h[N],W=I.color,Y=I.intensity,oe=I.distance,le=I.shadow&&I.shadow.map?I.shadow.map.texture:null;if(I.isAmbientLight)d+=W.r*Y,p+=W.g*Y,g+=W.b*Y;else if(I.isLightProbe){for(let z=0;z<9;z++)n.probe[z].addScaledVector(I.sh.coefficients[z],Y);C++}else if(I.isDirectionalLight){const z=e.get(I);if(z.color.copy(I.color).multiplyScalar(I.intensity),I.castShadow){const k=I.shadow,G=t.get(I);G.shadowIntensity=k.intensity,G.shadowBias=k.bias,G.shadowNormalBias=k.normalBias,G.shadowRadius=k.radius,G.shadowMapSize=k.mapSize,n.directionalShadow[y]=G,n.directionalShadowMap[y]=le,n.directionalShadowMatrix[y]=I.shadow.matrix,E++}n.directional[y]=z,y++}else if(I.isSpotLight){const z=e.get(I);z.position.setFromMatrixPosition(I.matrixWorld),z.color.copy(W).multiplyScalar(Y),z.distance=oe,z.coneCos=Math.cos(I.angle),z.penumbraCos=Math.cos(I.angle*(1-I.penumbra)),z.decay=I.decay,n.spot[S]=z;const k=I.shadow;if(I.map&&(n.spotLightMap[w]=I.map,w++,k.updateMatrices(I),I.castShadow&&R++),n.spotLightMatrix[S]=k.matrix,I.castShadow){const G=t.get(I);G.shadowIntensity=k.intensity,G.shadowBias=k.bias,G.shadowNormalBias=k.normalBias,G.shadowRadius=k.radius,G.shadowMapSize=k.mapSize,n.spotShadow[S]=G,n.spotShadowMap[S]=le,A++}S++}else if(I.isRectAreaLight){const z=e.get(I);z.color.copy(W).multiplyScalar(Y),z.halfWidth.set(I.width*.5,0,0),z.halfHeight.set(0,I.height*.5,0),n.rectArea[b]=z,b++}else if(I.isPointLight){const z=e.get(I);if(z.color.copy(I.color).multiplyScalar(I.intensity),z.distance=I.distance,z.decay=I.decay,I.castShadow){const k=I.shadow,G=t.get(I);G.shadowIntensity=k.intensity,G.shadowBias=k.bias,G.shadowNormalBias=k.normalBias,G.shadowRadius=k.radius,G.shadowMapSize=k.mapSize,G.shadowCameraNear=k.camera.near,G.shadowCameraFar=k.camera.far,n.pointShadow[v]=G,n.pointShadowMap[v]=le,n.pointShadowMatrix[v]=I.shadow.matrix,M++}n.point[v]=z,v++}else if(I.isHemisphereLight){const z=e.get(I);z.skyColor.copy(I.color).multiplyScalar(Y),z.groundColor.copy(I.groundColor).multiplyScalar(Y),n.hemi[_]=z,_++}}b>0&&(i.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=Ye.LTC_FLOAT_1,n.rectAreaLTC2=Ye.LTC_FLOAT_2):(n.rectAreaLTC1=Ye.LTC_HALF_1,n.rectAreaLTC2=Ye.LTC_HALF_2)),n.ambient[0]=d,n.ambient[1]=p,n.ambient[2]=g;const L=n.hash;(L.directionalLength!==y||L.pointLength!==v||L.spotLength!==S||L.rectAreaLength!==b||L.hemiLength!==_||L.numDirectionalShadows!==E||L.numPointShadows!==M||L.numSpotShadows!==A||L.numSpotMaps!==w||L.numLightProbes!==C)&&(n.directional.length=y,n.spot.length=S,n.rectArea.length=b,n.point.length=v,n.hemi.length=_,n.directionalShadow.length=E,n.directionalShadowMap.length=E,n.pointShadow.length=M,n.pointShadowMap.length=M,n.spotShadow.length=A,n.spotShadowMap.length=A,n.directionalShadowMatrix.length=E,n.pointShadowMatrix.length=M,n.spotLightMatrix.length=A+w-R,n.spotLightMap.length=w,n.numSpotLightShadowsWithMaps=R,n.numLightProbes=C,L.directionalLength=y,L.pointLength=v,L.spotLength=S,L.rectAreaLength=b,L.hemiLength=_,L.numDirectionalShadows=E,L.numPointShadows=M,L.numSpotShadows=A,L.numSpotMaps=w,L.numLightProbes=C,n.version=T$++)}function u(h,d){let p=0,g=0,y=0,v=0,S=0;const b=d.matrixWorldInverse;for(let _=0,E=h.length;_<E;_++){const M=h[_];if(M.isDirectionalLight){const A=n.directional[p];A.direction.setFromMatrixPosition(M.matrixWorld),r.setFromMatrixPosition(M.target.matrixWorld),A.direction.sub(r),A.direction.transformDirection(b),p++}else if(M.isSpotLight){const A=n.spot[y];A.position.setFromMatrixPosition(M.matrixWorld),A.position.applyMatrix4(b),A.direction.setFromMatrixPosition(M.matrixWorld),r.setFromMatrixPosition(M.target.matrixWorld),A.direction.sub(r),A.direction.transformDirection(b),y++}else if(M.isRectAreaLight){const A=n.rectArea[v];A.position.setFromMatrixPosition(M.matrixWorld),A.position.applyMatrix4(b),a.identity(),s.copy(M.matrixWorld),s.premultiply(b),a.extractRotation(s),A.halfWidth.set(M.width*.5,0,0),A.halfHeight.set(0,M.height*.5,0),A.halfWidth.applyMatrix4(a),A.halfHeight.applyMatrix4(a),v++}else if(M.isPointLight){const A=n.point[g];A.position.setFromMatrixPosition(M.matrixWorld),A.position.applyMatrix4(b),g++}else if(M.isHemisphereLight){const A=n.hemi[S];A.direction.setFromMatrixPosition(M.matrixWorld),A.direction.transformDirection(b),S++}}}return{setup:l,setupView:u,state:n}}function aP(i){const e=new E$(i),t=[],n=[];function r(d){h.camera=d,t.length=0,n.length=0}function s(d){t.push(d)}function a(d){n.push(d)}function l(){e.setup(t)}function u(d){e.setupView(t,d)}const h={lightsArray:t,shadowsArray:n,camera:null,lights:e,transmissionRenderTarget:{}};return{init:r,state:h,setupLights:l,setupLightsView:u,pushLight:s,pushShadow:a}}function A$(i){let e=new WeakMap;function t(r,s=0){const a=e.get(r);let l;return a===void 0?(l=new aP(i),e.set(r,[l])):s>=a.length?(l=new aP(i),a.push(l)):l=a[s],l}function n(){e=new WeakMap}return{get:t,dispose:n}}const w$=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,R$=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function C$(i,e,t){let n=new jp;const r=new Le,s=new Le,a=new bt,l=new G8({depthPacking:f6}),u=new H8,h={},d=t.maxTextureSize,p={[Lr]:An,[An]:Lr,[dr]:dr},g=new da({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Le},radius:{value:4}},vertexShader:w$,fragmentShader:R$}),y=g.clone();y.defines.HORIZONTAL_PASS=1;const v=new ar;v.setAttribute("position",new Wi(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const S=new fi(v,g),b=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=_M;let _=this.type;this.render=function(R,C,L){if(b.enabled===!1||b.autoUpdate===!1&&b.needsUpdate===!1||R.length===0)return;const N=i.getRenderTarget(),D=i.getActiveCubeFace(),I=i.getActiveMipmapLevel(),W=i.state;W.setBlending(Ur),W.buffers.color.setClear(1,1,1,1),W.buffers.depth.setTest(!0),W.setScissorTest(!1);const Y=_!==Jr&&this.type===Jr,oe=_===Jr&&this.type!==Jr;for(let le=0,z=R.length;le<z;le++){const k=R[le],G=k.shadow;if(G===void 0){console.warn("THREE.WebGLShadowMap:",k,"has no shadow.");continue}if(G.autoUpdate===!1&&G.needsUpdate===!1)continue;r.copy(G.mapSize);const he=G.getFrameExtents();if(r.multiply(he),s.copy(G.mapSize),(r.x>d||r.y>d)&&(r.x>d&&(s.x=Math.floor(d/he.x),r.x=s.x*he.x,G.mapSize.x=s.x),r.y>d&&(s.y=Math.floor(d/he.y),r.y=s.y*he.y,G.mapSize.y=s.y)),G.map===null||Y===!0||oe===!0){const se=this.type!==Jr?{minFilter:Pn,magFilter:Pn}:{};G.map!==null&&G.map.dispose(),G.map=new dl(r.x,r.y,se),G.map.texture.name=k.name+".shadowMap",G.camera.updateProjectionMatrix()}i.setRenderTarget(G.map),i.clear();const F=G.getViewportCount();for(let se=0;se<F;se++){const Me=G.getViewport(se);a.set(s.x*Me.x,s.y*Me.y,s.x*Me.z,s.y*Me.w),W.viewport(a),G.updateMatrices(k,se),n=G.getFrustum(),A(C,L,G.camera,k,this.type)}G.isPointLightShadow!==!0&&this.type===Jr&&E(G,L),G.needsUpdate=!1}_=this.type,b.needsUpdate=!1,i.setRenderTarget(N,D,I)};function E(R,C){const L=e.update(S);g.defines.VSM_SAMPLES!==R.blurSamples&&(g.defines.VSM_SAMPLES=R.blurSamples,y.defines.VSM_SAMPLES=R.blurSamples,g.needsUpdate=!0,y.needsUpdate=!0),R.mapPass===null&&(R.mapPass=new dl(r.x,r.y)),g.uniforms.shadow_pass.value=R.map.texture,g.uniforms.resolution.value=R.mapSize,g.uniforms.radius.value=R.radius,i.setRenderTarget(R.mapPass),i.clear(),i.renderBufferDirect(C,null,L,g,S,null),y.uniforms.shadow_pass.value=R.mapPass.texture,y.uniforms.resolution.value=R.mapSize,y.uniforms.radius.value=R.radius,i.setRenderTarget(R.map),i.clear(),i.renderBufferDirect(C,null,L,y,S,null)}function M(R,C,L,N){let D=null;const I=L.isPointLight===!0?R.customDistanceMaterial:R.customDepthMaterial;if(I!==void 0)D=I;else if(D=L.isPointLight===!0?u:l,i.localClippingEnabled&&C.clipShadows===!0&&Array.isArray(C.clippingPlanes)&&C.clippingPlanes.length!==0||C.displacementMap&&C.displacementScale!==0||C.alphaMap&&C.alphaTest>0||C.map&&C.alphaTest>0||C.alphaToCoverage===!0){const W=D.uuid,Y=C.uuid;let oe=h[W];oe===void 0&&(oe={},h[W]=oe);let le=oe[Y];le===void 0&&(le=D.clone(),oe[Y]=le,C.addEventListener("dispose",w)),D=le}if(D.visible=C.visible,D.wireframe=C.wireframe,N===Jr?D.side=C.shadowSide!==null?C.shadowSide:C.side:D.side=C.shadowSide!==null?C.shadowSide:p[C.side],D.alphaMap=C.alphaMap,D.alphaTest=C.alphaToCoverage===!0?.5:C.alphaTest,D.map=C.map,D.clipShadows=C.clipShadows,D.clippingPlanes=C.clippingPlanes,D.clipIntersection=C.clipIntersection,D.displacementMap=C.displacementMap,D.displacementScale=C.displacementScale,D.displacementBias=C.displacementBias,D.wireframeLinewidth=C.wireframeLinewidth,D.linewidth=C.linewidth,L.isPointLight===!0&&D.isMeshDistanceMaterial===!0){const W=i.properties.get(D);W.light=L}return D}function A(R,C,L,N,D){if(R.visible===!1)return;if(R.layers.test(C.layers)&&(R.isMesh||R.isLine||R.isPoints)&&(R.castShadow||R.receiveShadow&&D===Jr)&&(!R.frustumCulled||n.intersectsObject(R))){R.modelViewMatrix.multiplyMatrices(L.matrixWorldInverse,R.matrixWorld);const Y=e.update(R),oe=R.material;if(Array.isArray(oe)){const le=Y.groups;for(let z=0,k=le.length;z<k;z++){const G=le[z],he=oe[G.materialIndex];if(he&&he.visible){const F=M(R,he,N,D);R.onBeforeShadow(i,R,C,L,Y,F,G),i.renderBufferDirect(L,null,Y,F,R,G),R.onAfterShadow(i,R,C,L,Y,F,G)}}}else if(oe.visible){const le=M(R,oe,N,D);R.onBeforeShadow(i,R,C,L,Y,le,null),i.renderBufferDirect(L,null,Y,le,R,null),R.onAfterShadow(i,R,C,L,Y,le,null)}}const W=R.children;for(let Y=0,oe=W.length;Y<oe;Y++)A(W[Y],C,L,N,D)}function w(R){R.target.removeEventListener("dispose",w);for(const L in h){const N=h[L],D=R.target.uuid;D in N&&(N[D].dispose(),delete N[D])}}}const N$={[lp]:up,[cp]:dp,[hp]:pp,[hl]:fp,[up]:lp,[dp]:cp,[pp]:hp,[fp]:hl};function P$(i,e){function t(){let J=!1;const Xe=new bt;let Fe=null;const et=new bt(0,0,0,0);return{setMask:function(ze){Fe!==ze&&!J&&(i.colorMask(ze,ze,ze,ze),Fe=ze)},setLocked:function(ze){J=ze},setClear:function(ze,Pe,nt,At,fn){fn===!0&&(ze*=At,Pe*=At,nt*=At),Xe.set(ze,Pe,nt,At),et.equals(Xe)===!1&&(i.clearColor(ze,Pe,nt,At),et.copy(Xe))},reset:function(){J=!1,Fe=null,et.set(-1,0,0,0)}}}function n(){let J=!1,Xe=!1,Fe=null,et=null,ze=null;return{setReversed:function(Pe){if(Xe!==Pe){const nt=e.get("EXT_clip_control");Pe?nt.clipControlEXT(nt.LOWER_LEFT_EXT,nt.ZERO_TO_ONE_EXT):nt.clipControlEXT(nt.LOWER_LEFT_EXT,nt.NEGATIVE_ONE_TO_ONE_EXT),Xe=Pe;const At=ze;ze=null,this.setClear(At)}},getReversed:function(){return Xe},setTest:function(Pe){Pe?ne(i.DEPTH_TEST):ve(i.DEPTH_TEST)},setMask:function(Pe){Fe!==Pe&&!J&&(i.depthMask(Pe),Fe=Pe)},setFunc:function(Pe){if(Xe&&(Pe=N$[Pe]),et!==Pe){switch(Pe){case lp:i.depthFunc(i.NEVER);break;case up:i.depthFunc(i.ALWAYS);break;case cp:i.depthFunc(i.LESS);break;case hl:i.depthFunc(i.LEQUAL);break;case hp:i.depthFunc(i.EQUAL);break;case fp:i.depthFunc(i.GEQUAL);break;case dp:i.depthFunc(i.GREATER);break;case pp:i.depthFunc(i.NOTEQUAL);break;default:i.depthFunc(i.LEQUAL)}et=Pe}},setLocked:function(Pe){J=Pe},setClear:function(Pe){ze!==Pe&&(Xe&&(Pe=1-Pe),i.clearDepth(Pe),ze=Pe)},reset:function(){J=!1,Fe=null,et=null,ze=null,Xe=!1}}}function r(){let J=!1,Xe=null,Fe=null,et=null,ze=null,Pe=null,nt=null,At=null,fn=null;return{setTest:function(rn){J||(rn?ne(i.STENCIL_TEST):ve(i.STENCIL_TEST))},setMask:function(rn){Xe!==rn&&!J&&(i.stencilMask(rn),Xe=rn)},setFunc:function(rn,kr,Ai){(Fe!==rn||et!==kr||ze!==Ai)&&(i.stencilFunc(rn,kr,Ai),Fe=rn,et=kr,ze=Ai)},setOp:function(rn,kr,Ai){(Pe!==rn||nt!==kr||At!==Ai)&&(i.stencilOp(rn,kr,Ai),Pe=rn,nt=kr,At=Ai)},setLocked:function(rn){J=rn},setClear:function(rn){fn!==rn&&(i.clearStencil(rn),fn=rn)},reset:function(){J=!1,Xe=null,Fe=null,et=null,ze=null,Pe=null,nt=null,At=null,fn=null}}}const s=new t,a=new n,l=new r,u=new WeakMap,h=new WeakMap;let d={},p={},g=new WeakMap,y=[],v=null,S=!1,b=null,_=null,E=null,M=null,A=null,w=null,R=null,C=new ot(0,0,0),L=0,N=!1,D=null,I=null,W=null,Y=null,oe=null;const le=i.getParameter(i.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let z=!1,k=0;const G=i.getParameter(i.VERSION);G.indexOf("WebGL")!==-1?(k=parseFloat(/^WebGL (\d)/.exec(G)[1]),z=k>=1):G.indexOf("OpenGL ES")!==-1&&(k=parseFloat(/^OpenGL ES (\d)/.exec(G)[1]),z=k>=2);let he=null,F={};const se=i.getParameter(i.SCISSOR_BOX),Me=i.getParameter(i.VIEWPORT),De=new bt().fromArray(se),j=new bt().fromArray(Me);function Z(J,Xe,Fe,et){const ze=new Uint8Array(4),Pe=i.createTexture();i.bindTexture(J,Pe),i.texParameteri(J,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(J,i.TEXTURE_MAG_FILTER,i.NEAREST);for(let nt=0;nt<Fe;nt++)J===i.TEXTURE_3D||J===i.TEXTURE_2D_ARRAY?i.texImage3D(Xe,0,i.RGBA,1,1,et,0,i.RGBA,i.UNSIGNED_BYTE,ze):i.texImage2D(Xe+nt,0,i.RGBA,1,1,0,i.RGBA,i.UNSIGNED_BYTE,ze);return Pe}const $={};$[i.TEXTURE_2D]=Z(i.TEXTURE_2D,i.TEXTURE_2D,1),$[i.TEXTURE_CUBE_MAP]=Z(i.TEXTURE_CUBE_MAP,i.TEXTURE_CUBE_MAP_POSITIVE_X,6),$[i.TEXTURE_2D_ARRAY]=Z(i.TEXTURE_2D_ARRAY,i.TEXTURE_2D_ARRAY,1,1),$[i.TEXTURE_3D]=Z(i.TEXTURE_3D,i.TEXTURE_3D,1,1),s.setClear(0,0,0,1),a.setClear(1),l.setClear(0),ne(i.DEPTH_TEST),a.setFunc(hl),jt(!1),Ft(HS),ne(i.CULL_FACE),X(Ur);function ne(J){d[J]!==!0&&(i.enable(J),d[J]=!0)}function ve(J){d[J]!==!1&&(i.disable(J),d[J]=!1)}function He(J,Xe){return p[J]!==Xe?(i.bindFramebuffer(J,Xe),p[J]=Xe,J===i.DRAW_FRAMEBUFFER&&(p[i.FRAMEBUFFER]=Xe),J===i.FRAMEBUFFER&&(p[i.DRAW_FRAMEBUFFER]=Xe),!0):!1}function Ve(J,Xe){let Fe=y,et=!1;if(J){Fe=g.get(Xe),Fe===void 0&&(Fe=[],g.set(Xe,Fe));const ze=J.textures;if(Fe.length!==ze.length||Fe[0]!==i.COLOR_ATTACHMENT0){for(let Pe=0,nt=ze.length;Pe<nt;Pe++)Fe[Pe]=i.COLOR_ATTACHMENT0+Pe;Fe.length=ze.length,et=!0}}else Fe[0]!==i.BACK&&(Fe[0]=i.BACK,et=!0);et&&i.drawBuffers(Fe)}function st(J){return v!==J?(i.useProgram(J),v=J,!0):!1}const Lt={[er]:i.FUNC_ADD,[xM]:i.FUNC_SUBTRACT,[bM]:i.FUNC_REVERSE_SUBTRACT};Lt[WU]=i.MIN,Lt[jU]=i.MAX;const Rt={[qa]:i.ZERO,[SM]:i.ONE,[TM]:i.SRC_COLOR,[ap]:i.SRC_ALPHA,[CM]:i.SRC_ALPHA_SATURATE,[wM]:i.DST_COLOR,[EM]:i.DST_ALPHA,[MM]:i.ONE_MINUS_SRC_COLOR,[op]:i.ONE_MINUS_SRC_ALPHA,[RM]:i.ONE_MINUS_DST_COLOR,[AM]:i.ONE_MINUS_DST_ALPHA,[s6]:i.CONSTANT_COLOR,[a6]:i.ONE_MINUS_CONSTANT_COLOR,[o6]:i.CONSTANT_ALPHA,[l6]:i.ONE_MINUS_CONSTANT_ALPHA};function X(J,Xe,Fe,et,ze,Pe,nt,At,fn,rn){if(J===Ur){S===!0&&(ve(i.BLEND),S=!1);return}if(S===!1&&(ne(i.BLEND),S=!0),J!==Zc){if(J!==b||rn!==N){if((_!==er||A!==er)&&(i.blendEquation(i.FUNC_ADD),_=er,A=er),rn)switch(J){case es:i.blendFuncSeparate(i.ONE,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA);break;case lh:i.blendFunc(i.ONE,i.ONE);break;case uh:i.blendFuncSeparate(i.ZERO,i.ONE_MINUS_SRC_COLOR,i.ZERO,i.ONE);break;case ch:i.blendFuncSeparate(i.ZERO,i.SRC_COLOR,i.ZERO,i.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",J);break}else switch(J){case es:i.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA);break;case lh:i.blendFunc(i.SRC_ALPHA,i.ONE);break;case uh:i.blendFuncSeparate(i.ZERO,i.ONE_MINUS_SRC_COLOR,i.ZERO,i.ONE);break;case ch:i.blendFunc(i.ZERO,i.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",J);break}E=null,M=null,w=null,R=null,C.set(0,0,0),L=0,b=J,N=rn}return}ze=ze||Xe,Pe=Pe||Fe,nt=nt||et,(Xe!==_||ze!==A)&&(i.blendEquationSeparate(Lt[Xe],Lt[ze]),_=Xe,A=ze),(Fe!==E||et!==M||Pe!==w||nt!==R)&&(i.blendFuncSeparate(Rt[Fe],Rt[et],Rt[Pe],Rt[nt]),E=Fe,M=et,w=Pe,R=nt),(At.equals(C)===!1||fn!==L)&&(i.blendColor(At.r,At.g,At.b,fn),C.copy(At),L=fn),b=J,N=!1}function mn(J,Xe){J.side===dr?ve(i.CULL_FACE):ne(i.CULL_FACE);let Fe=J.side===An;Xe&&(Fe=!Fe),jt(Fe),J.blending===es&&J.transparent===!1?X(Ur):X(J.blending,J.blendEquation,J.blendSrc,J.blendDst,J.blendEquationAlpha,J.blendSrcAlpha,J.blendDstAlpha,J.blendColor,J.blendAlpha,J.premultipliedAlpha),a.setFunc(J.depthFunc),a.setTest(J.depthTest),a.setMask(J.depthWrite),s.setMask(J.colorWrite);const et=J.stencilWrite;l.setTest(et),et&&(l.setMask(J.stencilWriteMask),l.setFunc(J.stencilFunc,J.stencilRef,J.stencilFuncMask),l.setOp(J.stencilFail,J.stencilZFail,J.stencilZPass)),Kt(J.polygonOffset,J.polygonOffsetFactor,J.polygonOffsetUnits),J.alphaToCoverage===!0?ne(i.SAMPLE_ALPHA_TO_COVERAGE):ve(i.SAMPLE_ALPHA_TO_COVERAGE)}function jt(J){D!==J&&(J?i.frontFace(i.CW):i.frontFace(i.CCW),D=J)}function Ft(J){J!==GU?(ne(i.CULL_FACE),J!==I&&(J===HS?i.cullFace(i.BACK):J===HU?i.cullFace(i.FRONT):i.cullFace(i.FRONT_AND_BACK))):ve(i.CULL_FACE),I=J}function at(J){J!==W&&(z&&i.lineWidth(J),W=J)}function Kt(J,Xe,Fe){J?(ne(i.POLYGON_OFFSET_FILL),(Y!==Xe||oe!==Fe)&&(i.polygonOffset(Xe,Fe),Y=Xe,oe=Fe)):ve(i.POLYGON_OFFSET_FILL)}function pt(J){J?ne(i.SCISSOR_TEST):ve(i.SCISSOR_TEST)}function Pt(J){J===void 0&&(J=i.TEXTURE0+le-1),he!==J&&(i.activeTexture(J),he=J)}function Yn(J,Xe,Fe){Fe===void 0&&(he===null?Fe=i.TEXTURE0+le-1:Fe=he);let et=F[Fe];et===void 0&&(et={type:void 0,texture:void 0},F[Fe]=et),(et.type!==J||et.texture!==Xe)&&(he!==Fe&&(i.activeTexture(Fe),he=Fe),i.bindTexture(J,Xe||$[J]),et.type=J,et.texture=Xe)}function H(){const J=F[he];J!==void 0&&J.type!==void 0&&(i.bindTexture(J.type,null),J.type=void 0,J.texture=void 0)}function U(){try{i.compressedTexImage2D(...arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function de(){try{i.compressedTexImage3D(...arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function we(){try{i.texSubImage2D(...arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function Ce(){try{i.texSubImage3D(...arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function Se(){try{i.compressedTexSubImage2D(...arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function Qe(){try{i.compressedTexSubImage3D(...arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function $e(){try{i.texStorage2D(...arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function rt(){try{i.texStorage3D(...arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function lt(){try{i.texImage2D(...arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function Be(){try{i.texImage3D(...arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function Je(J){De.equals(J)===!1&&(i.scissor(J.x,J.y,J.z,J.w),De.copy(J))}function ft(J){j.equals(J)===!1&&(i.viewport(J.x,J.y,J.z,J.w),j.copy(J))}function dt(J,Xe){let Fe=h.get(Xe);Fe===void 0&&(Fe=new WeakMap,h.set(Xe,Fe));let et=Fe.get(J);et===void 0&&(et=i.getUniformBlockIndex(Xe,J.name),Fe.set(J,et))}function je(J,Xe){const et=h.get(Xe).get(J);u.get(Xe)!==et&&(i.uniformBlockBinding(Xe,et,J.__bindingPointIndex),u.set(Xe,et))}function Ct(){i.disable(i.BLEND),i.disable(i.CULL_FACE),i.disable(i.DEPTH_TEST),i.disable(i.POLYGON_OFFSET_FILL),i.disable(i.SCISSOR_TEST),i.disable(i.STENCIL_TEST),i.disable(i.SAMPLE_ALPHA_TO_COVERAGE),i.blendEquation(i.FUNC_ADD),i.blendFunc(i.ONE,i.ZERO),i.blendFuncSeparate(i.ONE,i.ZERO,i.ONE,i.ZERO),i.blendColor(0,0,0,0),i.colorMask(!0,!0,!0,!0),i.clearColor(0,0,0,0),i.depthMask(!0),i.depthFunc(i.LESS),a.setReversed(!1),i.clearDepth(1),i.stencilMask(4294967295),i.stencilFunc(i.ALWAYS,0,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.KEEP),i.clearStencil(0),i.cullFace(i.BACK),i.frontFace(i.CCW),i.polygonOffset(0,0),i.activeTexture(i.TEXTURE0),i.bindFramebuffer(i.FRAMEBUFFER,null),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,null),i.bindFramebuffer(i.READ_FRAMEBUFFER,null),i.useProgram(null),i.lineWidth(1),i.scissor(0,0,i.canvas.width,i.canvas.height),i.viewport(0,0,i.canvas.width,i.canvas.height),d={},he=null,F={},p={},g=new WeakMap,y=[],v=null,S=!1,b=null,_=null,E=null,M=null,A=null,w=null,R=null,C=new ot(0,0,0),L=0,N=!1,D=null,I=null,W=null,Y=null,oe=null,De.set(0,0,i.canvas.width,i.canvas.height),j.set(0,0,i.canvas.width,i.canvas.height),s.reset(),a.reset(),l.reset()}return{buffers:{color:s,depth:a,stencil:l},enable:ne,disable:ve,bindFramebuffer:He,drawBuffers:Ve,useProgram:st,setBlending:X,setMaterial:mn,setFlipSided:jt,setCullFace:Ft,setLineWidth:at,setPolygonOffset:Kt,setScissorTest:pt,activeTexture:Pt,bindTexture:Yn,unbindTexture:H,compressedTexImage2D:U,compressedTexImage3D:de,texImage2D:lt,texImage3D:Be,updateUBOMapping:dt,uniformBlockBinding:je,texStorage2D:$e,texStorage3D:rt,texSubImage2D:we,texSubImage3D:Ce,compressedTexSubImage2D:Se,compressedTexSubImage3D:Qe,scissor:Je,viewport:ft,reset:Ct}}function D$(i,e,t,n,r,s,a){const l=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,u=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),h=new Le,d=new WeakMap;let p;const g=new WeakMap;let y=!1;try{y=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function v(H,U){return y?new OffscreenCanvas(H,U):Tp("canvas")}function S(H,U,de){let we=1;const Ce=Yn(H);if((Ce.width>de||Ce.height>de)&&(we=de/Math.max(Ce.width,Ce.height)),we<1)if(typeof HTMLImageElement<"u"&&H instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&H instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&H instanceof ImageBitmap||typeof VideoFrame<"u"&&H instanceof VideoFrame){const Se=Math.floor(we*Ce.width),Qe=Math.floor(we*Ce.height);p===void 0&&(p=v(Se,Qe));const $e=U?v(Se,Qe):p;return $e.width=Se,$e.height=Qe,$e.getContext("2d").drawImage(H,0,0,Se,Qe),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Ce.width+"x"+Ce.height+") to ("+Se+"x"+Qe+")."),$e}else return"data"in H&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Ce.width+"x"+Ce.height+")."),H;return H}function b(H){return H.generateMipmaps}function _(H){i.generateMipmap(H)}function E(H){return H.isWebGLCubeRenderTarget?i.TEXTURE_CUBE_MAP:H.isWebGL3DRenderTarget?i.TEXTURE_3D:H.isWebGLArrayRenderTarget||H.isCompressedArrayTexture?i.TEXTURE_2D_ARRAY:i.TEXTURE_2D}function M(H,U,de,we,Ce=!1){if(H!==null){if(i[H]!==void 0)return i[H];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+H+"'")}let Se=U;if(U===i.RED&&(de===i.FLOAT&&(Se=i.R32F),de===i.HALF_FLOAT&&(Se=i.R16F),de===i.UNSIGNED_BYTE&&(Se=i.R8)),U===i.RED_INTEGER&&(de===i.UNSIGNED_BYTE&&(Se=i.R8UI),de===i.UNSIGNED_SHORT&&(Se=i.R16UI),de===i.UNSIGNED_INT&&(Se=i.R32UI),de===i.BYTE&&(Se=i.R8I),de===i.SHORT&&(Se=i.R16I),de===i.INT&&(Se=i.R32I)),U===i.RG&&(de===i.FLOAT&&(Se=i.RG32F),de===i.HALF_FLOAT&&(Se=i.RG16F),de===i.UNSIGNED_BYTE&&(Se=i.RG8)),U===i.RG_INTEGER&&(de===i.UNSIGNED_BYTE&&(Se=i.RG8UI),de===i.UNSIGNED_SHORT&&(Se=i.RG16UI),de===i.UNSIGNED_INT&&(Se=i.RG32UI),de===i.BYTE&&(Se=i.RG8I),de===i.SHORT&&(Se=i.RG16I),de===i.INT&&(Se=i.RG32I)),U===i.RGB_INTEGER&&(de===i.UNSIGNED_BYTE&&(Se=i.RGB8UI),de===i.UNSIGNED_SHORT&&(Se=i.RGB16UI),de===i.UNSIGNED_INT&&(Se=i.RGB32UI),de===i.BYTE&&(Se=i.RGB8I),de===i.SHORT&&(Se=i.RGB16I),de===i.INT&&(Se=i.RGB32I)),U===i.RGBA_INTEGER&&(de===i.UNSIGNED_BYTE&&(Se=i.RGBA8UI),de===i.UNSIGNED_SHORT&&(Se=i.RGBA16UI),de===i.UNSIGNED_INT&&(Se=i.RGBA32UI),de===i.BYTE&&(Se=i.RGBA8I),de===i.SHORT&&(Se=i.RGBA16I),de===i.INT&&(Se=i.RGBA32I)),U===i.RGB&&de===i.UNSIGNED_INT_5_9_9_9_REV&&(Se=i.RGB9_E5),U===i.RGBA){const Qe=Ce?Ch:wt.getTransfer(we);de===i.FLOAT&&(Se=i.RGBA32F),de===i.HALF_FLOAT&&(Se=i.RGBA16F),de===i.UNSIGNED_BYTE&&(Se=Qe===Ze?i.SRGB8_ALPHA8:i.RGBA8),de===i.UNSIGNED_SHORT_4_4_4_4&&(Se=i.RGBA4),de===i.UNSIGNED_SHORT_5_5_5_1&&(Se=i.RGB5_A1)}return(Se===i.R16F||Se===i.R32F||Se===i.RG16F||Se===i.RG32F||Se===i.RGBA16F||Se===i.RGBA32F)&&e.get("EXT_color_buffer_float"),Se}function A(H,U){let de;return H?U===null||U===En||U===ts?de=i.DEPTH24_STENCIL8:U===Jn?de=i.DEPTH32F_STENCIL8:U===ks&&(de=i.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):U===null||U===En||U===ts?de=i.DEPTH_COMPONENT24:U===Jn?de=i.DEPTH_COMPONENT32F:U===ks&&(de=i.DEPTH_COMPONENT16),de}function w(H,U){return b(H)===!0||H.isFramebufferTexture&&H.minFilter!==Pn&&H.minFilter!==Ti?Math.log2(Math.max(U.width,U.height))+1:H.mipmaps!==void 0&&H.mipmaps.length>0?H.mipmaps.length:H.isCompressedTexture&&Array.isArray(H.image)?U.mipmaps.length:1}function R(H){const U=H.target;U.removeEventListener("dispose",R),L(U),U.isVideoTexture&&d.delete(U)}function C(H){const U=H.target;U.removeEventListener("dispose",C),D(U)}function L(H){const U=n.get(H);if(U.__webglInit===void 0)return;const de=H.source,we=g.get(de);if(we){const Ce=we[U.__cacheKey];Ce.usedTimes--,Ce.usedTimes===0&&N(H),Object.keys(we).length===0&&g.delete(de)}n.remove(H)}function N(H){const U=n.get(H);i.deleteTexture(U.__webglTexture);const de=H.source,we=g.get(de);delete we[U.__cacheKey],a.memory.textures--}function D(H){const U=n.get(H);if(H.depthTexture&&(H.depthTexture.dispose(),n.remove(H.depthTexture)),H.isWebGLCubeRenderTarget)for(let we=0;we<6;we++){if(Array.isArray(U.__webglFramebuffer[we]))for(let Ce=0;Ce<U.__webglFramebuffer[we].length;Ce++)i.deleteFramebuffer(U.__webglFramebuffer[we][Ce]);else i.deleteFramebuffer(U.__webglFramebuffer[we]);U.__webglDepthbuffer&&i.deleteRenderbuffer(U.__webglDepthbuffer[we])}else{if(Array.isArray(U.__webglFramebuffer))for(let we=0;we<U.__webglFramebuffer.length;we++)i.deleteFramebuffer(U.__webglFramebuffer[we]);else i.deleteFramebuffer(U.__webglFramebuffer);if(U.__webglDepthbuffer&&i.deleteRenderbuffer(U.__webglDepthbuffer),U.__webglMultisampledFramebuffer&&i.deleteFramebuffer(U.__webglMultisampledFramebuffer),U.__webglColorRenderbuffer)for(let we=0;we<U.__webglColorRenderbuffer.length;we++)U.__webglColorRenderbuffer[we]&&i.deleteRenderbuffer(U.__webglColorRenderbuffer[we]);U.__webglDepthRenderbuffer&&i.deleteRenderbuffer(U.__webglDepthRenderbuffer)}const de=H.textures;for(let we=0,Ce=de.length;we<Ce;we++){const Se=n.get(de[we]);Se.__webglTexture&&(i.deleteTexture(Se.__webglTexture),a.memory.textures--),n.remove(de[we])}n.remove(H)}let I=0;function W(){I=0}function Y(){const H=I;return H>=r.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+H+" texture units while this GPU supports only "+r.maxTextures),I+=1,H}function oe(H){const U=[];return U.push(H.wrapS),U.push(H.wrapT),U.push(H.wrapR||0),U.push(H.magFilter),U.push(H.minFilter),U.push(H.anisotropy),U.push(H.internalFormat),U.push(H.format),U.push(H.type),U.push(H.generateMipmaps),U.push(H.premultiplyAlpha),U.push(H.flipY),U.push(H.unpackAlignment),U.push(H.colorSpace),U.join()}function le(H,U){const de=n.get(H);if(H.isVideoTexture&&pt(H),H.isRenderTargetTexture===!1&&H.version>0&&de.__version!==H.version){const we=H.image;if(we===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(we.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{$(de,H,U);return}}t.bindTexture(i.TEXTURE_2D,de.__webglTexture,i.TEXTURE0+U)}function z(H,U){const de=n.get(H);if(H.version>0&&de.__version!==H.version){$(de,H,U);return}t.bindTexture(i.TEXTURE_2D_ARRAY,de.__webglTexture,i.TEXTURE0+U)}function k(H,U){const de=n.get(H);if(H.version>0&&de.__version!==H.version){$(de,H,U);return}t.bindTexture(i.TEXTURE_3D,de.__webglTexture,i.TEXTURE0+U)}function G(H,U){const de=n.get(H);if(H.version>0&&de.__version!==H.version){ne(de,H,U);return}t.bindTexture(i.TEXTURE_CUBE_MAP,de.__webglTexture,i.TEXTURE0+U)}const he={[Tu]:i.REPEAT,[ra]:i.CLAMP_TO_EDGE,[Mu]:i.MIRRORED_REPEAT},F={[Pn]:i.NEAREST,[PM]:i.NEAREST_MIPMAP_NEAREST,[eo]:i.NEAREST_MIPMAP_LINEAR,[Ti]:i.LINEAR,[Qc]:i.LINEAR_MIPMAP_NEAREST,[Nr]:i.LINEAR_MIPMAP_LINEAR},se={[UM]:i.NEVER,[kM]:i.ALWAYS,[Sv]:i.LESS,[Tv]:i.LEQUAL,[OM]:i.EQUAL,[FM]:i.GEQUAL,[BM]:i.GREATER,[IM]:i.NOTEQUAL};function Me(H,U){if(U.type===Jn&&e.has("OES_texture_float_linear")===!1&&(U.magFilter===Ti||U.magFilter===Qc||U.magFilter===eo||U.magFilter===Nr||U.minFilter===Ti||U.minFilter===Qc||U.minFilter===eo||U.minFilter===Nr)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),i.texParameteri(H,i.TEXTURE_WRAP_S,he[U.wrapS]),i.texParameteri(H,i.TEXTURE_WRAP_T,he[U.wrapT]),(H===i.TEXTURE_3D||H===i.TEXTURE_2D_ARRAY)&&i.texParameteri(H,i.TEXTURE_WRAP_R,he[U.wrapR]),i.texParameteri(H,i.TEXTURE_MAG_FILTER,F[U.magFilter]),i.texParameteri(H,i.TEXTURE_MIN_FILTER,F[U.minFilter]),U.compareFunction&&(i.texParameteri(H,i.TEXTURE_COMPARE_MODE,i.COMPARE_REF_TO_TEXTURE),i.texParameteri(H,i.TEXTURE_COMPARE_FUNC,se[U.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(U.magFilter===Pn||U.minFilter!==eo&&U.minFilter!==Nr||U.type===Jn&&e.has("OES_texture_float_linear")===!1)return;if(U.anisotropy>1||n.get(U).__currentAnisotropy){const de=e.get("EXT_texture_filter_anisotropic");i.texParameterf(H,de.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(U.anisotropy,r.getMaxAnisotropy())),n.get(U).__currentAnisotropy=U.anisotropy}}}function De(H,U){let de=!1;H.__webglInit===void 0&&(H.__webglInit=!0,U.addEventListener("dispose",R));const we=U.source;let Ce=g.get(we);Ce===void 0&&(Ce={},g.set(we,Ce));const Se=oe(U);if(Se!==H.__cacheKey){Ce[Se]===void 0&&(Ce[Se]={texture:i.createTexture(),usedTimes:0},a.memory.textures++,de=!0),Ce[Se].usedTimes++;const Qe=Ce[H.__cacheKey];Qe!==void 0&&(Ce[H.__cacheKey].usedTimes--,Qe.usedTimes===0&&N(U)),H.__cacheKey=Se,H.__webglTexture=Ce[Se].texture}return de}function j(H,U,de){return Math.floor(Math.floor(H/de)/U)}function Z(H,U,de,we){const Se=H.updateRanges;if(Se.length===0)t.texSubImage2D(i.TEXTURE_2D,0,0,0,U.width,U.height,de,we,U.data);else{Se.sort((Be,Je)=>Be.start-Je.start);let Qe=0;for(let Be=1;Be<Se.length;Be++){const Je=Se[Qe],ft=Se[Be],dt=Je.start+Je.count,je=j(ft.start,U.width,4),Ct=j(Je.start,U.width,4);ft.start<=dt+1&&je===Ct&&j(ft.start+ft.count-1,U.width,4)===je?Je.count=Math.max(Je.count,ft.start+ft.count-Je.start):(++Qe,Se[Qe]=ft)}Se.length=Qe+1;const $e=i.getParameter(i.UNPACK_ROW_LENGTH),rt=i.getParameter(i.UNPACK_SKIP_PIXELS),lt=i.getParameter(i.UNPACK_SKIP_ROWS);i.pixelStorei(i.UNPACK_ROW_LENGTH,U.width);for(let Be=0,Je=Se.length;Be<Je;Be++){const ft=Se[Be],dt=Math.floor(ft.start/4),je=Math.ceil(ft.count/4),Ct=dt%U.width,J=Math.floor(dt/U.width),Xe=je,Fe=1;i.pixelStorei(i.UNPACK_SKIP_PIXELS,Ct),i.pixelStorei(i.UNPACK_SKIP_ROWS,J),t.texSubImage2D(i.TEXTURE_2D,0,Ct,J,Xe,Fe,de,we,U.data)}H.clearUpdateRanges(),i.pixelStorei(i.UNPACK_ROW_LENGTH,$e),i.pixelStorei(i.UNPACK_SKIP_PIXELS,rt),i.pixelStorei(i.UNPACK_SKIP_ROWS,lt)}}function $(H,U,de){let we=i.TEXTURE_2D;(U.isDataArrayTexture||U.isCompressedArrayTexture)&&(we=i.TEXTURE_2D_ARRAY),U.isData3DTexture&&(we=i.TEXTURE_3D);const Ce=De(H,U),Se=U.source;t.bindTexture(we,H.__webglTexture,i.TEXTURE0+de);const Qe=n.get(Se);if(Se.version!==Qe.__version||Ce===!0){t.activeTexture(i.TEXTURE0+de);const $e=wt.getPrimaries(wt.workingColorSpace),rt=U.colorSpace===pr?null:wt.getPrimaries(U.colorSpace),lt=U.colorSpace===pr||$e===rt?i.NONE:i.BROWSER_DEFAULT_WEBGL;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,U.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,U.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,U.unpackAlignment),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,lt);let Be=S(U.image,!1,r.maxTextureSize);Be=Pt(U,Be);const Je=s.convert(U.format,U.colorSpace),ft=s.convert(U.type);let dt=M(U.internalFormat,Je,ft,U.colorSpace,U.isVideoTexture);Me(we,U);let je;const Ct=U.mipmaps,J=U.isVideoTexture!==!0,Xe=Qe.__version===void 0||Ce===!0,Fe=Se.dataReady,et=w(U,Be);if(U.isDepthTexture)dt=A(U.format===is,U.type),Xe&&(J?t.texStorage2D(i.TEXTURE_2D,1,dt,Be.width,Be.height):t.texImage2D(i.TEXTURE_2D,0,dt,Be.width,Be.height,0,Je,ft,null));else if(U.isDataTexture)if(Ct.length>0){J&&Xe&&t.texStorage2D(i.TEXTURE_2D,et,dt,Ct[0].width,Ct[0].height);for(let ze=0,Pe=Ct.length;ze<Pe;ze++)je=Ct[ze],J?Fe&&t.texSubImage2D(i.TEXTURE_2D,ze,0,0,je.width,je.height,Je,ft,je.data):t.texImage2D(i.TEXTURE_2D,ze,dt,je.width,je.height,0,Je,ft,je.data);U.generateMipmaps=!1}else J?(Xe&&t.texStorage2D(i.TEXTURE_2D,et,dt,Be.width,Be.height),Fe&&Z(U,Be,Je,ft)):t.texImage2D(i.TEXTURE_2D,0,dt,Be.width,Be.height,0,Je,ft,Be.data);else if(U.isCompressedTexture)if(U.isCompressedArrayTexture){J&&Xe&&t.texStorage3D(i.TEXTURE_2D_ARRAY,et,dt,Ct[0].width,Ct[0].height,Be.depth);for(let ze=0,Pe=Ct.length;ze<Pe;ze++)if(je=Ct[ze],U.format!==Xn)if(Je!==null)if(J){if(Fe)if(U.layerUpdates.size>0){const nt=BN(je.width,je.height,U.format,U.type);for(const At of U.layerUpdates){const fn=je.data.subarray(At*nt/je.data.BYTES_PER_ELEMENT,(At+1)*nt/je.data.BYTES_PER_ELEMENT);t.compressedTexSubImage3D(i.TEXTURE_2D_ARRAY,ze,0,0,At,je.width,je.height,1,Je,fn)}U.clearLayerUpdates()}else t.compressedTexSubImage3D(i.TEXTURE_2D_ARRAY,ze,0,0,0,je.width,je.height,Be.depth,Je,je.data)}else t.compressedTexImage3D(i.TEXTURE_2D_ARRAY,ze,dt,je.width,je.height,Be.depth,0,je.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else J?Fe&&t.texSubImage3D(i.TEXTURE_2D_ARRAY,ze,0,0,0,je.width,je.height,Be.depth,Je,ft,je.data):t.texImage3D(i.TEXTURE_2D_ARRAY,ze,dt,je.width,je.height,Be.depth,0,Je,ft,je.data)}else{J&&Xe&&t.texStorage2D(i.TEXTURE_2D,et,dt,Ct[0].width,Ct[0].height);for(let ze=0,Pe=Ct.length;ze<Pe;ze++)je=Ct[ze],U.format!==Xn?Je!==null?J?Fe&&t.compressedTexSubImage2D(i.TEXTURE_2D,ze,0,0,je.width,je.height,Je,je.data):t.compressedTexImage2D(i.TEXTURE_2D,ze,dt,je.width,je.height,0,je.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):J?Fe&&t.texSubImage2D(i.TEXTURE_2D,ze,0,0,je.width,je.height,Je,ft,je.data):t.texImage2D(i.TEXTURE_2D,ze,dt,je.width,je.height,0,Je,ft,je.data)}else if(U.isDataArrayTexture)if(J){if(Xe&&t.texStorage3D(i.TEXTURE_2D_ARRAY,et,dt,Be.width,Be.height,Be.depth),Fe)if(U.layerUpdates.size>0){const ze=BN(Be.width,Be.height,U.format,U.type);for(const Pe of U.layerUpdates){const nt=Be.data.subarray(Pe*ze/Be.data.BYTES_PER_ELEMENT,(Pe+1)*ze/Be.data.BYTES_PER_ELEMENT);t.texSubImage3D(i.TEXTURE_2D_ARRAY,0,0,0,Pe,Be.width,Be.height,1,Je,ft,nt)}U.clearLayerUpdates()}else t.texSubImage3D(i.TEXTURE_2D_ARRAY,0,0,0,0,Be.width,Be.height,Be.depth,Je,ft,Be.data)}else t.texImage3D(i.TEXTURE_2D_ARRAY,0,dt,Be.width,Be.height,Be.depth,0,Je,ft,Be.data);else if(U.isData3DTexture)J?(Xe&&t.texStorage3D(i.TEXTURE_3D,et,dt,Be.width,Be.height,Be.depth),Fe&&t.texSubImage3D(i.TEXTURE_3D,0,0,0,0,Be.width,Be.height,Be.depth,Je,ft,Be.data)):t.texImage3D(i.TEXTURE_3D,0,dt,Be.width,Be.height,Be.depth,0,Je,ft,Be.data);else if(U.isFramebufferTexture){if(Xe)if(J)t.texStorage2D(i.TEXTURE_2D,et,dt,Be.width,Be.height);else{let ze=Be.width,Pe=Be.height;for(let nt=0;nt<et;nt++)t.texImage2D(i.TEXTURE_2D,nt,dt,ze,Pe,0,Je,ft,null),ze>>=1,Pe>>=1}}else if(Ct.length>0){if(J&&Xe){const ze=Yn(Ct[0]);t.texStorage2D(i.TEXTURE_2D,et,dt,ze.width,ze.height)}for(let ze=0,Pe=Ct.length;ze<Pe;ze++)je=Ct[ze],J?Fe&&t.texSubImage2D(i.TEXTURE_2D,ze,0,0,Je,ft,je):t.texImage2D(i.TEXTURE_2D,ze,dt,Je,ft,je);U.generateMipmaps=!1}else if(J){if(Xe){const ze=Yn(Be);t.texStorage2D(i.TEXTURE_2D,et,dt,ze.width,ze.height)}Fe&&t.texSubImage2D(i.TEXTURE_2D,0,0,0,Je,ft,Be)}else t.texImage2D(i.TEXTURE_2D,0,dt,Je,ft,Be);b(U)&&_(we),Qe.__version=Se.version,U.onUpdate&&U.onUpdate(U)}H.__version=U.version}function ne(H,U,de){if(U.image.length!==6)return;const we=De(H,U),Ce=U.source;t.bindTexture(i.TEXTURE_CUBE_MAP,H.__webglTexture,i.TEXTURE0+de);const Se=n.get(Ce);if(Ce.version!==Se.__version||we===!0){t.activeTexture(i.TEXTURE0+de);const Qe=wt.getPrimaries(wt.workingColorSpace),$e=U.colorSpace===pr?null:wt.getPrimaries(U.colorSpace),rt=U.colorSpace===pr||Qe===$e?i.NONE:i.BROWSER_DEFAULT_WEBGL;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,U.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,U.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,U.unpackAlignment),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,rt);const lt=U.isCompressedTexture||U.image[0].isCompressedTexture,Be=U.image[0]&&U.image[0].isDataTexture,Je=[];for(let Pe=0;Pe<6;Pe++)!lt&&!Be?Je[Pe]=S(U.image[Pe],!0,r.maxCubemapSize):Je[Pe]=Be?U.image[Pe].image:U.image[Pe],Je[Pe]=Pt(U,Je[Pe]);const ft=Je[0],dt=s.convert(U.format,U.colorSpace),je=s.convert(U.type),Ct=M(U.internalFormat,dt,je,U.colorSpace),J=U.isVideoTexture!==!0,Xe=Se.__version===void 0||we===!0,Fe=Ce.dataReady;let et=w(U,ft);Me(i.TEXTURE_CUBE_MAP,U);let ze;if(lt){J&&Xe&&t.texStorage2D(i.TEXTURE_CUBE_MAP,et,Ct,ft.width,ft.height);for(let Pe=0;Pe<6;Pe++){ze=Je[Pe].mipmaps;for(let nt=0;nt<ze.length;nt++){const At=ze[nt];U.format!==Xn?dt!==null?J?Fe&&t.compressedTexSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Pe,nt,0,0,At.width,At.height,dt,At.data):t.compressedTexImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Pe,nt,Ct,At.width,At.height,0,At.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):J?Fe&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Pe,nt,0,0,At.width,At.height,dt,je,At.data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Pe,nt,Ct,At.width,At.height,0,dt,je,At.data)}}}else{if(ze=U.mipmaps,J&&Xe){ze.length>0&&et++;const Pe=Yn(Je[0]);t.texStorage2D(i.TEXTURE_CUBE_MAP,et,Ct,Pe.width,Pe.height)}for(let Pe=0;Pe<6;Pe++)if(Be){J?Fe&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Pe,0,0,0,Je[Pe].width,Je[Pe].height,dt,je,Je[Pe].data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Pe,0,Ct,Je[Pe].width,Je[Pe].height,0,dt,je,Je[Pe].data);for(let nt=0;nt<ze.length;nt++){const fn=ze[nt].image[Pe].image;J?Fe&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Pe,nt+1,0,0,fn.width,fn.height,dt,je,fn.data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Pe,nt+1,Ct,fn.width,fn.height,0,dt,je,fn.data)}}else{J?Fe&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Pe,0,0,0,dt,je,Je[Pe]):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Pe,0,Ct,dt,je,Je[Pe]);for(let nt=0;nt<ze.length;nt++){const At=ze[nt];J?Fe&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Pe,nt+1,0,0,dt,je,At.image[Pe]):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Pe,nt+1,Ct,dt,je,At.image[Pe])}}}b(U)&&_(i.TEXTURE_CUBE_MAP),Se.__version=Ce.version,U.onUpdate&&U.onUpdate(U)}H.__version=U.version}function ve(H,U,de,we,Ce,Se){const Qe=s.convert(de.format,de.colorSpace),$e=s.convert(de.type),rt=M(de.internalFormat,Qe,$e,de.colorSpace),lt=n.get(U),Be=n.get(de);if(Be.__renderTarget=U,!lt.__hasExternalTextures){const Je=Math.max(1,U.width>>Se),ft=Math.max(1,U.height>>Se);Ce===i.TEXTURE_3D||Ce===i.TEXTURE_2D_ARRAY?t.texImage3D(Ce,Se,rt,Je,ft,U.depth,0,Qe,$e,null):t.texImage2D(Ce,Se,rt,Je,ft,0,Qe,$e,null)}t.bindFramebuffer(i.FRAMEBUFFER,H),Kt(U)?l.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,we,Ce,Be.__webglTexture,0,at(U)):(Ce===i.TEXTURE_2D||Ce>=i.TEXTURE_CUBE_MAP_POSITIVE_X&&Ce<=i.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&i.framebufferTexture2D(i.FRAMEBUFFER,we,Ce,Be.__webglTexture,Se),t.bindFramebuffer(i.FRAMEBUFFER,null)}function He(H,U,de){if(i.bindRenderbuffer(i.RENDERBUFFER,H),U.depthBuffer){const we=U.depthTexture,Ce=we&&we.isDepthTexture?we.type:null,Se=A(U.stencilBuffer,Ce),Qe=U.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT,$e=at(U);Kt(U)?l.renderbufferStorageMultisampleEXT(i.RENDERBUFFER,$e,Se,U.width,U.height):de?i.renderbufferStorageMultisample(i.RENDERBUFFER,$e,Se,U.width,U.height):i.renderbufferStorage(i.RENDERBUFFER,Se,U.width,U.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,Qe,i.RENDERBUFFER,H)}else{const we=U.textures;for(let Ce=0;Ce<we.length;Ce++){const Se=we[Ce],Qe=s.convert(Se.format,Se.colorSpace),$e=s.convert(Se.type),rt=M(Se.internalFormat,Qe,$e,Se.colorSpace),lt=at(U);de&&Kt(U)===!1?i.renderbufferStorageMultisample(i.RENDERBUFFER,lt,rt,U.width,U.height):Kt(U)?l.renderbufferStorageMultisampleEXT(i.RENDERBUFFER,lt,rt,U.width,U.height):i.renderbufferStorage(i.RENDERBUFFER,rt,U.width,U.height)}}i.bindRenderbuffer(i.RENDERBUFFER,null)}function Ve(H,U){if(U&&U.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(i.FRAMEBUFFER,H),!(U.depthTexture&&U.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const we=n.get(U.depthTexture);we.__renderTarget=U,(!we.__webglTexture||U.depthTexture.image.width!==U.width||U.depthTexture.image.height!==U.height)&&(U.depthTexture.image.width=U.width,U.depthTexture.image.height=U.height,U.depthTexture.needsUpdate=!0),le(U.depthTexture,0);const Ce=we.__webglTexture,Se=at(U);if(U.depthTexture.format===ns)Kt(U)?l.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,Ce,0,Se):i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,Ce,0);else if(U.depthTexture.format===is)Kt(U)?l.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.TEXTURE_2D,Ce,0,Se):i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.TEXTURE_2D,Ce,0);else throw new Error("Unknown depthTexture format")}function st(H){const U=n.get(H),de=H.isWebGLCubeRenderTarget===!0;if(U.__boundDepthTexture!==H.depthTexture){const we=H.depthTexture;if(U.__depthDisposeCallback&&U.__depthDisposeCallback(),we){const Ce=()=>{delete U.__boundDepthTexture,delete U.__depthDisposeCallback,we.removeEventListener("dispose",Ce)};we.addEventListener("dispose",Ce),U.__depthDisposeCallback=Ce}U.__boundDepthTexture=we}if(H.depthTexture&&!U.__autoAllocateDepthBuffer){if(de)throw new Error("target.depthTexture not supported in Cube render targets");const we=H.texture.mipmaps;we&&we.length>0?Ve(U.__webglFramebuffer[0],H):Ve(U.__webglFramebuffer,H)}else if(de){U.__webglDepthbuffer=[];for(let we=0;we<6;we++)if(t.bindFramebuffer(i.FRAMEBUFFER,U.__webglFramebuffer[we]),U.__webglDepthbuffer[we]===void 0)U.__webglDepthbuffer[we]=i.createRenderbuffer(),He(U.__webglDepthbuffer[we],H,!1);else{const Ce=H.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT,Se=U.__webglDepthbuffer[we];i.bindRenderbuffer(i.RENDERBUFFER,Se),i.framebufferRenderbuffer(i.FRAMEBUFFER,Ce,i.RENDERBUFFER,Se)}}else{const we=H.texture.mipmaps;if(we&&we.length>0?t.bindFramebuffer(i.FRAMEBUFFER,U.__webglFramebuffer[0]):t.bindFramebuffer(i.FRAMEBUFFER,U.__webglFramebuffer),U.__webglDepthbuffer===void 0)U.__webglDepthbuffer=i.createRenderbuffer(),He(U.__webglDepthbuffer,H,!1);else{const Ce=H.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT,Se=U.__webglDepthbuffer;i.bindRenderbuffer(i.RENDERBUFFER,Se),i.framebufferRenderbuffer(i.FRAMEBUFFER,Ce,i.RENDERBUFFER,Se)}}t.bindFramebuffer(i.FRAMEBUFFER,null)}function Lt(H,U,de){const we=n.get(H);U!==void 0&&ve(we.__webglFramebuffer,H,H.texture,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,0),de!==void 0&&st(H)}function Rt(H){const U=H.texture,de=n.get(H),we=n.get(U);H.addEventListener("dispose",C);const Ce=H.textures,Se=H.isWebGLCubeRenderTarget===!0,Qe=Ce.length>1;if(Qe||(we.__webglTexture===void 0&&(we.__webglTexture=i.createTexture()),we.__version=U.version,a.memory.textures++),Se){de.__webglFramebuffer=[];for(let $e=0;$e<6;$e++)if(U.mipmaps&&U.mipmaps.length>0){de.__webglFramebuffer[$e]=[];for(let rt=0;rt<U.mipmaps.length;rt++)de.__webglFramebuffer[$e][rt]=i.createFramebuffer()}else de.__webglFramebuffer[$e]=i.createFramebuffer()}else{if(U.mipmaps&&U.mipmaps.length>0){de.__webglFramebuffer=[];for(let $e=0;$e<U.mipmaps.length;$e++)de.__webglFramebuffer[$e]=i.createFramebuffer()}else de.__webglFramebuffer=i.createFramebuffer();if(Qe)for(let $e=0,rt=Ce.length;$e<rt;$e++){const lt=n.get(Ce[$e]);lt.__webglTexture===void 0&&(lt.__webglTexture=i.createTexture(),a.memory.textures++)}if(H.samples>0&&Kt(H)===!1){de.__webglMultisampledFramebuffer=i.createFramebuffer(),de.__webglColorRenderbuffer=[],t.bindFramebuffer(i.FRAMEBUFFER,de.__webglMultisampledFramebuffer);for(let $e=0;$e<Ce.length;$e++){const rt=Ce[$e];de.__webglColorRenderbuffer[$e]=i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,de.__webglColorRenderbuffer[$e]);const lt=s.convert(rt.format,rt.colorSpace),Be=s.convert(rt.type),Je=M(rt.internalFormat,lt,Be,rt.colorSpace,H.isXRRenderTarget===!0),ft=at(H);i.renderbufferStorageMultisample(i.RENDERBUFFER,ft,Je,H.width,H.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+$e,i.RENDERBUFFER,de.__webglColorRenderbuffer[$e])}i.bindRenderbuffer(i.RENDERBUFFER,null),H.depthBuffer&&(de.__webglDepthRenderbuffer=i.createRenderbuffer(),He(de.__webglDepthRenderbuffer,H,!0)),t.bindFramebuffer(i.FRAMEBUFFER,null)}}if(Se){t.bindTexture(i.TEXTURE_CUBE_MAP,we.__webglTexture),Me(i.TEXTURE_CUBE_MAP,U);for(let $e=0;$e<6;$e++)if(U.mipmaps&&U.mipmaps.length>0)for(let rt=0;rt<U.mipmaps.length;rt++)ve(de.__webglFramebuffer[$e][rt],H,U,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+$e,rt);else ve(de.__webglFramebuffer[$e],H,U,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+$e,0);b(U)&&_(i.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(Qe){for(let $e=0,rt=Ce.length;$e<rt;$e++){const lt=Ce[$e],Be=n.get(lt);t.bindTexture(i.TEXTURE_2D,Be.__webglTexture),Me(i.TEXTURE_2D,lt),ve(de.__webglFramebuffer,H,lt,i.COLOR_ATTACHMENT0+$e,i.TEXTURE_2D,0),b(lt)&&_(i.TEXTURE_2D)}t.unbindTexture()}else{let $e=i.TEXTURE_2D;if((H.isWebGL3DRenderTarget||H.isWebGLArrayRenderTarget)&&($e=H.isWebGL3DRenderTarget?i.TEXTURE_3D:i.TEXTURE_2D_ARRAY),t.bindTexture($e,we.__webglTexture),Me($e,U),U.mipmaps&&U.mipmaps.length>0)for(let rt=0;rt<U.mipmaps.length;rt++)ve(de.__webglFramebuffer[rt],H,U,i.COLOR_ATTACHMENT0,$e,rt);else ve(de.__webglFramebuffer,H,U,i.COLOR_ATTACHMENT0,$e,0);b(U)&&_($e),t.unbindTexture()}H.depthBuffer&&st(H)}function X(H){const U=H.textures;for(let de=0,we=U.length;de<we;de++){const Ce=U[de];if(b(Ce)){const Se=E(H),Qe=n.get(Ce).__webglTexture;t.bindTexture(Se,Qe),_(Se),t.unbindTexture()}}}const mn=[],jt=[];function Ft(H){if(H.samples>0){if(Kt(H)===!1){const U=H.textures,de=H.width,we=H.height;let Ce=i.COLOR_BUFFER_BIT;const Se=H.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT,Qe=n.get(H),$e=U.length>1;if($e)for(let lt=0;lt<U.length;lt++)t.bindFramebuffer(i.FRAMEBUFFER,Qe.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+lt,i.RENDERBUFFER,null),t.bindFramebuffer(i.FRAMEBUFFER,Qe.__webglFramebuffer),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0+lt,i.TEXTURE_2D,null,0);t.bindFramebuffer(i.READ_FRAMEBUFFER,Qe.__webglMultisampledFramebuffer);const rt=H.texture.mipmaps;rt&&rt.length>0?t.bindFramebuffer(i.DRAW_FRAMEBUFFER,Qe.__webglFramebuffer[0]):t.bindFramebuffer(i.DRAW_FRAMEBUFFER,Qe.__webglFramebuffer);for(let lt=0;lt<U.length;lt++){if(H.resolveDepthBuffer&&(H.depthBuffer&&(Ce|=i.DEPTH_BUFFER_BIT),H.stencilBuffer&&H.resolveStencilBuffer&&(Ce|=i.STENCIL_BUFFER_BIT)),$e){i.framebufferRenderbuffer(i.READ_FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,Qe.__webglColorRenderbuffer[lt]);const Be=n.get(U[lt]).__webglTexture;i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,Be,0)}i.blitFramebuffer(0,0,de,we,0,0,de,we,Ce,i.NEAREST),u===!0&&(mn.length=0,jt.length=0,mn.push(i.COLOR_ATTACHMENT0+lt),H.depthBuffer&&H.resolveDepthBuffer===!1&&(mn.push(Se),jt.push(Se),i.invalidateFramebuffer(i.DRAW_FRAMEBUFFER,jt)),i.invalidateFramebuffer(i.READ_FRAMEBUFFER,mn))}if(t.bindFramebuffer(i.READ_FRAMEBUFFER,null),t.bindFramebuffer(i.DRAW_FRAMEBUFFER,null),$e)for(let lt=0;lt<U.length;lt++){t.bindFramebuffer(i.FRAMEBUFFER,Qe.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+lt,i.RENDERBUFFER,Qe.__webglColorRenderbuffer[lt]);const Be=n.get(U[lt]).__webglTexture;t.bindFramebuffer(i.FRAMEBUFFER,Qe.__webglFramebuffer),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0+lt,i.TEXTURE_2D,Be,0)}t.bindFramebuffer(i.DRAW_FRAMEBUFFER,Qe.__webglMultisampledFramebuffer)}else if(H.depthBuffer&&H.resolveDepthBuffer===!1&&u){const U=H.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT;i.invalidateFramebuffer(i.DRAW_FRAMEBUFFER,[U])}}}function at(H){return Math.min(r.maxSamples,H.samples)}function Kt(H){const U=n.get(H);return H.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&U.__useRenderToTexture!==!1}function pt(H){const U=a.render.frame;d.get(H)!==U&&(d.set(H,U),H.update())}function Pt(H,U){const de=H.colorSpace,we=H.format,Ce=H.type;return H.isCompressedTexture===!0||H.isVideoTexture===!0||de!==ca&&de!==pr&&(wt.getTransfer(de)===Ze?(we!==Xn||Ce!==Gn)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",de)),U}function Yn(H){return typeof HTMLImageElement<"u"&&H instanceof HTMLImageElement?(h.width=H.naturalWidth||H.width,h.height=H.naturalHeight||H.height):typeof VideoFrame<"u"&&H instanceof VideoFrame?(h.width=H.displayWidth,h.height=H.displayHeight):(h.width=H.width,h.height=H.height),h}this.allocateTextureUnit=Y,this.resetTextureUnits=W,this.setTexture2D=le,this.setTexture2DArray=z,this.setTexture3D=k,this.setTextureCube=G,this.rebindTextures=Lt,this.setupRenderTarget=Rt,this.updateRenderTargetMipmap=X,this.updateMultisampleRenderTarget=Ft,this.setupDepthRenderbuffer=st,this.setupFrameBufferTexture=ve,this.useMultisampledRTT=Kt}function L$(i,e){function t(n,r=pr){let s;const a=wt.getTransfer(r);if(n===Gn)return i.UNSIGNED_BYTE;if(n===_v)return i.UNSIGNED_SHORT_4_4_4_4;if(n===xv)return i.UNSIGNED_SHORT_5_5_5_1;if(n===bv)return i.UNSIGNED_INT_5_9_9_9_REV;if(n===gu)return i.BYTE;if(n===yu)return i.SHORT;if(n===ks)return i.UNSIGNED_SHORT;if(n===Li)return i.INT;if(n===En)return i.UNSIGNED_INT;if(n===Jn)return i.FLOAT;if(n===Oi)return i.HALF_FLOAT;if(n===DM)return i.ALPHA;if(n===Vp)return i.RGB;if(n===Xn)return i.RGBA;if(n===ns)return i.DEPTH_COMPONENT;if(n===is)return i.DEPTH_STENCIL;if(n===Gp)return i.RED;if(n===Wh)return i.RED_INTEGER;if(n===to)return i.RG;if(n===jh)return i.RG_INTEGER;if(n===qh)return i.RGBA_INTEGER;if(n===vu||n===sl||n===al||n===ol)if(a===Ze)if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(n===vu)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===sl)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===al)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===ol)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=e.get("WEBGL_compressed_texture_s3tc"),s!==null){if(n===vu)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===sl)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===al)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===ol)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(n===mp||n===gp||n===yp||n===vp)if(s=e.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(n===mp)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===gp)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===yp)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===vp)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(n===_p||n===dh||n===ph)if(s=e.get("WEBGL_compressed_texture_etc"),s!==null){if(n===_p||n===dh)return a===Ze?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(n===ph)return a===Ze?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(n===mh||n===gh||n===yh||n===vh||n===_h||n===xh||n===bh||n===Sh||n===Th||n===Mh||n===Eh||n===Ah||n===wh||n===Rh)if(s=e.get("WEBGL_compressed_texture_astc"),s!==null){if(n===mh)return a===Ze?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===gh)return a===Ze?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===yh)return a===Ze?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===vh)return a===Ze?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===_h)return a===Ze?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===xh)return a===Ze?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===bh)return a===Ze?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===Sh)return a===Ze?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===Th)return a===Ze?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===Mh)return a===Ze?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===Eh)return a===Ze?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===Ah)return a===Ze?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===wh)return a===Ze?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===Rh)return a===Ze?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(n===_u||n===WS||n===jS)if(s=e.get("EXT_texture_compression_bptc"),s!==null){if(n===_u)return a===Ze?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===WS)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===jS)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(n===LM||n===xp||n===bp||n===Sp)if(s=e.get("EXT_texture_compression_rgtc"),s!==null){if(n===_u)return s.COMPRESSED_RED_RGTC1_EXT;if(n===xp)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===bp)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===Sp)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return n===ts?i.UNSIGNED_INT_24_8:i[n]!==void 0?i[n]:null}return{convert:t}}const U$=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,O$=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class B${constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,n){if(this.texture===null){const r=new ei,s=e.properties.get(r);s.__webglTexture=t.texture,(t.depthNear!==n.depthNear||t.depthFar!==n.depthFar)&&(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=r}}getMesh(e){if(this.texture!==null&&this.mesh===null){const t=e.cameras[0].viewport,n=new da({vertexShader:U$,fragmentShader:O$,uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new fi(new $p(20,20),n)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class I$ extends po{constructor(e,t){super();const n=this;let r=null,s=1,a=null,l="local-floor",u=1,h=null,d=null,p=null,g=null,y=null,v=null;const S=new B$,b=t.getContextAttributes();let _=null,E=null;const M=[],A=[],w=new Le;let R=null;const C=new Ui;C.viewport=new bt;const L=new Ui;L.viewport=new bt;const N=[C,L],D=new mO;let I=null,W=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(j){let Z=M[j];return Z===void 0&&(Z=new Ey,M[j]=Z),Z.getTargetRaySpace()},this.getControllerGrip=function(j){let Z=M[j];return Z===void 0&&(Z=new Ey,M[j]=Z),Z.getGripSpace()},this.getHand=function(j){let Z=M[j];return Z===void 0&&(Z=new Ey,M[j]=Z),Z.getHandSpace()};function Y(j){const Z=A.indexOf(j.inputSource);if(Z===-1)return;const $=M[Z];$!==void 0&&($.update(j.inputSource,j.frame,h||a),$.dispatchEvent({type:j.type,data:j.inputSource}))}function oe(){r.removeEventListener("select",Y),r.removeEventListener("selectstart",Y),r.removeEventListener("selectend",Y),r.removeEventListener("squeeze",Y),r.removeEventListener("squeezestart",Y),r.removeEventListener("squeezeend",Y),r.removeEventListener("end",oe),r.removeEventListener("inputsourceschange",le);for(let j=0;j<M.length;j++){const Z=A[j];Z!==null&&(A[j]=null,M[j].disconnect(Z))}I=null,W=null,S.reset(),e.setRenderTarget(_),y=null,g=null,p=null,r=null,E=null,De.stop(),n.isPresenting=!1,e.setPixelRatio(R),e.setSize(w.width,w.height,!1),n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(j){s=j,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(j){l=j,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return h||a},this.setReferenceSpace=function(j){h=j},this.getBaseLayer=function(){return g!==null?g:y},this.getBinding=function(){return p},this.getFrame=function(){return v},this.getSession=function(){return r},this.setSession=async function(j){if(r=j,r!==null){if(_=e.getRenderTarget(),r.addEventListener("select",Y),r.addEventListener("selectstart",Y),r.addEventListener("selectend",Y),r.addEventListener("squeeze",Y),r.addEventListener("squeezestart",Y),r.addEventListener("squeezeend",Y),r.addEventListener("end",oe),r.addEventListener("inputsourceschange",le),b.xrCompatible!==!0&&await t.makeXRCompatible(),R=e.getPixelRatio(),e.getSize(w),typeof XRWebGLBinding<"u"&&"createProjectionLayer"in XRWebGLBinding.prototype){let $=null,ne=null,ve=null;b.depth&&(ve=b.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,$=b.stencil?is:ns,ne=b.stencil?ts:En);const He={colorFormat:t.RGBA8,depthFormat:ve,scaleFactor:s};p=new XRWebGLBinding(r,t),g=p.createProjectionLayer(He),r.updateRenderState({layers:[g]}),e.setPixelRatio(1),e.setSize(g.textureWidth,g.textureHeight,!1),E=new dl(g.textureWidth,g.textureHeight,{format:Xn,type:Gn,depthTexture:new bs(g.textureWidth,g.textureHeight,ne,void 0,void 0,void 0,void 0,void 0,void 0,$),stencilBuffer:b.stencil,colorSpace:e.outputColorSpace,samples:b.antialias?4:0,resolveDepthBuffer:g.ignoreDepthValues===!1,resolveStencilBuffer:g.ignoreDepthValues===!1})}else{const $={antialias:b.antialias,alpha:!0,depth:b.depth,stencil:b.stencil,framebufferScaleFactor:s};y=new XRWebGLLayer(r,t,$),r.updateRenderState({baseLayer:y}),e.setPixelRatio(1),e.setSize(y.framebufferWidth,y.framebufferHeight,!1),E=new dl(y.framebufferWidth,y.framebufferHeight,{format:Xn,type:Gn,colorSpace:e.outputColorSpace,stencilBuffer:b.stencil,resolveDepthBuffer:y.ignoreDepthValues===!1,resolveStencilBuffer:y.ignoreDepthValues===!1})}E.isXRRenderTarget=!0,this.setFoveation(u),h=null,a=await r.requestReferenceSpace(l),De.setContext(r),De.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(r!==null)return r.environmentBlendMode},this.getDepthTexture=function(){return S.getDepthTexture()};function le(j){for(let Z=0;Z<j.removed.length;Z++){const $=j.removed[Z],ne=A.indexOf($);ne>=0&&(A[ne]=null,M[ne].disconnect($))}for(let Z=0;Z<j.added.length;Z++){const $=j.added[Z];let ne=A.indexOf($);if(ne===-1){for(let He=0;He<M.length;He++)if(He>=A.length){A.push($),ne=He;break}else if(A[He]===null){A[He]=$,ne=He;break}if(ne===-1)break}const ve=M[ne];ve&&ve.connect($)}}const z=new V,k=new V;function G(j,Z,$){z.setFromMatrixPosition(Z.matrixWorld),k.setFromMatrixPosition($.matrixWorld);const ne=z.distanceTo(k),ve=Z.projectionMatrix.elements,He=$.projectionMatrix.elements,Ve=ve[14]/(ve[10]-1),st=ve[14]/(ve[10]+1),Lt=(ve[9]+1)/ve[5],Rt=(ve[9]-1)/ve[5],X=(ve[8]-1)/ve[0],mn=(He[8]+1)/He[0],jt=Ve*X,Ft=Ve*mn,at=ne/(-X+mn),Kt=at*-X;if(Z.matrixWorld.decompose(j.position,j.quaternion,j.scale),j.translateX(Kt),j.translateZ(at),j.matrixWorld.compose(j.position,j.quaternion,j.scale),j.matrixWorldInverse.copy(j.matrixWorld).invert(),ve[10]===-1)j.projectionMatrix.copy(Z.projectionMatrix),j.projectionMatrixInverse.copy(Z.projectionMatrixInverse);else{const pt=Ve+at,Pt=st+at,Yn=jt-Kt,H=Ft+(ne-Kt),U=Lt*st/Pt*pt,de=Rt*st/Pt*pt;j.projectionMatrix.makePerspective(Yn,H,U,de,pt,Pt),j.projectionMatrixInverse.copy(j.projectionMatrix).invert()}}function he(j,Z){Z===null?j.matrixWorld.copy(j.matrix):j.matrixWorld.multiplyMatrices(Z.matrixWorld,j.matrix),j.matrixWorldInverse.copy(j.matrixWorld).invert()}this.updateCamera=function(j){if(r===null)return;let Z=j.near,$=j.far;S.texture!==null&&(S.depthNear>0&&(Z=S.depthNear),S.depthFar>0&&($=S.depthFar)),D.near=L.near=C.near=Z,D.far=L.far=C.far=$,(I!==D.near||W!==D.far)&&(r.updateRenderState({depthNear:D.near,depthFar:D.far}),I=D.near,W=D.far),C.layers.mask=j.layers.mask|2,L.layers.mask=j.layers.mask|4,D.layers.mask=C.layers.mask|L.layers.mask;const ne=j.parent,ve=D.cameras;he(D,ne);for(let He=0;He<ve.length;He++)he(ve[He],ne);ve.length===2?G(D,C,L):D.projectionMatrix.copy(C.projectionMatrix),F(j,D,ne)};function F(j,Z,$){$===null?j.matrix.copy(Z.matrixWorld):(j.matrix.copy($.matrixWorld),j.matrix.invert(),j.matrix.multiply(Z.matrixWorld)),j.matrix.decompose(j.position,j.quaternion,j.scale),j.updateMatrixWorld(!0),j.projectionMatrix.copy(Z.projectionMatrix),j.projectionMatrixInverse.copy(Z.projectionMatrixInverse),j.isPerspectiveCamera&&(j.fov=Eu*2*Math.atan(1/j.projectionMatrix.elements[5]),j.zoom=1)}this.getCamera=function(){return D},this.getFoveation=function(){if(!(g===null&&y===null))return u},this.setFoveation=function(j){u=j,g!==null&&(g.fixedFoveation=j),y!==null&&y.fixedFoveation!==void 0&&(y.fixedFoveation=j)},this.hasDepthSensing=function(){return S.texture!==null},this.getDepthSensingMesh=function(){return S.getMesh(D)};let se=null;function Me(j,Z){if(d=Z.getViewerPose(h||a),v=Z,d!==null){const $=d.views;y!==null&&(e.setRenderTargetFramebuffer(E,y.framebuffer),e.setRenderTarget(E));let ne=!1;$.length!==D.cameras.length&&(D.cameras.length=0,ne=!0);for(let Ve=0;Ve<$.length;Ve++){const st=$[Ve];let Lt=null;if(y!==null)Lt=y.getViewport(st);else{const X=p.getViewSubImage(g,st);Lt=X.viewport,Ve===0&&(e.setRenderTargetTextures(E,X.colorTexture,X.depthStencilTexture),e.setRenderTarget(E))}let Rt=N[Ve];Rt===void 0&&(Rt=new Ui,Rt.layers.enable(Ve),Rt.viewport=new bt,N[Ve]=Rt),Rt.matrix.fromArray(st.transform.matrix),Rt.matrix.decompose(Rt.position,Rt.quaternion,Rt.scale),Rt.projectionMatrix.fromArray(st.projectionMatrix),Rt.projectionMatrixInverse.copy(Rt.projectionMatrix).invert(),Rt.viewport.set(Lt.x,Lt.y,Lt.width,Lt.height),Ve===0&&(D.matrix.copy(Rt.matrix),D.matrix.decompose(D.position,D.quaternion,D.scale)),ne===!0&&D.cameras.push(Rt)}const ve=r.enabledFeatures;if(ve&&ve.includes("depth-sensing")&&r.depthUsage=="gpu-optimized"&&p){const Ve=p.getDepthInformation($[0]);Ve&&Ve.isValid&&Ve.texture&&S.init(e,Ve,r.renderState)}}for(let $=0;$<M.length;$++){const ne=A[$],ve=M[$];ne!==null&&ve!==void 0&&ve.update(ne,Z,h||a)}se&&se(j,Z),Z.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:Z}),v=null}const De=new vO;De.setAnimationLoop(Me),this.setAnimationLoop=function(j){se=j},this.dispose=function(){}}}const Xl=new Br,F$=new Wt;function k$(i,e){function t(b,_){b.matrixAutoUpdate===!0&&b.updateMatrix(),_.value.copy(b.matrix)}function n(b,_){_.color.getRGB(b.fogColor.value,rO(i)),_.isFog?(b.fogNear.value=_.near,b.fogFar.value=_.far):_.isFogExp2&&(b.fogDensity.value=_.density)}function r(b,_,E,M,A){_.isMeshBasicMaterial||_.isMeshLambertMaterial?s(b,_):_.isMeshToonMaterial?(s(b,_),p(b,_)):_.isMeshPhongMaterial?(s(b,_),d(b,_)):_.isMeshStandardMaterial?(s(b,_),g(b,_),_.isMeshPhysicalMaterial&&y(b,_,A)):_.isMeshMatcapMaterial?(s(b,_),v(b,_)):_.isMeshDepthMaterial?s(b,_):_.isMeshDistanceMaterial?(s(b,_),S(b,_)):_.isMeshNormalMaterial?s(b,_):_.isLineBasicMaterial?(a(b,_),_.isLineDashedMaterial&&l(b,_)):_.isPointsMaterial?u(b,_,E,M):_.isSpriteMaterial?h(b,_):_.isShadowMaterial?(b.color.value.copy(_.color),b.opacity.value=_.opacity):_.isShaderMaterial&&(_.uniformsNeedUpdate=!1)}function s(b,_){b.opacity.value=_.opacity,_.color&&b.diffuse.value.copy(_.color),_.emissive&&b.emissive.value.copy(_.emissive).multiplyScalar(_.emissiveIntensity),_.map&&(b.map.value=_.map,t(_.map,b.mapTransform)),_.alphaMap&&(b.alphaMap.value=_.alphaMap,t(_.alphaMap,b.alphaMapTransform)),_.bumpMap&&(b.bumpMap.value=_.bumpMap,t(_.bumpMap,b.bumpMapTransform),b.bumpScale.value=_.bumpScale,_.side===An&&(b.bumpScale.value*=-1)),_.normalMap&&(b.normalMap.value=_.normalMap,t(_.normalMap,b.normalMapTransform),b.normalScale.value.copy(_.normalScale),_.side===An&&b.normalScale.value.negate()),_.displacementMap&&(b.displacementMap.value=_.displacementMap,t(_.displacementMap,b.displacementMapTransform),b.displacementScale.value=_.displacementScale,b.displacementBias.value=_.displacementBias),_.emissiveMap&&(b.emissiveMap.value=_.emissiveMap,t(_.emissiveMap,b.emissiveMapTransform)),_.specularMap&&(b.specularMap.value=_.specularMap,t(_.specularMap,b.specularMapTransform)),_.alphaTest>0&&(b.alphaTest.value=_.alphaTest);const E=e.get(_),M=E.envMap,A=E.envMapRotation;M&&(b.envMap.value=M,Xl.copy(A),Xl.x*=-1,Xl.y*=-1,Xl.z*=-1,M.isCubeTexture&&M.isRenderTargetTexture===!1&&(Xl.y*=-1,Xl.z*=-1),b.envMapRotation.value.setFromMatrix4(F$.makeRotationFromEuler(Xl)),b.flipEnvMap.value=M.isCubeTexture&&M.isRenderTargetTexture===!1?-1:1,b.reflectivity.value=_.reflectivity,b.ior.value=_.ior,b.refractionRatio.value=_.refractionRatio),_.lightMap&&(b.lightMap.value=_.lightMap,b.lightMapIntensity.value=_.lightMapIntensity,t(_.lightMap,b.lightMapTransform)),_.aoMap&&(b.aoMap.value=_.aoMap,b.aoMapIntensity.value=_.aoMapIntensity,t(_.aoMap,b.aoMapTransform))}function a(b,_){b.diffuse.value.copy(_.color),b.opacity.value=_.opacity,_.map&&(b.map.value=_.map,t(_.map,b.mapTransform))}function l(b,_){b.dashSize.value=_.dashSize,b.totalSize.value=_.dashSize+_.gapSize,b.scale.value=_.scale}function u(b,_,E,M){b.diffuse.value.copy(_.color),b.opacity.value=_.opacity,b.size.value=_.size*E,b.scale.value=M*.5,_.map&&(b.map.value=_.map,t(_.map,b.uvTransform)),_.alphaMap&&(b.alphaMap.value=_.alphaMap,t(_.alphaMap,b.alphaMapTransform)),_.alphaTest>0&&(b.alphaTest.value=_.alphaTest)}function h(b,_){b.diffuse.value.copy(_.color),b.opacity.value=_.opacity,b.rotation.value=_.rotation,_.map&&(b.map.value=_.map,t(_.map,b.mapTransform)),_.alphaMap&&(b.alphaMap.value=_.alphaMap,t(_.alphaMap,b.alphaMapTransform)),_.alphaTest>0&&(b.alphaTest.value=_.alphaTest)}function d(b,_){b.specular.value.copy(_.specular),b.shininess.value=Math.max(_.shininess,1e-4)}function p(b,_){_.gradientMap&&(b.gradientMap.value=_.gradientMap)}function g(b,_){b.metalness.value=_.metalness,_.metalnessMap&&(b.metalnessMap.value=_.metalnessMap,t(_.metalnessMap,b.metalnessMapTransform)),b.roughness.value=_.roughness,_.roughnessMap&&(b.roughnessMap.value=_.roughnessMap,t(_.roughnessMap,b.roughnessMapTransform)),_.envMap&&(b.envMapIntensity.value=_.envMapIntensity)}function y(b,_,E){b.ior.value=_.ior,_.sheen>0&&(b.sheenColor.value.copy(_.sheenColor).multiplyScalar(_.sheen),b.sheenRoughness.value=_.sheenRoughness,_.sheenColorMap&&(b.sheenColorMap.value=_.sheenColorMap,t(_.sheenColorMap,b.sheenColorMapTransform)),_.sheenRoughnessMap&&(b.sheenRoughnessMap.value=_.sheenRoughnessMap,t(_.sheenRoughnessMap,b.sheenRoughnessMapTransform))),_.clearcoat>0&&(b.clearcoat.value=_.clearcoat,b.clearcoatRoughness.value=_.clearcoatRoughness,_.clearcoatMap&&(b.clearcoatMap.value=_.clearcoatMap,t(_.clearcoatMap,b.clearcoatMapTransform)),_.clearcoatRoughnessMap&&(b.clearcoatRoughnessMap.value=_.clearcoatRoughnessMap,t(_.clearcoatRoughnessMap,b.clearcoatRoughnessMapTransform)),_.clearcoatNormalMap&&(b.clearcoatNormalMap.value=_.clearcoatNormalMap,t(_.clearcoatNormalMap,b.clearcoatNormalMapTransform),b.clearcoatNormalScale.value.copy(_.clearcoatNormalScale),_.side===An&&b.clearcoatNormalScale.value.negate())),_.dispersion>0&&(b.dispersion.value=_.dispersion),_.iridescence>0&&(b.iridescence.value=_.iridescence,b.iridescenceIOR.value=_.iridescenceIOR,b.iridescenceThicknessMinimum.value=_.iridescenceThicknessRange[0],b.iridescenceThicknessMaximum.value=_.iridescenceThicknessRange[1],_.iridescenceMap&&(b.iridescenceMap.value=_.iridescenceMap,t(_.iridescenceMap,b.iridescenceMapTransform)),_.iridescenceThicknessMap&&(b.iridescenceThicknessMap.value=_.iridescenceThicknessMap,t(_.iridescenceThicknessMap,b.iridescenceThicknessMapTransform))),_.transmission>0&&(b.transmission.value=_.transmission,b.transmissionSamplerMap.value=E.texture,b.transmissionSamplerSize.value.set(E.width,E.height),_.transmissionMap&&(b.transmissionMap.value=_.transmissionMap,t(_.transmissionMap,b.transmissionMapTransform)),b.thickness.value=_.thickness,_.thicknessMap&&(b.thicknessMap.value=_.thicknessMap,t(_.thicknessMap,b.thicknessMapTransform)),b.attenuationDistance.value=_.attenuationDistance,b.attenuationColor.value.copy(_.attenuationColor)),_.anisotropy>0&&(b.anisotropyVector.value.set(_.anisotropy*Math.cos(_.anisotropyRotation),_.anisotropy*Math.sin(_.anisotropyRotation)),_.anisotropyMap&&(b.anisotropyMap.value=_.anisotropyMap,t(_.anisotropyMap,b.anisotropyMapTransform))),b.specularIntensity.value=_.specularIntensity,b.specularColor.value.copy(_.specularColor),_.specularColorMap&&(b.specularColorMap.value=_.specularColorMap,t(_.specularColorMap,b.specularColorMapTransform)),_.specularIntensityMap&&(b.specularIntensityMap.value=_.specularIntensityMap,t(_.specularIntensityMap,b.specularIntensityMapTransform))}function v(b,_){_.matcap&&(b.matcap.value=_.matcap)}function S(b,_){const E=e.get(_).light;b.referencePosition.value.setFromMatrixPosition(E.matrixWorld),b.nearDistance.value=E.shadow.camera.near,b.farDistance.value=E.shadow.camera.far}return{refreshFogUniforms:n,refreshMaterialUniforms:r}}function z$(i,e,t,n){let r={},s={},a=[];const l=i.getParameter(i.MAX_UNIFORM_BUFFER_BINDINGS);function u(E,M){const A=M.program;n.uniformBlockBinding(E,A)}function h(E,M){let A=r[E.id];A===void 0&&(v(E),A=d(E),r[E.id]=A,E.addEventListener("dispose",b));const w=M.program;n.updateUBOMapping(E,w);const R=e.render.frame;s[E.id]!==R&&(g(E),s[E.id]=R)}function d(E){const M=p();E.__bindingPointIndex=M;const A=i.createBuffer(),w=E.__size,R=E.usage;return i.bindBuffer(i.UNIFORM_BUFFER,A),i.bufferData(i.UNIFORM_BUFFER,w,R),i.bindBuffer(i.UNIFORM_BUFFER,null),i.bindBufferBase(i.UNIFORM_BUFFER,M,A),A}function p(){for(let E=0;E<l;E++)if(a.indexOf(E)===-1)return a.push(E),E;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function g(E){const M=r[E.id],A=E.uniforms,w=E.__cache;i.bindBuffer(i.UNIFORM_BUFFER,M);for(let R=0,C=A.length;R<C;R++){const L=Array.isArray(A[R])?A[R]:[A[R]];for(let N=0,D=L.length;N<D;N++){const I=L[N];if(y(I,R,N,w)===!0){const W=I.__offset,Y=Array.isArray(I.value)?I.value:[I.value];let oe=0;for(let le=0;le<Y.length;le++){const z=Y[le],k=S(z);typeof z=="number"||typeof z=="boolean"?(I.__data[0]=z,i.bufferSubData(i.UNIFORM_BUFFER,W+oe,I.__data)):z.isMatrix3?(I.__data[0]=z.elements[0],I.__data[1]=z.elements[1],I.__data[2]=z.elements[2],I.__data[3]=0,I.__data[4]=z.elements[3],I.__data[5]=z.elements[4],I.__data[6]=z.elements[5],I.__data[7]=0,I.__data[8]=z.elements[6],I.__data[9]=z.elements[7],I.__data[10]=z.elements[8],I.__data[11]=0):(z.toArray(I.__data,oe),oe+=k.storage/Float32Array.BYTES_PER_ELEMENT)}i.bufferSubData(i.UNIFORM_BUFFER,W,I.__data)}}}i.bindBuffer(i.UNIFORM_BUFFER,null)}function y(E,M,A,w){const R=E.value,C=M+"_"+A;if(w[C]===void 0)return typeof R=="number"||typeof R=="boolean"?w[C]=R:w[C]=R.clone(),!0;{const L=w[C];if(typeof R=="number"||typeof R=="boolean"){if(L!==R)return w[C]=R,!0}else if(L.equals(R)===!1)return L.copy(R),!0}return!1}function v(E){const M=E.uniforms;let A=0;const w=16;for(let C=0,L=M.length;C<L;C++){const N=Array.isArray(M[C])?M[C]:[M[C]];for(let D=0,I=N.length;D<I;D++){const W=N[D],Y=Array.isArray(W.value)?W.value:[W.value];for(let oe=0,le=Y.length;oe<le;oe++){const z=Y[oe],k=S(z),G=A%w,he=G%k.boundary,F=G+he;A+=he,F!==0&&w-F<k.storage&&(A+=w-F),W.__data=new Float32Array(k.storage/Float32Array.BYTES_PER_ELEMENT),W.__offset=A,A+=k.storage}}}const R=A%w;return R>0&&(A+=w-R),E.__size=A,E.__cache={},this}function S(E){const M={boundary:0,storage:0};return typeof E=="number"||typeof E=="boolean"?(M.boundary=4,M.storage=4):E.isVector2?(M.boundary=8,M.storage=8):E.isVector3||E.isColor?(M.boundary=16,M.storage=12):E.isVector4?(M.boundary=16,M.storage=16):E.isMatrix3?(M.boundary=48,M.storage=48):E.isMatrix4?(M.boundary=64,M.storage=64):E.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",E),M}function b(E){const M=E.target;M.removeEventListener("dispose",b);const A=a.indexOf(M.__bindingPointIndex);a.splice(A,1),i.deleteBuffer(r[M.id]),delete r[M.id],delete s[M.id]}function _(){for(const E in r)i.deleteBuffer(r[E]);a=[],r={},s={}}return{bind:u,update:h,dispose:_}}class V${constructor(e={}){const{canvas:t=tO(),context:n=null,depth:r=!0,stencil:s=!1,alpha:a=!1,antialias:l=!1,premultipliedAlpha:u=!0,preserveDrawingBuffer:h=!1,powerPreference:d="default",failIfMajorPerformanceCaveat:p=!1,reverseDepthBuffer:g=!1}=e;this.isWebGLRenderer=!0;let y;if(n!==null){if(typeof WebGLRenderingContext<"u"&&n instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");y=n.getContextAttributes().alpha}else y=a;const v=new Uint32Array(4),S=new Int32Array(4);let b=null,_=null;const E=[],M=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=Or,this.toneMappingExposure=1,this.transmissionResolutionScale=1;const A=this;let w=!1;this._outputColorSpace=Ji;let R=0,C=0,L=null,N=-1,D=null;const I=new bt,W=new bt;let Y=null;const oe=new ot(0);let le=0,z=t.width,k=t.height,G=1,he=null,F=null;const se=new bt(0,0,z,k),Me=new bt(0,0,z,k);let De=!1;const j=new jp;let Z=!1,$=!1;const ne=new Wt,ve=new Wt,He=new V,Ve=new bt,st={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let Lt=!1;function Rt(){return L===null?G:1}let X=n;function mn(B,ie){return t.getContext(B,ie)}try{const B={alpha:!0,depth:r,stencil:s,antialias:l,premultipliedAlpha:u,preserveDrawingBuffer:h,powerPreference:d,failIfMajorPerformanceCaveat:p};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${Hh}`),t.addEventListener("webglcontextlost",et,!1),t.addEventListener("webglcontextrestored",ze,!1),t.addEventListener("webglcontextcreationerror",Pe,!1),X===null){const ie="webgl2";if(X=mn(ie,B),X===null)throw mn(ie)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(B){throw console.error("THREE.WebGLRenderer: "+B.message),B}let jt,Ft,at,Kt,pt,Pt,Yn,H,U,de,we,Ce,Se,Qe,$e,rt,lt,Be,Je,ft,dt,je,Ct,J;function Xe(){jt=new Z9(X),jt.init(),je=new L$(X,jt),Ft=new W9(X,jt,e,je),at=new P$(X,jt),Ft.reverseDepthBuffer&&g&&at.buffers.depth.setReversed(!0),Kt=new eq(X),pt=new v$,Pt=new D$(X,jt,at,pt,Ft,je,Kt),Yn=new q9(A),H=new K9(A),U=new aW(X),Ct=new G9(X,U),de=new Q9(X,U,Kt,Ct),we=new nq(X,de,U,Kt),Je=new tq(X,Ft,Pt),rt=new j9(pt),Ce=new y$(A,Yn,H,jt,Ft,Ct,rt),Se=new k$(A,pt),Qe=new x$,$e=new A$(jt),Be=new V9(A,Yn,H,at,we,y,u),lt=new C$(A,we,Ft),J=new z$(X,Kt,Ft,at),ft=new H9(X,jt,Kt),dt=new J9(X,jt,Kt),Kt.programs=Ce.programs,A.capabilities=Ft,A.extensions=jt,A.properties=pt,A.renderLists=Qe,A.shadowMap=lt,A.state=at,A.info=Kt}Xe();const Fe=new I$(A,X);this.xr=Fe,this.getContext=function(){return X},this.getContextAttributes=function(){return X.getContextAttributes()},this.forceContextLoss=function(){const B=jt.get("WEBGL_lose_context");B&&B.loseContext()},this.forceContextRestore=function(){const B=jt.get("WEBGL_lose_context");B&&B.restoreContext()},this.getPixelRatio=function(){return G},this.setPixelRatio=function(B){B!==void 0&&(G=B,this.setSize(z,k,!1))},this.getSize=function(B){return B.set(z,k)},this.setSize=function(B,ie,ge=!0){if(Fe.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}z=B,k=ie,t.width=Math.floor(B*G),t.height=Math.floor(ie*G),ge===!0&&(t.style.width=B+"px",t.style.height=ie+"px"),this.setViewport(0,0,B,ie)},this.getDrawingBufferSize=function(B){return B.set(z*G,k*G).floor()},this.setDrawingBufferSize=function(B,ie,ge){z=B,k=ie,G=ge,t.width=Math.floor(B*ge),t.height=Math.floor(ie*ge),this.setViewport(0,0,B,ie)},this.getCurrentViewport=function(B){return B.copy(I)},this.getViewport=function(B){return B.copy(se)},this.setViewport=function(B,ie,ge,ye){B.isVector4?se.set(B.x,B.y,B.z,B.w):se.set(B,ie,ge,ye),at.viewport(I.copy(se).multiplyScalar(G).round())},this.getScissor=function(B){return B.copy(Me)},this.setScissor=function(B,ie,ge,ye){B.isVector4?Me.set(B.x,B.y,B.z,B.w):Me.set(B,ie,ge,ye),at.scissor(W.copy(Me).multiplyScalar(G).round())},this.getScissorTest=function(){return De},this.setScissorTest=function(B){at.setScissorTest(De=B)},this.setOpaqueSort=function(B){he=B},this.setTransparentSort=function(B){F=B},this.getClearColor=function(B){return B.copy(Be.getClearColor())},this.setClearColor=function(){Be.setClearColor(...arguments)},this.getClearAlpha=function(){return Be.getClearAlpha()},this.setClearAlpha=function(){Be.setClearAlpha(...arguments)},this.clear=function(B=!0,ie=!0,ge=!0){let ye=0;if(B){let ae=!1;if(L!==null){const ke=L.texture.format;ae=ke===qh||ke===jh||ke===Wh}if(ae){const ke=L.texture.type,qe=ke===Gn||ke===En||ke===ks||ke===ts||ke===_v||ke===xv,Ke=Be.getClearColor(),tt=Be.getClearAlpha(),vt=Ke.r,mt=Ke.g,ut=Ke.b;qe?(v[0]=vt,v[1]=mt,v[2]=ut,v[3]=tt,X.clearBufferuiv(X.COLOR,0,v)):(S[0]=vt,S[1]=mt,S[2]=ut,S[3]=tt,X.clearBufferiv(X.COLOR,0,S))}else ye|=X.COLOR_BUFFER_BIT}ie&&(ye|=X.DEPTH_BUFFER_BIT),ge&&(ye|=X.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),X.clear(ye)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",et,!1),t.removeEventListener("webglcontextrestored",ze,!1),t.removeEventListener("webglcontextcreationerror",Pe,!1),Be.dispose(),Qe.dispose(),$e.dispose(),pt.dispose(),Yn.dispose(),H.dispose(),we.dispose(),Ct.dispose(),J.dispose(),Ce.dispose(),Fe.dispose(),Fe.removeEventListener("sessionstart",yi),Fe.removeEventListener("sessionend",Bi),Sr.stop()};function et(B){B.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),w=!0}function ze(){console.log("THREE.WebGLRenderer: Context Restored."),w=!1;const B=Kt.autoReset,ie=lt.enabled,ge=lt.autoUpdate,ye=lt.needsUpdate,ae=lt.type;Xe(),Kt.autoReset=B,lt.enabled=ie,lt.autoUpdate=ge,lt.needsUpdate=ye,lt.type=ae}function Pe(B){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",B.statusMessage)}function nt(B){const ie=B.target;ie.removeEventListener("dispose",nt),At(ie)}function At(B){fn(B),pt.remove(B)}function fn(B){const ie=pt.get(B).programs;ie!==void 0&&(ie.forEach(function(ge){Ce.releaseProgram(ge)}),B.isShaderMaterial&&Ce.releaseShaderCache(B))}this.renderBufferDirect=function(B,ie,ge,ye,ae,ke){ie===null&&(ie=st);const qe=ae.isMesh&&ae.matrixWorld.determinant()<0,Ke=El(B,ie,ge,ye,ae);at.setMaterial(ye,qe);let tt=ge.index,vt=1;if(ye.wireframe===!0){if(tt=de.getWireframeAttribute(ge),tt===void 0)return;vt=2}const mt=ge.drawRange,ut=ge.attributes.position;let Vt=mt.start*vt,on=(mt.start+mt.count)*vt;ke!==null&&(Vt=Math.max(Vt,ke.start*vt),on=Math.min(on,(ke.start+ke.count)*vt)),tt!==null?(Vt=Math.max(Vt,0),on=Math.min(on,tt.count)):ut!=null&&(Vt=Math.max(Vt,0),on=Math.min(on,ut.count));const wn=on-Vt;if(wn<0||wn===1/0)return;Ct.setup(ae,ye,Ke,ge,tt);let Zt,Qt=ft;if(tt!==null&&(Zt=U.get(tt),Qt=dt,Qt.setIndex(Zt)),ae.isMesh)ye.wireframe===!0?(at.setLineWidth(ye.wireframeLinewidth*Rt()),Qt.setMode(X.LINES)):Qt.setMode(X.TRIANGLES);else if(ae.isLine){let gt=ye.linewidth;gt===void 0&&(gt=1),at.setLineWidth(gt*Rt()),ae.isLineSegments?Qt.setMode(X.LINES):ae.isLineLoop?Qt.setMode(X.LINE_LOOP):Qt.setMode(X.LINE_STRIP)}else ae.isPoints?Qt.setMode(X.POINTS):ae.isSprite&&Qt.setMode(X.TRIANGLES);if(ae.isBatchedMesh)if(ae._multiDrawInstances!==null)rs("THREE.WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),Qt.renderMultiDrawInstances(ae._multiDrawStarts,ae._multiDrawCounts,ae._multiDrawCount,ae._multiDrawInstances);else if(jt.get("WEBGL_multi_draw"))Qt.renderMultiDraw(ae._multiDrawStarts,ae._multiDrawCounts,ae._multiDrawCount);else{const gt=ae._multiDrawStarts,Wn=ae._multiDrawCounts,en=ae._multiDrawCount,qi=tt?U.get(tt).bytesPerElement:1,bo=pt.get(ye).currentProgram.getUniforms();for(let Rn=0;Rn<en;Rn++)bo.setValue(X,"_gl_DrawID",Rn),Qt.render(gt[Rn]/qi,Wn[Rn])}else if(ae.isInstancedMesh)Qt.renderInstances(Vt,wn,ae.count);else if(ge.isInstancedBufferGeometry){const gt=ge._maxInstanceCount!==void 0?ge._maxInstanceCount:1/0,Wn=Math.min(ge.instanceCount,gt);Qt.renderInstances(Vt,wn,Wn)}else Qt.render(Vt,wn)};function rn(B,ie,ge){B.transparent===!0&&B.side===dr&&B.forceSinglePass===!1?(B.side=An,B.needsUpdate=!0,_o(B,ie,ge),B.side=Lr,B.needsUpdate=!0,_o(B,ie,ge),B.side=dr):_o(B,ie,ge)}this.compile=function(B,ie,ge=null){ge===null&&(ge=B),_=$e.get(ge),_.init(ie),M.push(_),ge.traverseVisible(function(ae){ae.isLight&&ae.layers.test(ie.layers)&&(_.pushLight(ae),ae.castShadow&&_.pushShadow(ae))}),B!==ge&&B.traverseVisible(function(ae){ae.isLight&&ae.layers.test(ie.layers)&&(_.pushLight(ae),ae.castShadow&&_.pushShadow(ae))}),_.setupLights();const ye=new Set;return B.traverse(function(ae){if(!(ae.isMesh||ae.isPoints||ae.isLine||ae.isSprite))return;const ke=ae.material;if(ke)if(Array.isArray(ke))for(let qe=0;qe<ke.length;qe++){const Ke=ke[qe];rn(Ke,ge,ae),ye.add(Ke)}else rn(ke,ge,ae),ye.add(ke)}),_=M.pop(),ye},this.compileAsync=function(B,ie,ge=null){const ye=this.compile(B,ie,ge);return new Promise(ae=>{function ke(){if(ye.forEach(function(qe){pt.get(qe).currentProgram.isReady()&&ye.delete(qe)}),ye.size===0){ae(B);return}setTimeout(ke,10)}jt.get("KHR_parallel_shader_compile")!==null?ke():setTimeout(ke,10)})};let kr=null;function Ai(B){kr&&kr(B)}function yi(){Sr.stop()}function Bi(){Sr.start()}const Sr=new vO;Sr.setAnimationLoop(Ai),typeof self<"u"&&Sr.setContext(self),this.setAnimationLoop=function(B){kr=B,Fe.setAnimationLoop(B),B===null?Sr.stop():Sr.start()},Fe.addEventListener("sessionstart",yi),Fe.addEventListener("sessionend",Bi),this.render=function(B,ie){if(ie!==void 0&&ie.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(w===!0)return;if(B.matrixWorldAutoUpdate===!0&&B.updateMatrixWorld(),ie.parent===null&&ie.matrixWorldAutoUpdate===!0&&ie.updateMatrixWorld(),Fe.enabled===!0&&Fe.isPresenting===!0&&(Fe.cameraAutoUpdate===!0&&Fe.updateCamera(ie),ie=Fe.getCamera()),B.isScene===!0&&B.onBeforeRender(A,B,ie,L),_=$e.get(B,M.length),_.init(ie),M.push(_),ve.multiplyMatrices(ie.projectionMatrix,ie.matrixWorldInverse),j.setFromProjectionMatrix(ve),$=this.localClippingEnabled,Z=rt.init(this.clippingPlanes,$),b=Qe.get(B,E.length),b.init(),E.push(b),Fe.enabled===!0&&Fe.isPresenting===!0){const ke=A.xr.getDepthSensingMesh();ke!==null&&Tl(ke,ie,-1/0,A.sortObjects)}Tl(B,ie,0,A.sortObjects),b.finish(),A.sortObjects===!0&&b.sort(he,F),Lt=Fe.enabled===!1||Fe.isPresenting===!1||Fe.hasDepthSensing()===!1,Lt&&Be.addToRenderList(b,B),this.info.render.frame++,Z===!0&&rt.beginShadows();const ge=_.state.shadowsArray;lt.render(ge,B,ie),Z===!0&&rt.endShadows(),this.info.autoReset===!0&&this.info.reset();const ye=b.opaque,ae=b.transmissive;if(_.setupLights(),ie.isArrayCamera){const ke=ie.cameras;if(ae.length>0)for(let qe=0,Ke=ke.length;qe<Ke;qe++){const tt=ke[qe];im(ye,ae,B,tt)}Lt&&Be.render(B);for(let qe=0,Ke=ke.length;qe<Ke;qe++){const tt=ke[qe];nm(b,B,tt,tt.viewport)}}else ae.length>0&&im(ye,ae,B,ie),Lt&&Be.render(B),nm(b,B,ie);L!==null&&C===0&&(Pt.updateMultisampleRenderTarget(L),Pt.updateRenderTargetMipmap(L)),B.isScene===!0&&B.onAfterRender(A,B,ie),Ct.resetDefaultState(),N=-1,D=null,M.pop(),M.length>0?(_=M[M.length-1],Z===!0&&rt.setGlobalState(A.clippingPlanes,_.state.camera)):_=null,E.pop(),E.length>0?b=E[E.length-1]:b=null};function Tl(B,ie,ge,ye){if(B.visible===!1)return;if(B.layers.test(ie.layers)){if(B.isGroup)ge=B.renderOrder;else if(B.isLOD)B.autoUpdate===!0&&B.update(ie);else if(B.isLight)_.pushLight(B),B.castShadow&&_.pushShadow(B);else if(B.isSprite){if(!B.frustumCulled||j.intersectsSprite(B)){ye&&Ve.setFromMatrixPosition(B.matrixWorld).applyMatrix4(ve);const qe=we.update(B),Ke=B.material;Ke.visible&&b.push(B,qe,Ke,ge,Ve.z,null)}}else if((B.isMesh||B.isLine||B.isPoints)&&(!B.frustumCulled||j.intersectsObject(B))){const qe=we.update(B),Ke=B.material;if(ye&&(B.boundingSphere!==void 0?(B.boundingSphere===null&&B.computeBoundingSphere(),Ve.copy(B.boundingSphere.center)):(qe.boundingSphere===null&&qe.computeBoundingSphere(),Ve.copy(qe.boundingSphere.center)),Ve.applyMatrix4(B.matrixWorld).applyMatrix4(ve)),Array.isArray(Ke)){const tt=qe.groups;for(let vt=0,mt=tt.length;vt<mt;vt++){const ut=tt[vt],Vt=Ke[ut.materialIndex];Vt&&Vt.visible&&b.push(B,qe,Vt,ge,Ve.z,ut)}}else Ke.visible&&b.push(B,qe,Ke,ge,Ve.z,null)}}const ke=B.children;for(let qe=0,Ke=ke.length;qe<Ke;qe++)Tl(ke[qe],ie,ge,ye)}function nm(B,ie,ge,ye){const ae=B.opaque,ke=B.transmissive,qe=B.transparent;_.setupLightsView(ge),Z===!0&&rt.setGlobalState(A.clippingPlanes,ge),ye&&at.viewport(I.copy(ye)),ae.length>0&&Ml(ae,ie,ge),ke.length>0&&Ml(ke,ie,ge),qe.length>0&&Ml(qe,ie,ge),at.buffers.depth.setTest(!0),at.buffers.depth.setMask(!0),at.buffers.color.setMask(!0),at.setPolygonOffset(!1)}function im(B,ie,ge,ye){if((ge.isScene===!0?ge.overrideMaterial:null)!==null)return;_.state.transmissionRenderTarget[ye.id]===void 0&&(_.state.transmissionRenderTarget[ye.id]=new dl(1,1,{generateMipmaps:!0,type:jt.has("EXT_color_buffer_half_float")||jt.has("EXT_color_buffer_float")?Oi:Gn,minFilter:Nr,samples:4,stencilBuffer:s,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:wt.workingColorSpace}));const ke=_.state.transmissionRenderTarget[ye.id],qe=ye.viewport||I;ke.setSize(qe.z*A.transmissionResolutionScale,qe.w*A.transmissionResolutionScale);const Ke=A.getRenderTarget();A.setRenderTarget(ke),A.getClearColor(oe),le=A.getClearAlpha(),le<1&&A.setClearColor(16777215,.5),A.clear(),Lt&&Be.render(ge);const tt=A.toneMapping;A.toneMapping=Or;const vt=ye.viewport;if(ye.viewport!==void 0&&(ye.viewport=void 0),_.setupLightsView(ye),Z===!0&&rt.setGlobalState(A.clippingPlanes,ye),Ml(B,ge,ye),Pt.updateMultisampleRenderTarget(ke),Pt.updateRenderTargetMipmap(ke),jt.has("WEBGL_multisampled_render_to_texture")===!1){let mt=!1;for(let ut=0,Vt=ie.length;ut<Vt;ut++){const on=ie[ut],wn=on.object,Zt=on.geometry,Qt=on.material,gt=on.group;if(Qt.side===dr&&wn.layers.test(ye.layers)){const Wn=Qt.side;Qt.side=An,Qt.needsUpdate=!0,vo(wn,ge,ye,Zt,Qt,gt),Qt.side=Wn,Qt.needsUpdate=!0,mt=!0}}mt===!0&&(Pt.updateMultisampleRenderTarget(ke),Pt.updateRenderTargetMipmap(ke))}A.setRenderTarget(Ke),A.setClearColor(oe,le),vt!==void 0&&(ye.viewport=vt),A.toneMapping=tt}function Ml(B,ie,ge){const ye=ie.isScene===!0?ie.overrideMaterial:null;for(let ae=0,ke=B.length;ae<ke;ae++){const qe=B[ae],Ke=qe.object,tt=qe.geometry,vt=qe.group;let mt=qe.material;mt.allowOverride===!0&&ye!==null&&(mt=ye),Ke.layers.test(ge.layers)&&vo(Ke,ie,ge,tt,mt,vt)}}function vo(B,ie,ge,ye,ae,ke){B.onBeforeRender(A,ie,ge,ye,ae,ke),B.modelViewMatrix.multiplyMatrices(ge.matrixWorldInverse,B.matrixWorld),B.normalMatrix.getNormalMatrix(B.modelViewMatrix),ae.onBeforeRender(A,ie,ge,ye,B,ke),ae.transparent===!0&&ae.side===dr&&ae.forceSinglePass===!1?(ae.side=An,ae.needsUpdate=!0,A.renderBufferDirect(ge,ie,ye,ae,B,ke),ae.side=Lr,ae.needsUpdate=!0,A.renderBufferDirect(ge,ie,ye,ae,B,ke),ae.side=dr):A.renderBufferDirect(ge,ie,ye,ae,B,ke),B.onAfterRender(A,ie,ge,ye,ae,ke)}function _o(B,ie,ge){ie.isScene!==!0&&(ie=st);const ye=pt.get(B),ae=_.state.lights,ke=_.state.shadowsArray,qe=ae.state.version,Ke=Ce.getParameters(B,ae.state,ke,ie,ge),tt=Ce.getProgramCacheKey(Ke);let vt=ye.programs;ye.environment=B.isMeshStandardMaterial?ie.environment:null,ye.fog=ie.fog,ye.envMap=(B.isMeshStandardMaterial?H:Yn).get(B.envMap||ye.environment),ye.envMapRotation=ye.environment!==null&&B.envMap===null?ie.environmentRotation:B.envMapRotation,vt===void 0&&(B.addEventListener("dispose",nt),vt=new Map,ye.programs=vt);let mt=vt.get(tt);if(mt!==void 0){if(ye.currentProgram===mt&&ye.lightsStateVersion===qe)return xa(B,Ke),mt}else Ke.uniforms=Ce.getUniforms(B),B.onBeforeCompile(Ke,A),mt=Ce.acquireProgram(Ke,tt),vt.set(tt,mt),ye.uniforms=Ke.uniforms;const ut=ye.uniforms;return(!B.isShaderMaterial&&!B.isRawShaderMaterial||B.clipping===!0)&&(ut.clippingPlanes=rt.uniform),xa(B,Ke),ye.needsLights=ri(B),ye.lightsStateVersion=qe,ye.needsLights&&(ut.ambientLightColor.value=ae.state.ambient,ut.lightProbe.value=ae.state.probe,ut.directionalLights.value=ae.state.directional,ut.directionalLightShadows.value=ae.state.directionalShadow,ut.spotLights.value=ae.state.spot,ut.spotLightShadows.value=ae.state.spotShadow,ut.rectAreaLights.value=ae.state.rectArea,ut.ltc_1.value=ae.state.rectAreaLTC1,ut.ltc_2.value=ae.state.rectAreaLTC2,ut.pointLights.value=ae.state.point,ut.pointLightShadows.value=ae.state.pointShadow,ut.hemisphereLights.value=ae.state.hemi,ut.directionalShadowMap.value=ae.state.directionalShadowMap,ut.directionalShadowMatrix.value=ae.state.directionalShadowMatrix,ut.spotShadowMap.value=ae.state.spotShadowMap,ut.spotLightMatrix.value=ae.state.spotLightMatrix,ut.spotLightMap.value=ae.state.spotLightMap,ut.pointShadowMap.value=ae.state.pointShadowMap,ut.pointShadowMatrix.value=ae.state.pointShadowMatrix),ye.currentProgram=mt,ye.uniformsList=null,mt}function _a(B){if(B.uniformsList===null){const ie=B.currentProgram.getUniforms();B.uniformsList=Ay.seqWithValue(ie.seq,B.uniforms)}return B.uniformsList}function xa(B,ie){const ge=pt.get(B);ge.outputColorSpace=ie.outputColorSpace,ge.batching=ie.batching,ge.batchingColor=ie.batchingColor,ge.instancing=ie.instancing,ge.instancingColor=ie.instancingColor,ge.instancingMorph=ie.instancingMorph,ge.skinning=ie.skinning,ge.morphTargets=ie.morphTargets,ge.morphNormals=ie.morphNormals,ge.morphColors=ie.morphColors,ge.morphTargetsCount=ie.morphTargetsCount,ge.numClippingPlanes=ie.numClippingPlanes,ge.numIntersection=ie.numClipIntersection,ge.vertexAlphas=ie.vertexAlphas,ge.vertexTangents=ie.vertexTangents,ge.toneMapping=ie.toneMapping}function El(B,ie,ge,ye,ae){ie.isScene!==!0&&(ie=st),Pt.resetTextureUnits();const ke=ie.fog,qe=ye.isMeshStandardMaterial?ie.environment:null,Ke=L===null?A.outputColorSpace:L.isXRRenderTarget===!0?L.texture.colorSpace:ca,tt=(ye.isMeshStandardMaterial?H:Yn).get(ye.envMap||qe),vt=ye.vertexColors===!0&&!!ge.attributes.color&&ge.attributes.color.itemSize===4,mt=!!ge.attributes.tangent&&(!!ye.normalMap||ye.anisotropy>0),ut=!!ge.morphAttributes.position,Vt=!!ge.morphAttributes.normal,on=!!ge.morphAttributes.color;let wn=Or;ye.toneMapped&&(L===null||L.isXRRenderTarget===!0)&&(wn=A.toneMapping);const Zt=ge.morphAttributes.position||ge.morphAttributes.normal||ge.morphAttributes.color,Qt=Zt!==void 0?Zt.length:0,gt=pt.get(ye),Wn=_.state.lights;if(Z===!0&&($===!0||B!==D)){const wi=B===D&&ye.id===N;rt.setState(ye,B,wi)}let en=!1;ye.version===gt.__version?(gt.needsLights&&gt.lightsStateVersion!==Wn.state.version||gt.outputColorSpace!==Ke||ae.isBatchedMesh&&gt.batching===!1||!ae.isBatchedMesh&&gt.batching===!0||ae.isBatchedMesh&&gt.batchingColor===!0&&ae.colorTexture===null||ae.isBatchedMesh&&gt.batchingColor===!1&&ae.colorTexture!==null||ae.isInstancedMesh&&gt.instancing===!1||!ae.isInstancedMesh&&gt.instancing===!0||ae.isSkinnedMesh&&gt.skinning===!1||!ae.isSkinnedMesh&&gt.skinning===!0||ae.isInstancedMesh&&gt.instancingColor===!0&&ae.instanceColor===null||ae.isInstancedMesh&&gt.instancingColor===!1&&ae.instanceColor!==null||ae.isInstancedMesh&&gt.instancingMorph===!0&&ae.morphTexture===null||ae.isInstancedMesh&&gt.instancingMorph===!1&&ae.morphTexture!==null||gt.envMap!==tt||ye.fog===!0&&gt.fog!==ke||gt.numClippingPlanes!==void 0&&(gt.numClippingPlanes!==rt.numPlanes||gt.numIntersection!==rt.numIntersection)||gt.vertexAlphas!==vt||gt.vertexTangents!==mt||gt.morphTargets!==ut||gt.morphNormals!==Vt||gt.morphColors!==on||gt.toneMapping!==wn||gt.morphTargetsCount!==Qt)&&(en=!0):(en=!0,gt.__version=ye.version);let qi=gt.currentProgram;en===!0&&(qi=_o(ye,ie,ae));let bo=!1,Rn=!1,Sa=!1;const bn=qi.getUniforms(),$i=gt.uniforms;if(at.useProgram(qi.program)&&(bo=!0,Rn=!0,Sa=!0),ye.id!==N&&(N=ye.id,Rn=!0),bo||D!==B){at.buffers.depth.getReversed()?(ne.copy(B.projectionMatrix),W6(ne),j6(ne),bn.setValue(X,"projectionMatrix",ne)):bn.setValue(X,"projectionMatrix",B.projectionMatrix),bn.setValue(X,"viewMatrix",B.matrixWorldInverse);const Ii=bn.map.cameraPosition;Ii!==void 0&&Ii.setValue(X,He.setFromMatrixPosition(B.matrixWorld)),Ft.logarithmicDepthBuffer&&bn.setValue(X,"logDepthBufFC",2/(Math.log(B.far+1)/Math.LN2)),(ye.isMeshPhongMaterial||ye.isMeshToonMaterial||ye.isMeshLambertMaterial||ye.isMeshBasicMaterial||ye.isMeshStandardMaterial||ye.isShaderMaterial)&&bn.setValue(X,"isOrthographic",B.isOrthographicCamera===!0),D!==B&&(D=B,Rn=!0,Sa=!0)}if(ae.isSkinnedMesh){bn.setOptional(X,ae,"bindMatrix"),bn.setOptional(X,ae,"bindMatrixInverse");const wi=ae.skeleton;wi&&(wi.boneTexture===null&&wi.computeBoneTexture(),bn.setValue(X,"boneTexture",wi.boneTexture,Pt))}ae.isBatchedMesh&&(bn.setOptional(X,ae,"batchingTexture"),bn.setValue(X,"batchingTexture",ae._matricesTexture,Pt),bn.setOptional(X,ae,"batchingIdTexture"),bn.setValue(X,"batchingIdTexture",ae._indirectTexture,Pt),bn.setOptional(X,ae,"batchingColorTexture"),ae._colorsTexture!==null&&bn.setValue(X,"batchingColorTexture",ae._colorsTexture,Pt));const vi=ge.morphAttributes;if((vi.position!==void 0||vi.normal!==void 0||vi.color!==void 0)&&Je.update(ae,ge,qi),(Rn||gt.receiveShadow!==ae.receiveShadow)&&(gt.receiveShadow=ae.receiveShadow,bn.setValue(X,"receiveShadow",ae.receiveShadow)),ye.isMeshGouraudMaterial&&ye.envMap!==null&&($i.envMap.value=tt,$i.flipEnvMap.value=tt.isCubeTexture&&tt.isRenderTargetTexture===!1?-1:1),ye.isMeshStandardMaterial&&ye.envMap===null&&ie.environment!==null&&($i.envMapIntensity.value=ie.environmentIntensity),Rn&&(bn.setValue(X,"toneMappingExposure",A.toneMappingExposure),gt.needsLights&&xo($i,Sa),ke&&ye.fog===!0&&Se.refreshFogUniforms($i,ke),Se.refreshMaterialUniforms($i,ye,G,k,_.state.transmissionRenderTarget[B.id]),Ay.upload(X,_a(gt),$i,Pt)),ye.isShaderMaterial&&ye.uniformsNeedUpdate===!0&&(Ay.upload(X,_a(gt),$i,Pt),ye.uniformsNeedUpdate=!1),ye.isSpriteMaterial&&bn.setValue(X,"center",ae.center),bn.setValue(X,"modelViewMatrix",ae.modelViewMatrix),bn.setValue(X,"normalMatrix",ae.normalMatrix),bn.setValue(X,"modelMatrix",ae.matrixWorld),ye.isShaderMaterial||ye.isRawShaderMaterial){const wi=ye.uniformsGroups;for(let Ii=0,Ws=wi.length;Ii<Ws;Ii++){const Ta=wi[Ii];J.update(Ta,qi),J.bind(Ta,qi)}}return qi}function xo(B,ie){B.ambientLightColor.needsUpdate=ie,B.lightProbe.needsUpdate=ie,B.directionalLights.needsUpdate=ie,B.directionalLightShadows.needsUpdate=ie,B.pointLights.needsUpdate=ie,B.pointLightShadows.needsUpdate=ie,B.spotLights.needsUpdate=ie,B.spotLightShadows.needsUpdate=ie,B.rectAreaLights.needsUpdate=ie,B.hemisphereLights.needsUpdate=ie}function ri(B){return B.isMeshLambertMaterial||B.isMeshToonMaterial||B.isMeshPhongMaterial||B.isMeshStandardMaterial||B.isShadowMaterial||B.isShaderMaterial&&B.lights===!0}this.getActiveCubeFace=function(){return R},this.getActiveMipmapLevel=function(){return C},this.getRenderTarget=function(){return L},this.setRenderTargetTextures=function(B,ie,ge){const ye=pt.get(B);ye.__autoAllocateDepthBuffer=B.resolveDepthBuffer===!1,ye.__autoAllocateDepthBuffer===!1&&(ye.__useRenderToTexture=!1),pt.get(B.texture).__webglTexture=ie,pt.get(B.depthTexture).__webglTexture=ye.__autoAllocateDepthBuffer?void 0:ge,ye.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function(B,ie){const ge=pt.get(B);ge.__webglFramebuffer=ie,ge.__useDefaultFramebuffer=ie===void 0};const rm=X.createFramebuffer();this.setRenderTarget=function(B,ie=0,ge=0){L=B,R=ie,C=ge;let ye=!0,ae=null,ke=!1,qe=!1;if(B){const tt=pt.get(B);if(tt.__useDefaultFramebuffer!==void 0)at.bindFramebuffer(X.FRAMEBUFFER,null),ye=!1;else if(tt.__webglFramebuffer===void 0)Pt.setupRenderTarget(B);else if(tt.__hasExternalTextures)Pt.rebindTextures(B,pt.get(B.texture).__webglTexture,pt.get(B.depthTexture).__webglTexture);else if(B.depthBuffer){const ut=B.depthTexture;if(tt.__boundDepthTexture!==ut){if(ut!==null&&pt.has(ut)&&(B.width!==ut.image.width||B.height!==ut.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");Pt.setupDepthRenderbuffer(B)}}const vt=B.texture;(vt.isData3DTexture||vt.isDataArrayTexture||vt.isCompressedArrayTexture)&&(qe=!0);const mt=pt.get(B).__webglFramebuffer;B.isWebGLCubeRenderTarget?(Array.isArray(mt[ie])?ae=mt[ie][ge]:ae=mt[ie],ke=!0):B.samples>0&&Pt.useMultisampledRTT(B)===!1?ae=pt.get(B).__webglMultisampledFramebuffer:Array.isArray(mt)?ae=mt[ge]:ae=mt,I.copy(B.viewport),W.copy(B.scissor),Y=B.scissorTest}else I.copy(se).multiplyScalar(G).floor(),W.copy(Me).multiplyScalar(G).floor(),Y=De;if(ge!==0&&(ae=rm),at.bindFramebuffer(X.FRAMEBUFFER,ae)&&ye&&at.drawBuffers(B,ae),at.viewport(I),at.scissor(W),at.setScissorTest(Y),ke){const tt=pt.get(B.texture);X.framebufferTexture2D(X.FRAMEBUFFER,X.COLOR_ATTACHMENT0,X.TEXTURE_CUBE_MAP_POSITIVE_X+ie,tt.__webglTexture,ge)}else if(qe){const tt=pt.get(B.texture),vt=ie;X.framebufferTextureLayer(X.FRAMEBUFFER,X.COLOR_ATTACHMENT0,tt.__webglTexture,ge,vt)}else if(B!==null&&ge!==0){const tt=pt.get(B.texture);X.framebufferTexture2D(X.FRAMEBUFFER,X.COLOR_ATTACHMENT0,X.TEXTURE_2D,tt.__webglTexture,ge)}N=-1},this.readRenderTargetPixels=function(B,ie,ge,ye,ae,ke,qe,Ke=0){if(!(B&&B.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let tt=pt.get(B).__webglFramebuffer;if(B.isWebGLCubeRenderTarget&&qe!==void 0&&(tt=tt[qe]),tt){at.bindFramebuffer(X.FRAMEBUFFER,tt);try{const vt=B.textures[Ke],mt=vt.format,ut=vt.type;if(!Ft.textureFormatReadable(mt)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!Ft.textureTypeReadable(ut)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}ie>=0&&ie<=B.width-ye&&ge>=0&&ge<=B.height-ae&&(B.textures.length>1&&X.readBuffer(X.COLOR_ATTACHMENT0+Ke),X.readPixels(ie,ge,ye,ae,je.convert(mt),je.convert(ut),ke))}finally{const vt=L!==null?pt.get(L).__webglFramebuffer:null;at.bindFramebuffer(X.FRAMEBUFFER,vt)}}},this.readRenderTargetPixelsAsync=async function(B,ie,ge,ye,ae,ke,qe,Ke=0){if(!(B&&B.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let tt=pt.get(B).__webglFramebuffer;if(B.isWebGLCubeRenderTarget&&qe!==void 0&&(tt=tt[qe]),tt)if(ie>=0&&ie<=B.width-ye&&ge>=0&&ge<=B.height-ae){at.bindFramebuffer(X.FRAMEBUFFER,tt);const vt=B.textures[Ke],mt=vt.format,ut=vt.type;if(!Ft.textureFormatReadable(mt))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!Ft.textureTypeReadable(ut))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");const Vt=X.createBuffer();X.bindBuffer(X.PIXEL_PACK_BUFFER,Vt),X.bufferData(X.PIXEL_PACK_BUFFER,ke.byteLength,X.STREAM_READ),B.textures.length>1&&X.readBuffer(X.COLOR_ATTACHMENT0+Ke),X.readPixels(ie,ge,ye,ae,je.convert(mt),je.convert(ut),0);const on=L!==null?pt.get(L).__webglFramebuffer:null;at.bindFramebuffer(X.FRAMEBUFFER,on);const wn=X.fenceSync(X.SYNC_GPU_COMMANDS_COMPLETE,0);return X.flush(),await H6(X,wn,4),X.bindBuffer(X.PIXEL_PACK_BUFFER,Vt),X.getBufferSubData(X.PIXEL_PACK_BUFFER,0,ke),X.deleteBuffer(Vt),X.deleteSync(wn),ke}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")},this.copyFramebufferToTexture=function(B,ie=null,ge=0){const ye=Math.pow(2,-ge),ae=Math.floor(B.image.width*ye),ke=Math.floor(B.image.height*ye),qe=ie!==null?ie.x:0,Ke=ie!==null?ie.y:0;Pt.setTexture2D(B,0),X.copyTexSubImage2D(X.TEXTURE_2D,ge,0,0,qe,Ke,ae,ke),at.unbindTexture()};const sm=X.createFramebuffer(),ba=X.createFramebuffer();this.copyTextureToTexture=function(B,ie,ge=null,ye=null,ae=0,ke=null){ke===null&&(ae!==0?(rs("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),ke=ae,ae=0):ke=0);let qe,Ke,tt,vt,mt,ut,Vt,on,wn;const Zt=B.isCompressedTexture?B.mipmaps[ke]:B.image;if(ge!==null)qe=ge.max.x-ge.min.x,Ke=ge.max.y-ge.min.y,tt=ge.isBox3?ge.max.z-ge.min.z:1,vt=ge.min.x,mt=ge.min.y,ut=ge.isBox3?ge.min.z:0;else{const vi=Math.pow(2,-ae);qe=Math.floor(Zt.width*vi),Ke=Math.floor(Zt.height*vi),B.isDataArrayTexture?tt=Zt.depth:B.isData3DTexture?tt=Math.floor(Zt.depth*vi):tt=1,vt=0,mt=0,ut=0}ye!==null?(Vt=ye.x,on=ye.y,wn=ye.z):(Vt=0,on=0,wn=0);const Qt=je.convert(ie.format),gt=je.convert(ie.type);let Wn;ie.isData3DTexture?(Pt.setTexture3D(ie,0),Wn=X.TEXTURE_3D):ie.isDataArrayTexture||ie.isCompressedArrayTexture?(Pt.setTexture2DArray(ie,0),Wn=X.TEXTURE_2D_ARRAY):(Pt.setTexture2D(ie,0),Wn=X.TEXTURE_2D),X.pixelStorei(X.UNPACK_FLIP_Y_WEBGL,ie.flipY),X.pixelStorei(X.UNPACK_PREMULTIPLY_ALPHA_WEBGL,ie.premultiplyAlpha),X.pixelStorei(X.UNPACK_ALIGNMENT,ie.unpackAlignment);const en=X.getParameter(X.UNPACK_ROW_LENGTH),qi=X.getParameter(X.UNPACK_IMAGE_HEIGHT),bo=X.getParameter(X.UNPACK_SKIP_PIXELS),Rn=X.getParameter(X.UNPACK_SKIP_ROWS),Sa=X.getParameter(X.UNPACK_SKIP_IMAGES);X.pixelStorei(X.UNPACK_ROW_LENGTH,Zt.width),X.pixelStorei(X.UNPACK_IMAGE_HEIGHT,Zt.height),X.pixelStorei(X.UNPACK_SKIP_PIXELS,vt),X.pixelStorei(X.UNPACK_SKIP_ROWS,mt),X.pixelStorei(X.UNPACK_SKIP_IMAGES,ut);const bn=B.isDataArrayTexture||B.isData3DTexture,$i=ie.isDataArrayTexture||ie.isData3DTexture;if(B.isDepthTexture){const vi=pt.get(B),wi=pt.get(ie),Ii=pt.get(vi.__renderTarget),Ws=pt.get(wi.__renderTarget);at.bindFramebuffer(X.READ_FRAMEBUFFER,Ii.__webglFramebuffer),at.bindFramebuffer(X.DRAW_FRAMEBUFFER,Ws.__webglFramebuffer);for(let Ta=0;Ta<tt;Ta++)bn&&(X.framebufferTextureLayer(X.READ_FRAMEBUFFER,X.COLOR_ATTACHMENT0,pt.get(B).__webglTexture,ae,ut+Ta),X.framebufferTextureLayer(X.DRAW_FRAMEBUFFER,X.COLOR_ATTACHMENT0,pt.get(ie).__webglTexture,ke,wn+Ta)),X.blitFramebuffer(vt,mt,qe,Ke,Vt,on,qe,Ke,X.DEPTH_BUFFER_BIT,X.NEAREST);at.bindFramebuffer(X.READ_FRAMEBUFFER,null),at.bindFramebuffer(X.DRAW_FRAMEBUFFER,null)}else if(ae!==0||B.isRenderTargetTexture||pt.has(B)){const vi=pt.get(B),wi=pt.get(ie);at.bindFramebuffer(X.READ_FRAMEBUFFER,sm),at.bindFramebuffer(X.DRAW_FRAMEBUFFER,ba);for(let Ii=0;Ii<tt;Ii++)bn?X.framebufferTextureLayer(X.READ_FRAMEBUFFER,X.COLOR_ATTACHMENT0,vi.__webglTexture,ae,ut+Ii):X.framebufferTexture2D(X.READ_FRAMEBUFFER,X.COLOR_ATTACHMENT0,X.TEXTURE_2D,vi.__webglTexture,ae),$i?X.framebufferTextureLayer(X.DRAW_FRAMEBUFFER,X.COLOR_ATTACHMENT0,wi.__webglTexture,ke,wn+Ii):X.framebufferTexture2D(X.DRAW_FRAMEBUFFER,X.COLOR_ATTACHMENT0,X.TEXTURE_2D,wi.__webglTexture,ke),ae!==0?X.blitFramebuffer(vt,mt,qe,Ke,Vt,on,qe,Ke,X.COLOR_BUFFER_BIT,X.NEAREST):$i?X.copyTexSubImage3D(Wn,ke,Vt,on,wn+Ii,vt,mt,qe,Ke):X.copyTexSubImage2D(Wn,ke,Vt,on,vt,mt,qe,Ke);at.bindFramebuffer(X.READ_FRAMEBUFFER,null),at.bindFramebuffer(X.DRAW_FRAMEBUFFER,null)}else $i?B.isDataTexture||B.isData3DTexture?X.texSubImage3D(Wn,ke,Vt,on,wn,qe,Ke,tt,Qt,gt,Zt.data):ie.isCompressedArrayTexture?X.compressedTexSubImage3D(Wn,ke,Vt,on,wn,qe,Ke,tt,Qt,Zt.data):X.texSubImage3D(Wn,ke,Vt,on,wn,qe,Ke,tt,Qt,gt,Zt):B.isDataTexture?X.texSubImage2D(X.TEXTURE_2D,ke,Vt,on,qe,Ke,Qt,gt,Zt.data):B.isCompressedTexture?X.compressedTexSubImage2D(X.TEXTURE_2D,ke,Vt,on,Zt.width,Zt.height,Qt,Zt.data):X.texSubImage2D(X.TEXTURE_2D,ke,Vt,on,qe,Ke,Qt,gt,Zt);X.pixelStorei(X.UNPACK_ROW_LENGTH,en),X.pixelStorei(X.UNPACK_IMAGE_HEIGHT,qi),X.pixelStorei(X.UNPACK_SKIP_PIXELS,bo),X.pixelStorei(X.UNPACK_SKIP_ROWS,Rn),X.pixelStorei(X.UNPACK_SKIP_IMAGES,Sa),ke===0&&ie.generateMipmaps&&X.generateMipmap(Wn),at.unbindTexture()},this.copyTextureToTexture3D=function(B,ie,ge=null,ye=null,ae=0){return rs('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(B,ie,ge,ye,ae)},this.initRenderTarget=function(B){pt.get(B).__webglFramebuffer===void 0&&Pt.setupRenderTarget(B)},this.initTexture=function(B){B.isCubeTexture?Pt.setTextureCube(B,0):B.isData3DTexture?Pt.setTexture3D(B,0):B.isDataArrayTexture||B.isCompressedArrayTexture?Pt.setTexture2DArray(B,0):Pt.setTexture2D(B,0),at.unbindTexture()},this.resetState=function(){R=0,C=0,L=null,at.reset(),Ct.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return vr}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=wt._getDrawingBufferColorSpace(e),t.unpackColorSpace=wt._getUnpackColorSpace()}}const eh=new Bs,Ka=new Le,TO=new V,nb=new Le,wy=new Le,$y=new V,YS=new V,MO=new Wt,EO=new V,AO=new V;let Rr=null,Js=null;const Za=[],ll={NONE:-1,PAN:0,ROTATE:1};class G$ extends Rv{constructor(e,t,n=null){super(t,n),this.objects=e,this.recursive=!0,this.transformGroup=!1,this.rotateSpeed=1,this.raycaster=new yO,this.mouseButtons={LEFT:Hi.PAN,MIDDLE:Hi.PAN,RIGHT:Hi.ROTATE},this.touches={ONE:Ja.PAN},this._onPointerMove=H$.bind(this),this._onPointerDown=W$.bind(this),this._onPointerCancel=j$.bind(this),this._onContextMenu=q$.bind(this),n!==null&&this.connect(n)}connect(e){super.connect(e),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerCancel),this.domElement.addEventListener("pointerleave",this._onPointerCancel),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerCancel),this.domElement.removeEventListener("pointerleave",this._onPointerCancel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="auto",this.domElement.style.cursor=""}dispose(){this.disconnect()}_updatePointer(e){const t=this.domElement.getBoundingClientRect();Ka.x=(e.clientX-t.left)/t.width*2-1,Ka.y=-(e.clientY-t.top)/t.height*2+1}_updateState(e){let t;if(e.pointerType==="touch")t=this.touches.ONE;else switch(e.button){case 0:t=this.mouseButtons.LEFT;break;case 1:t=this.mouseButtons.MIDDLE;break;case 2:t=this.mouseButtons.RIGHT;break;default:t=null}switch(t){case Hi.PAN:case Ja.PAN:this.state=ll.PAN;break;case Hi.ROTATE:case Ja.ROTATE:this.state=ll.ROTATE;break;default:this.state=ll.NONE}}getRaycaster(){return console.warn("THREE.DragControls: getRaycaster() has been deprecated. Use controls.raycaster instead."),this.raycaster}setObjects(e){console.warn("THREE.DragControls: setObjects() has been deprecated. Use controls.objects instead."),this.objects=e}getObjects(){return console.warn("THREE.DragControls: getObjects() has been deprecated. Use controls.objects instead."),this.objects}activate(){console.warn("THREE.DragControls: activate() has been renamed to connect()."),this.connect()}deactivate(){console.warn("THREE.DragControls: deactivate() has been renamed to disconnect()."),this.disconnect()}set mode(e){console.warn("THREE.DragControls: The .mode property has been removed. Define the type of transformation via the .mouseButtons or .touches properties.")}get mode(){console.warn("THREE.DragControls: The .mode property has been removed. Define the type of transformation via the .mouseButtons or .touches properties.")}}function H$(i){const e=this.object,t=this.domElement,n=this.raycaster;if(this.enabled!==!1){if(this._updatePointer(i),n.setFromCamera(Ka,e),Rr)this.state===ll.PAN?n.ray.intersectPlane(eh,$y)&&Rr.position.copy($y.sub(TO).applyMatrix4(MO)):this.state===ll.ROTATE&&(nb.subVectors(Ka,wy).multiplyScalar(this.rotateSpeed),Rr.rotateOnWorldAxis(EO,nb.x),Rr.rotateOnWorldAxis(AO.normalize(),-nb.y)),this.dispatchEvent({type:"drag",object:Rr}),wy.copy(Ka);else if(i.pointerType==="mouse"||i.pointerType==="pen")if(Za.length=0,n.setFromCamera(Ka,e),n.intersectObjects(this.objects,this.recursive,Za),Za.length>0){const r=Za[0].object;eh.setFromNormalAndCoplanarPoint(e.getWorldDirection(eh.normal),YS.setFromMatrixPosition(r.matrixWorld)),Js!==r&&Js!==null&&(this.dispatchEvent({type:"hoveroff",object:Js}),t.style.cursor="auto",Js=null),Js!==r&&(this.dispatchEvent({type:"hoveron",object:r}),t.style.cursor="pointer",Js=r)}else Js!==null&&(this.dispatchEvent({type:"hoveroff",object:Js}),t.style.cursor="auto",Js=null);wy.copy(Ka)}}function W$(i){const e=this.object,t=this.domElement,n=this.raycaster;this.enabled!==!1&&(this._updatePointer(i),this._updateState(i),Za.length=0,n.setFromCamera(Ka,e),n.intersectObjects(this.objects,this.recursive,Za),Za.length>0&&(this.transformGroup===!0?Rr=wO(Za[0].object):Rr=Za[0].object,eh.setFromNormalAndCoplanarPoint(e.getWorldDirection(eh.normal),YS.setFromMatrixPosition(Rr.matrixWorld)),n.ray.intersectPlane(eh,$y)&&(this.state===ll.PAN?(MO.copy(Rr.parent.matrixWorld).invert(),TO.copy($y).sub(YS.setFromMatrixPosition(Rr.matrixWorld))):this.state===ll.ROTATE&&(EO.set(0,1,0).applyQuaternion(e.quaternion).normalize(),AO.set(1,0,0).applyQuaternion(e.quaternion).normalize())),t.style.cursor="move",this.dispatchEvent({type:"dragstart",object:Rr})),wy.copy(Ka))}function j$(){this.enabled!==!1&&(Rr&&(this.dispatchEvent({type:"dragend",object:Rr}),Rr=null),this.domElement.style.cursor=Js?"pointer":"auto",this.state=ll.NONE)}function q$(i){this.enabled!==!1&&i.preventDefault()}function wO(i,e=null){return i.isGroup&&(e=i),i.parent===null?e:wO(i.parent,e)}function $$(i,e,t){var n,r=1;i==null&&(i=0),e==null&&(e=0),t==null&&(t=0);function s(){var a,l=n.length,u,h=0,d=0,p=0;for(a=0;a<l;++a)u=n[a],h+=u.x||0,d+=u.y||0,p+=u.z||0;for(h=(h/l-i)*r,d=(d/l-e)*r,p=(p/l-t)*r,a=0;a<l;++a)u=n[a],h&&(u.x-=h),d&&(u.y-=d),p&&(u.z-=p)}return s.initialize=function(a){n=a},s.x=function(a){return arguments.length?(i=+a,s):i},s.y=function(a){return arguments.length?(e=+a,s):e},s.z=function(a){return arguments.length?(t=+a,s):t},s.strength=function(a){return arguments.length?(r=+a,s):r},s}function X$(i){const e=+this._x.call(null,i);return RO(this.cover(e),e,i)}function RO(i,e,t){if(isNaN(e))return i;var n,r=i._root,s={data:t},a=i._x0,l=i._x1,u,h,d,p,g;if(!r)return i._root=s,i;for(;r.length;)if((d=e>=(u=(a+l)/2))?a=u:l=u,n=r,!(r=r[p=+d]))return n[p]=s,i;if(h=+i._x.call(null,r.data),e===h)return s.next=r,n?n[p]=s:i._root=s,i;do n=n?n[p]=new Array(2):i._root=new Array(2),(d=e>=(u=(a+l)/2))?a=u:l=u;while((p=+d)==(g=+(h>=u)));return n[g]=r,n[p]=s,i}function Y$(i){Array.isArray(i)||(i=Array.from(i));const e=i.length,t=new Float64Array(e);let n=1/0,r=-1/0;for(let s=0,a;s<e;++s)isNaN(a=+this._x.call(null,i[s]))||(t[s]=a,a<n&&(n=a),a>r&&(r=a));if(n>r)return this;this.cover(n).cover(r);for(let s=0;s<e;++s)RO(this,t[s],i[s]);return this}function K$(i){if(isNaN(i=+i))return this;var e=this._x0,t=this._x1;if(isNaN(e))t=(e=Math.floor(i))+1;else{for(var n=t-e||1,r=this._root,s,a;e>i||i>=t;)switch(a=+(i<e),s=new Array(2),s[a]=r,r=s,n*=2,a){case 0:t=e+n;break;case 1:e=t-n;break}this._root&&this._root.length&&(this._root=r)}return this._x0=e,this._x1=t,this}function Z$(){var i=[];return this.visit(function(e){if(!e.length)do i.push(e.data);while(e=e.next)}),i}function Q$(i){return arguments.length?this.cover(+i[0][0]).cover(+i[1][0]):isNaN(this._x0)?void 0:[[this._x0],[this._x1]]}function ao(i,e,t){this.node=i,this.x0=e,this.x1=t}function J$(i,e){var t,n=this._x0,r,s,a=this._x1,l=[],u=this._root,h,d;for(u&&l.push(new ao(u,n,a)),e==null?e=1/0:(n=i-e,a=i+e);h=l.pop();)if(!(!(u=h.node)||(r=h.x0)>a||(s=h.x1)<n))if(u.length){var p=(r+s)/2;l.push(new ao(u[1],p,s),new ao(u[0],r,p)),(d=+(i>=p))&&(h=l[l.length-1],l[l.length-1]=l[l.length-1-d],l[l.length-1-d]=h)}else{var g=Math.abs(i-+this._x.call(null,u.data));g<e&&(e=g,n=i-g,a=i+g,t=u.data)}return t}function eX(i){if(isNaN(u=+this._x.call(null,i)))return this;var e,t=this._root,n,r,s,a=this._x0,l=this._x1,u,h,d,p,g;if(!t)return this;if(t.length)for(;;){if((d=u>=(h=(a+l)/2))?a=h:l=h,e=t,!(t=t[p=+d]))return this;if(!t.length)break;e[p+1&1]&&(n=e,g=p)}for(;t.data!==i;)if(r=t,!(t=t.next))return this;return(s=t.next)&&delete t.next,r?(s?r.next=s:delete r.next,this):e?(s?e[p]=s:delete e[p],(t=e[0]||e[1])&&t===(e[1]||e[0])&&!t.length&&(n?n[g]=t:this._root=t),this):(this._root=s,this)}function tX(i){for(var e=0,t=i.length;e<t;++e)this.remove(i[e]);return this}function nX(){return this._root}function iX(){var i=0;return this.visit(function(e){if(!e.length)do++i;while(e=e.next)}),i}function rX(i){var e=[],t,n=this._root,r,s,a;for(n&&e.push(new ao(n,this._x0,this._x1));t=e.pop();)if(!i(n=t.node,s=t.x0,a=t.x1)&&n.length){var l=(s+a)/2;(r=n[1])&&e.push(new ao(r,l,a)),(r=n[0])&&e.push(new ao(r,s,l))}return this}function sX(i){var e=[],t=[],n;for(this._root&&e.push(new ao(this._root,this._x0,this._x1));n=e.pop();){var r=n.node;if(r.length){var s,a=n.x0,l=n.x1,u=(a+l)/2;(s=r[0])&&e.push(new ao(s,a,u)),(s=r[1])&&e.push(new ao(s,u,l))}t.push(n)}for(;n=t.pop();)i(n.node,n.x0,n.x1);return this}function aX(i){return i[0]}function oX(i){return arguments.length?(this._x=i,this):this._x}function CO(i,e){var t=new sE(e??aX,NaN,NaN);return i==null?t:t.addAll(i)}function sE(i,e,t){this._x=i,this._x0=e,this._x1=t,this._root=void 0}function oP(i){for(var e={data:i.data},t=e;i=i.next;)t=t.next={data:i.data};return e}var Fr=CO.prototype=sE.prototype;Fr.copy=function(){var i=new sE(this._x,this._x0,this._x1),e=this._root,t,n;if(!e)return i;if(!e.length)return i._root=oP(e),i;for(t=[{source:e,target:i._root=new Array(2)}];e=t.pop();)for(var r=0;r<2;++r)(n=e.source[r])&&(n.length?t.push({source:n,target:e.target[r]=new Array(2)}):e.target[r]=oP(n));return i};Fr.add=X$;Fr.addAll=Y$;Fr.cover=K$;Fr.data=Z$;Fr.extent=Q$;Fr.find=J$;Fr.remove=eX;Fr.removeAll=tX;Fr.root=nX;Fr.size=iX;Fr.visit=rX;Fr.visitAfter=sX;Fr.x=oX;function lX(i){const e=+this._x.call(null,i),t=+this._y.call(null,i);return NO(this.cover(e,t),e,t,i)}function NO(i,e,t,n){if(isNaN(e)||isNaN(t))return i;var r,s=i._root,a={data:n},l=i._x0,u=i._y0,h=i._x1,d=i._y1,p,g,y,v,S,b,_,E;if(!s)return i._root=a,i;for(;s.length;)if((S=e>=(p=(l+h)/2))?l=p:h=p,(b=t>=(g=(u+d)/2))?u=g:d=g,r=s,!(s=s[_=b<<1|S]))return r[_]=a,i;if(y=+i._x.call(null,s.data),v=+i._y.call(null,s.data),e===y&&t===v)return a.next=s,r?r[_]=a:i._root=a,i;do r=r?r[_]=new Array(4):i._root=new Array(4),(S=e>=(p=(l+h)/2))?l=p:h=p,(b=t>=(g=(u+d)/2))?u=g:d=g;while((_=b<<1|S)===(E=(v>=g)<<1|y>=p));return r[E]=s,r[_]=a,i}function uX(i){var e,t,n=i.length,r,s,a=new Array(n),l=new Array(n),u=1/0,h=1/0,d=-1/0,p=-1/0;for(t=0;t<n;++t)isNaN(r=+this._x.call(null,e=i[t]))||isNaN(s=+this._y.call(null,e))||(a[t]=r,l[t]=s,r<u&&(u=r),r>d&&(d=r),s<h&&(h=s),s>p&&(p=s));if(u>d||h>p)return this;for(this.cover(u,h).cover(d,p),t=0;t<n;++t)NO(this,a[t],l[t],i[t]);return this}function cX(i,e){if(isNaN(i=+i)||isNaN(e=+e))return this;var t=this._x0,n=this._y0,r=this._x1,s=this._y1;if(isNaN(t))r=(t=Math.floor(i))+1,s=(n=Math.floor(e))+1;else{for(var a=r-t||1,l=this._root,u,h;t>i||i>=r||n>e||e>=s;)switch(h=(e<n)<<1|i<t,u=new Array(4),u[h]=l,l=u,a*=2,h){case 0:r=t+a,s=n+a;break;case 1:t=r-a,s=n+a;break;case 2:r=t+a,n=s-a;break;case 3:t=r-a,n=s-a;break}this._root&&this._root.length&&(this._root=l)}return this._x0=t,this._y0=n,this._x1=r,this._y1=s,this}function hX(){var i=[];return this.visit(function(e){if(!e.length)do i.push(e.data);while(e=e.next)}),i}function fX(i){return arguments.length?this.cover(+i[0][0],+i[0][1]).cover(+i[1][0],+i[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function gr(i,e,t,n,r){this.node=i,this.x0=e,this.y0=t,this.x1=n,this.y1=r}function dX(i,e,t){var n,r=this._x0,s=this._y0,a,l,u,h,d=this._x1,p=this._y1,g=[],y=this._root,v,S;for(y&&g.push(new gr(y,r,s,d,p)),t==null?t=1/0:(r=i-t,s=e-t,d=i+t,p=e+t,t*=t);v=g.pop();)if(!(!(y=v.node)||(a=v.x0)>d||(l=v.y0)>p||(u=v.x1)<r||(h=v.y1)<s))if(y.length){var b=(a+u)/2,_=(l+h)/2;g.push(new gr(y[3],b,_,u,h),new gr(y[2],a,_,b,h),new gr(y[1],b,l,u,_),new gr(y[0],a,l,b,_)),(S=(e>=_)<<1|i>=b)&&(v=g[g.length-1],g[g.length-1]=g[g.length-1-S],g[g.length-1-S]=v)}else{var E=i-+this._x.call(null,y.data),M=e-+this._y.call(null,y.data),A=E*E+M*M;if(A<t){var w=Math.sqrt(t=A);r=i-w,s=e-w,d=i+w,p=e+w,n=y.data}}return n}function pX(i){if(isNaN(d=+this._x.call(null,i))||isNaN(p=+this._y.call(null,i)))return this;var e,t=this._root,n,r,s,a=this._x0,l=this._y0,u=this._x1,h=this._y1,d,p,g,y,v,S,b,_;if(!t)return this;if(t.length)for(;;){if((v=d>=(g=(a+u)/2))?a=g:u=g,(S=p>=(y=(l+h)/2))?l=y:h=y,e=t,!(t=t[b=S<<1|v]))return this;if(!t.length)break;(e[b+1&3]||e[b+2&3]||e[b+3&3])&&(n=e,_=b)}for(;t.data!==i;)if(r=t,!(t=t.next))return this;return(s=t.next)&&delete t.next,r?(s?r.next=s:delete r.next,this):e?(s?e[b]=s:delete e[b],(t=e[0]||e[1]||e[2]||e[3])&&t===(e[3]||e[2]||e[1]||e[0])&&!t.length&&(n?n[_]=t:this._root=t),this):(this._root=s,this)}function mX(i){for(var e=0,t=i.length;e<t;++e)this.remove(i[e]);return this}function gX(){return this._root}function yX(){var i=0;return this.visit(function(e){if(!e.length)do++i;while(e=e.next)}),i}function vX(i){var e=[],t,n=this._root,r,s,a,l,u;for(n&&e.push(new gr(n,this._x0,this._y0,this._x1,this._y1));t=e.pop();)if(!i(n=t.node,s=t.x0,a=t.y0,l=t.x1,u=t.y1)&&n.length){var h=(s+l)/2,d=(a+u)/2;(r=n[3])&&e.push(new gr(r,h,d,l,u)),(r=n[2])&&e.push(new gr(r,s,d,h,u)),(r=n[1])&&e.push(new gr(r,h,a,l,d)),(r=n[0])&&e.push(new gr(r,s,a,h,d))}return this}function _X(i){var e=[],t=[],n;for(this._root&&e.push(new gr(this._root,this._x0,this._y0,this._x1,this._y1));n=e.pop();){var r=n.node;if(r.length){var s,a=n.x0,l=n.y0,u=n.x1,h=n.y1,d=(a+u)/2,p=(l+h)/2;(s=r[0])&&e.push(new gr(s,a,l,d,p)),(s=r[1])&&e.push(new gr(s,d,l,u,p)),(s=r[2])&&e.push(new gr(s,a,p,d,h)),(s=r[3])&&e.push(new gr(s,d,p,u,h))}t.push(n)}for(;n=t.pop();)i(n.node,n.x0,n.y0,n.x1,n.y1);return this}function xX(i){return i[0]}function bX(i){return arguments.length?(this._x=i,this):this._x}function SX(i){return i[1]}function TX(i){return arguments.length?(this._y=i,this):this._y}function PO(i,e,t){var n=new aE(e??xX,t??SX,NaN,NaN,NaN,NaN);return i==null?n:n.addAll(i)}function aE(i,e,t,n,r,s){this._x=i,this._y=e,this._x0=t,this._y0=n,this._x1=r,this._y1=s,this._root=void 0}function lP(i){for(var e={data:i.data},t=e;i=i.next;)t=t.next={data:i.data};return e}var br=PO.prototype=aE.prototype;br.copy=function(){var i=new aE(this._x,this._y,this._x0,this._y0,this._x1,this._y1),e=this._root,t,n;if(!e)return i;if(!e.length)return i._root=lP(e),i;for(t=[{source:e,target:i._root=new Array(4)}];e=t.pop();)for(var r=0;r<4;++r)(n=e.source[r])&&(n.length?t.push({source:n,target:e.target[r]=new Array(4)}):e.target[r]=lP(n));return i};br.add=lX;br.addAll=uX;br.cover=cX;br.data=hX;br.extent=fX;br.find=dX;br.remove=pX;br.removeAll=mX;br.root=gX;br.size=yX;br.visit=vX;br.visitAfter=_X;br.x=bX;br.y=TX;function MX(i){const e=+this._x.call(null,i),t=+this._y.call(null,i),n=+this._z.call(null,i);return DO(this.cover(e,t,n),e,t,n,i)}function DO(i,e,t,n,r){if(isNaN(e)||isNaN(t)||isNaN(n))return i;var s,a=i._root,l={data:r},u=i._x0,h=i._y0,d=i._z0,p=i._x1,g=i._y1,y=i._z1,v,S,b,_,E,M,A,w,R,C,L;if(!a)return i._root=l,i;for(;a.length;)if((A=e>=(v=(u+p)/2))?u=v:p=v,(w=t>=(S=(h+g)/2))?h=S:g=S,(R=n>=(b=(d+y)/2))?d=b:y=b,s=a,!(a=a[C=R<<2|w<<1|A]))return s[C]=l,i;if(_=+i._x.call(null,a.data),E=+i._y.call(null,a.data),M=+i._z.call(null,a.data),e===_&&t===E&&n===M)return l.next=a,s?s[C]=l:i._root=l,i;do s=s?s[C]=new Array(8):i._root=new Array(8),(A=e>=(v=(u+p)/2))?u=v:p=v,(w=t>=(S=(h+g)/2))?h=S:g=S,(R=n>=(b=(d+y)/2))?d=b:y=b;while((C=R<<2|w<<1|A)===(L=(M>=b)<<2|(E>=S)<<1|_>=v));return s[L]=a,s[C]=l,i}function EX(i){Array.isArray(i)||(i=Array.from(i));const e=i.length,t=new Float64Array(e),n=new Float64Array(e),r=new Float64Array(e);let s=1/0,a=1/0,l=1/0,u=-1/0,h=-1/0,d=-1/0;for(let p=0,g,y,v,S;p<e;++p)isNaN(y=+this._x.call(null,g=i[p]))||isNaN(v=+this._y.call(null,g))||isNaN(S=+this._z.call(null,g))||(t[p]=y,n[p]=v,r[p]=S,y<s&&(s=y),y>u&&(u=y),v<a&&(a=v),v>h&&(h=v),S<l&&(l=S),S>d&&(d=S));if(s>u||a>h||l>d)return this;this.cover(s,a,l).cover(u,h,d);for(let p=0;p<e;++p)DO(this,t[p],n[p],r[p],i[p]);return this}function AX(i,e,t){if(isNaN(i=+i)||isNaN(e=+e)||isNaN(t=+t))return this;var n=this._x0,r=this._y0,s=this._z0,a=this._x1,l=this._y1,u=this._z1;if(isNaN(n))a=(n=Math.floor(i))+1,l=(r=Math.floor(e))+1,u=(s=Math.floor(t))+1;else{for(var h=a-n||1,d=this._root,p,g;n>i||i>=a||r>e||e>=l||s>t||t>=u;)switch(g=(t<s)<<2|(e<r)<<1|i<n,p=new Array(8),p[g]=d,d=p,h*=2,g){case 0:a=n+h,l=r+h,u=s+h;break;case 1:n=a-h,l=r+h,u=s+h;break;case 2:a=n+h,r=l-h,u=s+h;break;case 3:n=a-h,r=l-h,u=s+h;break;case 4:a=n+h,l=r+h,s=u-h;break;case 5:n=a-h,l=r+h,s=u-h;break;case 6:a=n+h,r=l-h,s=u-h;break;case 7:n=a-h,r=l-h,s=u-h;break}this._root&&this._root.length&&(this._root=d)}return this._x0=n,this._y0=r,this._z0=s,this._x1=a,this._y1=l,this._z1=u,this}function wX(){var i=[];return this.visit(function(e){if(!e.length)do i.push(e.data);while(e=e.next)}),i}function RX(i){return arguments.length?this.cover(+i[0][0],+i[0][1],+i[0][2]).cover(+i[1][0],+i[1][1],+i[1][2]):isNaN(this._x0)?void 0:[[this._x0,this._y0,this._z0],[this._x1,this._y1,this._z1]]}function Tn(i,e,t,n,r,s,a){this.node=i,this.x0=e,this.y0=t,this.z0=n,this.x1=r,this.y1=s,this.z1=a}function CX(i,e,t,n){var r,s=this._x0,a=this._y0,l=this._z0,u,h,d,p,g,y,v=this._x1,S=this._y1,b=this._z1,_=[],E=this._root,M,A;for(E&&_.push(new Tn(E,s,a,l,v,S,b)),n==null?n=1/0:(s=i-n,a=e-n,l=t-n,v=i+n,S=e+n,b=t+n,n*=n);M=_.pop();)if(!(!(E=M.node)||(u=M.x0)>v||(h=M.y0)>S||(d=M.z0)>b||(p=M.x1)<s||(g=M.y1)<a||(y=M.z1)<l))if(E.length){var w=(u+p)/2,R=(h+g)/2,C=(d+y)/2;_.push(new Tn(E[7],w,R,C,p,g,y),new Tn(E[6],u,R,C,w,g,y),new Tn(E[5],w,h,C,p,R,y),new Tn(E[4],u,h,C,w,R,y),new Tn(E[3],w,R,d,p,g,C),new Tn(E[2],u,R,d,w,g,C),new Tn(E[1],w,h,d,p,R,C),new Tn(E[0],u,h,d,w,R,C)),(A=(t>=C)<<2|(e>=R)<<1|i>=w)&&(M=_[_.length-1],_[_.length-1]=_[_.length-1-A],_[_.length-1-A]=M)}else{var L=i-+this._x.call(null,E.data),N=e-+this._y.call(null,E.data),D=t-+this._z.call(null,E.data),I=L*L+N*N+D*D;if(I<n){var W=Math.sqrt(n=I);s=i-W,a=e-W,l=t-W,v=i+W,S=e+W,b=t+W,r=E.data}}return r}const NX=(i,e,t,n,r,s)=>Math.sqrt((i-n)**2+(e-r)**2+(t-s)**2);function PX(i,e,t,n){const r=[],s=i-n,a=e-n,l=t-n,u=i+n,h=e+n,d=t+n;return this.visit((p,g,y,v,S,b,_)=>{if(!p.length)do{const E=p.data;NX(i,e,t,this._x(E),this._y(E),this._z(E))<=n&&r.push(E)}while(p=p.next);return g>u||y>h||v>d||S<s||b<a||_<l}),r}function DX(i){if(isNaN(g=+this._x.call(null,i))||isNaN(y=+this._y.call(null,i))||isNaN(v=+this._z.call(null,i)))return this;var e,t=this._root,n,r,s,a=this._x0,l=this._y0,u=this._z0,h=this._x1,d=this._y1,p=this._z1,g,y,v,S,b,_,E,M,A,w,R;if(!t)return this;if(t.length)for(;;){if((E=g>=(S=(a+h)/2))?a=S:h=S,(M=y>=(b=(l+d)/2))?l=b:d=b,(A=v>=(_=(u+p)/2))?u=_:p=_,e=t,!(t=t[w=A<<2|M<<1|E]))return this;if(!t.length)break;(e[w+1&7]||e[w+2&7]||e[w+3&7]||e[w+4&7]||e[w+5&7]||e[w+6&7]||e[w+7&7])&&(n=e,R=w)}for(;t.data!==i;)if(r=t,!(t=t.next))return this;return(s=t.next)&&delete t.next,r?(s?r.next=s:delete r.next,this):e?(s?e[w]=s:delete e[w],(t=e[0]||e[1]||e[2]||e[3]||e[4]||e[5]||e[6]||e[7])&&t===(e[7]||e[6]||e[5]||e[4]||e[3]||e[2]||e[1]||e[0])&&!t.length&&(n?n[R]=t:this._root=t),this):(this._root=s,this)}function LX(i){for(var e=0,t=i.length;e<t;++e)this.remove(i[e]);return this}function UX(){return this._root}function OX(){var i=0;return this.visit(function(e){if(!e.length)do++i;while(e=e.next)}),i}function BX(i){var e=[],t,n=this._root,r,s,a,l,u,h,d;for(n&&e.push(new Tn(n,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));t=e.pop();)if(!i(n=t.node,s=t.x0,a=t.y0,l=t.z0,u=t.x1,h=t.y1,d=t.z1)&&n.length){var p=(s+u)/2,g=(a+h)/2,y=(l+d)/2;(r=n[7])&&e.push(new Tn(r,p,g,y,u,h,d)),(r=n[6])&&e.push(new Tn(r,s,g,y,p,h,d)),(r=n[5])&&e.push(new Tn(r,p,a,y,u,g,d)),(r=n[4])&&e.push(new Tn(r,s,a,y,p,g,d)),(r=n[3])&&e.push(new Tn(r,p,g,l,u,h,y)),(r=n[2])&&e.push(new Tn(r,s,g,l,p,h,y)),(r=n[1])&&e.push(new Tn(r,p,a,l,u,g,y)),(r=n[0])&&e.push(new Tn(r,s,a,l,p,g,y))}return this}function IX(i){var e=[],t=[],n;for(this._root&&e.push(new Tn(this._root,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));n=e.pop();){var r=n.node;if(r.length){var s,a=n.x0,l=n.y0,u=n.z0,h=n.x1,d=n.y1,p=n.z1,g=(a+h)/2,y=(l+d)/2,v=(u+p)/2;(s=r[0])&&e.push(new Tn(s,a,l,u,g,y,v)),(s=r[1])&&e.push(new Tn(s,g,l,u,h,y,v)),(s=r[2])&&e.push(new Tn(s,a,y,u,g,d,v)),(s=r[3])&&e.push(new Tn(s,g,y,u,h,d,v)),(s=r[4])&&e.push(new Tn(s,a,l,v,g,y,p)),(s=r[5])&&e.push(new Tn(s,g,l,v,h,y,p)),(s=r[6])&&e.push(new Tn(s,a,y,v,g,d,p)),(s=r[7])&&e.push(new Tn(s,g,y,v,h,d,p))}t.push(n)}for(;n=t.pop();)i(n.node,n.x0,n.y0,n.z0,n.x1,n.y1,n.z1);return this}function FX(i){return i[0]}function kX(i){return arguments.length?(this._x=i,this):this._x}function zX(i){return i[1]}function VX(i){return arguments.length?(this._y=i,this):this._y}function GX(i){return i[2]}function HX(i){return arguments.length?(this._z=i,this):this._z}function LO(i,e,t,n){var r=new oE(e??FX,t??zX,n??GX,NaN,NaN,NaN,NaN,NaN,NaN);return i==null?r:r.addAll(i)}function oE(i,e,t,n,r,s,a,l,u){this._x=i,this._y=e,this._z=t,this._x0=n,this._y0=r,this._z0=s,this._x1=a,this._y1=l,this._z1=u,this._root=void 0}function uP(i){for(var e={data:i.data},t=e;i=i.next;)t=t.next={data:i.data};return e}var ji=LO.prototype=oE.prototype;ji.copy=function(){var i=new oE(this._x,this._y,this._z,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1),e=this._root,t,n;if(!e)return i;if(!e.length)return i._root=uP(e),i;for(t=[{source:e,target:i._root=new Array(8)}];e=t.pop();)for(var r=0;r<8;++r)(n=e.source[r])&&(n.length?t.push({source:n,target:e.target[r]=new Array(8)}):e.target[r]=uP(n));return i};ji.add=MX;ji.addAll=EX;ji.cover=AX;ji.data=wX;ji.extent=RX;ji.find=CX;ji.findAllWithinRadius=PX;ji.remove=DX;ji.removeAll=LX;ji.root=UX;ji.size=OX;ji.visit=BX;ji.visitAfter=IX;ji.x=kX;ji.y=VX;ji.z=HX;function no(i){return function(){return i}}function $a(i){return(i()-.5)*1e-6}function WX(i){return i.index}function cP(i,e){var t=i.get(e);if(!t)throw new Error("node not found: "+e);return t}function jX(i){var e=WX,t=g,n,r=no(30),s,a,l,u,h,d,p=1;i==null&&(i=[]);function g(_){return 1/Math.min(u[_.source.index],u[_.target.index])}function y(_){for(var E=0,M=i.length;E<p;++E)for(var A=0,w,R,C,L=0,N=0,D=0,I,W;A<M;++A)w=i[A],R=w.source,C=w.target,L=C.x+C.vx-R.x-R.vx||$a(d),l>1&&(N=C.y+C.vy-R.y-R.vy||$a(d)),l>2&&(D=C.z+C.vz-R.z-R.vz||$a(d)),I=Math.sqrt(L*L+N*N+D*D),I=(I-s[A])/I*_*n[A],L*=I,N*=I,D*=I,C.vx-=L*(W=h[A]),l>1&&(C.vy-=N*W),l>2&&(C.vz-=D*W),R.vx+=L*(W=1-W),l>1&&(R.vy+=N*W),l>2&&(R.vz+=D*W)}function v(){if(a){var _,E=a.length,M=i.length,A=new Map(a.map((R,C)=>[e(R,C,a),R])),w;for(_=0,u=new Array(E);_<M;++_)w=i[_],w.index=_,typeof w.source!="object"&&(w.source=cP(A,w.source)),typeof w.target!="object"&&(w.target=cP(A,w.target)),u[w.source.index]=(u[w.source.index]||0)+1,u[w.target.index]=(u[w.target.index]||0)+1;for(_=0,h=new Array(M);_<M;++_)w=i[_],h[_]=u[w.source.index]/(u[w.source.index]+u[w.target.index]);n=new Array(M),S(),s=new Array(M),b()}}function S(){if(a)for(var _=0,E=i.length;_<E;++_)n[_]=+t(i[_],_,i)}function b(){if(a)for(var _=0,E=i.length;_<E;++_)s[_]=+r(i[_],_,i)}return y.initialize=function(_,...E){a=_,d=E.find(M=>typeof M=="function")||Math.random,l=E.find(M=>[1,2,3].includes(M))||2,v()},y.links=function(_){return arguments.length?(i=_,v(),y):i},y.id=function(_){return arguments.length?(e=_,y):e},y.iterations=function(_){return arguments.length?(p=+_,y):p},y.strength=function(_){return arguments.length?(t=typeof _=="function"?_:no(+_),S(),y):t},y.distance=function(_){return arguments.length?(r=typeof _=="function"?_:no(+_),b(),y):r},y}var qX={value:()=>{}};function UO(){for(var i=0,e=arguments.length,t={},n;i<e;++i){if(!(n=arguments[i]+"")||n in t||/[\s.]/.test(n))throw new Error("illegal type: "+n);t[n]=[]}return new Ry(t)}function Ry(i){this._=i}function $X(i,e){return i.trim().split(/^|\s+/).map(function(t){var n="",r=t.indexOf(".");if(r>=0&&(n=t.slice(r+1),t=t.slice(0,r)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:n}})}Ry.prototype=UO.prototype={constructor:Ry,on:function(i,e){var t=this._,n=$X(i+"",t),r,s=-1,a=n.length;if(arguments.length<2){for(;++s<a;)if((r=(i=n[s]).type)&&(r=XX(t[r],i.name)))return r;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++s<a;)if(r=(i=n[s]).type)t[r]=hP(t[r],i.name,e);else if(e==null)for(r in t)t[r]=hP(t[r],i.name,null);return this},copy:function(){var i={},e=this._;for(var t in e)i[t]=e[t].slice();return new Ry(i)},call:function(i,e){if((r=arguments.length-2)>0)for(var t=new Array(r),n=0,r,s;n<r;++n)t[n]=arguments[n+2];if(!this._.hasOwnProperty(i))throw new Error("unknown type: "+i);for(s=this._[i],n=0,r=s.length;n<r;++n)s[n].value.apply(e,t)},apply:function(i,e,t){if(!this._.hasOwnProperty(i))throw new Error("unknown type: "+i);for(var n=this._[i],r=0,s=n.length;r<s;++r)n[r].value.apply(e,t)}};function XX(i,e){for(var t=0,n=i.length,r;t<n;++t)if((r=i[t]).name===e)return r.value}function hP(i,e,t){for(var n=0,r=i.length;n<r;++n)if(i[n].name===e){i[n]=qX,i=i.slice(0,n).concat(i.slice(n+1));break}return t!=null&&i.push({name:e,value:t}),i}var Ph=0,wd=0,sd=0,OO=1e3,Xy,Rd,Yy=0,Au=0,Nv=0,Ep=typeof performance=="object"&&performance.now?performance:Date,BO=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(i){setTimeout(i,17)};function IO(){return Au||(BO(YX),Au=Ep.now()+Nv)}function YX(){Au=0}function KS(){this._call=this._time=this._next=null}KS.prototype=FO.prototype={constructor:KS,restart:function(i,e,t){if(typeof i!="function")throw new TypeError("callback is not a function");t=(t==null?IO():+t)+(e==null?0:+e),!this._next&&Rd!==this&&(Rd?Rd._next=this:Xy=this,Rd=this),this._call=i,this._time=t,ZS()},stop:function(){this._call&&(this._call=null,this._time=1/0,ZS())}};function FO(i,e,t){var n=new KS;return n.restart(i,e,t),n}function KX(){IO(),++Ph;for(var i=Xy,e;i;)(e=Au-i._time)>=0&&i._call.call(void 0,e),i=i._next;--Ph}function fP(){Au=(Yy=Ep.now())+Nv,Ph=wd=0;try{KX()}finally{Ph=0,QX(),Au=0}}function ZX(){var i=Ep.now(),e=i-Yy;e>OO&&(Nv-=e,Yy=i)}function QX(){for(var i,e=Xy,t,n=1/0;e;)e._call?(n>e._time&&(n=e._time),i=e,e=e._next):(t=e._next,e._next=null,e=i?i._next=t:Xy=t);Rd=i,ZS(n)}function ZS(i){if(!Ph){wd&&(wd=clearTimeout(wd));var e=i-Au;e>24?(i<1/0&&(wd=setTimeout(fP,i-Ep.now()-Nv)),sd&&(sd=clearInterval(sd))):(sd||(Yy=Ep.now(),sd=setInterval(ZX,OO)),Ph=1,BO(fP))}}const JX=1664525,e7=1013904223,dP=4294967296;function t7(){let i=1;return()=>(i=(JX*i+e7)%dP)/dP}var pP=3;function ib(i){return i.x}function mP(i){return i.y}function n7(i){return i.z}var i7=10,r7=Math.PI*(3-Math.sqrt(5)),s7=Math.PI*20/(9+Math.sqrt(221));function a7(i,e){e=e||2;var t=Math.min(pP,Math.max(1,Math.round(e))),n,r=1,s=.001,a=1-Math.pow(s,1/300),l=0,u=.6,h=new Map,d=FO(y),p=UO("tick","end"),g=t7();i==null&&(i=[]);function y(){v(),p.call("tick",n),r<s&&(d.stop(),p.call("end",n))}function v(_){var E,M=i.length,A;_===void 0&&(_=1);for(var w=0;w<_;++w)for(r+=(l-r)*a,h.forEach(function(R){R(r)}),E=0;E<M;++E)A=i[E],A.fx==null?A.x+=A.vx*=u:(A.x=A.fx,A.vx=0),t>1&&(A.fy==null?A.y+=A.vy*=u:(A.y=A.fy,A.vy=0)),t>2&&(A.fz==null?A.z+=A.vz*=u:(A.z=A.fz,A.vz=0));return n}function S(){for(var _=0,E=i.length,M;_<E;++_){if(M=i[_],M.index=_,M.fx!=null&&(M.x=M.fx),M.fy!=null&&(M.y=M.fy),M.fz!=null&&(M.z=M.fz),isNaN(M.x)||t>1&&isNaN(M.y)||t>2&&isNaN(M.z)){var A=i7*(t>2?Math.cbrt(.5+_):t>1?Math.sqrt(.5+_):_),w=_*r7,R=_*s7;t===1?M.x=A:t===2?(M.x=A*Math.cos(w),M.y=A*Math.sin(w)):(M.x=A*Math.sin(w)*Math.cos(R),M.y=A*Math.cos(w),M.z=A*Math.sin(w)*Math.sin(R))}(isNaN(M.vx)||t>1&&isNaN(M.vy)||t>2&&isNaN(M.vz))&&(M.vx=0,t>1&&(M.vy=0),t>2&&(M.vz=0))}}function b(_){return _.initialize&&_.initialize(i,g,t),_}return S(),n={tick:v,restart:function(){return d.restart(y),n},stop:function(){return d.stop(),n},numDimensions:function(_){return arguments.length?(t=Math.min(pP,Math.max(1,Math.round(_))),h.forEach(b),n):t},nodes:function(_){return arguments.length?(i=_,S(),h.forEach(b),n):i},alpha:function(_){return arguments.length?(r=+_,n):r},alphaMin:function(_){return arguments.length?(s=+_,n):s},alphaDecay:function(_){return arguments.length?(a=+_,n):+a},alphaTarget:function(_){return arguments.length?(l=+_,n):l},velocityDecay:function(_){return arguments.length?(u=1-_,n):1-u},randomSource:function(_){return arguments.length?(g=_,h.forEach(b),n):g},force:function(_,E){return arguments.length>1?(E==null?h.delete(_):h.set(_,b(E)),n):h.get(_)},find:function(){var _=Array.prototype.slice.call(arguments),E=_.shift()||0,M=(t>1?_.shift():null)||0,A=(t>2?_.shift():null)||0,w=_.shift()||1/0,R=0,C=i.length,L,N,D,I,W,Y;for(w*=w,R=0;R<C;++R)W=i[R],L=E-W.x,N=M-(W.y||0),D=A-(W.z||0),I=L*L+N*N+D*D,I<w&&(Y=W,w=I);return Y},on:function(_,E){return arguments.length>1?(p.on(_,E),n):p.on(_)}}}function o7(){var i,e,t,n,r,s=no(-30),a,l=1,u=1/0,h=.81;function d(v){var S,b=i.length,_=(e===1?CO(i,ib):e===2?PO(i,ib,mP):e===3?LO(i,ib,mP,n7):null).visitAfter(g);for(r=v,S=0;S<b;++S)t=i[S],_.visit(y)}function p(){if(i){var v,S=i.length,b;for(a=new Array(S),v=0;v<S;++v)b=i[v],a[b.index]=+s(b,v,i)}}function g(v){var S=0,b,_,E=0,M,A,w,R,C=v.length;if(C){for(M=A=w=R=0;R<C;++R)(b=v[R])&&(_=Math.abs(b.value))&&(S+=b.value,E+=_,M+=_*(b.x||0),A+=_*(b.y||0),w+=_*(b.z||0));S*=Math.sqrt(4/C),v.x=M/E,e>1&&(v.y=A/E),e>2&&(v.z=w/E)}else{b=v,b.x=b.data.x,e>1&&(b.y=b.data.y),e>2&&(b.z=b.data.z);do S+=a[b.data.index];while(b=b.next)}v.value=S}function y(v,S,b,_,E){if(!v.value)return!0;var M=[b,_,E][e-1],A=v.x-t.x,w=e>1?v.y-t.y:0,R=e>2?v.z-t.z:0,C=M-S,L=A*A+w*w+R*R;if(C*C/h<L)return L<u&&(A===0&&(A=$a(n),L+=A*A),e>1&&w===0&&(w=$a(n),L+=w*w),e>2&&R===0&&(R=$a(n),L+=R*R),L<l&&(L=Math.sqrt(l*L)),t.vx+=A*v.value*r/L,e>1&&(t.vy+=w*v.value*r/L),e>2&&(t.vz+=R*v.value*r/L)),!0;if(v.length||L>=u)return;(v.data!==t||v.next)&&(A===0&&(A=$a(n),L+=A*A),e>1&&w===0&&(w=$a(n),L+=w*w),e>2&&R===0&&(R=$a(n),L+=R*R),L<l&&(L=Math.sqrt(l*L)));do v.data!==t&&(C=a[v.data.index]*r/L,t.vx+=A*C,e>1&&(t.vy+=w*C),e>2&&(t.vz+=R*C));while(v=v.next)}return d.initialize=function(v,...S){i=v,n=S.find(b=>typeof b=="function")||Math.random,e=S.find(b=>[1,2,3].includes(b))||2,p()},d.strength=function(v){return arguments.length?(s=typeof v=="function"?v:no(+v),p(),d):s},d.distanceMin=function(v){return arguments.length?(l=v*v,d):Math.sqrt(l)},d.distanceMax=function(v){return arguments.length?(u=v*v,d):Math.sqrt(u)},d.theta=function(v){return arguments.length?(h=v*v,d):Math.sqrt(h)},d}function l7(i,e,t,n){var r,s,a=no(.1),l,u;typeof i!="function"&&(i=no(+i)),e==null&&(e=0),t==null&&(t=0),n==null&&(n=0);function h(p){for(var g=0,y=r.length;g<y;++g){var v=r[g],S=v.x-e||1e-6,b=(v.y||0)-t||1e-6,_=(v.z||0)-n||1e-6,E=Math.sqrt(S*S+b*b+_*_),M=(u[g]-E)*l[g]*p/E;v.vx+=S*M,s>1&&(v.vy+=b*M),s>2&&(v.vz+=_*M)}}function d(){if(r){var p,g=r.length;for(l=new Array(g),u=new Array(g),p=0;p<g;++p)u[p]=+i(r[p],p,r),l[p]=isNaN(u[p])?0:+a(r[p],p,r)}}return h.initialize=function(p,...g){r=p,s=g.find(y=>[1,2,3].includes(y))||2,d()},h.strength=function(p){return arguments.length?(a=typeof p=="function"?p:no(+p),d(),h):a},h.radius=function(p){return arguments.length?(i=typeof p=="function"?p:no(+p),d(),h):i},h.x=function(p){return arguments.length?(e=+p,h):e},h.y=function(p){return arguments.length?(t=+p,h):t},h.z=function(p){return arguments.length?(n=+p,h):n},h}var rb,gP;function lE(){if(gP)return rb;gP=1,rb=function(n){e(n);var r=i(n);return n.on=r.on,n.off=r.off,n.fire=r.fire,n};function i(t){var n=Object.create(null);return{on:function(r,s,a){if(typeof s!="function")throw new Error("callback is expected to be a function");var l=n[r];return l||(l=n[r]=[]),l.push({callback:s,ctx:a}),t},off:function(r,s){var a=typeof r>"u";if(a)return n=Object.create(null),t;if(n[r]){var l=typeof s!="function";if(l)delete n[r];else for(var u=n[r],h=0;h<u.length;++h)u[h].callback===s&&u.splice(h,1)}return t},fire:function(r){var s=n[r];if(!s)return t;var a;arguments.length>1&&(a=Array.prototype.splice.call(arguments,1));for(var l=0;l<s.length;++l){var u=s[l];u.callback.apply(u.ctx,a)}return t}}}function e(t){if(!t)throw new Error("Eventify cannot use falsy object as events subject");for(var n=["on","fire","off"],r=0;r<n.length;++r)if(t.hasOwnProperty(n[r]))throw new Error("Subject cannot be eventified, since it already has property '"+n[r]+"'")}return rb}var sb,yP;function u7(){if(yP)return sb;yP=1,sb=e;var i=lE();function e(a){if(a=a||{},"uniqueLinkId"in a&&(console.warn("ngraph.graph: Starting from version 0.14 `uniqueLinkId` is deprecated.\nUse `multigraph` option instead\n",`
`,`Note: there is also change in default behavior: From now on each graph
is considered to be not a multigraph by default (each edge is unique).`),a.multigraph=a.uniqueLinkId),a.multigraph===void 0&&(a.multigraph=!1),typeof Map!="function")throw new Error("ngraph.graph requires `Map` to be defined. Please polyfill it before using ngraph");var l=new Map,u=new Map,h={},d=0,p=a.multigraph?D:N,g=[],y=Me,v=Me,S=Me,b=Me,_={version:20,addNode:w,addLink:L,removeLink:oe,removeNode:C,getNode:R,getNodeCount:I,getLinkCount:W,getEdgeCount:W,getLinksCount:W,getNodesCount:I,getLinks:Y,forEachNode:Z,forEachLinkedNode:he,forEachLink:G,beginUpdate:S,endUpdate:b,clear:k,hasLink:z,hasNode:R,getLink:z};return i(_),E(),_;function E(){var $=_.on;_.on=ne;function ne(){return _.beginUpdate=S=De,_.endUpdate=b=j,y=M,v=A,_.on=$,$.apply(_,arguments)}}function M($,ne){g.push({link:$,changeType:ne})}function A($,ne){g.push({node:$,changeType:ne})}function w($,ne){if($===void 0)throw new Error("Invalid node identifier");S();var ve=R($);return ve?(ve.data=ne,v(ve,"update")):(ve=new t($,ne),v(ve,"add")),l.set($,ve),b(),ve}function R($){return l.get($)}function C($){var ne=R($);if(!ne)return!1;S();var ve=ne.links;return ve&&(ve.forEach(le),ne.links=null),l.delete($),v(ne,"remove"),b(),!0}function L($,ne,ve){S();var He=R($)||w($),Ve=R(ne)||w(ne),st=p($,ne,ve),Lt=u.has(st.id);return u.set(st.id,st),n(He,st),$!==ne&&n(Ve,st),y(st,Lt?"update":"add"),b(),st}function N($,ne,ve){var He=s($,ne),Ve=u.get(He);return Ve?(Ve.data=ve,Ve):new r($,ne,ve,He)}function D($,ne,ve){var He=s($,ne),Ve=h.hasOwnProperty(He);if(Ve||z($,ne)){Ve||(h[He]=0);var st="@"+ ++h[He];He=s($+st,ne+st)}return new r($,ne,ve,He)}function I(){return l.size}function W(){return u.size}function Y($){var ne=R($);return ne?ne.links:null}function oe($,ne){return ne!==void 0&&($=z($,ne)),le($)}function le($){if(!$||!u.get($.id))return!1;S(),u.delete($.id);var ne=R($.fromId),ve=R($.toId);return ne&&ne.links.delete($),ve&&ve.links.delete($),y($,"remove"),b(),!0}function z($,ne){if(!($===void 0||ne===void 0))return u.get(s($,ne))}function k(){S(),Z(function($){C($.id)}),b()}function G($){if(typeof $=="function")for(var ne=u.values(),ve=ne.next();!ve.done;){if($(ve.value))return!0;ve=ne.next()}}function he($,ne,ve){var He=R($);if(He&&He.links&&typeof ne=="function")return ve?se(He.links,$,ne):F(He.links,$,ne)}function F($,ne,ve){for(var He,Ve=$.values(),st=Ve.next();!st.done;){var Lt=st.value,Rt=Lt.fromId===ne?Lt.toId:Lt.fromId;if(He=ve(l.get(Rt),Lt),He)return!0;st=Ve.next()}}function se($,ne,ve){for(var He,Ve=$.values(),st=Ve.next();!st.done;){var Lt=st.value;if(Lt.fromId===ne&&(He=ve(l.get(Lt.toId),Lt),He))return!0;st=Ve.next()}}function Me(){}function De(){d+=1}function j(){d-=1,d===0&&g.length>0&&(_.fire("changed",g),g.length=0)}function Z($){if(typeof $!="function")throw new Error("Function is expected to iterate over graph nodes. You passed "+$);for(var ne=l.values(),ve=ne.next();!ve.done;){if($(ve.value))return!0;ve=ne.next()}}}function t(a,l){this.id=a,this.links=null,this.data=l}function n(a,l){a.links?a.links.add(l):a.links=new Set([l])}function r(a,l,u,h){this.fromId=a,this.toId=l,this.data=u,this.id=h}function s(a,l){return a.toString()+"👉 "+l.toString()}return sb}var c7=u7();const h7=Up(c7);var Hg={exports:{}},Cc={exports:{}},ab,vP;function kO(){return vP||(vP=1,ab=function(e){return e===0?"x":e===1?"y":e===2?"z":"c"+(e+1)}),ab}var ob,_P;function Xh(){if(_P)return ob;_P=1;const i=kO();return ob=function(t){return n;function n(r,s){let a=s&&s.indent||0,l=s&&s.join!==void 0?s.join:`
`,u=Array(a+1).join(" "),h=[];for(let d=0;d<t;++d){let p=i(d),g=d===0?"":u;h.push(g+r.replace(/{var}/g,p))}return h.join(l)}},ob}var xP;function f7(){if(xP)return Cc.exports;xP=1;const i=Xh();Cc.exports=e,Cc.exports.generateCreateBodyFunctionBody=t,Cc.exports.getVectorCode=r,Cc.exports.getBodyCode=n;function e(s,a){let l=t(s,a),{Body:u}=new Function(l)();return u}function t(s,a){return`
${r(s,a)}
${n(s)}
return {Body: Body, Vector: Vector};
`}function n(s){let a=i(s),l=a("{var}",{join:", "});return`
function Body(${l}) {
  this.isPinned = false;
  this.pos = new Vector(${l});
  this.force = new Vector();
  this.velocity = new Vector();
  this.mass = 1;

  this.springCount = 0;
  this.springLength = 0;
}

Body.prototype.reset = function() {
  this.force.reset();
  this.springCount = 0;
  this.springLength = 0;
}

Body.prototype.setPosition = function (${l}) {
  ${a("this.pos.{var} = {var} || 0;",{indent:2})}
};`}function r(s,a){let l=i(s),u="";return a&&(u=`${l(`
	   var v{var};
	Object.defineProperty(this, '{var}', {
	  set: function(v) { 
	    if (!Number.isFinite(v)) throw new Error('Cannot set non-numbers to {var}');
	    v{var} = v; 
	  },
	  get: function() { return v{var}; }
	});`)}`),`function Vector(${l("{var}",{join:", "})}) {
  ${u}
    if (typeof arguments[0] === 'object') {
      // could be another vector
      let v = arguments[0];
      ${l('if (!Number.isFinite(v.{var})) throw new Error("Expected value is not a finite number at Vector constructor ({var})");',{indent:4})}
      ${l("this.{var} = v.{var};",{indent:4})}
    } else {
      ${l('this.{var} = typeof {var} === "number" ? {var} : 0;',{indent:4})}
    }
  }
  
  Vector.prototype.reset = function () {
    ${l("this.{var} = ",{join:""})}0;
  };`}return Cc.exports}var Ha={exports:{}},bP;function d7(){if(bP)return Ha.exports;bP=1;const i=Xh(),e=kO();Ha.exports=t,Ha.exports.generateQuadTreeFunctionBody=n,Ha.exports.getInsertStackCode=u,Ha.exports.getQuadNodeCode=l,Ha.exports.isSamePosition=r,Ha.exports.getChildBodyCode=a,Ha.exports.setChildBodyCode=s;function t(h){let d=n(h);return new Function(d)()}function n(h){let d=i(h),p=Math.pow(2,h);return`
${u()}
${l(h)}
${r(h)}
${a(h)}
${s(h)}

function createQuadTree(options, random) {
  options = options || {};
  options.gravity = typeof options.gravity === 'number' ? options.gravity : -1;
  options.theta = typeof options.theta === 'number' ? options.theta : 0.8;

  var gravity = options.gravity;
  var updateQueue = [];
  var insertStack = new InsertStack();
  var theta = options.theta;

  var nodesCache = [];
  var currentInCache = 0;
  var root = newNode();

  return {
    insertBodies: insertBodies,

    /**
     * Gets root node if it is present
     */
    getRoot: function() {
      return root;
    },

    updateBodyForce: update,

    options: function(newOptions) {
      if (newOptions) {
        if (typeof newOptions.gravity === 'number') {
          gravity = newOptions.gravity;
        }
        if (typeof newOptions.theta === 'number') {
          theta = newOptions.theta;
        }

        return this;
      }

      return {
        gravity: gravity,
        theta: theta
      };
    }
  };

  function newNode() {
    // To avoid pressure on GC we reuse nodes.
    var node = nodesCache[currentInCache];
    if (node) {
${S("      node.")}
      node.body = null;
      node.mass = ${d("node.mass_{var} = ",{join:""})}0;
      ${d("node.min_{var} = node.max_{var} = ",{join:""})}0;
    } else {
      node = new QuadNode();
      nodesCache[currentInCache] = node;
    }

    ++currentInCache;
    return node;
  }

  function update(sourceBody) {
    var queue = updateQueue;
    var v;
    ${d("var d{var};",{indent:4})}
    var r; 
    ${d("var f{var} = 0;",{indent:4})}
    var queueLength = 1;
    var shiftIdx = 0;
    var pushIdx = 1;

    queue[0] = root;

    while (queueLength) {
      var node = queue[shiftIdx];
      var body = node.body;

      queueLength -= 1;
      shiftIdx += 1;
      var differentBody = (body !== sourceBody);
      if (body && differentBody) {
        // If the current node is a leaf node (and it is not source body),
        // calculate the force exerted by the current node on body, and add this
        // amount to body's net force.
        ${d("d{var} = body.pos.{var} - sourceBody.pos.{var};",{indent:8})}
        r = Math.sqrt(${d("d{var} * d{var}",{join:" + "})});

        if (r === 0) {
          // Poor man's protection against zero distance.
          ${d("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:10})}
          r = Math.sqrt(${d("d{var} * d{var}",{join:" + "})});
        }

        // This is standard gravitation force calculation but we divide
        // by r^3 to save two operations when normalizing force vector.
        v = gravity * body.mass * sourceBody.mass / (r * r * r);
        ${d("f{var} += v * d{var};",{indent:8})}
      } else if (differentBody) {
        // Otherwise, calculate the ratio s / r,  where s is the width of the region
        // represented by the internal node, and r is the distance between the body
        // and the node's center-of-mass
        ${d("d{var} = node.mass_{var} / node.mass - sourceBody.pos.{var};",{indent:8})}
        r = Math.sqrt(${d("d{var} * d{var}",{join:" + "})});

        if (r === 0) {
          // Sorry about code duplication. I don't want to create many functions
          // right away. Just want to see performance first.
          ${d("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:10})}
          r = Math.sqrt(${d("d{var} * d{var}",{join:" + "})});
        }
        // If s / r < θ, treat this internal node as a single body, and calculate the
        // force it exerts on sourceBody, and add this amount to sourceBody's net force.
        if ((node.max_${e(0)} - node.min_${e(0)}) / r < theta) {
          // in the if statement above we consider node's width only
          // because the region was made into square during tree creation.
          // Thus there is no difference between using width or height.
          v = gravity * node.mass * sourceBody.mass / (r * r * r);
          ${d("f{var} += v * d{var};",{indent:10})}
        } else {
          // Otherwise, run the procedure recursively on each of the current node's children.

          // I intentionally unfolded this loop, to save several CPU cycles.
${v()}
        }
      }
    }

    ${d("sourceBody.force.{var} += f{var};",{indent:4})}
  }

  function insertBodies(bodies) {
    ${d("var {var}min = Number.MAX_VALUE;",{indent:4})}
    ${d("var {var}max = Number.MIN_VALUE;",{indent:4})}
    var i = bodies.length;

    // To reduce quad tree depth we are looking for exact bounding box of all particles.
    while (i--) {
      var pos = bodies[i].pos;
      ${d("if (pos.{var} < {var}min) {var}min = pos.{var};",{indent:6})}
      ${d("if (pos.{var} > {var}max) {var}max = pos.{var};",{indent:6})}
    }

    // Makes the bounds square.
    var maxSideLength = -Infinity;
    ${d("if ({var}max - {var}min > maxSideLength) maxSideLength = {var}max - {var}min ;",{indent:4})}

    currentInCache = 0;
    root = newNode();
    ${d("root.min_{var} = {var}min;",{indent:4})}
    ${d("root.max_{var} = {var}min + maxSideLength;",{indent:4})}

    i = bodies.length - 1;
    if (i >= 0) {
      root.body = bodies[i];
    }
    while (i--) {
      insert(bodies[i], root);
    }
  }

  function insert(newBody) {
    insertStack.reset();
    insertStack.push(root, newBody);

    while (!insertStack.isEmpty()) {
      var stackItem = insertStack.pop();
      var node = stackItem.node;
      var body = stackItem.body;

      if (!node.body) {
        // This is internal node. Update the total mass of the node and center-of-mass.
        ${d("var {var} = body.pos.{var};",{indent:8})}
        node.mass += body.mass;
        ${d("node.mass_{var} += body.mass * {var};",{indent:8})}

        // Recursively insert the body in the appropriate quadrant.
        // But first find the appropriate quadrant.
        var quadIdx = 0; // Assume we are in the 0's quad.
        ${d("var min_{var} = node.min_{var};",{indent:8})}
        ${d("var max_{var} = (min_{var} + node.max_{var}) / 2;",{indent:8})}

${y(8)}

        var child = getChild(node, quadIdx);

        if (!child) {
          // The node is internal but this quadrant is not taken. Add
          // subnode to it.
          child = newNode();
          ${d("child.min_{var} = min_{var};",{indent:10})}
          ${d("child.max_{var} = max_{var};",{indent:10})}
          child.body = body;

          setChild(node, quadIdx, child);
        } else {
          // continue searching in this quadrant.
          insertStack.push(child, body);
        }
      } else {
        // We are trying to add to the leaf node.
        // We have to convert current leaf into internal node
        // and continue adding two nodes.
        var oldBody = node.body;
        node.body = null; // internal nodes do not cary bodies

        if (isSamePosition(oldBody.pos, body.pos)) {
          // Prevent infinite subdivision by bumping one node
          // anywhere in this quadrant
          var retriesCount = 3;
          do {
            var offset = random.nextDouble();
            ${d("var d{var} = (node.max_{var} - node.min_{var}) * offset;",{indent:12})}

            ${d("oldBody.pos.{var} = node.min_{var} + d{var};",{indent:12})}
            retriesCount -= 1;
            // Make sure we don't bump it out of the box. If we do, next iteration should fix it
          } while (retriesCount > 0 && isSamePosition(oldBody.pos, body.pos));

          if (retriesCount === 0 && isSamePosition(oldBody.pos, body.pos)) {
            // This is very bad, we ran out of precision.
            // if we do not return from the method we'll get into
            // infinite loop here. So we sacrifice correctness of layout, and keep the app running
            // Next layout iteration should get larger bounding box in the first step and fix this
            return;
          }
        }
        // Next iteration should subdivide node further.
        insertStack.push(node, oldBody);
        insertStack.push(node, body);
      }
    }
  }
}
return createQuadTree;

`;function y(b){let _=[],E=Array(b+1).join(" ");for(let M=0;M<h;++M)_.push(E+`if (${e(M)} > max_${e(M)}) {`),_.push(E+`  quadIdx = quadIdx + ${Math.pow(2,M)};`),_.push(E+`  min_${e(M)} = max_${e(M)};`),_.push(E+`  max_${e(M)} = node.max_${e(M)};`),_.push(E+"}");return _.join(`
`)}function v(){let b=Array(11).join(" "),_=[];for(let E=0;E<p;++E)_.push(b+`if (node.quad${E}) {`),_.push(b+`  queue[pushIdx] = node.quad${E};`),_.push(b+"  queueLength += 1;"),_.push(b+"  pushIdx += 1;"),_.push(b+"}");return _.join(`
`)}function S(b){let _=[];for(let E=0;E<p;++E)_.push(`${b}quad${E} = null;`);return _.join(`
`)}}function r(h){let d=i(h);return`
  function isSamePosition(point1, point2) {
    ${d("var d{var} = Math.abs(point1.{var} - point2.{var});",{indent:2})}
  
    return ${d("d{var} < 1e-8",{join:" && "})};
  }  
`}function s(h){var d=Math.pow(2,h);return`
function setChild(node, idx, child) {
  ${p()}
}`;function p(){let g=[];for(let y=0;y<d;++y){let v=y===0?"  ":"  else ";g.push(`${v}if (idx === ${y}) node.quad${y} = child;`)}return g.join(`
`)}}function a(h){return`function getChild(node, idx) {
${d()}
  return null;
}`;function d(){let p=[],g=Math.pow(2,h);for(let y=0;y<g;++y)p.push(`  if (idx === ${y}) return node.quad${y};`);return p.join(`
`)}}function l(h){let d=i(h),p=Math.pow(2,h);var g=`
function QuadNode() {
  // body stored inside this node. In quad tree only leaf nodes (by construction)
  // contain bodies:
  this.body = null;

  // Child nodes are stored in quads. Each quad is presented by number:
  // 0 | 1
  // -----
  // 2 | 3
${y("  this.")}

  // Total mass of current node
  this.mass = 0;

  // Center of mass coordinates
  ${d("this.mass_{var} = 0;",{indent:2})}

  // bounding box coordinates
  ${d("this.min_{var} = 0;",{indent:2})}
  ${d("this.max_{var} = 0;",{indent:2})}
}
`;return g;function y(v){let S=[];for(let b=0;b<p;++b)S.push(`${v}quad${b} = null;`);return S.join(`
`)}}function u(){return`
/**
 * Our implementation of QuadTree is non-recursive to avoid GC hit
 * This data structure represent stack of elements
 * which we are trying to insert into quad tree.
 */
function InsertStack () {
    this.stack = [];
    this.popIdx = 0;
}

InsertStack.prototype = {
    isEmpty: function() {
        return this.popIdx === 0;
    },
    push: function (node, body) {
        var item = this.stack[this.popIdx];
        if (!item) {
            // we are trying to avoid memory pressure: create new element
            // only when absolutely necessary
            this.stack[this.popIdx] = new InsertStackElement(node, body);
        } else {
            item.node = node;
            item.body = body;
        }
        ++this.popIdx;
    },
    pop: function () {
        if (this.popIdx > 0) {
            return this.stack[--this.popIdx];
        }
    },
    reset: function () {
        this.popIdx = 0;
    }
};

function InsertStackElement(node, body) {
    this.node = node; // QuadTree node
    this.body = body; // physical body which needs to be inserted to node
}
`}return Ha.exports}var Wg={exports:{}},SP;function p7(){if(SP)return Wg.exports;SP=1,Wg.exports=e,Wg.exports.generateFunctionBody=t;const i=Xh();function e(n){let r=t(n);return new Function("bodies","settings","random",r)}function t(n){let r=i(n);return`
  var boundingBox = {
    ${r("min_{var}: 0, max_{var}: 0,",{indent:4})}
  };

  return {
    box: boundingBox,

    update: updateBoundingBox,

    reset: resetBoundingBox,

    getBestNewPosition: function (neighbors) {
      var ${r("base_{var} = 0",{join:", "})};

      if (neighbors.length) {
        for (var i = 0; i < neighbors.length; ++i) {
          let neighborPos = neighbors[i].pos;
          ${r("base_{var} += neighborPos.{var};",{indent:10})}
        }

        ${r("base_{var} /= neighbors.length;",{indent:8})}
      } else {
        ${r("base_{var} = (boundingBox.min_{var} + boundingBox.max_{var}) / 2;",{indent:8})}
      }

      var springLength = settings.springLength;
      return {
        ${r("{var}: base_{var} + (random.nextDouble() - 0.5) * springLength,",{indent:8})}
      };
    }
  };

  function updateBoundingBox() {
    var i = bodies.length;
    if (i === 0) return; // No bodies - no borders.

    ${r("var max_{var} = -Infinity;",{indent:4})}
    ${r("var min_{var} = Infinity;",{indent:4})}

    while(i--) {
      // this is O(n), it could be done faster with quadtree, if we check the root node bounds
      var bodyPos = bodies[i].pos;
      ${r("if (bodyPos.{var} < min_{var}) min_{var} = bodyPos.{var};",{indent:6})}
      ${r("if (bodyPos.{var} > max_{var}) max_{var} = bodyPos.{var};",{indent:6})}
    }

    ${r("boundingBox.min_{var} = min_{var};",{indent:4})}
    ${r("boundingBox.max_{var} = max_{var};",{indent:4})}
  }

  function resetBoundingBox() {
    ${r("boundingBox.min_{var} = boundingBox.max_{var} = 0;",{indent:4})}
  }
`}return Wg.exports}var jg={exports:{}},TP;function m7(){if(TP)return jg.exports;TP=1;const i=Xh();jg.exports=e,jg.exports.generateCreateDragForceFunctionBody=t;function e(n){let r=t(n);return new Function("options",r)}function t(n){return`
  if (!Number.isFinite(options.dragCoefficient)) throw new Error('dragCoefficient is not a finite number');

  return {
    update: function(body) {
      ${i(n)("body.force.{var} -= options.dragCoefficient * body.velocity.{var};",{indent:6})}
    }
  };
`}return jg.exports}var qg={exports:{}},MP;function g7(){if(MP)return qg.exports;MP=1;const i=Xh();qg.exports=e,qg.exports.generateCreateSpringForceFunctionBody=t;function e(n){let r=t(n);return new Function("options","random",r)}function t(n){let r=i(n);return`
  if (!Number.isFinite(options.springCoefficient)) throw new Error('Spring coefficient is not a number');
  if (!Number.isFinite(options.springLength)) throw new Error('Spring length is not a number');

  return {
    /**
     * Updates forces acting on a spring
     */
    update: function (spring) {
      var body1 = spring.from;
      var body2 = spring.to;
      var length = spring.length < 0 ? options.springLength : spring.length;
      ${r("var d{var} = body2.pos.{var} - body1.pos.{var};",{indent:6})}
      var r = Math.sqrt(${r("d{var} * d{var}",{join:" + "})});

      if (r === 0) {
        ${r("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:8})}
        r = Math.sqrt(${r("d{var} * d{var}",{join:" + "})});
      }

      var d = r - length;
      var coefficient = ((spring.coefficient > 0) ? spring.coefficient : options.springCoefficient) * d / r;

      ${r("body1.force.{var} += coefficient * d{var}",{indent:6})};
      body1.springCount += 1;
      body1.springLength += r;

      ${r("body2.force.{var} -= coefficient * d{var}",{indent:6})};
      body2.springCount += 1;
      body2.springLength += r;
    }
  };
`}return qg.exports}var $g={exports:{}},EP;function y7(){if(EP)return $g.exports;EP=1;const i=Xh();$g.exports=e,$g.exports.generateIntegratorFunctionBody=t;function e(n){let r=t(n);return new Function("bodies","timeStep","adaptiveTimeStepWeight",r)}function t(n){let r=i(n);return`
  var length = bodies.length;
  if (length === 0) return 0;

  ${r("var d{var} = 0, t{var} = 0;",{indent:2})}

  for (var i = 0; i < length; ++i) {
    var body = bodies[i];
    if (body.isPinned) continue;

    if (adaptiveTimeStepWeight && body.springCount) {
      timeStep = (adaptiveTimeStepWeight * body.springLength/body.springCount);
    }

    var coeff = timeStep / body.mass;

    ${r("body.velocity.{var} += coeff * body.force.{var};",{indent:4})}
    ${r("var v{var} = body.velocity.{var};",{indent:4})}
    var v = Math.sqrt(${r("v{var} * v{var}",{join:" + "})});

    if (v > 1) {
      // We normalize it so that we move within timeStep range. 
      // for the case when v <= 1 - we let velocity to fade out.
      ${r("body.velocity.{var} = v{var} / v;",{indent:6})}
    }

    ${r("d{var} = timeStep * body.velocity.{var};",{indent:4})}

    ${r("body.pos.{var} += d{var};",{indent:4})}

    ${r("t{var} += Math.abs(d{var});",{indent:4})}
  }

  return (${r("t{var} * t{var}",{join:" + "})})/length;
`}return $g.exports}var lb,AP;function v7(){if(AP)return lb;AP=1,lb=i;function i(e,t,n,r){this.from=e,this.to=t,this.length=n,this.coefficient=r}return lb}var ub,wP;function _7(){if(wP)return ub;wP=1,ub=i;function i(e,t){var n;if(e||(e={}),t){for(n in t)if(t.hasOwnProperty(n)){var r=e.hasOwnProperty(n),s=typeof t[n],a=!r||typeof e[n]!==s;a?e[n]=t[n]:s==="object"&&(e[n]=i(e[n],t[n]))}}return e}return ub}var ad={exports:{}},RP;function x7(){if(RP)return ad.exports;RP=1,ad.exports=i,ad.exports.random=i,ad.exports.randomIterator=l;function i(u){var h=typeof u=="number"?u:+new Date;return new e(h)}function e(u){this.seed=u}e.prototype.next=a,e.prototype.nextDouble=s,e.prototype.uniform=s,e.prototype.gaussian=t,e.prototype.random=s;function t(){var u,h,d;do h=this.nextDouble()*2-1,d=this.nextDouble()*2-1,u=h*h+d*d;while(u>=1||u===0);return h*Math.sqrt(-2*Math.log(u)/u)}e.prototype.levy=n;function n(){var u=1.5,h=Math.pow(r(1+u)*Math.sin(Math.PI*u/2)/(r((1+u)/2)*u*Math.pow(2,(u-1)/2)),1/u);return this.gaussian()*h/Math.pow(Math.abs(this.gaussian()),1/u)}function r(u){return Math.sqrt(2*Math.PI/u)*Math.pow(1/Math.E*(u+1/(12*u-1/(10*u))),u)}function s(){var u=this.seed;return u=u+2127912214+(u<<12)&4294967295,u=(u^3345072700^u>>>19)&4294967295,u=u+374761393+(u<<5)&4294967295,u=(u+3550635116^u<<9)&4294967295,u=u+4251993797+(u<<3)&4294967295,u=(u^3042594569^u>>>16)&4294967295,this.seed=u,(u&268435455)/268435456}function a(u){return Math.floor(this.nextDouble()*u)}function l(u,h){var d=h||i();if(typeof d.next!="function")throw new Error("customRandom does not match expected API: next() function is missing");return{forEach:g,shuffle:p};function p(){var y,v,S;for(y=u.length-1;y>0;--y)v=d.next(y+1),S=u[v],u[v]=u[y],u[y]=S;return u}function g(y){var v,S,b;for(v=u.length-1;v>0;--v)S=d.next(v+1),b=u[S],u[S]=u[v],u[v]=b,y(b);u.length&&y(u[0])}}return ad.exports}var cb,CP;function NP(){if(CP)return cb;CP=1,cb=l;var i=f7(),e=d7(),t=p7(),n=m7(),r=g7(),s=y7(),a={};function l(d){var p=v7(),g=_7(),y=lE();if(d){if(d.springCoeff!==void 0)throw new Error("springCoeff was renamed to springCoefficient");if(d.dragCoeff!==void 0)throw new Error("dragCoeff was renamed to dragCoefficient")}d=g(d,{springLength:10,springCoefficient:.8,gravity:-12,theta:.8,dragCoefficient:.9,timeStep:.5,adaptiveTimeStepWeight:0,dimensions:2,debug:!1});var v=a[d.dimensions];if(!v){var S=d.dimensions;v={Body:i(S,d.debug),createQuadTree:e(S),createBounds:t(S),createDragForce:n(S),createSpringForce:r(S),integrate:s(S)},a[S]=v}var b=v.Body,_=v.createQuadTree,E=v.createBounds,M=v.createDragForce,A=v.createSpringForce,w=v.integrate,R=Z=>new b(Z),C=x7().random(42),L=[],N=[],D=_(d,C),I=E(L,d,C),W=A(d,C),Y=M(d),oe=0,le=[],z=new Map,k=0;F("nbody",De),F("spring",j);var G={bodies:L,quadTree:D,springs:N,settings:d,addForce:F,removeForce:se,getForces:Me,step:function(){for(var Z=0;Z<le.length;++Z)le[Z](k);var $=w(L,d.timeStep,d.adaptiveTimeStepWeight);return k+=1,$},addBody:function(Z){if(!Z)throw new Error("Body is required");return L.push(Z),Z},addBodyAt:function(Z){if(!Z)throw new Error("Body position is required");var $=R(Z);return L.push($),$},removeBody:function(Z){if(Z){var $=L.indexOf(Z);if(!($<0))return L.splice($,1),L.length===0&&I.reset(),!0}},addSpring:function(Z,$,ne,ve){if(!Z||!$)throw new Error("Cannot add null spring to force simulator");typeof ne!="number"&&(ne=-1);var He=new p(Z,$,ne,ve>=0?ve:-1);return N.push(He),He},getTotalMovement:function(){return oe},removeSpring:function(Z){if(Z){var $=N.indexOf(Z);if($>-1)return N.splice($,1),!0}},getBestNewBodyPosition:function(Z){return I.getBestNewPosition(Z)},getBBox:he,getBoundingBox:he,invalidateBBox:function(){console.warn("invalidateBBox() is deprecated, bounds always recomputed on `getBBox()` call")},gravity:function(Z){return Z!==void 0?(d.gravity=Z,D.options({gravity:Z}),this):d.gravity},theta:function(Z){return Z!==void 0?(d.theta=Z,D.options({theta:Z}),this):d.theta},random:C};return u(d,G),y(G),G;function he(){return I.update(),I.box}function F(Z,$){if(z.has(Z))throw new Error("Force "+Z+" is already added");z.set(Z,$),le.push($)}function se(Z){var $=le.indexOf(z.get(Z));$<0||(le.splice($,1),z.delete(Z))}function Me(){return z}function De(){if(L.length!==0){D.insertBodies(L);for(var Z=L.length;Z--;){var $=L[Z];$.isPinned||($.reset(),D.updateBodyForce($),Y.update($))}}}function j(){for(var Z=N.length;Z--;)W.update(N[Z])}}function u(d,p){for(var g in d)h(d,p,g)}function h(d,p,g){if(d.hasOwnProperty(g)&&typeof p[g]!="function"){var y=Number.isFinite(d[g]);y?p[g]=function(v){if(v!==void 0){if(!Number.isFinite(v))throw new Error("Value of "+g+" should be a valid number.");return d[g]=v,p}return d[g]}:p[g]=function(v){return v!==void 0?(d[g]=v,p):d[g]}}}return cb}var PP;function b7(){if(PP)return Hg.exports;PP=1,Hg.exports=e,Hg.exports.simulator=NP();var i=lE();function e(n,r){if(!n)throw new Error("Graph structure cannot be undefined");var s=r&&r.createSimulator||NP(),a=s(r);if(Array.isArray(r))throw new Error("Physics settings is expected to be an object");var l=n.version>19?z:le;r&&typeof r.nodeMass=="function"&&(l=r.nodeMass);var u=new Map,h={},d=0,p=a.settings.springTransform||t;R(),M();var g=!1,y={step:function(){if(d===0)return v(!0),!0;var k=a.step();y.lastMove=k,y.fire("step");var G=k/d,he=G<=.01;return v(he),he},getNodePosition:function(k){return oe(k).pos},setNodePosition:function(k){var G=oe(k);G.setPosition.apply(G,Array.prototype.slice.call(arguments,1))},getLinkPosition:function(k){var G=h[k];if(G)return{from:G.from.pos,to:G.to.pos}},getGraphRect:function(){return a.getBBox()},forEachBody:S,pinNode:function(k,G){var he=oe(k.id);he.isPinned=!!G},isNodePinned:function(k){return oe(k.id).isPinned},dispose:function(){n.off("changed",w),y.fire("disposed")},getBody:E,getSpring:_,getForceVectorLength:b,simulator:a,graph:n,lastMove:0};return i(y),y;function v(k){g!==k&&(g=k,A(k))}function S(k){u.forEach(k)}function b(){var k=0,G=0;return S(function(he){k+=Math.abs(he.force.x),G+=Math.abs(he.force.y)}),Math.sqrt(k*k+G*G)}function _(k,G){var he;if(G===void 0)typeof k!="object"?he=k:he=k.id;else{var F=n.hasLink(k,G);if(!F)return;he=F.id}return h[he]}function E(k){return u.get(k)}function M(){n.on("changed",w)}function A(k){y.fire("stable",k)}function w(k){for(var G=0;G<k.length;++G){var he=k[G];he.changeType==="add"?(he.node&&C(he.node.id),he.link&&N(he.link)):he.changeType==="remove"&&(he.node&&L(he.node),he.link&&D(he.link))}d=n.getNodesCount()}function R(){d=0,n.forEachNode(function(k){C(k.id),d+=1}),n.forEachLink(N)}function C(k){var G=u.get(k);if(!G){var he=n.getNode(k);if(!he)throw new Error("initBody() was called with unknown node id");var F=he.position;if(!F){var se=I(he);F=a.getBestNewBodyPosition(se)}G=a.addBodyAt(F),G.id=k,u.set(k,G),W(k),Y(he)&&(G.isPinned=!0)}}function L(k){var G=k.id,he=u.get(G);he&&(u.delete(G),a.removeBody(he))}function N(k){W(k.fromId),W(k.toId);var G=u.get(k.fromId),he=u.get(k.toId),F=a.addSpring(G,he,k.length);p(k,F),h[k.id]=F}function D(k){var G=h[k.id];if(G){var he=n.getNode(k.fromId),F=n.getNode(k.toId);he&&W(he.id),F&&W(F.id),delete h[k.id],a.removeSpring(G)}}function I(k){var G=[];if(!k.links)return G;for(var he=Math.min(k.links.length,2),F=0;F<he;++F){var se=k.links[F],Me=se.fromId!==k.id?u.get(se.fromId):u.get(se.toId);Me&&Me.pos&&G.push(Me)}return G}function W(k){var G=u.get(k);if(G.mass=l(k),Number.isNaN(G.mass))throw new Error("Node mass should be a number")}function Y(k){return k&&(k.isPinned||k.data&&k.data.isPinned)}function oe(k){var G=u.get(k);return G||(C(k),G=u.get(k)),G}function le(k){var G=n.getLinks(k);return G?1+G.length/3:1}function z(k){var G=n.getLinks(k);return G?1+G.size/3:1}}function t(){}return Hg.exports}var S7=b7();const T7=Up(S7);function QS(i){var e=typeof i;return i!=null&&(e=="object"||e=="function")}var M7=typeof global=="object"&&global&&global.Object===Object&&global,E7=typeof self=="object"&&self&&self.Object===Object&&self,zO=M7||E7||Function("return this")(),hb=function(){return zO.Date.now()},A7=/\s/;function w7(i){for(var e=i.length;e--&&A7.test(i.charAt(e)););return e}var R7=/^\s+/;function C7(i){return i&&i.slice(0,w7(i)+1).replace(R7,"")}var Ky=zO.Symbol,VO=Object.prototype,N7=VO.hasOwnProperty,P7=VO.toString,od=Ky?Ky.toStringTag:void 0;function D7(i){var e=N7.call(i,od),t=i[od];try{i[od]=void 0;var n=!0}catch{}var r=P7.call(i);return n&&(e?i[od]=t:delete i[od]),r}var L7=Object.prototype,U7=L7.toString;function O7(i){return U7.call(i)}var B7="[object Null]",I7="[object Undefined]",DP=Ky?Ky.toStringTag:void 0;function F7(i){return i==null?i===void 0?I7:B7:DP&&DP in Object(i)?D7(i):O7(i)}function k7(i){return i!=null&&typeof i=="object"}var z7="[object Symbol]";function V7(i){return typeof i=="symbol"||k7(i)&&F7(i)==z7}var LP=NaN,G7=/^[-+]0x[0-9a-f]+$/i,H7=/^0b[01]+$/i,W7=/^0o[0-7]+$/i,j7=parseInt;function UP(i){if(typeof i=="number")return i;if(V7(i))return LP;if(QS(i)){var e=typeof i.valueOf=="function"?i.valueOf():i;i=QS(e)?e+"":e}if(typeof i!="string")return i===0?i:+i;i=C7(i);var t=H7.test(i);return t||W7.test(i)?j7(i.slice(2),t?2:8):G7.test(i)?LP:+i}var q7="Expected a function",$7=Math.max,X7=Math.min;function Y7(i,e,t){var n,r,s,a,l,u,h=0,d=!1,p=!1,g=!0;if(typeof i!="function")throw new TypeError(q7);e=UP(e)||0,QS(t)&&(d=!!t.leading,p="maxWait"in t,s=p?$7(UP(t.maxWait)||0,e):s,g="trailing"in t?!!t.trailing:g);function y(R){var C=n,L=r;return n=r=void 0,h=R,a=i.apply(L,C),a}function v(R){return h=R,l=setTimeout(_,e),d?y(R):a}function S(R){var C=R-u,L=R-h,N=e-C;return p?X7(N,s-L):N}function b(R){var C=R-u,L=R-h;return u===void 0||C>=e||C<0||p&&L>=s}function _(){var R=hb();if(b(R))return E(R);l=setTimeout(_,S(R))}function E(R){return l=void 0,g&&n?y(R):(n=r=void 0,a)}function M(){l!==void 0&&clearTimeout(l),h=0,n=u=r=l=void 0}function A(){return l===void 0?a:E(hb())}function w(){var R=hb(),C=b(R);if(n=arguments,r=this,u=R,C){if(l===void 0)return v(u);if(p)return clearTimeout(l),l=setTimeout(_,e),y(u)}return l===void 0&&(l=setTimeout(_,e)),a}return w.cancel=M,w.flush=A,w}function OP(i,e){(e==null||e>i.length)&&(e=i.length);for(var t=0,n=Array(e);t<e;t++)n[t]=i[t];return n}function K7(i){if(Array.isArray(i))return i}function Z7(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function Q7(i,e,t){return Object.defineProperty(i,"prototype",{writable:!1}),i}function J7(i,e){var t=i==null?null:typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(t!=null){var n,r,s,a,l=[],u=!0,h=!1;try{if(s=(t=t.call(i)).next,e!==0)for(;!(u=(n=s.call(t)).done)&&(l.push(n.value),l.length!==e);u=!0);}catch(d){h=!0,r=d}finally{try{if(!u&&t.return!=null&&(a=t.return(),Object(a)!==a))return}finally{if(h)throw r}}return l}}function eY(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function tY(i,e){return K7(i)||J7(i,e)||nY(i,e)||eY()}function nY(i,e){if(i){if(typeof i=="string")return OP(i,e);var t={}.toString.call(i).slice(8,-1);return t==="Object"&&i.constructor&&(t=i.constructor.name),t==="Map"||t==="Set"?Array.from(i):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?OP(i,e):void 0}}var iY=Q7(function i(e,t){var n=t.default,r=n===void 0?null:n,s=t.triggerUpdate,a=s===void 0?!0:s,l=t.onChange,u=l===void 0?function(h,d){}:l;Z7(this,i),this.name=e,this.defaultVal=r,this.triggerUpdate=a,this.onChange=u});function Pv(i){var e=i.stateInit,t=e===void 0?function(){return{}}:e,n=i.props,r=n===void 0?{}:n,s=i.methods,a=s===void 0?{}:s,l=i.aliases,u=l===void 0?{}:l,h=i.init,d=h===void 0?function(){}:h,p=i.update,g=p===void 0?function(){}:p,y=Object.keys(r).map(function(v){return new iY(v,r[v])});return function v(){for(var S=arguments.length,b=new Array(S),_=0;_<S;_++)b[_]=arguments[_];var E=!!(this instanceof v&&this.constructor),M=E?b.shift():void 0,A=b[0],w=A===void 0?{}:A,R=Object.assign({},t instanceof Function?t(w):t,{initialised:!1}),C={};function L(I){return N(I,w),D(),L}var N=function(W,Y){d.call(L,W,R,Y),R.initialised=!0},D=Y7(function(){R.initialised&&(g.call(L,R,C),C={})},1);return y.forEach(function(I){L[I.name]=W(I);function W(Y){var oe=Y.name,le=Y.triggerUpdate,z=le===void 0?!1:le,k=Y.onChange,G=k===void 0?function(se,Me){}:k,he=Y.defaultVal,F=he===void 0?null:he;return function(se){var Me=R[oe];if(!arguments.length)return Me;var De=se===void 0?F:se;return R[oe]=De,G.call(L,De,R,Me),!C.hasOwnProperty(oe)&&(C[oe]=Me),z&&D(),L}}}),Object.keys(a).forEach(function(I){L[I]=function(){for(var W,Y=arguments.length,oe=new Array(Y),le=0;le<Y;le++)oe[le]=arguments[le];return(W=a[I]).call.apply(W,[L,R].concat(oe))}}),Object.entries(u).forEach(function(I){var W=tY(I,2),Y=W[0],oe=W[1];return L[Y]=L[oe]}),L.resetProps=function(){return y.forEach(function(I){L[I.name](I.defaultVal)}),L},L.resetProps(),R._rerender=D,E&&M&&L(M),L}}var tn=function(i){return typeof i=="function"?i:typeof i=="string"?function(e){return e[i]}:function(e){return i}};class BP extends Map{constructor(e,t=aY){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:t}}),e!=null)for(const[n,r]of e)this.set(n,r)}get(e){return super.get(IP(this,e))}has(e){return super.has(IP(this,e))}set(e,t){return super.set(rY(this,e),t)}delete(e){return super.delete(sY(this,e))}}function IP({_intern:i,_key:e},t){const n=e(t);return i.has(n)?i.get(n):t}function rY({_intern:i,_key:e},t){const n=e(t);return i.has(n)?i.get(n):(i.set(n,t),t)}function sY({_intern:i,_key:e},t){const n=e(t);return i.has(n)&&(t=i.get(n),i.delete(n)),t}function aY(i){return i!==null&&typeof i=="object"?i.valueOf():i}function oY(i,e){let t;if(e===void 0)for(const n of i)n!=null&&(t<n||t===void 0&&n>=n)&&(t=n);else{let n=-1;for(let r of i)(r=e(r,++n,i))!=null&&(t<r||t===void 0&&r>=r)&&(t=r)}return t}function lY(i,e){let t;if(e===void 0)for(const n of i)n!=null&&(t>n||t===void 0&&n>=n)&&(t=n);else{let n=-1;for(let r of i)(r=e(r,++n,i))!=null&&(t>r||t===void 0&&r>=r)&&(t=r)}return t}function JS(i,e){(e==null||e>i.length)&&(e=i.length);for(var t=0,n=Array(e);t<e;t++)n[t]=i[t];return n}function uY(i){if(Array.isArray(i))return i}function cY(i){if(Array.isArray(i))return JS(i)}function GO(i,e,t){if(typeof i=="function"?i===e:i.has(e))return arguments.length<3?e:t;throw new TypeError("Private element is not present on this object")}function hY(i,e){if(e.has(i))throw new TypeError("Cannot initialize the same private elements twice on an object")}function fY(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function Qi(i,e){return i.get(GO(i,e))}function Nc(i,e,t){hY(i,e),e.set(i,t)}function Xg(i,e,t){return i.set(GO(i,e),t),t}function dY(i,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,SY(n.key),n)}}function pY(i,e,t){return e&&dY(i.prototype,e),Object.defineProperty(i,"prototype",{writable:!1}),i}function mY(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function gY(i,e){var t=i==null?null:typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(t!=null){var n,r,s,a,l=[],u=!0,h=!1;try{if(s=(t=t.call(i)).next,e!==0)for(;!(u=(n=s.call(t)).done)&&(l.push(n.value),l.length!==e);u=!0);}catch(d){h=!0,r=d}finally{try{if(!u&&t.return!=null&&(a=t.return(),Object(a)!==a))return}finally{if(h)throw r}}return l}}function yY(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function vY(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _Y(i,e){return uY(i)||gY(i,e)||HO(i,e)||yY()}function xY(i){return cY(i)||mY(i)||HO(i)||vY()}function bY(i,e){if(typeof i!="object"||!i)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var n=t.call(i,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(i)}function SY(i){var e=bY(i,"string");return typeof e=="symbol"?e:e+""}function HO(i,e){if(i){if(typeof i=="string")return JS(i,e);var t={}.toString.call(i).slice(8,-1);return t==="Object"&&i.constructor&&(t=i.constructor.name),t==="Map"||t==="Set"?Array.from(i):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?JS(i,e):void 0}}var Pc=new WeakMap,ld=new WeakMap,Dc=new WeakMap,fb=new WeakMap,db=new WeakMap,pb=new WeakMap,TY=function(){function i(){fY(this,i),Nc(this,Pc,new Map),Nc(this,ld,new Map),Nc(this,Dc,function(e){return e}),Nc(this,fb,function(){return{}}),Nc(this,db,function(){}),Nc(this,pb,function(){})}return pY(i,[{key:"getObj",value:function(t){return Qi(Pc,this).get(Qi(Dc,this).call(this,t))}},{key:"getData",value:function(t){return Qi(ld,this).get(t)}},{key:"entries",value:function(){return xY(Qi(ld,this).entries()).map(function(t){var n=_Y(t,2),r=n[0],s=n[1];return[s,r]})}},{key:"id",value:function(t){return Xg(Dc,this,tn(t)),this}},{key:"onCreateObj",value:function(t){return Xg(fb,this,t),this}},{key:"onUpdateObj",value:function(t){return Xg(db,this,t),this}},{key:"onRemoveObj",value:function(t){return Xg(pb,this,t),this}},{key:"digest",value:function(t){var n=this;t.filter(function(s){return!Qi(Pc,n).has(Qi(Dc,n).call(n,s))}).forEach(function(s){var a=Qi(fb,n).call(n,s);Qi(Pc,n).set(Qi(Dc,n).call(n,s),a),Qi(ld,n).set(a,s)});var r=new Map(t.map(function(s){return[Qi(Dc,n).call(n,s),s]}));return Qi(Pc,this).forEach(function(s,a){r.has(a)?Qi(db,n).call(n,s,r.get(a)):(Qi(pb,n).call(n,s,a),Qi(Pc,n).delete(a),Qi(ld,n).delete(s))}),this}},{key:"clear",value:function(){return this.digest([]),this}}])}();function MY(i,e){switch(arguments.length){case 0:break;case 1:this.range(i);break;default:this.range(e).domain(i);break}return this}const FP=Symbol("implicit");function WO(){var i=new BP,e=[],t=[],n=FP;function r(s){let a=i.get(s);if(a===void 0){if(n!==FP)return n;i.set(s,a=e.push(s)-1)}return t[a%t.length]}return r.domain=function(s){if(!arguments.length)return e.slice();e=[],i=new BP;for(const a of s)i.has(a)||i.set(a,e.push(a)-1);return r},r.range=function(s){return arguments.length?(t=Array.from(s),r):t.slice()},r.unknown=function(s){return arguments.length?(n=s,r):n},r.copy=function(){return WO(e,t).unknown(n)},MY.apply(r,arguments),r}function EY(i){for(var e=i.length/6|0,t=new Array(e),n=0;n<e;)t[n]="#"+i.slice(n*6,++n*6);return t}const AY=EY("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928");function Zy(i){"@babel/helpers - typeof";return Zy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Zy(i)}var wY=/^\s+/,RY=/\s+$/;function ct(i,e){if(i=i||"",e=e||{},i instanceof ct)return i;if(!(this instanceof ct))return new ct(i,e);var t=CY(i);this._originalInput=i,this._r=t.r,this._g=t.g,this._b=t.b,this._a=t.a,this._roundA=Math.round(100*this._a)/100,this._format=e.format||t.format,this._gradientType=e.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=t.ok}ct.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var e=this.toRgb();return(e.r*299+e.g*587+e.b*114)/1e3},getLuminance:function(){var e=this.toRgb(),t,n,r,s,a,l;return t=e.r/255,n=e.g/255,r=e.b/255,t<=.03928?s=t/12.92:s=Math.pow((t+.055)/1.055,2.4),n<=.03928?a=n/12.92:a=Math.pow((n+.055)/1.055,2.4),r<=.03928?l=r/12.92:l=Math.pow((r+.055)/1.055,2.4),.2126*s+.7152*a+.0722*l},setAlpha:function(e){return this._a=jO(e),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var e=zP(this._r,this._g,this._b);return{h:e.h*360,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=zP(this._r,this._g,this._b),t=Math.round(e.h*360),n=Math.round(e.s*100),r=Math.round(e.v*100);return this._a==1?"hsv("+t+", "+n+"%, "+r+"%)":"hsva("+t+", "+n+"%, "+r+"%, "+this._roundA+")"},toHsl:function(){var e=kP(this._r,this._g,this._b);return{h:e.h*360,s:e.s,l:e.l,a:this._a}},toHslString:function(){var e=kP(this._r,this._g,this._b),t=Math.round(e.h*360),n=Math.round(e.s*100),r=Math.round(e.l*100);return this._a==1?"hsl("+t+", "+n+"%, "+r+"%)":"hsla("+t+", "+n+"%, "+r+"%, "+this._roundA+")"},toHex:function(e){return VP(this._r,this._g,this._b,e)},toHexString:function(e){return"#"+this.toHex(e)},toHex8:function(e){return LY(this._r,this._g,this._b,this._a,e)},toHex8String:function(e){return"#"+this.toHex8(e)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return this._a==1?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Math.round(Bn(this._r,255)*100)+"%",g:Math.round(Bn(this._g,255)*100)+"%",b:Math.round(Bn(this._b,255)*100)+"%",a:this._a}},toPercentageRgbString:function(){return this._a==1?"rgb("+Math.round(Bn(this._r,255)*100)+"%, "+Math.round(Bn(this._g,255)*100)+"%, "+Math.round(Bn(this._b,255)*100)+"%)":"rgba("+Math.round(Bn(this._r,255)*100)+"%, "+Math.round(Bn(this._g,255)*100)+"%, "+Math.round(Bn(this._b,255)*100)+"%, "+this._roundA+")"},toName:function(){return this._a===0?"transparent":this._a<1?!1:jY[VP(this._r,this._g,this._b,!0)]||!1},toFilter:function(e){var t="#"+GP(this._r,this._g,this._b,this._a),n=t,r=this._gradientType?"GradientType = 1, ":"";if(e){var s=ct(e);n="#"+GP(s._r,s._g,s._b,s._a)}return"progid:DXImageTransform.Microsoft.gradient("+r+"startColorstr="+t+",endColorstr="+n+")"},toString:function(e){var t=!!e;e=e||this._format;var n=!1,r=this._a<1&&this._a>=0,s=!t&&r&&(e==="hex"||e==="hex6"||e==="hex3"||e==="hex4"||e==="hex8"||e==="name");return s?e==="name"&&this._a===0?this.toName():this.toRgbString():(e==="rgb"&&(n=this.toRgbString()),e==="prgb"&&(n=this.toPercentageRgbString()),(e==="hex"||e==="hex6")&&(n=this.toHexString()),e==="hex3"&&(n=this.toHexString(!0)),e==="hex4"&&(n=this.toHex8String(!0)),e==="hex8"&&(n=this.toHex8String()),e==="name"&&(n=this.toName()),e==="hsl"&&(n=this.toHslString()),e==="hsv"&&(n=this.toHsvString()),n||this.toHexString())},clone:function(){return ct(this.toString())},_applyModification:function(e,t){var n=e.apply(null,[this].concat([].slice.call(t)));return this._r=n._r,this._g=n._g,this._b=n._b,this.setAlpha(n._a),this},lighten:function(){return this._applyModification(IY,arguments)},brighten:function(){return this._applyModification(FY,arguments)},darken:function(){return this._applyModification(kY,arguments)},desaturate:function(){return this._applyModification(UY,arguments)},saturate:function(){return this._applyModification(OY,arguments)},greyscale:function(){return this._applyModification(BY,arguments)},spin:function(){return this._applyModification(zY,arguments)},_applyCombination:function(e,t){return e.apply(null,[this].concat([].slice.call(t)))},analogous:function(){return this._applyCombination(HY,arguments)},complement:function(){return this._applyCombination(VY,arguments)},monochromatic:function(){return this._applyCombination(WY,arguments)},splitcomplement:function(){return this._applyCombination(GY,arguments)},triad:function(){return this._applyCombination(HP,[3])},tetrad:function(){return this._applyCombination(HP,[4])}};ct.fromRatio=function(i,e){if(Zy(i)=="object"){var t={};for(var n in i)i.hasOwnProperty(n)&&(n==="a"?t[n]=i[n]:t[n]=Cd(i[n]));i=t}return ct(i,e)};function CY(i){var e={r:0,g:0,b:0},t=1,n=null,r=null,s=null,a=!1,l=!1;return typeof i=="string"&&(i=YY(i)),Zy(i)=="object"&&(Wa(i.r)&&Wa(i.g)&&Wa(i.b)?(e=NY(i.r,i.g,i.b),a=!0,l=String(i.r).substr(-1)==="%"?"prgb":"rgb"):Wa(i.h)&&Wa(i.s)&&Wa(i.v)?(n=Cd(i.s),r=Cd(i.v),e=DY(i.h,n,r),a=!0,l="hsv"):Wa(i.h)&&Wa(i.s)&&Wa(i.l)&&(n=Cd(i.s),s=Cd(i.l),e=PY(i.h,n,s),a=!0,l="hsl"),i.hasOwnProperty("a")&&(t=i.a)),t=jO(t),{ok:a,format:i.format||l,r:Math.min(255,Math.max(e.r,0)),g:Math.min(255,Math.max(e.g,0)),b:Math.min(255,Math.max(e.b,0)),a:t}}function NY(i,e,t){return{r:Bn(i,255)*255,g:Bn(e,255)*255,b:Bn(t,255)*255}}function kP(i,e,t){i=Bn(i,255),e=Bn(e,255),t=Bn(t,255);var n=Math.max(i,e,t),r=Math.min(i,e,t),s,a,l=(n+r)/2;if(n==r)s=a=0;else{var u=n-r;switch(a=l>.5?u/(2-n-r):u/(n+r),n){case i:s=(e-t)/u+(e<t?6:0);break;case e:s=(t-i)/u+2;break;case t:s=(i-e)/u+4;break}s/=6}return{h:s,s:a,l}}function PY(i,e,t){var n,r,s;i=Bn(i,360),e=Bn(e,100),t=Bn(t,100);function a(h,d,p){return p<0&&(p+=1),p>1&&(p-=1),p<1/6?h+(d-h)*6*p:p<1/2?d:p<2/3?h+(d-h)*(2/3-p)*6:h}if(e===0)n=r=s=t;else{var l=t<.5?t*(1+e):t+e-t*e,u=2*t-l;n=a(u,l,i+1/3),r=a(u,l,i),s=a(u,l,i-1/3)}return{r:n*255,g:r*255,b:s*255}}function zP(i,e,t){i=Bn(i,255),e=Bn(e,255),t=Bn(t,255);var n=Math.max(i,e,t),r=Math.min(i,e,t),s,a,l=n,u=n-r;if(a=n===0?0:u/n,n==r)s=0;else{switch(n){case i:s=(e-t)/u+(e<t?6:0);break;case e:s=(t-i)/u+2;break;case t:s=(i-e)/u+4;break}s/=6}return{h:s,s:a,v:l}}function DY(i,e,t){i=Bn(i,360)*6,e=Bn(e,100),t=Bn(t,100);var n=Math.floor(i),r=i-n,s=t*(1-e),a=t*(1-r*e),l=t*(1-(1-r)*e),u=n%6,h=[t,a,s,s,l,t][u],d=[l,t,t,a,s,s][u],p=[s,s,l,t,t,a][u];return{r:h*255,g:d*255,b:p*255}}function VP(i,e,t,n){var r=[zs(Math.round(i).toString(16)),zs(Math.round(e).toString(16)),zs(Math.round(t).toString(16))];return n&&r[0].charAt(0)==r[0].charAt(1)&&r[1].charAt(0)==r[1].charAt(1)&&r[2].charAt(0)==r[2].charAt(1)?r[0].charAt(0)+r[1].charAt(0)+r[2].charAt(0):r.join("")}function LY(i,e,t,n,r){var s=[zs(Math.round(i).toString(16)),zs(Math.round(e).toString(16)),zs(Math.round(t).toString(16)),zs(qO(n))];return r&&s[0].charAt(0)==s[0].charAt(1)&&s[1].charAt(0)==s[1].charAt(1)&&s[2].charAt(0)==s[2].charAt(1)&&s[3].charAt(0)==s[3].charAt(1)?s[0].charAt(0)+s[1].charAt(0)+s[2].charAt(0)+s[3].charAt(0):s.join("")}function GP(i,e,t,n){var r=[zs(qO(n)),zs(Math.round(i).toString(16)),zs(Math.round(e).toString(16)),zs(Math.round(t).toString(16))];return r.join("")}ct.equals=function(i,e){return!i||!e?!1:ct(i).toRgbString()==ct(e).toRgbString()};ct.random=function(){return ct.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})};function UY(i,e){e=e===0?0:e||10;var t=ct(i).toHsl();return t.s-=e/100,t.s=Dv(t.s),ct(t)}function OY(i,e){e=e===0?0:e||10;var t=ct(i).toHsl();return t.s+=e/100,t.s=Dv(t.s),ct(t)}function BY(i){return ct(i).desaturate(100)}function IY(i,e){e=e===0?0:e||10;var t=ct(i).toHsl();return t.l+=e/100,t.l=Dv(t.l),ct(t)}function FY(i,e){e=e===0?0:e||10;var t=ct(i).toRgb();return t.r=Math.max(0,Math.min(255,t.r-Math.round(255*-(e/100)))),t.g=Math.max(0,Math.min(255,t.g-Math.round(255*-(e/100)))),t.b=Math.max(0,Math.min(255,t.b-Math.round(255*-(e/100)))),ct(t)}function kY(i,e){e=e===0?0:e||10;var t=ct(i).toHsl();return t.l-=e/100,t.l=Dv(t.l),ct(t)}function zY(i,e){var t=ct(i).toHsl(),n=(t.h+e)%360;return t.h=n<0?360+n:n,ct(t)}function VY(i){var e=ct(i).toHsl();return e.h=(e.h+180)%360,ct(e)}function HP(i,e){if(isNaN(e)||e<=0)throw new Error("Argument to polyad must be a positive number");for(var t=ct(i).toHsl(),n=[ct(i)],r=360/e,s=1;s<e;s++)n.push(ct({h:(t.h+s*r)%360,s:t.s,l:t.l}));return n}function GY(i){var e=ct(i).toHsl(),t=e.h;return[ct(i),ct({h:(t+72)%360,s:e.s,l:e.l}),ct({h:(t+216)%360,s:e.s,l:e.l})]}function HY(i,e,t){e=e||6,t=t||30;var n=ct(i).toHsl(),r=360/t,s=[ct(i)];for(n.h=(n.h-(r*e>>1)+720)%360;--e;)n.h=(n.h+r)%360,s.push(ct(n));return s}function WY(i,e){e=e||6;for(var t=ct(i).toHsv(),n=t.h,r=t.s,s=t.v,a=[],l=1/e;e--;)a.push(ct({h:n,s:r,v:s})),s=(s+l)%1;return a}ct.mix=function(i,e,t){t=t===0?0:t||50;var n=ct(i).toRgb(),r=ct(e).toRgb(),s=t/100,a={r:(r.r-n.r)*s+n.r,g:(r.g-n.g)*s+n.g,b:(r.b-n.b)*s+n.b,a:(r.a-n.a)*s+n.a};return ct(a)};ct.readability=function(i,e){var t=ct(i),n=ct(e);return(Math.max(t.getLuminance(),n.getLuminance())+.05)/(Math.min(t.getLuminance(),n.getLuminance())+.05)};ct.isReadable=function(i,e,t){var n=ct.readability(i,e),r,s;switch(s=!1,r=KY(t),r.level+r.size){case"AAsmall":case"AAAlarge":s=n>=4.5;break;case"AAlarge":s=n>=3;break;case"AAAsmall":s=n>=7;break}return s};ct.mostReadable=function(i,e,t){var n=null,r=0,s,a,l,u;t=t||{},a=t.includeFallbackColors,l=t.level,u=t.size;for(var h=0;h<e.length;h++)s=ct.readability(i,e[h]),s>r&&(r=s,n=ct(e[h]));return ct.isReadable(i,n,{level:l,size:u})||!a?n:(t.includeFallbackColors=!1,ct.mostReadable(i,["#fff","#000"],t))};var eT=ct.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},jY=ct.hexNames=qY(eT);function qY(i){var e={};for(var t in i)i.hasOwnProperty(t)&&(e[i[t]]=t);return e}function jO(i){return i=parseFloat(i),(isNaN(i)||i<0||i>1)&&(i=1),i}function Bn(i,e){$Y(i)&&(i="100%");var t=XY(i);return i=Math.min(e,Math.max(0,parseFloat(i))),t&&(i=parseInt(i*e,10)/100),Math.abs(i-e)<1e-6?1:i%e/parseFloat(e)}function Dv(i){return Math.min(1,Math.max(0,i))}function Zr(i){return parseInt(i,16)}function $Y(i){return typeof i=="string"&&i.indexOf(".")!=-1&&parseFloat(i)===1}function XY(i){return typeof i=="string"&&i.indexOf("%")!=-1}function zs(i){return i.length==1?"0"+i:""+i}function Cd(i){return i<=1&&(i=i*100+"%"),i}function qO(i){return Math.round(parseFloat(i)*255).toString(16)}function WP(i){return Zr(i)/255}var Ds=function(){var i="[-\\+]?\\d+%?",e="[-\\+]?\\d*\\.\\d+%?",t="(?:"+e+")|(?:"+i+")",n="[\\s|\\(]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")\\s*\\)?",r="[\\s|\\(]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")\\s*\\)?";return{CSS_UNIT:new RegExp(t),rgb:new RegExp("rgb"+n),rgba:new RegExp("rgba"+r),hsl:new RegExp("hsl"+n),hsla:new RegExp("hsla"+r),hsv:new RegExp("hsv"+n),hsva:new RegExp("hsva"+r),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();function Wa(i){return!!Ds.CSS_UNIT.exec(i)}function YY(i){i=i.replace(wY,"").replace(RY,"").toLowerCase();var e=!1;if(eT[i])i=eT[i],e=!0;else if(i=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};var t;return(t=Ds.rgb.exec(i))?{r:t[1],g:t[2],b:t[3]}:(t=Ds.rgba.exec(i))?{r:t[1],g:t[2],b:t[3],a:t[4]}:(t=Ds.hsl.exec(i))?{h:t[1],s:t[2],l:t[3]}:(t=Ds.hsla.exec(i))?{h:t[1],s:t[2],l:t[3],a:t[4]}:(t=Ds.hsv.exec(i))?{h:t[1],s:t[2],v:t[3]}:(t=Ds.hsva.exec(i))?{h:t[1],s:t[2],v:t[3],a:t[4]}:(t=Ds.hex8.exec(i))?{r:Zr(t[1]),g:Zr(t[2]),b:Zr(t[3]),a:WP(t[4]),format:e?"name":"hex8"}:(t=Ds.hex6.exec(i))?{r:Zr(t[1]),g:Zr(t[2]),b:Zr(t[3]),format:e?"name":"hex"}:(t=Ds.hex4.exec(i))?{r:Zr(t[1]+""+t[1]),g:Zr(t[2]+""+t[2]),b:Zr(t[3]+""+t[3]),a:WP(t[4]+""+t[4]),format:e?"name":"hex8"}:(t=Ds.hex3.exec(i))?{r:Zr(t[1]+""+t[1]),g:Zr(t[2]+""+t[2]),b:Zr(t[3]+""+t[3]),format:e?"name":"hex"}:!1}function KY(i){var e,t;return i=i||{level:"AA",size:"small"},e=(i.level||"AA").toUpperCase(),t=(i.size||"small").toLowerCase(),e!=="AA"&&e!=="AAA"&&(e="AA"),t!=="small"&&t!=="large"&&(t="small"),{level:e,size:t}}function tT(i,e){(e==null||e>i.length)&&(e=i.length);for(var t=0,n=Array(e);t<e;t++)n[t]=i[t];return n}function ZY(i){if(Array.isArray(i))return i}function QY(i){if(Array.isArray(i))return tT(i)}function $O(i,e,t){if(typeof i=="function"?i===e:i.has(e))return arguments.length<3?e:t;throw new TypeError("Private element is not present on this object")}function JY(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function XO(i,e,t){return e=Dh(e),oK(i,uE()?Reflect.construct(e,t||[],Dh(i).constructor):e.apply(i,t))}function eK(i,e){if(e.has(i))throw new TypeError("Cannot initialize the same private elements twice on an object")}function YO(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function mb(i,e){return i.get($O(i,e))}function jP(i,e,t){eK(i,e),e.set(i,t)}function qP(i,e,t){return i.set($O(i,e),t),t}function KO(i,e,t){if(uE())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,e);var r=new(i.bind.apply(i,n));return r}function tK(i,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,JO(n.key),n)}}function ZO(i,e,t){return e&&tK(i.prototype,e),Object.defineProperty(i,"prototype",{writable:!1}),i}function Lv(i,e,t){return(e=JO(e))in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function nT(){return nT=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(i,e,t){var n=lK(i,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(arguments.length<3?i:t):r.value}},nT.apply(null,arguments)}function Dh(i){return Dh=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Dh(i)}function QO(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(e&&e.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Object.defineProperty(i,"prototype",{writable:!1}),e&&iT(i,e)}function uE(){try{var i=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(uE=function(){return!!i})()}function nK(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function iK(i,e){var t=i==null?null:typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(t!=null){var n,r,s,a,l=[],u=!0,h=!1;try{if(s=(t=t.call(i)).next,e!==0)for(;!(u=(n=s.call(t)).done)&&(l.push(n.value),l.length!==e);u=!0);}catch(d){h=!0,r=d}finally{try{if(!u&&t.return!=null&&(a=t.return(),Object(a)!==a))return}finally{if(h)throw r}}return l}}function rK(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function sK(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function $P(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);e&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(i,r).enumerable})),t.push.apply(t,n)}return t}function aK(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?$P(Object(t),!0).forEach(function(n){Lv(i,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):$P(Object(t)).forEach(function(n){Object.defineProperty(i,n,Object.getOwnPropertyDescriptor(t,n))})}return i}function oK(i,e){if(e&&(typeof e=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return JY(i)}function iT(i,e){return iT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t},iT(i,e)}function jd(i,e){return ZY(i)||iK(i,e)||eB(i,e)||rK()}function lK(i,e){for(;!{}.hasOwnProperty.call(i,e)&&(i=Dh(i))!==null;);return i}function gb(i,e,t,n){var r=nT(Dh(i.prototype),e,t);return typeof r=="function"?function(s){return r.apply(t,s)}:r}function Os(i){return QY(i)||nK(i)||eB(i)||sK()}function uK(i,e){if(typeof i!="object"||!i)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var n=t.call(i,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function JO(i){var e=uK(i,"string");return typeof e=="symbol"?e:e+""}function rT(i){"@babel/helpers - typeof";return rT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},rT(i)}function eB(i,e){if(i){if(typeof i=="string")return tT(i,e);var t={}.toString.call(i).slice(8,-1);return t==="Object"&&i.constructor&&(t=i.constructor.name),t==="Map"||t==="Set"?Array.from(i):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?tT(i,e):void 0}}var tB=function(e){e instanceof Array?e.forEach(tB):(e.map&&e.map.dispose(),e.dispose())},nB=function(e){e.geometry&&e.geometry.dispose(),e.material&&tB(e.material),e.texture&&e.texture.dispose(),e.children&&e.children.forEach(nB)},sT=function(e){for(;e.children.length;){var t=e.children[0];e.remove(t),nB(t)}},yb=new WeakMap,Yg=new WeakMap,ud=function(i){function e(t){var n,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=r.dataBindAttr,a=s===void 0?"__data":s,l=r.objBindAttr,u=l===void 0?"__threeObj":l;return YO(this,e),n=XO(this,e),Lv(n,"scene",void 0),jP(n,yb,void 0),jP(n,Yg,void 0),n.scene=t,qP(yb,n,a),qP(Yg,n,u),n.onRemoveObj(function(){}),n}return QO(e,i),ZO(e,[{key:"onCreateObj",value:function(n){var r=this;return gb(e,"onCreateObj",this)([function(s){var a=n(s);return s[mb(Yg,r)]=a,a[mb(yb,r)]=s,r.scene.add(a),a}]),this}},{key:"onRemoveObj",value:function(n){var r=this;return gb(e,"onRemoveObj",this)([function(s,a){var l=gb(e,"getData",r)([s]);n(s,a),r.scene.remove(s),sT(s),delete l[mb(Yg,r)]}]),this}}])}(TY),cd=function(e){return isNaN(e)?parseInt(ct(e).toHex(),16):e},vb=function(e){return isNaN(e)?ct(e).getAlpha():1},cK=WO(AY);function XP(i,e,t){!e||typeof t!="string"||i.filter(function(n){return!n[t]}).forEach(function(n){n[t]=cK(e(n))})}function hK(i,e){var t=i.nodes,n=i.links,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=r.nodeFilter,a=s===void 0?function(){return!0}:s,l=r.onLoopError,u=l===void 0?function(y){throw"Invalid DAG structure! Found cycle in node path: ".concat(y.join(" -> "),".")}:l,h={};t.forEach(function(y){return h[e(y)]={data:y,out:[],depth:-1,skip:!a(y)}}),n.forEach(function(y){var v=y.source,S=y.target,b=A(v),_=A(S);if(!h.hasOwnProperty(b))throw"Missing source node with id: ".concat(b);if(!h.hasOwnProperty(_))throw"Missing target node with id: ".concat(_);var E=h[b],M=h[_];E.out.push(M);function A(w){return rT(w)==="object"?e(w):w}});var d=[];g(Object.values(h));var p=Object.assign.apply(Object,[{}].concat(Os(Object.entries(h).filter(function(y){var v=jd(y,2),S=v[1];return!S.skip}).map(function(y){var v=jd(y,2),S=v[0],b=v[1];return Lv({},S,b.depth)}))));return p;function g(y){for(var v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],S=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,b=function(){var A=y[_];if(v.indexOf(A)!==-1){var w=[].concat(Os(v.slice(v.indexOf(A))),[A]).map(function(R){return e(R.data)});return d.some(function(R){return R.length===w.length&&R.every(function(C,L){return C===w[L]})})||(d.push(w),u(w)),1}S>A.depth&&(A.depth=S,g(A.out,[].concat(Os(v),[A]),S+(A.skip?0:1)))},_=0,E=y.length;_<E;_++)b()}}var xt=window.THREE?window.THREE:{Group:jc,Mesh:fi,MeshLambertMaterial:fO,Color:ot,BufferGeometry:ar,BufferAttribute:Wi,Matrix4:Wt,Vector3:V,SphereGeometry:Xp,CylinderGeometry:qp,TubeGeometry:eE,ConeGeometry:ZM,Line:v8,LineBasicMaterial:Av,QuadraticBezierCurve3:JM,CubicBezierCurve3:cO,Box3:Pu},YP={graph:h7,forcelayout:T7},fK=2,_b=new xt.BufferGeometry().setAttribute?"setAttribute":"addAttribute",Kg=new xt.BufferGeometry().applyMatrix4?"applyMatrix4":"applyMatrix",dK=Pv({props:{jsonUrl:{onChange:function(e,t){var n=this;e&&!t.fetchingJson&&(t.fetchingJson=!0,t.onLoading(),fetch(e).then(function(r){return r.json()}).then(function(r){t.fetchingJson=!1,t.onFinishLoading(r),n.graphData(r)}))},triggerUpdate:!1},graphData:{default:{nodes:[],links:[]},onChange:function(e,t){t.engineRunning=!1}},numDimensions:{default:3,onChange:function(e,t){var n=t.d3ForceLayout.force("charge");n&&n.strength(e>2?-60:-30),e<3&&r(t.graphData.nodes,"z"),e<2&&r(t.graphData.nodes,"y");function r(s,a){s.forEach(function(l){delete l[a],delete l["v".concat(a)]})}}},dagMode:{onChange:function(e,t){!e&&t.forceEngine==="d3"&&(t.graphData.nodes||[]).forEach(function(n){return n.fx=n.fy=n.fz=void 0})}},dagLevelDistance:{},dagNodeFilter:{default:function(e){return!0}},onDagError:{triggerUpdate:!1},nodeRelSize:{default:4},nodeId:{default:"id"},nodeVal:{default:"val"},nodeResolution:{default:8},nodeColor:{default:"color"},nodeAutoColorBy:{},nodeOpacity:{default:.75},nodeVisibility:{default:!0},nodeThreeObject:{},nodeThreeObjectExtend:{default:!1},nodePositionUpdate:{triggerUpdate:!1},linkSource:{default:"source"},linkTarget:{default:"target"},linkVisibility:{default:!0},linkColor:{default:"color"},linkAutoColorBy:{},linkOpacity:{default:.2},linkWidth:{},linkResolution:{default:6},linkCurvature:{default:0,triggerUpdate:!1},linkCurveRotation:{default:0,triggerUpdate:!1},linkMaterial:{},linkThreeObject:{},linkThreeObjectExtend:{default:!1},linkPositionUpdate:{triggerUpdate:!1},linkDirectionalArrowLength:{default:0},linkDirectionalArrowColor:{},linkDirectionalArrowRelPos:{default:.5,triggerUpdate:!1},linkDirectionalArrowResolution:{default:8},linkDirectionalParticles:{default:0},linkDirectionalParticleSpeed:{default:.01,triggerUpdate:!1},linkDirectionalParticleWidth:{default:.5},linkDirectionalParticleColor:{},linkDirectionalParticleResolution:{default:4},forceEngine:{default:"d3"},d3AlphaMin:{default:0},d3AlphaDecay:{default:.0228,triggerUpdate:!1,onChange:function(e,t){t.d3ForceLayout.alphaDecay(e)}},d3AlphaTarget:{default:0,triggerUpdate:!1,onChange:function(e,t){t.d3ForceLayout.alphaTarget(e)}},d3VelocityDecay:{default:.4,triggerUpdate:!1,onChange:function(e,t){t.d3ForceLayout.velocityDecay(e)}},ngraphPhysics:{default:{timeStep:20,gravity:-1.2,theta:.8,springLength:30,springCoefficient:8e-4,dragCoefficient:.02}},warmupTicks:{default:0,triggerUpdate:!1},cooldownTicks:{default:1/0,triggerUpdate:!1},cooldownTime:{default:15e3,triggerUpdate:!1},onLoading:{default:function(){},triggerUpdate:!1},onFinishLoading:{default:function(){},triggerUpdate:!1},onUpdate:{default:function(){},triggerUpdate:!1},onFinishUpdate:{default:function(){},triggerUpdate:!1},onEngineTick:{default:function(){},triggerUpdate:!1},onEngineStop:{default:function(){},triggerUpdate:!1}},methods:{refresh:function(e){return e._flushObjects=!0,e._rerender(),this},d3Force:function(e,t,n){return n===void 0?e.d3ForceLayout.force(t):(e.d3ForceLayout.force(t,n),this)},d3ReheatSimulation:function(e){return e.d3ForceLayout.alpha(1),this.resetCountdown(),this},resetCountdown:function(e){return e.cntTicks=0,e.startTickTime=new Date,e.engineRunning=!0,this},tickFrame:function(e){var t=e.forceEngine!=="ngraph";return e.engineRunning&&n(),r(),s(),this;function n(){++e.cntTicks>e.cooldownTicks||new Date-e.startTickTime>e.cooldownTime||t&&e.d3AlphaMin>0&&e.d3ForceLayout.alpha()<e.d3AlphaMin?(e.engineRunning=!1,e.onEngineStop()):(e.layout[t?"tick":"step"](),e.onEngineTick());var a=tn(e.nodeThreeObjectExtend);e.nodeDataMapper.entries().forEach(function(g){var y=jd(g,2),v=y[0],S=y[1];if(S){var b=t?v:e.layout.getNodePosition(v[e.nodeId]),_=a(v);(!e.nodePositionUpdate||!e.nodePositionUpdate(_?S.children[0]:S,{x:b.x,y:b.y,z:b.z},v)||_)&&(S.position.x=b.x,S.position.y=b.y||0,S.position.z=b.z||0)}});var l=tn(e.linkWidth),u=tn(e.linkCurvature),h=tn(e.linkCurveRotation),d=tn(e.linkThreeObjectExtend);e.linkDataMapper.entries().forEach(function(g){var y=jd(g,2),v=y[0],S=y[1];if(S){var b=t?v:e.layout.getLinkPosition(e.layout.graph.getLink(v.source,v.target).id),_=b[t?"source":"from"],E=b[t?"target":"to"];if(!(!_||!E||!_.hasOwnProperty("x")||!E.hasOwnProperty("x"))){p(v);var M=d(v);if(!(e.linkPositionUpdate&&e.linkPositionUpdate(M?S.children[1]:S,{start:{x:_.x,y:_.y,z:_.z},end:{x:E.x,y:E.y,z:E.z}},v)&&!M)){var A=30,w=v.__curve,R=S.children.length?S.children[0]:S;if(R.type==="Line"){if(w){var L=w.getPoints(A);R.geometry.getAttribute("position").array.length!==L.length*3&&R.geometry[_b]("position",new xt.BufferAttribute(new Float32Array(L.length*3),3)),R.geometry.setFromPoints(L)}else{var C=R.geometry.getAttribute("position");(!C||!C.array||C.array.length!==6)&&R.geometry[_b]("position",C=new xt.BufferAttribute(new Float32Array(2*3),3)),C.array[0]=_.x,C.array[1]=_.y||0,C.array[2]=_.z||0,C.array[3]=E.x,C.array[4]=E.y||0,C.array[5]=E.z||0,C.needsUpdate=!0}R.geometry.computeBoundingSphere()}else if(R.type==="Mesh")if(w){R.geometry.type.match(/^Tube(Buffer)?Geometry$/)||(R.position.set(0,0,0),R.rotation.set(0,0,0),R.scale.set(1,1,1));var le=Math.ceil(l(v)*10)/10,z=le/2,k=new xt.TubeGeometry(w,A,z,e.linkResolution,!1);R.geometry.dispose(),R.geometry=k}else{if(!R.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)){var N=Math.ceil(l(v)*10)/10,D=N/2,I=new xt.CylinderGeometry(D,D,1,e.linkResolution,1,!1);I[Kg](new xt.Matrix4().makeTranslation(0,1/2,0)),I[Kg](new xt.Matrix4().makeRotationX(Math.PI/2)),R.geometry.dispose(),R.geometry=I}var W=new xt.Vector3(_.x,_.y||0,_.z||0),Y=new xt.Vector3(E.x,E.y||0,E.z||0),oe=W.distanceTo(Y);R.position.x=W.x,R.position.y=W.y,R.position.z=W.z,R.scale.z=oe,R.parent.localToWorld(Y),R.lookAt(Y)}}}}});function p(g){var y=t?g:e.layout.getLinkPosition(e.layout.graph.getLink(g.source,g.target).id),v=y[t?"source":"from"],S=y[t?"target":"to"];if(!(!v||!S||!v.hasOwnProperty("x")||!S.hasOwnProperty("x"))){var b=u(g);if(!b)g.__curve=null;else{var _=new xt.Vector3(v.x,v.y||0,v.z||0),E=new xt.Vector3(S.x,S.y||0,S.z||0),M=_.distanceTo(E),A,w=h(g);if(M>0){var R=S.x-v.x,C=S.y-v.y||0,L=new xt.Vector3().subVectors(E,_),N=L.clone().multiplyScalar(b).cross(R!==0||C!==0?new xt.Vector3(0,0,1):new xt.Vector3(0,1,0)).applyAxisAngle(L.normalize(),w).add(new xt.Vector3().addVectors(_,E).divideScalar(2));A=new xt.QuadraticBezierCurve3(_,N,E)}else{var D=b*70,I=-w,W=I+Math.PI/2;A=new xt.CubicBezierCurve3(_,new xt.Vector3(D*Math.cos(W),D*Math.sin(W),0).add(_),new xt.Vector3(D*Math.cos(I),D*Math.sin(I),0).add(_),E)}g.__curve=A}}}}function r(){var a=tn(e.linkDirectionalArrowRelPos),l=tn(e.linkDirectionalArrowLength),u=tn(e.nodeVal);e.arrowDataMapper.entries().forEach(function(h){var d=jd(h,2),p=d[0],g=d[1];if(g){var y=t?p:e.layout.getLinkPosition(e.layout.graph.getLink(p.source,p.target).id),v=y[t?"source":"from"],S=y[t?"target":"to"];if(!(!v||!S||!v.hasOwnProperty("x")||!S.hasOwnProperty("x"))){var b=Math.cbrt(Math.max(0,u(v)||1))*e.nodeRelSize,_=Math.cbrt(Math.max(0,u(S)||1))*e.nodeRelSize,E=l(p),M=a(p),A=p.__curve?function(D){return p.__curve.getPoint(D)}:function(D){var I=function(Y,oe,le,z){return oe[Y]+(le[Y]-oe[Y])*z||0};return{x:I("x",v,S,D),y:I("y",v,S,D),z:I("z",v,S,D)}},w=p.__curve?p.__curve.getLength():Math.sqrt(["x","y","z"].map(function(D){return Math.pow((S[D]||0)-(v[D]||0),2)}).reduce(function(D,I){return D+I},0)),R=b+E+(w-b-_-E)*M,C=A(R/w),L=A((R-E)/w);["x","y","z"].forEach(function(D){return g.position[D]=L[D]});var N=KO(xt.Vector3,Os(["x","y","z"].map(function(D){return C[D]})));g.parent.localToWorld(N),g.lookAt(N)}}})}function s(){var a=tn(e.linkDirectionalParticleSpeed);e.graphData.links.forEach(function(l){var u=e.particlesDataMapper.getObj(l),h=u&&u.children,d=l.__singleHopPhotonsObj&&l.__singleHopPhotonsObj.children;if(!((!d||!d.length)&&(!h||!h.length))){var p=t?l:e.layout.getLinkPosition(e.layout.graph.getLink(l.source,l.target).id),g=p[t?"source":"from"],y=p[t?"target":"to"];if(!(!g||!y||!g.hasOwnProperty("x")||!y.hasOwnProperty("x"))){var v=a(l),S=l.__curve?function(_){return l.__curve.getPoint(_)}:function(_){var E=function(A,w,R,C){return w[A]+(R[A]-w[A])*C||0};return{x:E("x",g,y,_),y:E("y",g,y,_),z:E("z",g,y,_)}},b=[].concat(Os(h||[]),Os(d||[]));b.forEach(function(_,E){var M=_.parent.__linkThreeObjType==="singleHopPhotons";if(_.hasOwnProperty("__progressRatio")||(_.__progressRatio=M?0:E/h.length),_.__progressRatio+=v,_.__progressRatio>=1)if(!M)_.__progressRatio=_.__progressRatio%1;else{_.parent.remove(_),sT(_);return}var A=_.__progressRatio,w=S(A);["x","y","z"].forEach(function(R){return _.position[R]=w[R]})})}}})}},emitParticle:function(e,t){if(t&&e.graphData.links.includes(t)){if(!t.__singleHopPhotonsObj){var n=new xt.Group;n.__linkThreeObjType="singleHopPhotons",t.__singleHopPhotonsObj=n,e.graphScene.add(n)}var r=tn(e.linkDirectionalParticleWidth),s=Math.ceil(r(t)*10)/10/2,a=e.linkDirectionalParticleResolution,l=new xt.SphereGeometry(s,a,a),u=tn(e.linkColor),h=tn(e.linkDirectionalParticleColor),d=h(t)||u(t)||"#f0f0f0",p=new xt.Color(cd(d)),g=e.linkOpacity*3,y=new xt.MeshLambertMaterial({color:p,transparent:!0,opacity:g});t.__singleHopPhotonsObj.add(new xt.Mesh(l,y))}return this},getGraphBbox:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){return!0};if(!e.initialised)return null;var n=function r(s){var a=[];if(s.geometry){s.geometry.computeBoundingBox();var l=new xt.Box3;l.copy(s.geometry.boundingBox).applyMatrix4(s.matrixWorld),a.push(l)}return a.concat.apply(a,Os((s.children||[]).filter(function(u){return!u.hasOwnProperty("__graphObjType")||u.__graphObjType==="node"&&t(u.__data)}).map(r)))}(e.graphScene);return n.length?Object.assign.apply(Object,Os(["x","y","z"].map(function(r){return Lv({},r,[lY(n,function(s){return s.min[r]}),oY(n,function(s){return s.max[r]})])}))):null}},stateInit:function(){return{d3ForceLayout:a7().force("link",jX()).force("charge",o7()).force("center",$$()).force("dagRadial",null).stop(),engineRunning:!1}},init:function(e,t){t.graphScene=e,t.nodeDataMapper=new ud(e,{objBindAttr:"__threeObj"}),t.linkDataMapper=new ud(e,{objBindAttr:"__lineObj"}),t.arrowDataMapper=new ud(e,{objBindAttr:"__arrowObj"}),t.particlesDataMapper=new ud(e,{objBindAttr:"__photonsObj"})},update:function(e,t){var n=function(Z){return Z.some(function($){return t.hasOwnProperty($)})};if(e.engineRunning=!1,typeof e.onUpdate=="function"&&e.onUpdate(),e.nodeAutoColorBy!==null&&n(["nodeAutoColorBy","graphData","nodeColor"])&&XP(e.graphData.nodes,tn(e.nodeAutoColorBy),e.nodeColor),e.linkAutoColorBy!==null&&n(["linkAutoColorBy","graphData","linkColor"])&&XP(e.graphData.links,tn(e.linkAutoColorBy),e.linkColor),e._flushObjects||n(["graphData","nodeThreeObject","nodeThreeObjectExtend","nodeVal","nodeColor","nodeVisibility","nodeRelSize","nodeResolution","nodeOpacity"])){var r=tn(e.nodeThreeObject),s=tn(e.nodeThreeObjectExtend),a=tn(e.nodeVal),l=tn(e.nodeColor),u=tn(e.nodeVisibility),h={},d={};(e._flushObjects||n(["nodeThreeObject","nodeThreeObjectExtend"]))&&e.nodeDataMapper.clear(),e.nodeDataMapper.onCreateObj(function(j){var Z=r(j),$=s(j);Z&&e.nodeThreeObject===Z&&(Z=Z.clone());var ne;return Z&&!$?ne=Z:(ne=new xt.Mesh,ne.__graphDefaultObj=!0,Z&&$&&ne.add(Z)),ne.__graphObjType="node",ne}).onUpdateObj(function(j,Z){if(j.__graphDefaultObj){var $=a(Z)||1,ne=Math.cbrt($)*e.nodeRelSize,ve=e.nodeResolution;(!j.geometry.type.match(/^Sphere(Buffer)?Geometry$/)||j.geometry.parameters.radius!==ne||j.geometry.parameters.widthSegments!==ve)&&(h.hasOwnProperty($)||(h[$]=new xt.SphereGeometry(ne,ve,ve)),j.geometry.dispose(),j.geometry=h[$]);var He=l(Z),Ve=new xt.Color(cd(He||"#ffffaa")),st=e.nodeOpacity*vb(He);(j.material.type!=="MeshLambertMaterial"||!j.material.color.equals(Ve)||j.material.opacity!==st)&&(d.hasOwnProperty(He)||(d[He]=new xt.MeshLambertMaterial({color:Ve,transparent:!0,opacity:st})),j.material.dispose(),j.material=d[He])}}).digest(e.graphData.nodes.filter(u))}if(e._flushObjects||n(["graphData","linkThreeObject","linkThreeObjectExtend","linkMaterial","linkColor","linkWidth","linkVisibility","linkResolution","linkOpacity","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution"])){var p=tn(e.linkThreeObject),g=tn(e.linkThreeObjectExtend),y=tn(e.linkMaterial),v=tn(e.linkVisibility),S=tn(e.linkColor),b=tn(e.linkWidth),_={},E={},M={},A=e.graphData.links.filter(v);if((e._flushObjects||n(["linkThreeObject","linkThreeObjectExtend","linkWidth"]))&&e.linkDataMapper.clear(),e.linkDataMapper.onRemoveObj(function(j){var Z=j.__data&&j.__data.__singleHopPhotonsObj;Z&&(Z.parent.remove(Z),sT(Z),delete j.__data.__singleHopPhotonsObj)}).onCreateObj(function(j){var Z=p(j),$=g(j);Z&&e.linkThreeObject===Z&&(Z=Z.clone());var ne;if(!Z||$){var ve=!!b(j);if(ve)ne=new xt.Mesh;else{var He=new xt.BufferGeometry;He[_b]("position",new xt.BufferAttribute(new Float32Array(2*3),3)),ne=new xt.Line(He)}}var Ve;return Z?$?(Ve=new xt.Group,Ve.__graphDefaultObj=!0,Ve.add(ne),Ve.add(Z)):Ve=Z:(Ve=ne,Ve.__graphDefaultObj=!0),Ve.renderOrder=10,Ve.__graphObjType="link",Ve}).onUpdateObj(function(j,Z){if(j.__graphDefaultObj){var $=j.children.length?j.children[0]:j,ne=Math.ceil(b(Z)*10)/10,ve=!!ne;if(ve){var He=ne/2,Ve=e.linkResolution;if(!$.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)||$.geometry.parameters.radiusTop!==He||$.geometry.parameters.radialSegments!==Ve){if(!_.hasOwnProperty(ne)){var st=new xt.CylinderGeometry(He,He,1,Ve,1,!1);st[Kg](new xt.Matrix4().makeTranslation(0,1/2,0)),st[Kg](new xt.Matrix4().makeRotationX(Math.PI/2)),_[ne]=st}$.geometry.dispose(),$.geometry=_[ne]}}var Lt=y(Z);if(Lt)$.material=Lt;else{var Rt=S(Z),X=new xt.Color(cd(Rt||"#f0f0f0")),mn=e.linkOpacity*vb(Rt),jt=ve?"MeshLambertMaterial":"LineBasicMaterial";if($.material.type!==jt||!$.material.color.equals(X)||$.material.opacity!==mn){var Ft=ve?E:M;Ft.hasOwnProperty(Rt)||(Ft[Rt]=new xt[jt]({color:X,transparent:mn<1,opacity:mn,depthWrite:mn>=1})),$.material.dispose(),$.material=Ft[Rt]}}}}).digest(A),e.linkDirectionalArrowLength||t.hasOwnProperty("linkDirectionalArrowLength")){var w=tn(e.linkDirectionalArrowLength),R=tn(e.linkDirectionalArrowColor);e.arrowDataMapper.onCreateObj(function(){var j=new xt.Mesh(void 0,new xt.MeshLambertMaterial({transparent:!0}));return j.__linkThreeObjType="arrow",j}).onUpdateObj(function(j,Z){var $=w(Z),ne=e.linkDirectionalArrowResolution;if(!j.geometry.type.match(/^Cone(Buffer)?Geometry$/)||j.geometry.parameters.height!==$||j.geometry.parameters.radialSegments!==ne){var ve=new xt.ConeGeometry($*.25,$,ne);ve.translate(0,$/2,0),ve.rotateX(Math.PI/2),j.geometry.dispose(),j.geometry=ve}var He=R(Z)||S(Z)||"#f0f0f0";j.material.color=new xt.Color(cd(He)),j.material.opacity=e.linkOpacity*3*vb(He)}).digest(A.filter(w))}if(e.linkDirectionalParticles||t.hasOwnProperty("linkDirectionalParticles")){var C=tn(e.linkDirectionalParticles),L=tn(e.linkDirectionalParticleWidth),N=tn(e.linkDirectionalParticleColor),D={},I={};e.particlesDataMapper.onCreateObj(function(){var j=new xt.Group;return j.__linkThreeObjType="photons",j.__photonDataMapper=new ud(j),j}).onUpdateObj(function(j,Z){var $=Math.round(Math.abs(C(Z))),ne=!!j.children.length&&j.children[0],ve=Math.ceil(L(Z)*10)/10/2,He=e.linkDirectionalParticleResolution,Ve;ne&&ne.geometry.parameters.radius===ve&&ne.geometry.parameters.widthSegments===He?Ve=ne.geometry:(I.hasOwnProperty(ve)||(I[ve]=new xt.SphereGeometry(ve,He,He)),Ve=I[ve],ne&&ne.geometry.dispose());var st=N(Z)||S(Z)||"#f0f0f0",Lt=new xt.Color(cd(st)),Rt=e.linkOpacity*3,X;ne&&ne.material.color.equals(Lt)&&ne.material.opacity===Rt?X=ne.material:(D.hasOwnProperty(st)||(D[st]=new xt.MeshLambertMaterial({color:Lt,transparent:!0,opacity:Rt})),X=D[st],ne&&ne.material.dispose()),j.__photonDataMapper.id(function(mn){return mn.idx}).onCreateObj(function(){return new xt.Mesh(Ve,X)}).onUpdateObj(function(mn){mn.geometry=Ve,mn.material=X}).digest(Os(new Array($)).map(function(mn,jt){return{idx:jt}}))}).digest(A.filter(C))}}if(e._flushObjects=!1,n(["graphData","nodeId","linkSource","linkTarget","numDimensions","forceEngine","dagMode","dagNodeFilter","dagLevelDistance"])){e.engineRunning=!1,e.graphData.links.forEach(function(j){j.source=j[e.linkSource],j.target=j[e.linkTarget]});var W=e.forceEngine!=="ngraph",Y;if(W){(Y=e.d3ForceLayout).stop().alpha(1).numDimensions(e.numDimensions).nodes(e.graphData.nodes);var oe=e.d3ForceLayout.force("link");oe&&oe.id(function(j){return j[e.nodeId]}).links(e.graphData.links);var le=e.dagMode&&hK(e.graphData,function(j){return j[e.nodeId]},{nodeFilter:e.dagNodeFilter,onLoopError:e.onDagError||void 0}),z=Math.max.apply(Math,Os(Object.values(le||[]))),k=e.dagLevelDistance||e.graphData.nodes.length/(z||1)*fK*(["radialin","radialout"].indexOf(e.dagMode)!==-1?.7:1);if(["lr","rl","td","bu","zin","zout"].includes(t.dagMode)){var G=["lr","rl"].includes(t.dagMode)?"fx":["td","bu"].includes(t.dagMode)?"fy":"fz";e.graphData.nodes.filter(e.dagNodeFilter).forEach(function(j){return delete j[G]})}if(["lr","rl","td","bu","zin","zout"].includes(e.dagMode)){var he=["rl","td","zout"].includes(e.dagMode),F=function(Z){return(le[Z[e.nodeId]]-z/2)*k*(he?-1:1)},se=["lr","rl"].includes(e.dagMode)?"fx":["td","bu"].includes(e.dagMode)?"fy":"fz";e.graphData.nodes.filter(e.dagNodeFilter).forEach(function(j){return j[se]=F(j)})}e.d3ForceLayout.force("dagRadial",["radialin","radialout"].indexOf(e.dagMode)!==-1?l7(function(j){var Z=le[j[e.nodeId]]||-1;return(e.dagMode==="radialin"?z-Z:Z)*k}).strength(function(j){return e.dagNodeFilter(j)?1:0}):null)}else{var Me=YP.graph();e.graphData.nodes.forEach(function(j){Me.addNode(j[e.nodeId])}),e.graphData.links.forEach(function(j){Me.addLink(j.source,j.target)}),Y=YP.forcelayout(Me,aK({dimensions:e.numDimensions},e.ngraphPhysics)),Y.graph=Me}for(var De=0;De<e.warmupTicks&&!(W&&e.d3AlphaMin>0&&e.d3ForceLayout.alpha()<e.d3AlphaMin);De++)Y[W?"tick":"step"]();e.layout=Y,this.resetCountdown()}e.engineRunning=!0,e.onFinishUpdate()}});function pK(i){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Object,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,n=function(r){function s(){var a;YO(this,s);for(var l=arguments.length,u=new Array(l),h=0;h<l;h++)u[h]=arguments[h];return a=XO(this,s,[].concat(u)),a.__kapsuleInstance=KO(i,[].concat(Os(t?[a]:[]),u)),a}return QO(s,r),ZO(s)}(e);return Object.keys(i()).forEach(function(r){return n.prototype[r]=function(){var s,a=(s=this.__kapsuleInstance)[r].apply(s,arguments);return a===this.__kapsuleInstance?this:a}}),n}var mK=window.THREE?window.THREE:{Group:jc},iB=pK(dK,mK.Group,!0);/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const gK=["alphaMap","alphaTest","anisotropy","anisotropyMap","anisotropyRotation","aoMap","aoMapIntensity","attenuationColor","attenuationDistance","bumpMap","clearcoat","clearcoatMap","clearcoatNormalMap","clearcoatNormalScale","clearcoatRoughness","color","dispersion","displacementMap","emissive","emissiveIntensity","emissiveMap","envMap","envMapIntensity","gradientMap","ior","iridescence","iridescenceIOR","iridescenceMap","iridescenceThicknessMap","lightMap","lightMapIntensity","map","matcap","metalness","metalnessMap","normalMap","normalScale","opacity","roughness","roughnessMap","sheen","sheenColor","sheenColorMap","sheenRoughnessMap","shininess","specular","specularColor","specularColorMap","specularIntensity","specularIntensityMap","specularMap","thickness","transmission","transmissionMap"];class yK{constructor(e){this.renderObjects=new WeakMap,this.hasNode=this.containsNode(e),this.hasAnimation=e.object.isSkinnedMesh===!0,this.refreshUniforms=gK,this.renderId=0}firstInitialization(e){return this.renderObjects.has(e)===!1?(this.getRenderObjectData(e),!0):!1}needsVelocity(e){const t=e.getMRT();return t!==null&&t.has("velocity")}getRenderObjectData(e){let t=this.renderObjects.get(e);if(t===void 0){const{geometry:n,material:r,object:s}=e;if(t={material:this.getMaterialData(r),geometry:{id:n.id,attributes:this.getAttributesData(n.attributes),indexVersion:n.index?n.index.version:null,drawRange:{start:n.drawRange.start,count:n.drawRange.count}},worldMatrix:s.matrixWorld.clone()},s.center&&(t.center=s.center.clone()),s.morphTargetInfluences&&(t.morphTargetInfluences=s.morphTargetInfluences.slice()),e.bundle!==null&&(t.version=e.bundle.version),t.material.transmission>0){const{width:a,height:l}=e.context;t.bufferWidth=a,t.bufferHeight=l}this.renderObjects.set(e,t)}return t}getAttributesData(e){const t={};for(const n in e){const r=e[n];t[n]={version:r.version}}return t}containsNode(e){const t=e.material;for(const n in t)if(t[n]&&t[n].isNode)return!0;return e.renderer.overrideNodes.modelViewMatrix!==null||e.renderer.overrideNodes.modelNormalViewMatrix!==null}getMaterialData(e){const t={};for(const n of this.refreshUniforms){const r=e[n];r!=null&&(typeof r=="object"&&r.clone!==void 0?r.isTexture===!0?t[n]={id:r.id,version:r.version}:t[n]=r.clone():t[n]=r)}return t}equals(e){const{object:t,material:n,geometry:r}=e,s=this.getRenderObjectData(e);if(s.worldMatrix.equals(t.matrixWorld)!==!0)return s.worldMatrix.copy(t.matrixWorld),!1;const a=s.material;for(const S in a){const b=a[S],_=n[S];if(b.equals!==void 0){if(b.equals(_)===!1)return b.copy(_),!1}else if(_.isTexture===!0){if(b.id!==_.id||b.version!==_.version)return b.id=_.id,b.version=_.version,!1}else if(b!==_)return a[S]=_,!1}if(a.transmission>0){const{width:S,height:b}=e.context;if(s.bufferWidth!==S||s.bufferHeight!==b)return s.bufferWidth=S,s.bufferHeight=b,!1}const l=s.geometry,u=r.attributes,h=l.attributes,d=Object.keys(h),p=Object.keys(u);if(l.id!==r.id)return l.id=r.id,!1;if(d.length!==p.length)return s.geometry.attributes=this.getAttributesData(u),!1;for(const S of d){const b=h[S],_=u[S];if(_===void 0)return delete h[S],!1;if(b.version!==_.version)return b.version=_.version,!1}const g=r.index,y=l.indexVersion,v=g?g.version:null;if(y!==v)return l.indexVersion=v,!1;if(l.drawRange.start!==r.drawRange.start||l.drawRange.count!==r.drawRange.count)return l.drawRange.start=r.drawRange.start,l.drawRange.count=r.drawRange.count,!1;if(s.morphTargetInfluences){let S=!1;for(let b=0;b<s.morphTargetInfluences.length;b++)s.morphTargetInfluences[b]!==t.morphTargetInfluences[b]&&(S=!0);if(S)return!0}return s.center&&s.center.equals(t.center)===!1?(s.center.copy(t.center),!0):(e.bundle!==null&&(s.version=e.bundle.version),!0)}needsRefresh(e,t){if(this.hasNode||this.hasAnimation||this.firstInitialization(e)||this.needsVelocity(t.renderer))return!0;const{renderId:n}=t;if(this.renderId!==n)return this.renderId=n,!0;const r=e.object.static===!0,s=e.bundle!==null&&e.bundle.static===!0&&this.getRenderObjectData(e).version===e.bundle.version;return r||s?!1:this.equals(e)!==!0}}function Ap(i,e=0){let t=3735928559^e,n=1103547991^e;if(i instanceof Array)for(let r=0,s;r<i.length;r++)s=i[r],t=Math.imul(t^s,2654435761),n=Math.imul(n^s,1597334677);else for(let r=0,s;r<i.length;r++)s=i.charCodeAt(r),t=Math.imul(t^s,2654435761),n=Math.imul(n^s,1597334677);return t=Math.imul(t^t>>>16,2246822507),t^=Math.imul(n^n>>>13,3266489909),n=Math.imul(n^n>>>16,2246822507),n^=Math.imul(t^t>>>13,3266489909),4294967296*(2097151&n)+(t>>>0)}const vK=i=>Ap(i),cE=i=>Ap(i),Qy=(...i)=>Ap(i);function rB(i,e=!1){const t=[];i.isNode===!0&&(t.push(i.id),i=i.getSelf());for(const{property:n,childNode:r}of Jy(i))t.push(Ap(n.slice(0,-4)),r.getCacheKey(e));return Ap(t)}function*Jy(i,e=!1){for(const t in i){if(t.startsWith("_")===!0)continue;const n=i[t];if(Array.isArray(n)===!0)for(let r=0;r<n.length;r++){const s=n[r];s&&(s.isNode===!0||e&&typeof s.toJSON=="function")&&(yield{property:t,index:r,childNode:s})}else if(n&&n.isNode===!0)yield{property:t,childNode:n};else if(typeof n=="object")for(const r in n){const s=n[r];s&&(s.isNode===!0||e&&typeof s.toJSON=="function")&&(yield{property:t,index:r,childNode:s})}}}const _K=new Map([[1,"float"],[2,"vec2"],[3,"vec3"],[4,"vec4"],[9,"mat3"],[16,"mat4"]]),KP=new WeakMap;function xK(i){return _K.get(i)}function ev(i){if(i==null)return null;const e=typeof i;return i.isNode===!0?"node":e==="number"?"float":e==="boolean"?"bool":e==="string"?"string":e==="function"?"shader":i.isVector2===!0?"vec2":i.isVector3===!0?"vec3":i.isVector4===!0?"vec4":i.isMatrix2===!0?"mat2":i.isMatrix3===!0?"mat3":i.isMatrix4===!0?"mat4":i.isColor===!0?"color":i instanceof ArrayBuffer?"ArrayBuffer":null}function sB(i,...e){const t=i?i.slice(-4):void 0;return e.length===1&&(t==="vec2"?e=[e[0],e[0]]:t==="vec3"?e=[e[0],e[0],e[0]]:t==="vec4"&&(e=[e[0],e[0],e[0],e[0]])),i==="color"?new ot(...e):t==="vec2"?new Le(...e):t==="vec3"?new V(...e):t==="vec4"?new bt(...e):t==="mat2"?new wv(...e):t==="mat3"?new Nt(...e):t==="mat4"?new Wt(...e):i==="bool"?e[0]||!1:i==="float"||i==="int"||i==="uint"?e[0]||0:i==="string"?e[0]||"":i==="ArrayBuffer"?SK(e[0]):null}function aB(i){let e=KP.get(i);return e===void 0&&(e={},KP.set(i,e)),e}function bK(i){let e="";const t=new Uint8Array(i);for(let n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return btoa(e)}function SK(i){return Uint8Array.from(atob(i),e=>e.charCodeAt(0)).buffer}const Zg={VERTEX:"vertex"},Ht={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},io={READ_ONLY:"readOnly",WRITE_ONLY:"writeOnly",READ_WRITE:"readWrite"},TK=["fragment","vertex"],ZP=["setup","analyze","generate"],QP=[...TK,"compute"],Yh=["x","y","z","w"],MK={analyze:"setup",generate:"analyze"};let EK=0;class Ot extends po{static get type(){return"Node"}constructor(e=null){super(),this.nodeType=e,this.updateType=Ht.NONE,this.updateBeforeType=Ht.NONE,this.updateAfterType=Ht.NONE,this.uuid=Wy.generateUUID(),this.version=0,this.global=!1,this.parents=!1,this.isNode=!0,this._cacheKey=null,this._cacheKeyVersion=0,Object.defineProperty(this,"id",{value:EK++})}set needsUpdate(e){e===!0&&this.version++}get type(){return this.constructor.type}onUpdate(e,t){return this.updateType=t,this.update=e.bind(this.getSelf()),this}onFrameUpdate(e){return this.onUpdate(e,Ht.FRAME)}onRenderUpdate(e){return this.onUpdate(e,Ht.RENDER)}onObjectUpdate(e){return this.onUpdate(e,Ht.OBJECT)}onReference(e){return this.updateReference=e.bind(this.getSelf()),this}getSelf(){return this.self||this}updateReference(){return this}isGlobal(){return this.global}*getChildren(){for(const{childNode:e}of Jy(this))yield e}dispose(){this.dispatchEvent({type:"dispose"})}traverse(e){e(this);for(const t of this.getChildren())t.traverse(e)}getCacheKey(e=!1){return e=e||this.version!==this._cacheKeyVersion,(e===!0||this._cacheKey===null)&&(this._cacheKey=Qy(rB(this,e),this.customCacheKey()),this._cacheKeyVersion=this.version),this._cacheKey}customCacheKey(){return 0}getScope(){return this}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getUpdateAfterType(){return this.updateAfterType}getElementType(e){const t=this.getNodeType(e);return e.getElementType(t)}getMemberType(){return"void"}getNodeType(e){const t=e.getNodeProperties(this);return t.outputNode?t.outputNode.getNodeType(e):this.nodeType}getShared(e){const t=this.getHash(e);return e.getNodeFromHash(t)||this}setup(e){const t=e.getNodeProperties(this);let n=0;for(const r of this.getChildren())t["node"+n++]=r;return t.outputNode||null}analyze(e,t=null){const n=e.increaseUsage(this);if(this.parents===!0){const r=e.getDataFromNode(this,"any");r.stages=r.stages||{},r.stages[e.shaderStage]=r.stages[e.shaderStage]||[],r.stages[e.shaderStage].push(t)}if(n===1){const r=e.getNodeProperties(this);for(const s of Object.values(r))s&&s.isNode===!0&&s.build(e,this)}}generate(e,t){const{outputNode:n}=e.getNodeProperties(this);if(n&&n.isNode===!0)return n.build(e,t)}updateBefore(){console.warn("Abstract function.")}updateAfter(){console.warn("Abstract function.")}update(){console.warn("Abstract function.")}build(e,t=null){const n=this.getShared(e);if(this!==n)return n.build(e,t);const r=e.getDataFromNode(this);r.buildStages=r.buildStages||{},r.buildStages[e.buildStage]=!0;const s=MK[e.buildStage];if(s&&r.buildStages[s]!==!0){const u=e.getBuildStage();e.setBuildStage(s),this.build(e),e.setBuildStage(u)}e.addNode(this),e.addChain(this);let a=null;const l=e.getBuildStage();if(l==="setup"){this.updateReference(e);const u=e.getNodeProperties(this);if(u.initialized!==!0){u.initialized=!0,u.outputNode=this.setup(e)||u.outputNode||null;for(const h of Object.values(u))if(h&&h.isNode===!0){if(h.parents===!0){const d=e.getNodeProperties(h);d.parents=d.parents||[],d.parents.push(this)}h.build(e)}}a=u.outputNode}else if(l==="analyze")this.analyze(e,t);else if(l==="generate")if(this.generate.length===1){const h=this.getNodeType(e),d=e.getDataFromNode(this);a=d.snippet,a===void 0?d.generated===void 0?(d.generated=!0,a=this.generate(e)||"",d.snippet=a):(console.warn("THREE.Node: Recursion detected.",this),a=""):d.flowCodes!==void 0&&e.context.nodeBlock!==void 0&&e.addFlowCodeHierarchy(this,e.context.nodeBlock),a=e.format(a,h,t)}else a=this.generate(e,t)||"";return e.removeChain(this),e.addSequentialNode(this),a}getSerializeChildren(){return Jy(this)}serialize(e){const t=this.getSerializeChildren(),n={};for(const{property:r,index:s,childNode:a}of t)s!==void 0?(n[r]===void 0&&(n[r]=Number.isInteger(s)?[]:{}),n[r][s]=a.toJSON(e.meta).uuid):n[r]=a.toJSON(e.meta).uuid;Object.keys(n).length>0&&(e.inputNodes=n)}deserialize(e){if(e.inputNodes!==void 0){const t=e.meta.nodes;for(const n in e.inputNodes)if(Array.isArray(e.inputNodes[n])){const r=[];for(const s of e.inputNodes[n])r.push(t[s]);this[n]=r}else if(typeof e.inputNodes[n]=="object"){const r={};for(const s in e.inputNodes[n]){const a=e.inputNodes[n][s];r[s]=t[a]}this[n]=r}else{const r=e.inputNodes[n];this[n]=t[r]}}}toJSON(e){const{uuid:t,type:n}=this,r=e===void 0||typeof e=="string";r&&(e={textures:{},images:{},nodes:{}});let s=e.nodes[t];s===void 0&&(s={uuid:t,type:n,meta:e,metadata:{version:4.7,type:"Node",generator:"Node.toJSON"}},r!==!0&&(e.nodes[s.uuid]=s),this.serialize(s),delete s.meta);function a(l){const u=[];for(const h in l){const d=l[h];delete d.metadata,u.push(d)}return u}if(r){const l=a(e.textures),u=a(e.images),h=a(e.nodes);l.length>0&&(s.textures=l),u.length>0&&(s.images=u),h.length>0&&(s.nodes=h)}return s}}class Kp extends Ot{static get type(){return"ArrayElementNode"}constructor(e,t){super(),this.node=e,this.indexNode=t,this.isArrayElementNode=!0}getNodeType(e){return this.node.getElementType(e)}generate(e){const t=this.indexNode.getNodeType(e),n=this.node.build(e),r=this.indexNode.build(e,!e.isVector(t)&&e.isInteger(t)?t:"uint");return`${n}[ ${r} ]`}}class oB extends Ot{static get type(){return"ConvertNode"}constructor(e,t){super(),this.node=e,this.convertTo=t}getNodeType(e){const t=this.node.getNodeType(e);let n=null;for(const r of this.convertTo.split("|"))(n===null||e.getTypeLength(t)===e.getTypeLength(r))&&(n=r);return n}serialize(e){super.serialize(e),e.convertTo=this.convertTo}deserialize(e){super.deserialize(e),this.convertTo=e.convertTo}generate(e,t){const n=this.node,r=this.getNodeType(e),s=n.build(e,r);return e.format(s,r,t)}}class mi extends Ot{static get type(){return"TempNode"}constructor(e=null){super(e),this.isTempNode=!0}hasDependencies(e){return e.getDataFromNode(this).usageCount>1}build(e,t){if(e.getBuildStage()==="generate"){const r=e.getVectorType(this.getNodeType(e,t)),s=e.getDataFromNode(this);if(s.propertyName!==void 0)return e.format(s.propertyName,r,t);if(r!=="void"&&t!=="void"&&this.hasDependencies(e)){const a=super.build(e,r),l=e.getVarFromNode(this,null,r),u=e.getPropertyName(l);return e.addLineFlowCode(`${u} = ${a}`,this),s.snippet=a,s.propertyName=u,e.format(s.propertyName,r,t)}}return super.build(e,t)}}class AK extends mi{static get type(){return"JoinNode"}constructor(e=[],t=null){super(t),this.nodes=e}getNodeType(e){return this.nodeType!==null?e.getVectorType(this.nodeType):e.getTypeFromLength(this.nodes.reduce((t,n)=>t+e.getTypeLength(n.getNodeType(e)),0))}generate(e,t){const n=this.getNodeType(e),r=e.getTypeLength(n),s=this.nodes,a=e.getComponentType(n),l=[];let u=0;for(const d of s){if(u>=r){console.error(`THREE.TSL: Length of parameters exceeds maximum length of function '${n}()' type.`);break}let p=d.getNodeType(e),g=e.getTypeLength(p),y;u+g>r&&(console.error(`THREE.TSL: Length of '${n}()' data exceeds maximum length of output type.`),g=r-u,p=e.getTypeFromLength(g)),u+=g,y=d.build(e,p);const v=e.getComponentType(p);v!==a&&(y=e.format(y,v,a)),l.push(y)}const h=`${e.getType(n)}( ${l.join(", ")} )`;return e.format(h,n,t)}}const wK=Yh.join("");class JP extends Ot{static get type(){return"SplitNode"}constructor(e,t="x"){super(),this.node=e,this.components=t,this.isSplitNode=!0}getVectorLength(){let e=this.components.length;for(const t of this.components)e=Math.max(Yh.indexOf(t)+1,e);return e}getComponentType(e){return e.getComponentType(this.node.getNodeType(e))}getNodeType(e){return e.getTypeFromLength(this.components.length,this.getComponentType(e))}generate(e,t){const n=this.node,r=e.getTypeLength(n.getNodeType(e));let s=null;if(r>1){let a=null;this.getVectorLength()>=r&&(a=e.getTypeFromLength(this.getVectorLength(),this.getComponentType(e)));const u=n.build(e,a);this.components.length===r&&this.components===wK.slice(0,this.components.length)?s=e.format(u,a,t):s=e.format(`${u}.${this.components}`,this.getNodeType(e),t)}else s=n.build(e,t);return s}serialize(e){super.serialize(e),e.components=this.components}deserialize(e){super.deserialize(e),this.components=e.components}}class RK extends mi{static get type(){return"SetNode"}constructor(e,t,n){super(),this.sourceNode=e,this.components=t,this.targetNode=n}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{sourceNode:t,components:n,targetNode:r}=this,s=this.getNodeType(e),a=e.getComponentType(r.getNodeType(e)),l=e.getTypeFromLength(n.length,a),u=r.build(e,l),h=t.build(e,s),d=e.getTypeLength(s),p=[];for(let g=0;g<d;g++){const y=Yh[g];y===n[0]?(p.push(u),g+=n.length-1):p.push(h+"."+y)}return`${e.getType(s)}( ${p.join(", ")} )`}}class CK extends mi{static get type(){return"FlipNode"}constructor(e,t){super(),this.sourceNode=e,this.components=t}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{components:t,sourceNode:n}=this,r=this.getNodeType(e),s=n.build(e),a=e.getVarFromNode(this),l=e.getPropertyName(a);e.addLineFlowCode(l+" = "+s,this);const u=e.getTypeLength(r),h=[];let d=0;for(let p=0;p<u;p++){const g=Yh[p];g===t[d]?(h.push("1.0 - "+(l+"."+g)),d++):h.push(l+"."+g)}return`${e.getType(r)}( ${h.join(", ")} )`}}class hE extends Ot{static get type(){return"InputNode"}constructor(e,t=null){super(t),this.isInputNode=!0,this.value=e,this.precision=null}getNodeType(){return this.nodeType===null?ev(this.value):this.nodeType}getInputType(e){return this.getNodeType(e)}setPrecision(e){return this.precision=e,this}serialize(e){super.serialize(e),e.value=this.value,this.value&&this.value.toArray&&(e.value=this.value.toArray()),e.valueType=ev(this.value),e.nodeType=this.nodeType,e.valueType==="ArrayBuffer"&&(e.value=bK(e.value)),e.precision=this.precision}deserialize(e){super.deserialize(e),this.nodeType=e.nodeType,this.value=Array.isArray(e.value)?sB(e.valueType,...e.value):e.value,this.precision=e.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(e.value))}generate(){console.warn("Abstract function.")}}const eD=/float|u?int/;class go extends hE{static get type(){return"ConstNode"}constructor(e,t=null){super(e,t),this.isConstNode=!0}generateConst(e){return e.generateConst(this.getNodeType(e),this.value)}generate(e,t){const n=this.getNodeType(e);return eD.test(n)&&eD.test(t)?e.generateConst(t,this.value):e.format(this.generateConst(e),n,t)}}class NK extends Ot{static get type(){return"MemberNode"}constructor(e,t){super(),this.node=e,this.property=t,this.isMemberNode=!0}getNodeType(e){return this.node.getMemberType(e,this.property)}generate(e){return this.node.build(e)+"."+this.property}}let Lh=null;const $c=new Map;function be(i,e){if($c.has(i)){console.warn(`THREE.TSL: Redefinition of method chaining '${i}'.`);return}if(typeof e!="function")throw new Error(`THREE.TSL: Node element ${i} is not a function`);$c.set(i,e)}const lB=i=>i.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),tD=i=>lB(i).split("").sort().join(""),uB={setup(i,e){const t=e.shift();return i(Bv(t),...e)},get(i,e,t){if(typeof e=="string"&&i[e]===void 0){if(i.isStackNode!==!0&&e==="assign")return(...n)=>(Lh.assign(t,...n),t);if($c.has(e)){const n=$c.get(e);return i.isStackNode?(...r)=>t.add(n(...r)):(...r)=>n(t,...r)}else{if(e==="self")return i;if(e.endsWith("Assign")&&$c.has(e.slice(0,e.length-6))){const n=$c.get(e.slice(0,e.length-6));return i.isStackNode?(...r)=>t.assign(r[0],n(...r)):(...r)=>t.assign(n(t,...r))}else{if(/^[xyzwrgbastpq]{1,4}$/.test(e)===!0)return e=lB(e),Ie(new JP(t,e));if(/^set[XYZWRGBASTPQ]{1,4}$/.test(e)===!0)return e=tD(e.slice(3).toLowerCase()),n=>Ie(new RK(i,e,Ie(n)));if(/^flip[XYZWRGBASTPQ]{1,4}$/.test(e)===!0)return e=tD(e.slice(4).toLowerCase()),()=>Ie(new CK(Ie(i),e));if(e==="width"||e==="height"||e==="depth")return e==="width"?e="x":e==="height"?e="y":e==="depth"&&(e="z"),Ie(new JP(i,e));if(/^\d+$/.test(e)===!0)return Ie(new Kp(t,new go(Number(e),"uint")));if(/^get$/.test(e)===!0)return n=>Ie(new NK(t,n))}}}return Reflect.get(i,e,t)},set(i,e,t,n){return typeof e=="string"&&i[e]===void 0&&(/^[xyzwrgbastpq]{1,4}$/.test(e)===!0||e==="width"||e==="height"||e==="depth"||/^\d+$/.test(e)===!0)?(n[e].assign(t),!0):Reflect.set(i,e,t,n)}},xb=new WeakMap,nD=new WeakMap,PK=function(i,e=null){const t=ev(i);if(t==="node"){let n=xb.get(i);return n===void 0&&(n=new Proxy(i,uB),xb.set(i,n),xb.set(n,n)),n}else{if(e===null&&(t==="float"||t==="boolean")||t&&t!=="shader"&&t!=="string")return Ie(aT(i,e));if(t==="shader")return Ue(i)}return i},DK=function(i,e=null){for(const t in i)i[t]=Ie(i[t],e);return i},LK=function(i,e=null){const t=i.length;for(let n=0;n<t;n++)i[n]=Ie(i[n],e);return i},UK=function(i,e=null,t=null,n=null){const r=d=>Ie(n!==null?Object.assign(d,n):d);let s,a=e,l,u;function h(d){let p;return a?p=/[a-z]/i.test(a)?a+"()":a:p=i.type,l!==void 0&&d.length<l?(console.error(`THREE.TSL: "${p}" parameter length is less than minimum required.`),d.concat(new Array(l-d.length).fill(0))):u!==void 0&&d.length>u?(console.error(`THREE.TSL: "${p}" parameter length exceeds limit.`),d.slice(0,u)):d}return e===null?s=(...d)=>r(new i(...th(h(d)))):t!==null?(t=Ie(t),s=(...d)=>r(new i(e,...th(h(d)),t))):s=(...d)=>r(new i(e,...th(h(d)))),s.setParameterLength=(...d)=>(d.length===1?l=u=d[0]:d.length===2&&([l,u]=d),s),s.setName=d=>(a=d,s),s},OK=function(i,...e){return Ie(new i(...th(e)))};class BK extends Ot{constructor(e,t){super(),this.shaderNode=e,this.inputNodes=t,this.isShaderCallNodeInternal=!0}getNodeType(e){return this.shaderNode.nodeType||this.getOutputNode(e).getNodeType(e)}getMemberType(e,t){return this.getOutputNode(e).getMemberType(e,t)}call(e){const{shaderNode:t,inputNodes:n}=this,r=e.getNodeProperties(t),s=t.namespace&&t.namespace===e.namespace?e.getNamespace("once"):"once";if(r[s])return r[s];let a=null;if(t.layout){let l=nD.get(e.constructor);l===void 0&&(l=new WeakMap,nD.set(e.constructor,l));let u=l.get(t);u===void 0&&(u=Ie(e.buildFunctionNode(t)),l.set(t,u)),e.addInclude(u),a=Ie(u.call(n))}else{const l=t.jsFunc,u=n!==null||l.length>1?l(n||[],e):l(e);a=Ie(u)}return t.once&&(r[s]=a),a}setupOutput(e){return e.addStack(),e.stack.outputNode=this.call(e),e.removeStack()}getOutputNode(e){const t=e.getNodeProperties(this),n=e.getOutputNamespace();return t[n]=t[n]||this.setupOutput(e),t[n]}build(e,t=null){let n=null;const r=e.getBuildStage(),s=e.getNodeProperties(this),a=e.getOutputNamespace(),l=this.getOutputNode(e);if(r==="setup"){const u=e.getNamespace("initialized");s[u]!==!0&&(s[u]=!0,s[a]=this.getOutputNode(e),s[a].build(e)),n=s[a]}else r==="analyze"?l.build(e,t):r==="generate"&&(n=l.build(e,t)||"");return n}}class IK extends Ot{constructor(e,t){super(t),this.jsFunc=e,this.layout=null,this.global=!0,this.once=!1,this.namespace=null}setLayout(e){return this.layout=e,this}call(e=null){return Bv(e),Ie(new BK(this,e))}setup(){return this.call()}}const FK=[!1,!0],kK=[0,1,2,3],zK=[-1,-2],cB=[.5,1.5,1/3,1e-6,1e6,Math.PI,Math.PI*2,1/Math.PI,2/Math.PI,1/(Math.PI*2),Math.PI/2],fE=new Map;for(const i of FK)fE.set(i,new go(i));const dE=new Map;for(const i of kK)dE.set(i,new go(i,"uint"));const pE=new Map([...dE].map(i=>new go(i.value,"int")));for(const i of zK)pE.set(i,new go(i,"int"));const Uv=new Map([...pE].map(i=>new go(i.value)));for(const i of cB)Uv.set(i,new go(i));for(const i of cB)Uv.set(-i,new go(-i));const Ov={bool:fE,uint:dE,ints:pE,float:Uv},iD=new Map([...fE,...Uv]),aT=(i,e)=>iD.has(i)?iD.get(i):i.isNode===!0?i:new go(i,e),VK=i=>{try{return i.getNodeType()}catch{return}},gi=function(i,e=null){return(...t)=>{if((t.length===0||!["bool","float","int","uint"].includes(i)&&t.every(r=>typeof r!="object"))&&(t=[sB(i,...t)]),t.length===1&&e!==null&&e.has(t[0]))return Ie(e.get(t[0]));if(t.length===1){const r=aT(t[0],i);return VK(r)===i?Ie(r):Ie(new oB(r,i))}const n=t.map(r=>aT(r));return Ie(new AK(n,i))}},rD=i=>typeof i=="object"&&i!==null?i.value:i,GK=i=>i!=null?i.nodeType||i.convertTo||(typeof i=="string"?i:null):null;function Nd(i,e){return new Proxy(new IK(i,e),uB)}const Ie=(i,e=null)=>PK(i,e),Bv=(i,e=null)=>new DK(i,e),th=(i,e=null)=>new LK(i,e),Oe=(...i)=>new UK(...i),Ge=(...i)=>new OK(...i);let HK=0;const Ue=(i,e=null)=>{let t=null;e!==null&&(typeof e=="object"?t=e.return:(typeof e=="string"?t=e:console.error("THREE.TSL: Invalid layout type."),e=null));const n=new Nd(i,t),r=(...s)=>{let a;Bv(s),s[0]&&(s[0].isNode||Object.getPrototypeOf(s[0])!==Object.prototype)?a=[...s]:a=s[0];const u=n.call(a);return t==="void"&&u.toStack(),u};if(r.shaderNode=n,r.id=n.id,r.getNodeType=(...s)=>n.getNodeType(...s),r.getCacheKey=(...s)=>n.getCacheKey(...s),r.setLayout=s=>(n.setLayout(s),r),r.once=(s=null)=>(n.once=!0,n.namespace=s,r),e!==null){if(typeof e.inputs!="object"){const s={name:"fn"+HK++,type:t,inputs:[]};for(const a in e)a!=="return"&&s.inputs.push({name:a,type:e[a]});e=s}r.setLayout(e)}return r},tv=i=>{Lh=i},hB=()=>Lh,ii=(...i)=>Lh.If(...i);function fB(i){return Lh&&Lh.add(i),i}be("toStack",fB);const WK=new gi("color"),Te=new gi("float",Ov.float),Nn=new gi("int",Ov.ints),jK=new gi("uint",Ov.uint),mE=new gi("bool",Ov.bool),We=new gi("vec2"),Xa=new gi("ivec2"),qK=new gi("uvec2"),$K=new gi("bvec2"),Ee=new gi("vec3"),XK=new gi("ivec3"),YK=new gi("uvec3"),KK=new gi("bvec3"),Ut=new gi("vec4"),ZK=new gi("ivec4"),QK=new gi("uvec4"),JK=new gi("bvec4"),gE=new gi("mat2"),_r=new gi("mat3"),nh=new gi("mat4");be("toColor",WK);be("toFloat",Te);be("toInt",Nn);be("toUint",jK);be("toBool",mE);be("toVec2",We);be("toIVec2",Xa);be("toUVec2",qK);be("toBVec2",$K);be("toVec3",Ee);be("toIVec3",XK);be("toUVec3",YK);be("toBVec3",KK);be("toVec4",Ut);be("toIVec4",ZK);be("toUVec4",QK);be("toBVec4",JK);be("toMat2",gE);be("toMat3",_r);be("toMat4",nh);const eZ=Oe(Kp).setParameterLength(2),tZ=(i,e)=>Ie(new oB(Ie(i),e));be("element",eZ);be("convert",tZ);be("append",i=>(console.warn("THREE.TSL: .append() has been renamed to .toStack()."),fB(i)));class hn extends Ot{static get type(){return"PropertyNode"}constructor(e,t=null,n=!1){super(e),this.name=t,this.varying=n,this.isPropertyNode=!0,this.global=!0}getHash(e){return this.name||super.getHash(e)}generate(e){let t;return this.varying===!0?(t=e.getVaryingFromNode(this,this.name),t.needsInterpolation=!0):t=e.getVarFromNode(this,this.name),e.getPropertyName(t)}}const Zp=(i,e)=>Ie(new hn(i,e)),nv=(i,e)=>Ie(new hn(i,e,!0)),an=Ge(hn,"vec4","DiffuseColor"),sD=Ge(hn,"vec3","EmissiveColor"),Qa=Ge(hn,"float","Roughness"),iv=Ge(hn,"float","Metalness"),oT=Ge(hn,"float","Clearcoat"),rv=Ge(hn,"float","ClearcoatRoughness"),Xc=Ge(hn,"vec3","Sheen"),yE=Ge(hn,"float","SheenRoughness"),vE=Ge(hn,"float","Iridescence"),dB=Ge(hn,"float","IridescenceIOR"),pB=Ge(hn,"float","IridescenceThickness"),lT=Ge(hn,"float","AlphaT"),iu=Ge(hn,"float","Anisotropy"),Cy=Ge(hn,"vec3","AnisotropyT"),ih=Ge(hn,"vec3","AnisotropyB"),Qr=Ge(hn,"color","SpecularColor"),sv=Ge(hn,"float","SpecularF90"),uT=Ge(hn,"float","Shininess"),qd=Ge(hn,"vec4","Output"),bb=Ge(hn,"float","dashSize"),aD=Ge(hn,"float","gapSize"),Ny=Ge(hn,"float","IOR"),cT=Ge(hn,"float","Transmission"),mB=Ge(hn,"float","Thickness"),gB=Ge(hn,"float","AttenuationDistance"),yB=Ge(hn,"color","AttenuationColor"),vB=Ge(hn,"float","Dispersion");class _B extends Ot{static get type(){return"UniformGroupNode"}constructor(e,t=!1,n=1){super("string"),this.name=e,this.shared=t,this.order=n,this.isUniformGroup=!0}serialize(e){super.serialize(e),e.name=this.name,e.version=this.version,e.shared=this.shared}deserialize(e){super.deserialize(e),this.name=e.name,this.version=e.version,this.shared=e.shared}}const nZ=i=>new _B(i),_E=(i,e=0)=>new _B(i,!0,e),iZ=_E("frame"),Mt=_E("render"),xB=nZ("object");class Qp extends hE{static get type(){return"UniformNode"}constructor(e,t=null){super(e,t),this.isUniformNode=!0,this.name="",this.groupNode=xB}label(e){return this.name=e,this}setGroup(e){return this.groupNode=e,this}getGroup(){return this.groupNode}getUniformHash(e){return this.getHash(e)}onUpdate(e,t){const n=this.getSelf();return e=e.bind(n),super.onUpdate(r=>{const s=e(r,n);s!==void 0&&(this.value=s)},t)}generate(e,t){const n=this.getNodeType(e),r=this.getUniformHash(e);let s=e.getNodeFromHash(r);s===void 0&&(e.setHashNode(this,r),s=this);const a=s.getInputType(e),l=e.getUniformFromNode(s,a,e.shaderStage,this.name||e.context.label),u=e.getPropertyName(l);return e.context.label!==void 0&&delete e.context.label,e.format(u,n,t)}}const Et=(i,e)=>{const t=GK(e||i),n=i&&i.isNode===!0?i.node&&i.node.value||i.value:i;return Ie(new Qp(n,t))};class oD extends mi{static get type(){return"ArrayNode"}constructor(e,t,n=null){super(e),this.count=t,this.values=n,this.isArrayNode=!0}getNodeType(e){return this.nodeType===null&&(this.nodeType=this.values[0].getNodeType(e)),this.nodeType}getElementType(e){return this.getNodeType(e)}generate(e){const t=this.getNodeType(e);return e.generateArray(t,this.count,this.values)}}const rZ=(...i)=>{let e;if(i.length===1){const t=i[0];e=new oD(null,t.length,t)}else{const t=i[0],n=i[1];e=new oD(t,n)}return Ie(e)};be("toArray",(i,e)=>rZ(Array(e).fill(i)));class sZ extends mi{static get type(){return"AssignNode"}constructor(e,t){super(),this.targetNode=e,this.sourceNode=t,this.isAssignNode=!0}hasDependencies(){return!1}getNodeType(e,t){return t!=="void"?this.targetNode.getNodeType(e):"void"}needsSplitAssign(e){const{targetNode:t}=this;if(e.isAvailable("swizzleAssign")===!1&&t.isSplitNode&&t.components.length>1){const n=e.getTypeLength(t.node.getNodeType(e));return Yh.join("").slice(0,n)!==t.components}return!1}setup(e){const{targetNode:t,sourceNode:n}=this,r=e.getNodeProperties(this);r.sourceNode=n,r.targetNode=t.context({assign:!0})}generate(e,t){const{targetNode:n,sourceNode:r}=e.getNodeProperties(this),s=this.needsSplitAssign(e),a=n.getNodeType(e),l=n.build(e),u=r.build(e,a),h=r.getNodeType(e),d=e.getDataFromNode(this);let p;if(d.initialized===!0)t!=="void"&&(p=l);else if(s){const g=e.getVarFromNode(this,null,a),y=e.getPropertyName(g);e.addLineFlowCode(`${y} = ${u}`,this);const v=n.node,b=v.node.context({assign:!0}).build(e);for(let _=0;_<v.components.length;_++){const E=v.components[_];e.addLineFlowCode(`${b}.${E} = ${y}[ ${_} ]`,this)}t!=="void"&&(p=l)}else p=`${l} = ${u}`,(t==="void"||h==="void")&&(e.addLineFlowCode(p,this),t!=="void"&&(p=l));return d.initialized=!0,e.format(p,a,t)}}const aZ=Oe(sZ).setParameterLength(2);be("assign",aZ);class oZ extends mi{static get type(){return"FunctionCallNode"}constructor(e=null,t={}){super(),this.functionNode=e,this.parameters=t}setParameters(e){return this.parameters=e,this}getParameters(){return this.parameters}getNodeType(e){return this.functionNode.getNodeType(e)}generate(e){const t=[],n=this.functionNode,r=n.getInputs(e),s=this.parameters,a=(u,h)=>{const d=h.type,p=d==="pointer";let g;return p?g="&"+u.build(e):g=u.build(e,d),g};if(Array.isArray(s)){if(s.length>r.length)console.error("THREE.TSL: The number of provided parameters exceeds the expected number of inputs in 'Fn()'."),s.length=r.length;else if(s.length<r.length)for(console.error("THREE.TSL: The number of provided parameters is less than the expected number of inputs in 'Fn()'.");s.length<r.length;)s.push(Te(0));for(let u=0;u<s.length;u++)t.push(a(s[u],r[u]))}else for(const u of r){const h=s[u.name];h!==void 0?t.push(a(h,u)):(console.error(`THREE.TSL: Input '${u.name}' not found in 'Fn()'.`),t.push(a(Te(0),u)))}return`${n.build(e,"property")}( ${t.join(", ")} )`}}const lZ=(i,...e)=>(e=e.length>1||e[0]&&e[0].isNode===!0?th(e):Bv(e[0]),Ie(new oZ(Ie(i),e)));be("call",lZ);const uZ={"==":"equal","!=":"notEqual","<":"lessThan",">":"greaterThan","<=":"lessThanEqual",">=":"greaterThanEqual","%":"mod"};class Fn extends mi{static get type(){return"OperatorNode"}constructor(e,t,n,...r){if(super(),r.length>0){let s=new Fn(e,t,n);for(let a=0;a<r.length-1;a++)s=new Fn(e,s,r[a]);t=s,n=r[r.length-1]}this.op=e,this.aNode=t,this.bNode=n,this.isOperatorNode=!0}getOperatorMethod(e,t){return e.getMethod(uZ[this.op],t)}getNodeType(e){const t=this.op,n=this.aNode,r=this.bNode,s=n.getNodeType(e),a=r?r.getNodeType(e):null;if(s==="void"||a==="void")return"void";if(t==="%")return s;if(t==="~"||t==="&"||t==="|"||t==="^"||t===">>"||t==="<<")return e.getIntegerType(s);if(t==="!"||t==="&&"||t==="||"||t==="^^")return"bool";if(t==="=="||t==="!="||t==="<"||t===">"||t==="<="||t===">="){const l=Math.max(e.getTypeLength(s),e.getTypeLength(a));return l>1?`bvec${l}`:"bool"}else{if(e.isMatrix(s)){if(a==="float")return s;if(e.isVector(a))return e.getVectorFromMatrix(s);if(e.isMatrix(a))return s}else if(e.isMatrix(a)){if(s==="float")return a;if(e.isVector(s))return e.getVectorFromMatrix(a)}return e.getTypeLength(a)>e.getTypeLength(s)?a:s}}generate(e,t){const n=this.op,{aNode:r,bNode:s}=this,a=this.getNodeType(e);let l=null,u=null;a!=="void"?(l=r.getNodeType(e),u=s?s.getNodeType(e):null,n==="<"||n===">"||n==="<="||n===">="||n==="=="||n==="!="?e.isVector(l)?u=l:e.isVector(u)?l=u:l!==u&&(l=u="float"):n===">>"||n==="<<"?(l=a,u=e.changeComponentType(u,"uint")):n==="%"?(l=a,u=e.isInteger(l)&&e.isInteger(u)?u:l):e.isMatrix(l)?u==="float"?u="float":e.isVector(u)?u=e.getVectorFromMatrix(l):e.isMatrix(u)||(l=u=a):e.isMatrix(u)?l==="float"?l="float":e.isVector(l)?l=e.getVectorFromMatrix(u):l=u=a:l=u=a):l=u=a;const h=r.build(e,l),d=s?s.build(e,u):null,p=e.getFunctionOperator(n);if(t!=="void"){const g=e.renderer.coordinateSystem===vr;if(n==="=="||n==="!="||n==="<"||n===">"||n==="<="||n===">=")return g?e.isVector(l)?e.format(`${this.getOperatorMethod(e,t)}( ${h}, ${d} )`,a,t):e.format(`( ${h} ${n} ${d} )`,a,t):e.format(`( ${h} ${n} ${d} )`,a,t);if(n==="%")return e.isInteger(u)?e.format(`( ${h} % ${d} )`,a,t):e.format(`${this.getOperatorMethod(e,a)}( ${h}, ${d} )`,a,t);if(n==="!"||n==="~")return e.format(`(${n}${h})`,l,t);if(p)return e.format(`${p}( ${h}, ${d} )`,a,t);if(e.isMatrix(l)&&u==="float")return e.format(`( ${d} ${n} ${h} )`,a,t);if(l==="float"&&e.isMatrix(u))return e.format(`${h} ${n} ${d}`,a,t);{let y=`( ${h} ${n} ${d} )`;return!g&&a==="bool"&&e.isVector(l)&&e.isVector(u)&&(y=`all${y}`),e.format(y,a,t)}}else if(l!=="void")return p?e.format(`${p}( ${h}, ${d} )`,a,t):e.isMatrix(l)&&u==="float"?e.format(`${d} ${n} ${h}`,a,t):e.format(`${h} ${n} ${d}`,a,t)}serialize(e){super.serialize(e),e.op=this.op}deserialize(e){super.deserialize(e),this.op=e.op}}const xr=Oe(Fn,"+").setParameterLength(2,1/0).setName("add"),hr=Oe(Fn,"-").setParameterLength(2,1/0).setName("sub"),$t=Oe(Fn,"*").setParameterLength(2,1/0).setName("mul"),pa=Oe(Fn,"/").setParameterLength(2,1/0).setName("div"),Iv=Oe(Fn,"%").setParameterLength(2).setName("mod"),bB=Oe(Fn,"==").setParameterLength(2).setName("equal"),cZ=Oe(Fn,"!=").setParameterLength(2).setName("notEqual"),hZ=Oe(Fn,"<").setParameterLength(2).setName("lessThan"),fZ=Oe(Fn,">").setParameterLength(2).setName("greaterThan"),dZ=Oe(Fn,"<=").setParameterLength(2).setName("lessThanEqual"),pZ=Oe(Fn,">=").setParameterLength(2).setName("greaterThanEqual"),mZ=Oe(Fn,"&&").setParameterLength(2,1/0).setName("and"),gZ=Oe(Fn,"||").setParameterLength(2,1/0).setName("or"),yZ=Oe(Fn,"!").setParameterLength(1).setName("not"),vZ=Oe(Fn,"^^").setParameterLength(2).setName("xor"),_Z=Oe(Fn,"&").setParameterLength(2).setName("bitAnd"),xZ=Oe(Fn,"~").setParameterLength(2).setName("bitNot"),bZ=Oe(Fn,"|").setParameterLength(2).setName("bitOr"),SZ=Oe(Fn,"^").setParameterLength(2).setName("bitXor"),TZ=Oe(Fn,"<<").setParameterLength(2).setName("shiftLeft"),MZ=Oe(Fn,">>").setParameterLength(2).setName("shiftRight"),EZ=Ue(([i])=>(i.addAssign(1),i)),AZ=Ue(([i])=>(i.subAssign(1),i)),wZ=Ue(([i])=>{const e=Nn(i).toConst();return i.addAssign(1),e}),RZ=Ue(([i])=>{const e=Nn(i).toConst();return i.subAssign(1),e});be("add",xr);be("sub",hr);be("mul",$t);be("div",pa);be("mod",Iv);be("equal",bB);be("notEqual",cZ);be("lessThan",hZ);be("greaterThan",fZ);be("lessThanEqual",dZ);be("greaterThanEqual",pZ);be("and",mZ);be("or",gZ);be("not",yZ);be("xor",vZ);be("bitAnd",_Z);be("bitNot",xZ);be("bitOr",bZ);be("bitXor",SZ);be("shiftLeft",TZ);be("shiftRight",MZ);be("incrementBefore",EZ);be("decrementBefore",AZ);be("increment",wZ);be("decrement",RZ);const CZ=(i,e)=>(console.warn('THREE.TSL: "remainder()" is deprecated. Use "mod( int( ... ) )" instead.'),Iv(i,e)),NZ=(i,e)=>(console.warn('THREE.TSL: "modInt()" is deprecated. Use "mod( int( ... ) )" instead.'),Iv(Nn(i),Nn(e)));be("remainder",CZ);be("modInt",NZ);class re extends mi{static get type(){return"MathNode"}constructor(e,t,n=null,r=null){if(super(),(e===re.MAX||e===re.MIN)&&arguments.length>3){let s=new re(e,t,n);for(let a=2;a<arguments.length-1;a++)s=new re(e,s,arguments[a]);t=s,n=arguments[arguments.length-1],r=null}this.method=e,this.aNode=t,this.bNode=n,this.cNode=r,this.isMathNode=!0}getInputType(e){const t=this.aNode.getNodeType(e),n=this.bNode?this.bNode.getNodeType(e):null,r=this.cNode?this.cNode.getNodeType(e):null,s=e.isMatrix(t)?0:e.getTypeLength(t),a=e.isMatrix(n)?0:e.getTypeLength(n),l=e.isMatrix(r)?0:e.getTypeLength(r);return s>a&&s>l?t:a>l?n:l>s?r:t}getNodeType(e){const t=this.method;return t===re.LENGTH||t===re.DISTANCE||t===re.DOT?"float":t===re.CROSS?"vec3":t===re.ALL||t===re.ANY?"bool":t===re.EQUALS?e.changeComponentType(this.aNode.getNodeType(e),"bool"):this.getInputType(e)}setup(e){const{aNode:t,bNode:n,method:r}=this;let s=null;if(r===re.ONE_MINUS)s=hr(1,t);else if(r===re.RECIPROCAL)s=pa(1,t);else if(r===re.DIFFERENCE)s=ys(hr(t,n));else if(r===re.TRANSFORM_DIRECTION){let a=t,l=n;e.isMatrix(a.getNodeType(e))?l=Ut(Ee(l),0):a=Ut(Ee(a),0);const u=$t(a,l).xyz;s=Rp(u)}return s!==null?s:super.setup(e)}generate(e,t){if(e.getNodeProperties(this).outputNode)return super.generate(e,t);let r=this.method;const s=this.getNodeType(e),a=this.getInputType(e),l=this.aNode,u=this.bNode,h=this.cNode,d=e.renderer.coordinateSystem;if(r===re.NEGATE)return e.format("( - "+l.build(e,a)+" )",s,t);{const p=[];return r===re.CROSS?p.push(l.build(e,s),u.build(e,s)):d===vr&&r===re.STEP?p.push(l.build(e,e.getTypeLength(l.getNodeType(e))===1?"float":a),u.build(e,a)):d===vr&&(r===re.MIN||r===re.MAX)?p.push(l.build(e,a),u.build(e,e.getTypeLength(u.getNodeType(e))===1?"float":a)):r===re.REFRACT?p.push(l.build(e,a),u.build(e,a),h.build(e,"float")):r===re.MIX?p.push(l.build(e,a),u.build(e,a),h.build(e,e.getTypeLength(h.getNodeType(e))===1?"float":a)):(d===fl&&r===re.ATAN&&u!==null&&(r="atan2"),e.shaderStage!=="fragment"&&(r===re.DFDX||r===re.DFDY)&&(console.warn(`THREE.TSL: '${r}' is not supported in the ${e.shaderStage} stage.`),r="/*"+r+"*/"),p.push(l.build(e,a)),u!==null&&p.push(u.build(e,a)),h!==null&&p.push(h.build(e,a))),e.format(`${e.getMethod(r,s)}( ${p.join(", ")} )`,s,t)}}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}re.ALL="all";re.ANY="any";re.RADIANS="radians";re.DEGREES="degrees";re.EXP="exp";re.EXP2="exp2";re.LOG="log";re.LOG2="log2";re.SQRT="sqrt";re.INVERSE_SQRT="inversesqrt";re.FLOOR="floor";re.CEIL="ceil";re.NORMALIZE="normalize";re.FRACT="fract";re.SIN="sin";re.COS="cos";re.TAN="tan";re.ASIN="asin";re.ACOS="acos";re.ATAN="atan";re.ABS="abs";re.SIGN="sign";re.LENGTH="length";re.NEGATE="negate";re.ONE_MINUS="oneMinus";re.DFDX="dFdx";re.DFDY="dFdy";re.ROUND="round";re.RECIPROCAL="reciprocal";re.TRUNC="trunc";re.FWIDTH="fwidth";re.TRANSPOSE="transpose";re.BITCAST="bitcast";re.EQUALS="equals";re.MIN="min";re.MAX="max";re.STEP="step";re.REFLECT="reflect";re.DISTANCE="distance";re.DIFFERENCE="difference";re.DOT="dot";re.CROSS="cross";re.POW="pow";re.TRANSFORM_DIRECTION="transformDirection";re.MIX="mix";re.CLAMP="clamp";re.REFRACT="refract";re.SMOOTHSTEP="smoothstep";re.FACEFORWARD="faceforward";const PZ=Te(1e-6),DZ=Te(Math.PI),LZ=Oe(re,re.ALL).setParameterLength(1),UZ=Oe(re,re.ANY).setParameterLength(1),OZ=Oe(re,re.RADIANS).setParameterLength(1),BZ=Oe(re,re.DEGREES).setParameterLength(1),SB=Oe(re,re.EXP).setParameterLength(1),wp=Oe(re,re.EXP2).setParameterLength(1),TB=Oe(re,re.LOG).setParameterLength(1),oo=Oe(re,re.LOG2).setParameterLength(1),xE=Oe(re,re.SQRT).setParameterLength(1),IZ=Oe(re,re.INVERSE_SQRT).setParameterLength(1),xu=Oe(re,re.FLOOR).setParameterLength(1),bE=Oe(re,re.CEIL).setParameterLength(1),Rp=Oe(re,re.NORMALIZE).setParameterLength(1),vl=Oe(re,re.FRACT).setParameterLength(1),Is=Oe(re,re.SIN).setParameterLength(1),el=Oe(re,re.COS).setParameterLength(1),FZ=Oe(re,re.TAN).setParameterLength(1),kZ=Oe(re,re.ASIN).setParameterLength(1),MB=Oe(re,re.ACOS).setParameterLength(1),EB=Oe(re,re.ATAN).setParameterLength(1,2),ys=Oe(re,re.ABS).setParameterLength(1),av=Oe(re,re.SIGN).setParameterLength(1),lo=Oe(re,re.LENGTH).setParameterLength(1),zZ=Oe(re,re.NEGATE).setParameterLength(1),VZ=Oe(re,re.ONE_MINUS).setParameterLength(1),AB=Oe(re,re.DFDX).setParameterLength(1),wB=Oe(re,re.DFDY).setParameterLength(1),GZ=Oe(re,re.ROUND).setParameterLength(1),HZ=Oe(re,re.RECIPROCAL).setParameterLength(1),WZ=Oe(re,re.TRUNC).setParameterLength(1),jZ=Oe(re,re.FWIDTH).setParameterLength(1),qZ=Oe(re,re.TRANSPOSE).setParameterLength(1),$Z=(i,e)=>(console.warn('THREE.TSL: "equals" is deprecated. Use "equal" inside a vector instead, like: "bvec*( equal( ... ) )"'),bB(i,e)),Uh=Oe(re,re.MIN).setParameterLength(2,1/0),sr=Oe(re,re.MAX).setParameterLength(2,1/0),RB=Oe(re,re.STEP).setParameterLength(2),XZ=Oe(re,re.REFLECT).setParameterLength(2),YZ=Oe(re,re.DISTANCE).setParameterLength(2),KZ=Oe(re,re.DIFFERENCE).setParameterLength(2),SE=Oe(re,re.DOT).setParameterLength(2),CB=Oe(re,re.CROSS).setParameterLength(2),Fv=Oe(re,re.POW).setParameterLength(2),NB=Oe(re,re.POW,2).setParameterLength(1),ZZ=Oe(re,re.POW,3).setParameterLength(1),QZ=Oe(re,re.POW,4).setParameterLength(1),JZ=Oe(re,re.TRANSFORM_DIRECTION).setParameterLength(2),eQ=i=>$t(av(i),Fv(ys(i),1/3)),PB=i=>SE(i,i),Dn=Oe(re,re.MIX).setParameterLength(3),fo=(i,e=0,t=1)=>Ie(new re(re.CLAMP,Ie(i),Ie(e),Ie(t))),DB=i=>fo(i),LB=Oe(re,re.REFRACT).setParameterLength(3),pl=Oe(re,re.SMOOTHSTEP).setParameterLength(3),tQ=Oe(re,re.FACEFORWARD).setParameterLength(3),nQ=Ue(([i])=>{const n=43758.5453,r=SE(i.xy,We(12.9898,78.233)),s=Iv(r,DZ);return vl(Is(s).mul(n))}),iQ=(i,e,t)=>Dn(e,t,i),rQ=(i,e,t)=>pl(e,t,i),sQ=(i,e)=>(console.warn('THREE.TSL: "atan2" is overloaded. Use "atan" instead.'),EB(i,e));be("all",LZ);be("any",UZ);be("equals",$Z);be("radians",OZ);be("degrees",BZ);be("exp",SB);be("exp2",wp);be("log",TB);be("log2",oo);be("sqrt",xE);be("inverseSqrt",IZ);be("floor",xu);be("ceil",bE);be("normalize",Rp);be("fract",vl);be("sin",Is);be("cos",el);be("tan",FZ);be("asin",kZ);be("acos",MB);be("atan",EB);be("abs",ys);be("sign",av);be("length",lo);be("lengthSq",PB);be("negate",zZ);be("oneMinus",VZ);be("dFdx",AB);be("dFdy",wB);be("round",GZ);be("reciprocal",HZ);be("trunc",WZ);be("fwidth",jZ);be("atan2",sQ);be("min",Uh);be("max",sr);be("step",RB);be("reflect",XZ);be("distance",YZ);be("dot",SE);be("cross",CB);be("pow",Fv);be("pow2",NB);be("pow3",ZZ);be("pow4",QZ);be("transformDirection",JZ);be("mix",iQ);be("clamp",fo);be("refract",LB);be("smoothstep",rQ);be("faceForward",tQ);be("difference",KZ);be("saturate",DB);be("cbrt",eQ);be("transpose",qZ);be("rand",nQ);class aQ extends Ot{static get type(){return"ConditionalNode"}constructor(e,t,n=null){super(),this.condNode=e,this.ifNode=t,this.elseNode=n}getNodeType(e){const{ifNode:t,elseNode:n}=e.getNodeProperties(this);if(t===void 0)return this.setup(e),this.getNodeType(e);const r=t.getNodeType(e);if(n!==null){const s=n.getNodeType(e);if(e.getTypeLength(s)>e.getTypeLength(r))return s}return r}setup(e){const t=this.condNode.cache(),n=this.ifNode.cache(),r=this.elseNode?this.elseNode.cache():null,s=e.context.nodeBlock;e.getDataFromNode(n).parentNodeBlock=s,r!==null&&(e.getDataFromNode(r).parentNodeBlock=s);const a=e.getNodeProperties(this);a.condNode=t,a.ifNode=n.context({nodeBlock:n}),a.elseNode=r?r.context({nodeBlock:r}):null}generate(e,t){const n=this.getNodeType(e),r=e.getDataFromNode(this);if(r.nodeProperty!==void 0)return r.nodeProperty;const{condNode:s,ifNode:a,elseNode:l}=e.getNodeProperties(this),u=e.currentFunctionNode,h=t!=="void",d=h?Zp(n).build(e):"";r.nodeProperty=d;const p=s.build(e,"bool");e.addFlowCode(`
${e.tab}if ( ${p} ) {

`).addFlowTab();let g=a.build(e,n);if(g&&(h?g=d+" = "+g+";":(g="return "+g+";",u===null&&(console.warn("THREE.TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),g="// "+g))),e.removeFlowTab().addFlowCode(e.tab+"	"+g+`

`+e.tab+"}"),l!==null){e.addFlowCode(` else {

`).addFlowTab();let y=l.build(e,n);y&&(h?y=d+" = "+y+";":(y="return "+y+";",u===null&&(console.warn("THREE.TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),y="// "+y))),e.removeFlowTab().addFlowCode(e.tab+"	"+y+`

`+e.tab+`}

`)}else e.addFlowCode(`

`);return e.format(d,n,t)}}const ir=Oe(aQ).setParameterLength(2,3);be("select",ir);const oQ=(...i)=>(console.warn("THREE.TSL: cond() has been renamed to select()."),ir(...i));be("cond",oQ);class UB extends Ot{static get type(){return"ContextNode"}constructor(e,t={}){super(),this.isContextNode=!0,this.node=e,this.value=t}getScope(){return this.node.getScope()}getNodeType(e){return this.node.getNodeType(e)}analyze(e){const t=e.getContext();e.setContext({...e.context,...this.value}),this.node.build(e),e.setContext(t)}setup(e){const t=e.getContext();e.setContext({...e.context,...this.value}),this.node.build(e),e.setContext(t)}generate(e,t){const n=e.getContext();e.setContext({...e.context,...this.value});const r=this.node.build(e,t);return e.setContext(n),r}}const TE=Oe(UB).setParameterLength(1,2),lQ=(i,e)=>TE(i,{label:e});be("context",TE);be("label",lQ);class Py extends Ot{static get type(){return"VarNode"}constructor(e,t=null,n=!1){super(),this.node=e,this.name=t,this.global=!0,this.isVarNode=!0,this.readOnly=n,this.parents=!0}getMemberType(e,t){return this.node.getMemberType(e,t)}getElementType(e){return this.node.getElementType(e)}getNodeType(e){return this.node.getNodeType(e)}generate(e){const{node:t,name:n,readOnly:r}=this,{renderer:s}=e,a=s.backend.isWebGPUBackend===!0;let l=!1,u=!1;r&&(l=e.isDeterministic(t),u=a?r:l);const h=e.getVectorType(this.getNodeType(e)),d=t.build(e,h),p=e.getVarFromNode(this,n,h,void 0,u),g=e.getPropertyName(p);let y=g;if(u)if(a)y=l?`const ${g}`:`let ${g}`;else{const v=e.getArrayCount(t);y=`const ${e.getVar(p.type,g,v)}`}return e.addLineFlowCode(`${y} = ${d}`,this),g}}const ME=Oe(Py),uQ=(i,e=null)=>ME(i,e).toStack(),cQ=(i,e=null)=>ME(i,e,!0).toStack();be("toVar",uQ);be("toConst",cQ);const hQ=i=>(console.warn('TSL: "temp( node )" is deprecated. Use "Var( node )" or "node.toVar()" instead.'),ME(i));be("temp",hQ);class fQ extends Ot{static get type(){return"VaryingNode"}constructor(e,t=null){super(),this.node=e,this.name=t,this.isVaryingNode=!0,this.interpolationType=null,this.interpolationSampling=null,this.global=!0}setInterpolation(e,t=null){return this.interpolationType=e,this.interpolationSampling=t,this}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}setupVarying(e){const t=e.getNodeProperties(this);let n=t.varying;if(n===void 0){const r=this.name,s=this.getNodeType(e),a=this.interpolationType,l=this.interpolationSampling;t.varying=n=e.getVaryingFromNode(this,r,s,a,l),t.node=this.node}return n.needsInterpolation||(n.needsInterpolation=e.shaderStage==="fragment"),n}setup(e){this.setupVarying(e),e.flowNodeFromShaderStage(Zg.VERTEX,this.node)}analyze(e){this.setupVarying(e),e.flowNodeFromShaderStage(Zg.VERTEX,this.node)}generate(e){const t=e.getNodeProperties(this),n=this.setupVarying(e);if(t.propertyName===void 0){const r=this.getNodeType(e),s=e.getPropertyName(n,Zg.VERTEX);e.flowNodeFromShaderStage(Zg.VERTEX,this.node,r,s),t.propertyName=s}return e.getPropertyName(n)}}const Hs=Oe(fQ).setParameterLength(1,2),dQ=i=>Hs(i);be("toVarying",Hs);be("toVertexStage",dQ);be("varying",(...i)=>(console.warn("THREE.TSL: .varying() has been renamed to .toVarying()."),Hs(...i)));be("vertexStage",(...i)=>(console.warn("THREE.TSL: .vertexStage() has been renamed to .toVertexStage()."),Hs(...i)));const pQ=Ue(([i])=>{const e=i.mul(.9478672986).add(.0521327014).pow(2.4),t=i.mul(.0773993808),n=i.lessThanEqual(.04045);return Dn(e,t,n)}).setLayout({name:"sRGBTransferEOTF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),mQ=Ue(([i])=>{const e=i.pow(.41666).mul(1.055).sub(.055),t=i.mul(12.92),n=i.lessThanEqual(.0031308);return Dn(e,t,n)}).setLayout({name:"sRGBTransferOETF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),EE="WorkingColorSpace",gQ="OutputColorSpace";class OB extends mi{static get type(){return"ColorSpaceNode"}constructor(e,t,n){super("vec4"),this.colorNode=e,this.source=t,this.target=n}resolveColorSpace(e,t){return t===EE?wt.workingColorSpace:t===gQ?e.context.outputColorSpace||e.renderer.outputColorSpace:t}setup(e){const{colorNode:t}=this,n=this.resolveColorSpace(e,this.source),r=this.resolveColorSpace(e,this.target);let s=t;return wt.enabled===!1||n===r||!n||!r||(wt.getTransfer(n)===Ze&&(s=Ut(pQ(s.rgb),s.a)),wt.getPrimaries(n)!==wt.getPrimaries(r)&&(s=Ut(_r(wt._getMatrix(new Nt,n,r)).mul(s.rgb),s.a)),wt.getTransfer(r)===Ze&&(s=Ut(mQ(s.rgb),s.a))),s}}const yQ=(i,e)=>Ie(new OB(Ie(i),EE,e)),AE=(i,e)=>Ie(new OB(Ie(i),e,EE));be("workingToColorSpace",yQ);be("colorSpaceToWorking",AE);let vQ=class extends Kp{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),n=this.referenceNode.getNodeType(),r=this.getNodeType();return e.format(t,n,r)}};class BB extends Ot{static get type(){return"ReferenceBaseNode"}constructor(e,t,n=null,r=null){super(),this.property=e,this.uniformType=t,this.object=n,this.count=r,this.properties=e.split("."),this.reference=n,this.node=null,this.group=null,this.updateType=Ht.OBJECT}setGroup(e){return this.group=e,this}element(e){return Ie(new vQ(this,Ie(e)))}setNodeType(e){const t=Et(null,e).getSelf();this.group!==null&&t.setGroup(this.group),this.node=t}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let n=e[t[0]];for(let r=1;r<t.length;r++)n=n[t[r]];return n}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const _Q=(i,e,t)=>Ie(new BB(i,e,t));class xQ extends BB{static get type(){return"RendererReferenceNode"}constructor(e,t,n=null){super(e,t,n),this.renderer=n,this.setGroup(Mt)}updateReference(e){return this.reference=this.renderer!==null?this.renderer:e.renderer,this.reference}}const bQ=(i,e,t=null)=>Ie(new xQ(i,e,t));class SQ extends mi{static get type(){return"ToneMappingNode"}constructor(e,t=MQ,n=null){super("vec3"),this.toneMapping=e,this.exposureNode=t,this.colorNode=n}customCacheKey(){return Qy(this.toneMapping)}setup(e){const t=this.colorNode||e.context.color,n=this.toneMapping;if(n===Or)return t;let r=null;const s=e.renderer.library.getToneMappingFunction(n);return s!==null?r=Ut(s(t.rgb,this.exposureNode),t.a):(console.error("ToneMappingNode: Unsupported Tone Mapping configuration.",n),r=t),r}}const TQ=(i,e,t)=>Ie(new SQ(i,Ie(e),Ie(t))),MQ=bQ("toneMappingExposure","float");be("toneMapping",(i,e,t)=>TQ(e,t,i));class EQ extends hE{static get type(){return"BufferAttributeNode"}constructor(e,t=null,n=0,r=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferStride=n,this.bufferOffset=r,this.usage=Hy,this.instanced=!1,this.attribute=null,this.global=!0,e&&e.isBufferAttribute===!0&&(this.attribute=e,this.usage=e.usage,this.instanced=e.isInstancedBufferAttribute)}getHash(e){if(this.bufferStride===0&&this.bufferOffset===0){let t=e.globalCache.getData(this.value);return t===void 0&&(t={node:this},e.globalCache.setData(this.value,t)),t.node.uuid}return this.uuid}getNodeType(e){return this.bufferType===null&&(this.bufferType=e.getTypeFromAttribute(this.attribute)),this.bufferType}setup(e){if(this.attribute!==null)return;const t=this.getNodeType(e),n=this.value,r=e.getTypeLength(t),s=this.bufferStride||r,a=this.bufferOffset,l=n.isInterleavedBuffer===!0?n:new XM(n,s),u=new Mp(l,r,a);l.setUsage(this.usage),this.attribute=u,this.attribute.isInstancedBufferAttribute=this.instanced}generate(e){const t=this.getNodeType(e),n=e.getBufferAttributeFromNode(this,t),r=e.getPropertyName(n);let s=null;return e.shaderStage==="vertex"||e.shaderStage==="compute"?(this.name=r,s=r):s=Hs(this).build(e,t),s}getInputType(){return"bufferAttribute"}setUsage(e){return this.usage=e,this.attribute&&this.attribute.isBufferAttribute===!0&&(this.attribute.usage=e),this}setInstanced(e){return this.instanced=e,this}}const wE=(i,e=null,t=0,n=0)=>Ie(new EQ(i,e,t,n)),AQ=(i,e=null,t=0,n=0)=>wE(i,e,t,n).setUsage(Wc),lD=(i,e=null,t=0,n=0)=>wE(i,e,t,n).setInstanced(!0),uD=(i,e=null,t=0,n=0)=>AQ(i,e,t,n).setInstanced(!0);be("toAttribute",i=>wE(i.value));class wQ extends Ot{static get type(){return"ComputeNode"}constructor(e,t,n=[64]){super("void"),this.isComputeNode=!0,this.computeNode=e,this.count=t,this.workgroupSize=n,this.dispatchCount=0,this.version=1,this.name="",this.updateBeforeType=Ht.OBJECT,this.onInitFunction=null,this.updateDispatchCount()}dispose(){this.dispatchEvent({type:"dispose"})}label(e){return this.name=e,this}updateDispatchCount(){const{count:e,workgroupSize:t}=this;let n=t[0];for(let r=1;r<t.length;r++)n*=t[r];this.dispatchCount=Math.ceil(e/n)}onInit(e){return this.onInitFunction=e,this}updateBefore({renderer:e}){e.compute(this)}setup(e){const t=this.computeNode.build(e);if(t){const n=e.getNodeProperties(this);n.outputComputeNode=t.outputNode,t.outputNode=null}return t}generate(e,t){const{shaderStage:n}=e;if(n==="compute"){const r=this.computeNode.build(e,"void");r!==""&&e.addLineFlowCode(r,this)}else{const s=e.getNodeProperties(this).outputComputeNode;if(s)return s.build(e,t)}}}const RQ=(i,e,t)=>Ie(new wQ(Ie(i),e,t));be("compute",RQ);class CQ extends Ot{static get type(){return"CacheNode"}constructor(e,t=!0){super(),this.node=e,this.parent=t,this.isCacheNode=!0}getNodeType(e){const t=e.getCache(),n=e.getCacheFromNode(this,this.parent);e.setCache(n);const r=this.node.getNodeType(e);return e.setCache(t),r}build(e,...t){const n=e.getCache(),r=e.getCacheFromNode(this,this.parent);e.setCache(r);const s=this.node.build(e,...t);return e.setCache(n),s}}const Dy=(i,e)=>Ie(new CQ(Ie(i),e)),NQ=(i,e)=>i.context({namespace:e});be("cache",Dy);class PQ extends Ot{static get type(){return"BypassNode"}constructor(e,t){super(),this.isBypassNode=!0,this.outputNode=e,this.callNode=t}getNodeType(e){return this.outputNode.getNodeType(e)}generate(e){const t=this.callNode.build(e,"void");return t!==""&&e.addLineFlowCode(t,this),this.outputNode.build(e)}}const DQ=Oe(PQ).setParameterLength(2);be("bypass",DQ);class IB extends Ot{static get type(){return"RemapNode"}constructor(e,t,n,r=Te(0),s=Te(1)){super(),this.node=e,this.inLowNode=t,this.inHighNode=n,this.outLowNode=r,this.outHighNode=s,this.doClamp=!0}setup(){const{node:e,inLowNode:t,inHighNode:n,outLowNode:r,outHighNode:s,doClamp:a}=this;let l=e.sub(t).div(n.sub(t));return a===!0&&(l=l.clamp()),l.mul(s.sub(r)).add(r)}}const LQ=Oe(IB,null,null,{doClamp:!1}).setParameterLength(3,5),UQ=Oe(IB).setParameterLength(3,5);be("remap",LQ);be("remapClamp",UQ);class Ly extends Ot{static get type(){return"ExpressionNode"}constructor(e="",t="void"){super(t),this.snippet=e}generate(e,t){const n=this.getNodeType(e),r=this.snippet;if(n==="void")e.addLineFlowCode(r,this);else return e.format(r,n,t)}}const Oh=Oe(Ly).setParameterLength(1,2),OQ=i=>(i?ir(i,Oh("discard")):Oh("discard")).toStack();be("discard",OQ);class BQ extends mi{static get type(){return"RenderOutputNode"}constructor(e,t,n){super("vec4"),this.colorNode=e,this.toneMapping=t,this.outputColorSpace=n,this.isRenderOutputNode=!0}setup({context:e}){let t=this.colorNode||e.color;const n=(this.toneMapping!==null?this.toneMapping:e.toneMapping)||Or,r=(this.outputColorSpace!==null?this.outputColorSpace:e.outputColorSpace)||pr;return n!==Or&&(t=t.toneMapping(n)),r!==pr&&r!==wt.workingColorSpace&&(t=t.workingToColorSpace(r)),t}}const IQ=(i,e=null,t=null)=>Ie(new BQ(Ie(i),e,t));be("renderOutput",IQ);class FQ extends mi{static get type(){return"DebugNode"}constructor(e,t=null){super(),this.node=e,this.callback=t}getNodeType(e){return this.node.getNodeType(e)}setup(e){return this.node.build(e)}analyze(e){return this.node.build(e)}generate(e){const t=this.callback,n=this.node.build(e),r="--- TSL debug - "+e.shaderStage+" shader ---",s="-".repeat(r.length);let a="";return a+="// #"+r+`#
`,a+=e.flow.code.replace(/^\t/mg,"")+`
`,a+="/* ... */ "+n+` /* ... */
`,a+="// #"+s+`#
`,t!==null?t(e,a):console.log(a),n}}const kQ=(i,e=null)=>Ie(new FQ(Ie(i),e));be("debug",kQ);class FB extends Ot{static get type(){return"AttributeNode"}constructor(e,t=null){super(t),this.global=!0,this._attributeName=e}getHash(e){return this.getAttributeName(e)}getNodeType(e){let t=this.nodeType;if(t===null){const n=this.getAttributeName(e);if(e.hasGeometryAttribute(n)){const r=e.geometry.getAttribute(n);t=e.getTypeFromAttribute(r)}else t="float"}return t}setAttributeName(e){return this._attributeName=e,this}getAttributeName(){return this._attributeName}generate(e){const t=this.getAttributeName(e),n=this.getNodeType(e);if(e.hasGeometryAttribute(t)===!0){const s=e.geometry.getAttribute(t),a=e.getTypeFromAttribute(s),l=e.getAttribute(t,a);return e.shaderStage==="vertex"?e.format(l.name,a,n):Hs(this).build(e,n)}else return console.warn(`AttributeNode: Vertex attribute "${t}" not found on geometry.`),e.generateConst(n)}serialize(e){super.serialize(e),e.global=this.global,e._attributeName=this._attributeName}deserialize(e){super.deserialize(e),this.global=e.global,this._attributeName=e._attributeName}}const ml=(i,e=null)=>Ie(new FB(i,e)),Jp=(i=0)=>ml("uv"+(i>0?i:""),"vec2");class zQ extends Ot{static get type(){return"TextureSizeNode"}constructor(e,t=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=e,this.levelNode=t}generate(e,t){const n=this.textureNode.build(e,"property"),r=this.levelNode===null?"0":this.levelNode.build(e,"int");return e.format(`${e.getMethod("textureDimensions")}( ${n}, ${r} )`,this.getNodeType(e),t)}}const rh=Oe(zQ).setParameterLength(1,2);class VQ extends Qp{static get type(){return"MaxMipLevelNode"}constructor(e){super(0),this._textureNode=e,this.updateType=Ht.FRAME}get textureNode(){return this._textureNode}get texture(){return this._textureNode.value}update(){const e=this.texture,t=e.images,n=t&&t.length>0?t[0]&&t[0].image||t[0]:e.image;if(n&&n.width!==void 0){const{width:r,height:s}=n;this.value=Math.log2(Math.max(r,s))}}}const GQ=Oe(VQ).setParameterLength(1),kB=new ei;class Kh extends Qp{static get type(){return"TextureNode"}constructor(e=kB,t=null,n=null,r=null){super(e),this.isTextureNode=!0,this.uvNode=t,this.levelNode=n,this.biasNode=r,this.compareNode=null,this.depthNode=null,this.gradNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=Ht.NONE,this.referenceNode=null,this._value=e,this._matrixUniform=null,this.setUpdateMatrix(t===null)}set value(e){this.referenceNode?this.referenceNode.value=e:this._value=e}get value(){return this.referenceNode?this.referenceNode.value:this._value}getUniformHash(){return this.value.uuid}getNodeType(){return this.value.isDepthTexture===!0?"float":this.value.type===En?"uvec4":this.value.type===Li?"ivec4":"vec4"}getInputType(){return"texture"}getDefaultUV(){return Jp(this.value.channel)}updateReference(){return this.value}getTransformedUV(e){return this._matrixUniform===null&&(this._matrixUniform=Et(this.value.matrix)),this._matrixUniform.mul(Ee(e,1)).xy}setUpdateMatrix(e){return this.updateMatrix=e,this.updateType=e?Ht.OBJECT:Ht.NONE,this}setupUV(e,t){const n=this.value;return e.isFlipY()&&(n.image instanceof ImageBitmap&&n.flipY===!0||n.isRenderTargetTexture===!0||n.isFramebufferTexture===!0||n.isDepthTexture===!0)&&(this.sampler?t=t.flipY():t=t.setY(Nn(rh(this,this.levelNode).y).sub(t.y).sub(1))),t}setup(e){const t=e.getNodeProperties(this);t.referenceNode=this.referenceNode;const n=this.value;if(!n||n.isTexture!==!0)throw new Error("THREE.TSL: `texture( value )` function expects a valid instance of THREE.Texture().");let r=this.uvNode;(r===null||e.context.forceUVContext===!0)&&e.context.getUV&&(r=e.context.getUV(this,e)),r||(r=this.getDefaultUV()),this.updateMatrix===!0&&(r=this.getTransformedUV(r)),r=this.setupUV(e,r);let s=this.levelNode;s===null&&e.context.getTextureLevel&&(s=e.context.getTextureLevel(this)),t.uvNode=r,t.levelNode=s,t.biasNode=this.biasNode,t.compareNode=this.compareNode,t.gradNode=this.gradNode,t.depthNode=this.depthNode}generateUV(e,t){return t.build(e,this.sampler===!0?"vec2":"ivec2")}generateSnippet(e,t,n,r,s,a,l,u){const h=this.value;let d;return r?d=e.generateTextureLevel(h,t,n,r,a):s?d=e.generateTextureBias(h,t,n,s,a):u?d=e.generateTextureGrad(h,t,n,u,a):l?d=e.generateTextureCompare(h,t,n,l,a):this.sampler===!1?d=e.generateTextureLoad(h,t,n,a):d=e.generateTexture(h,t,n,a),d}generate(e,t){const n=this.value,r=e.getNodeProperties(this),s=super.generate(e,"property");if(/^sampler/.test(t))return s+"_sampler";if(e.isReference(t))return s;{const a=e.getDataFromNode(this);let l=a.propertyName;if(l===void 0){const{uvNode:d,levelNode:p,biasNode:g,compareNode:y,depthNode:v,gradNode:S}=r,b=this.generateUV(e,d),_=p?p.build(e,"float"):null,E=g?g.build(e,"float"):null,M=v?v.build(e,"int"):null,A=y?y.build(e,"float"):null,w=S?[S[0].build(e,"vec2"),S[1].build(e,"vec2")]:null,R=e.getVarFromNode(this);l=e.getPropertyName(R);const C=this.generateSnippet(e,s,b,_,E,M,A,w);e.addLineFlowCode(`${l} = ${C}`,this),a.snippet=C,a.propertyName=l}let u=l;const h=this.getNodeType(e);return e.needsToWorkingColorSpace(n)&&(u=AE(Oh(u,h),n.colorSpace).setup(e).build(e,h)),e.format(u,h,t)}}setSampler(e){return this.sampler=e,this}getSampler(){return this.sampler}uv(e){return console.warn("THREE.TextureNode: .uv() has been renamed. Use .sample() instead."),this.sample(e)}sample(e){const t=this.clone();return t.uvNode=Ie(e),t.referenceNode=this.getSelf(),Ie(t)}blur(e){const t=this.clone();t.biasNode=Ie(e).mul(GQ(t)),t.referenceNode=this.getSelf();const n=t.value;return t.generateMipmaps===!1&&(n&&n.generateMipmaps===!1||n.minFilter===Pn||n.magFilter===Pn)&&(console.warn("THREE.TSL: texture().blur() requires mipmaps and sampling. Use .generateMipmaps=true and .minFilter/.magFilter=THREE.LinearFilter in the Texture."),t.biasNode=null),Ie(t)}level(e){const t=this.clone();return t.levelNode=Ie(e),t.referenceNode=this.getSelf(),Ie(t)}size(e){return rh(this,e)}bias(e){const t=this.clone();return t.biasNode=Ie(e),t.referenceNode=this.getSelf(),Ie(t)}compare(e){const t=this.clone();return t.compareNode=Ie(e),t.referenceNode=this.getSelf(),Ie(t)}grad(e,t){const n=this.clone();return n.gradNode=[Ie(e),Ie(t)],n.referenceNode=this.getSelf(),Ie(n)}depth(e){const t=this.clone();return t.depthNode=Ie(e),t.referenceNode=this.getSelf(),Ie(t)}serialize(e){super.serialize(e),e.value=this.value.toJSON(e.meta).uuid,e.sampler=this.sampler,e.updateMatrix=this.updateMatrix,e.updateType=this.updateType}deserialize(e){super.deserialize(e),this.value=e.meta.textures[e.value],this.sampler=e.sampler,this.updateMatrix=e.updateMatrix,this.updateType=e.updateType}update(){const e=this.value,t=this._matrixUniform;t!==null&&(t.value=e.matrix),e.matrixAutoUpdate===!0&&e.updateMatrix()}clone(){const e=new this.constructor(this.value,this.uvNode,this.levelNode,this.biasNode);return e.sampler=this.sampler,e.depthNode=this.depthNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e}}const HQ=Oe(Kh).setParameterLength(1,4).setName("texture"),nn=(i=kB,e=null,t=null,n=null)=>{let r;return i&&i.isTextureNode===!0?(r=Ie(i.clone()),r.referenceNode=i.getSelf(),e!==null&&(r.uvNode=Ie(e)),t!==null&&(r.levelNode=Ie(t)),n!==null&&(r.biasNode=Ie(n))):r=HQ(i,e,t,n),r},Us=(...i)=>nn(...i).setSampler(!1);class zB extends Qp{static get type(){return"BufferNode"}constructor(e,t,n=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferCount=n}getElementType(e){return this.getNodeType(e)}getInputType(){return"buffer"}}const VB=(i,e,t)=>Ie(new zB(i,e,t));class WQ extends Kp{static get type(){return"UniformArrayElementNode"}constructor(e,t){super(e,t),this.isArrayBufferElementNode=!0}generate(e){const t=super.generate(e),n=this.getNodeType(),r=this.node.getPaddedType();return e.format(t,r,n)}}class jQ extends zB{static get type(){return"UniformArrayNode"}constructor(e,t=null){super(null),this.array=e,this.elementType=t===null?ev(e[0]):t,this.paddedType=this.getPaddedType(),this.updateType=Ht.RENDER,this.isArrayBufferNode=!0}getNodeType(){return this.paddedType}getElementType(){return this.elementType}getPaddedType(){const e=this.elementType;let t="vec4";return e==="mat2"?t="mat2":/mat/.test(e)===!0?t="mat4":e.charAt(0)==="i"?t="ivec4":e.charAt(0)==="u"&&(t="uvec4"),t}update(){const{array:e,value:t}=this,n=this.elementType;if(n==="float"||n==="int"||n==="uint")for(let r=0;r<e.length;r++){const s=r*4;t[s]=e[r]}else if(n==="color")for(let r=0;r<e.length;r++){const s=r*4,a=e[r];t[s]=a.r,t[s+1]=a.g,t[s+2]=a.b||0}else if(n==="mat2")for(let r=0;r<e.length;r++){const s=r*4,a=e[r];t[s]=a.elements[0],t[s+1]=a.elements[1],t[s+2]=a.elements[2],t[s+3]=a.elements[3]}else if(n==="mat3")for(let r=0;r<e.length;r++){const s=r*16,a=e[r];t[s]=a.elements[0],t[s+1]=a.elements[1],t[s+2]=a.elements[2],t[s+4]=a.elements[3],t[s+5]=a.elements[4],t[s+6]=a.elements[5],t[s+8]=a.elements[6],t[s+9]=a.elements[7],t[s+10]=a.elements[8],t[s+15]=1}else if(n==="mat4")for(let r=0;r<e.length;r++){const s=r*16,a=e[r];for(let l=0;l<a.elements.length;l++)t[s+l]=a.elements[l]}else for(let r=0;r<e.length;r++){const s=r*4,a=e[r];t[s]=a.x,t[s+1]=a.y,t[s+2]=a.z||0,t[s+3]=a.w||0}}setup(e){const t=this.array.length,n=this.elementType;let r=Float32Array;const s=this.paddedType,a=e.getTypeLength(s);return n.charAt(0)==="i"&&(r=Int32Array),n.charAt(0)==="u"&&(r=Uint32Array),this.value=new r(t*a),this.bufferCount=t,this.bufferType=s,super.setup(e)}element(e){return Ie(new WQ(this,Ie(e)))}}const ia=(i,e)=>Ie(new jQ(i,e));class qQ extends Ot{constructor(e){super("float"),this.name=e,this.isBuiltinNode=!0}generate(){return this.name}}const kv=Oe(qQ).setParameterLength(1),GB=Et(0,"uint").label("u_cameraIndex").setGroup(_E("cameraIndex")).toVarying("v_cameraIndex"),ou=Et("float").label("cameraNear").setGroup(Mt).onRenderUpdate(({camera:i})=>i.near),lu=Et("float").label("cameraFar").setGroup(Mt).onRenderUpdate(({camera:i})=>i.far),RE=Ue(({camera:i})=>{let e;if(i.isArrayCamera&&i.cameras.length>0){const t=[];for(const r of i.cameras)t.push(r.projectionMatrix);e=ia(t).setGroup(Mt).label("cameraProjectionMatrices").element(i.isMultiViewCamera?kv("gl_ViewID_OVR"):GB).toVar("cameraProjectionMatrix")}else e=Et("mat4").label("cameraProjectionMatrix").setGroup(Mt).onRenderUpdate(({camera:t})=>t.projectionMatrix);return e}).once()(),yo=Ue(({camera:i})=>{let e;if(i.isArrayCamera&&i.cameras.length>0){const t=[];for(const r of i.cameras)t.push(r.matrixWorldInverse);e=ia(t).setGroup(Mt).label("cameraViewMatrices").element(i.isMultiViewCamera?kv("gl_ViewID_OVR"):GB).toVar("cameraViewMatrix")}else e=Et("mat4").label("cameraViewMatrix").setGroup(Mt).onRenderUpdate(({camera:t})=>t.matrixWorldInverse);return e}).once()(),$Q=Et(new V).label("cameraPosition").setGroup(Mt).onRenderUpdate(({camera:i},e)=>e.value.setFromMatrixPosition(i.matrixWorld)),cD=new Hp;class _n extends Ot{static get type(){return"Object3DNode"}constructor(e,t=null){super(),this.scope=e,this.object3d=t,this.updateType=Ht.OBJECT,this.uniformNode=new Qp(null)}getNodeType(){const e=this.scope;if(e===_n.WORLD_MATRIX)return"mat4";if(e===_n.POSITION||e===_n.VIEW_POSITION||e===_n.DIRECTION||e===_n.SCALE)return"vec3";if(e===_n.RADIUS)return"float"}update(e){const t=this.object3d,n=this.uniformNode,r=this.scope;if(r===_n.WORLD_MATRIX)n.value=t.matrixWorld;else if(r===_n.POSITION)n.value=n.value||new V,n.value.setFromMatrixPosition(t.matrixWorld);else if(r===_n.SCALE)n.value=n.value||new V,n.value.setFromMatrixScale(t.matrixWorld);else if(r===_n.DIRECTION)n.value=n.value||new V,t.getWorldDirection(n.value);else if(r===_n.VIEW_POSITION){const s=e.camera;n.value=n.value||new V,n.value.setFromMatrixPosition(t.matrixWorld),n.value.applyMatrix4(s.matrixWorldInverse)}else if(r===_n.RADIUS){const s=e.object.geometry;s.boundingSphere===null&&s.computeBoundingSphere(),cD.copy(s.boundingSphere).applyMatrix4(t.matrixWorld),n.value=cD.radius}}generate(e){const t=this.scope;return t===_n.WORLD_MATRIX?this.uniformNode.nodeType="mat4":t===_n.POSITION||t===_n.VIEW_POSITION||t===_n.DIRECTION||t===_n.SCALE?this.uniformNode.nodeType="vec3":t===_n.RADIUS&&(this.uniformNode.nodeType="float"),this.uniformNode.build(e)}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}_n.WORLD_MATRIX="worldMatrix";_n.POSITION="position";_n.SCALE="scale";_n.VIEW_POSITION="viewPosition";_n.DIRECTION="direction";_n.RADIUS="radius";const XQ=Oe(_n,_n.POSITION).setParameterLength(1);class Ts extends _n{static get type(){return"ModelNode"}constructor(e){super(e)}update(e){this.object3d=e.object,super.update(e)}}Ts.DIRECTION;const wu=Ge(Ts,Ts.WORLD_MATRIX);Ts.POSITION;Ts.SCALE;Ts.VIEW_POSITION;Ts.RADIUS;const YQ=Et(new Nt).onObjectUpdate(({object:i},e)=>e.value.getNormalMatrix(i.matrixWorld)),zv=Ue(i=>i.renderer.overrideNodes.modelViewMatrix||KQ).once()().toVar("modelViewMatrix"),KQ=yo.mul(wu),hD=Ue(i=>(i.context.isHighPrecisionModelViewMatrix=!0,Et("mat4").onObjectUpdate(({object:e,camera:t})=>e.modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld)))).once()().toVar("highpModelViewMatrix"),fD=Ue(i=>{const e=i.context.isHighPrecisionModelViewMatrix;return Et("mat3").onObjectUpdate(({object:t,camera:n})=>(e!==!0&&t.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix)))}).once()().toVar("highpModelNormalViewMatrix"),Vv=ml("position","vec3"),tr=Vv.toVarying("positionLocal"),dD=Vv.toVarying("positionPrevious"),Cp=Ue(i=>wu.mul(tr).xyz.toVarying(i.getNamespace("v_positionWorld")),"vec3").once("POSITION")(),HB=Ue(i=>tr.transformDirection(wu).toVarying(i.getNamespace("v_positionWorldDirection")).normalize().toVar("positionWorldDirection"),"vec3").once("POSITION")(),hi=Ue(i=>i.context.setupPositionView().toVarying(i.getNamespace("v_positionView")),"vec3").once("POSITION")(),zn=hi.negate().toVarying("v_positionViewDirection").normalize().toVar("positionViewDirection");class ZQ extends Ot{static get type(){return"FrontFacingNode"}constructor(){super("bool"),this.isFrontFacingNode=!0}generate(e){const{renderer:t,material:n}=e;return t.coordinateSystem===vr&&n.side===An?"false":e.getFrontFacing()}}const QQ=Ge(ZQ),Gv=Te(QQ).mul(2).sub(1),WB=ml("normal","vec3"),ma=Ue(i=>i.geometry.hasAttribute("normal")===!1?(console.warn('THREE.TSL: Vertex attribute "normal" not found on geometry.'),Ee(0,1,0)):WB,"vec3").once()().toVar("normalLocal"),JQ=hi.dFdx().cross(hi.dFdy()).normalize().toVar("normalFlat"),ga=Ue(i=>{let e;return i.material.flatShading===!0?e=JQ:e=Hs(jB(ma),"v_normalView").normalize(),e},"vec3").once()().toVar("normalView"),CE=Ue(i=>{let e=ga.transformDirection(yo);return i.material.flatShading!==!0&&(e=Hs(e,"v_normalWorld")),e},"vec3").once()().normalize().toVar("normalWorld"),ci=Ue(i=>{let e=i.context.setupNormal().context({getUV:null});return i.material.flatShading!==!0&&(e=e.mul(Gv)),e},"vec3").once()().toVar("transformedNormalView"),NE=ci.transformDirection(yo).toVar("transformedNormalWorld"),Pd=Ue(i=>{let e=i.context.setupClearcoatNormal().context({getUV:null});return i.material.flatShading!==!0&&(e=e.mul(Gv)),e},"vec3").once()().toVar("transformedClearcoatNormalView"),eJ=Ue(([i,e=wu])=>{const t=_r(e),n=i.div(Ee(t[0].dot(t[0]),t[1].dot(t[1]),t[2].dot(t[2])));return t.mul(n).xyz}),jB=Ue(([i],e)=>{const t=e.renderer.overrideNodes.modelNormalViewMatrix;if(t!==null)return t.transformDirection(i);const n=YQ.mul(i);return yo.transformDirection(n)}),pD=new Br,Sb=new Wt,tJ=Et(0).onReference(({material:i})=>i).onObjectUpdate(({material:i})=>i.refractionRatio),Tb=Et(1).onReference(({material:i})=>i).onObjectUpdate(function({material:i,scene:e}){return i.envMap?i.envMapIntensity:e.environmentIntensity}),qB=Et(new Wt).onReference(function(i){return i.material}).onObjectUpdate(function({material:i,scene:e}){const t=e.environment!==null&&i.envMap===null?e.environmentRotation:i.envMapRotation;return t?(pD.copy(t),Sb.makeRotationFromEuler(pD)):Sb.identity(),Sb}),nJ=zn.negate().reflect(ci),iJ=zn.negate().refract(ci,tJ),rJ=nJ.transformDirection(yo).toVar("reflectVector"),sJ=iJ.transformDirection(yo).toVar("reflectVector"),aJ=new Wp;class oJ extends Kh{static get type(){return"CubeTextureNode"}constructor(e,t=null,n=null,r=null){super(e,t,n,r),this.isCubeTextureNode=!0}getInputType(){return"cubeTexture"}getDefaultUV(){const e=this.value;return e.mapping===ha?rJ:e.mapping===fa?sJ:(console.error('THREE.CubeTextureNode: Mapping "%s" not supported.',e.mapping),Ee(0,0,0))}setUpdateMatrix(){}setupUV(e,t){const n=this.value;return(e.renderer.coordinateSystem===fl||!n.isRenderTargetTexture)&&(t=Ee(t.x.negate(),t.yz)),qB.mul(t)}generateUV(e,t){return t.build(e,"vec3")}}const lJ=Oe(oJ).setParameterLength(1,4).setName("cubeTexture"),Np=(i=aJ,e=null,t=null,n=null)=>{let r;return i&&i.isCubeTextureNode===!0?(r=Ie(i.clone()),r.referenceNode=i.getSelf(),e!==null&&(r.uvNode=Ie(e)),t!==null&&(r.levelNode=Ie(t)),n!==null&&(r.biasNode=Ie(n))):r=lJ(i,e,t,n),r};class uJ extends Kp{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),n=this.referenceNode.getNodeType(),r=this.getNodeType();return e.format(t,n,r)}}class PE extends Ot{static get type(){return"ReferenceNode"}constructor(e,t,n=null,r=null){super(),this.property=e,this.uniformType=t,this.object=n,this.count=r,this.properties=e.split("."),this.reference=n,this.node=null,this.group=null,this.name=null,this.updateType=Ht.OBJECT}element(e){return Ie(new uJ(this,Ie(e)))}setGroup(e){return this.group=e,this}label(e){return this.name=e,this}setNodeType(e){let t=null;this.count!==null?t=VB(null,e,this.count):Array.isArray(this.getValueFromReference())?t=ia(null,e):e==="texture"?t=nn(null):e==="cubeTexture"?t=Np(null):t=Et(null,e),this.group!==null&&t.setGroup(this.group),this.name!==null&&t.label(this.name),this.node=t.getSelf()}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let n=e[t[0]];for(let r=1;r<t.length;r++)n=n[t[r]];return n}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const Mn=(i,e,t)=>Ie(new PE(i,e,t)),mD=(i,e,t,n)=>Ie(new PE(i,e,n,t));class cJ extends PE{static get type(){return"MaterialReferenceNode"}constructor(e,t,n=null){super(e,t,n),this.material=n,this.isMaterialReferenceNode=!0}updateReference(e){return this.reference=this.material!==null?this.material:e.material,this.reference}}const tl=(i,e,t=null)=>Ie(new cJ(i,e,t)),$B=Ue(i=>(i.geometry.hasAttribute("tangent")===!1&&i.geometry.computeTangents(),ml("tangent","vec4")))(),DE=$B.xyz.toVar("tangentLocal"),XB=zv.mul(Ut(DE,0)).xyz.toVarying("v_tangentView").normalize().toVar("tangentView"),hJ=Ue(([i,e],t)=>{let n=i.mul($B.w).xyz;return t.material.flatShading!==!0&&(n=Hs(n,e)),n}).once(),fJ=hJ(ga.cross(XB),"v_bitangentView").normalize().toVar("bitangentView"),Dd=_r(XB,fJ,ga),dJ=(()=>{let i=ih.cross(zn);return i=i.cross(ih).normalize(),i=Dn(i,ci,iu.mul(Qa.oneMinus()).oneMinus().pow2().pow2()).normalize(),i})(),pJ=Ue(i=>{const{eye_pos:e,surf_norm:t,mapN:n,uv:r}=i,s=e.dFdx(),a=e.dFdy(),l=r.dFdx(),u=r.dFdy(),h=t,d=a.cross(h),p=h.cross(s),g=d.mul(l.x).add(p.mul(u.x)),y=d.mul(l.y).add(p.mul(u.y)),v=g.dot(g).max(y.dot(y)),S=Gv.mul(v.inverseSqrt());return xr(g.mul(n.x,S),y.mul(n.y,S),h.mul(n.z)).normalize()});class mJ extends mi{static get type(){return"NormalMapNode"}constructor(e,t=null){super("vec3"),this.node=e,this.scaleNode=t,this.normalMapType=ho}setup(e){const{normalMapType:t,scaleNode:n}=this;let r=this.node.mul(2).sub(1);n!==null&&(r=Ee(r.xy.mul(n),r.z));let s=null;return t===eO?s=jB(r):t===ho&&(e.hasGeometryAttribute("tangent")===!0?s=Dd.mul(r).normalize():s=pJ({eye_pos:hi,surf_norm:ga,mapN:r,uv:Jp()})),s}}const gD=Oe(mJ).setParameterLength(1,2),gJ=Ue(({textureNode:i,bumpScale:e})=>{const t=r=>i.cache().context({getUV:s=>r(s.uvNode||Jp()),forceUVContext:!0}),n=Te(t(r=>r));return We(Te(t(r=>r.add(r.dFdx()))).sub(n),Te(t(r=>r.add(r.dFdy()))).sub(n)).mul(e)}),yJ=Ue(i=>{const{surf_pos:e,surf_norm:t,dHdxy:n}=i,r=e.dFdx().normalize(),s=e.dFdy().normalize(),a=t,l=s.cross(a),u=a.cross(r),h=r.dot(l).mul(Gv),d=h.sign().mul(n.x.mul(l).add(n.y.mul(u)));return h.abs().mul(t).sub(d).normalize()});class vJ extends mi{static get type(){return"BumpMapNode"}constructor(e,t=null){super("vec3"),this.textureNode=e,this.scaleNode=t}setup(){const e=this.scaleNode!==null?this.scaleNode:1,t=gJ({textureNode:this.textureNode,bumpScale:e});return yJ({surf_pos:hi,surf_norm:ga,dHdxy:t})}}const _J=Oe(vJ).setParameterLength(1,2),yD=new Map;class xe extends Ot{static get type(){return"MaterialNode"}constructor(e){super(),this.scope=e}getCache(e,t){let n=yD.get(e);return n===void 0&&(n=tl(e,t),yD.set(e,n)),n}getFloat(e){return this.getCache(e,"float")}getColor(e){return this.getCache(e,"color")}getTexture(e){return this.getCache(e==="map"?"map":e+"Map","texture")}setup(e){const t=e.context.material,n=this.scope;let r=null;if(n===xe.COLOR){const s=t.color!==void 0?this.getColor(n):Ee();t.map&&t.map.isTexture===!0?r=s.mul(this.getTexture("map")):r=s}else if(n===xe.OPACITY){const s=this.getFloat(n);t.alphaMap&&t.alphaMap.isTexture===!0?r=s.mul(this.getTexture("alpha")):r=s}else if(n===xe.SPECULAR_STRENGTH)t.specularMap&&t.specularMap.isTexture===!0?r=this.getTexture("specular").r:r=Te(1);else if(n===xe.SPECULAR_INTENSITY){const s=this.getFloat(n);t.specularIntensityMap&&t.specularIntensityMap.isTexture===!0?r=s.mul(this.getTexture(n).a):r=s}else if(n===xe.SPECULAR_COLOR){const s=this.getColor(n);t.specularColorMap&&t.specularColorMap.isTexture===!0?r=s.mul(this.getTexture(n).rgb):r=s}else if(n===xe.ROUGHNESS){const s=this.getFloat(n);t.roughnessMap&&t.roughnessMap.isTexture===!0?r=s.mul(this.getTexture(n).g):r=s}else if(n===xe.METALNESS){const s=this.getFloat(n);t.metalnessMap&&t.metalnessMap.isTexture===!0?r=s.mul(this.getTexture(n).b):r=s}else if(n===xe.EMISSIVE){const s=this.getFloat("emissiveIntensity"),a=this.getColor(n).mul(s);t.emissiveMap&&t.emissiveMap.isTexture===!0?r=a.mul(this.getTexture(n)):r=a}else if(n===xe.NORMAL)t.normalMap?(r=gD(this.getTexture("normal"),this.getCache("normalScale","vec2")),r.normalMapType=t.normalMapType):t.bumpMap?r=_J(this.getTexture("bump").r,this.getFloat("bumpScale")):r=ga;else if(n===xe.CLEARCOAT){const s=this.getFloat(n);t.clearcoatMap&&t.clearcoatMap.isTexture===!0?r=s.mul(this.getTexture(n).r):r=s}else if(n===xe.CLEARCOAT_ROUGHNESS){const s=this.getFloat(n);t.clearcoatRoughnessMap&&t.clearcoatRoughnessMap.isTexture===!0?r=s.mul(this.getTexture(n).r):r=s}else if(n===xe.CLEARCOAT_NORMAL)t.clearcoatNormalMap?r=gD(this.getTexture(n),this.getCache(n+"Scale","vec2")):r=ga;else if(n===xe.SHEEN){const s=this.getColor("sheenColor").mul(this.getFloat("sheen"));t.sheenColorMap&&t.sheenColorMap.isTexture===!0?r=s.mul(this.getTexture("sheenColor").rgb):r=s}else if(n===xe.SHEEN_ROUGHNESS){const s=this.getFloat(n);t.sheenRoughnessMap&&t.sheenRoughnessMap.isTexture===!0?r=s.mul(this.getTexture(n).a):r=s,r=r.clamp(.07,1)}else if(n===xe.ANISOTROPY)if(t.anisotropyMap&&t.anisotropyMap.isTexture===!0){const s=this.getTexture(n);r=gE(hd.x,hd.y,hd.y.negate(),hd.x).mul(s.rg.mul(2).sub(We(1)).normalize().mul(s.b))}else r=hd;else if(n===xe.IRIDESCENCE_THICKNESS){const s=Mn("1","float",t.iridescenceThicknessRange);if(t.iridescenceThicknessMap){const a=Mn("0","float",t.iridescenceThicknessRange);r=s.sub(a).mul(this.getTexture(n).g).add(a)}else r=s}else if(n===xe.TRANSMISSION){const s=this.getFloat(n);t.transmissionMap?r=s.mul(this.getTexture(n).r):r=s}else if(n===xe.THICKNESS){const s=this.getFloat(n);t.thicknessMap?r=s.mul(this.getTexture(n).g):r=s}else if(n===xe.IOR)r=this.getFloat(n);else if(n===xe.LIGHT_MAP)r=this.getTexture(n).rgb.mul(this.getFloat("lightMapIntensity"));else if(n===xe.AO)r=this.getTexture(n).r.sub(1).mul(this.getFloat("aoMapIntensity")).add(1);else if(n===xe.LINE_DASH_OFFSET)r=t.dashOffset?this.getFloat(n):Te(0);else{const s=this.getNodeType(e);r=this.getCache(n,s)}return r}}xe.ALPHA_TEST="alphaTest";xe.COLOR="color";xe.OPACITY="opacity";xe.SHININESS="shininess";xe.SPECULAR="specular";xe.SPECULAR_STRENGTH="specularStrength";xe.SPECULAR_INTENSITY="specularIntensity";xe.SPECULAR_COLOR="specularColor";xe.REFLECTIVITY="reflectivity";xe.ROUGHNESS="roughness";xe.METALNESS="metalness";xe.NORMAL="normal";xe.CLEARCOAT="clearcoat";xe.CLEARCOAT_ROUGHNESS="clearcoatRoughness";xe.CLEARCOAT_NORMAL="clearcoatNormal";xe.EMISSIVE="emissive";xe.ROTATION="rotation";xe.SHEEN="sheen";xe.SHEEN_ROUGHNESS="sheenRoughness";xe.ANISOTROPY="anisotropy";xe.IRIDESCENCE="iridescence";xe.IRIDESCENCE_IOR="iridescenceIOR";xe.IRIDESCENCE_THICKNESS="iridescenceThickness";xe.IOR="ior";xe.TRANSMISSION="transmission";xe.THICKNESS="thickness";xe.ATTENUATION_DISTANCE="attenuationDistance";xe.ATTENUATION_COLOR="attenuationColor";xe.LINE_SCALE="scale";xe.LINE_DASH_SIZE="dashSize";xe.LINE_GAP_SIZE="gapSize";xe.LINE_WIDTH="linewidth";xe.LINE_DASH_OFFSET="dashOffset";xe.POINT_SIZE="size";xe.DISPERSION="dispersion";xe.LIGHT_MAP="light";xe.AO="ao";const xJ=Ge(xe,xe.ALPHA_TEST),bJ=Ge(xe,xe.COLOR),SJ=Ge(xe,xe.SHININESS),TJ=Ge(xe,xe.EMISSIVE),YB=Ge(xe,xe.OPACITY),MJ=Ge(xe,xe.SPECULAR),vD=Ge(xe,xe.SPECULAR_INTENSITY),EJ=Ge(xe,xe.SPECULAR_COLOR),Uy=Ge(xe,xe.SPECULAR_STRENGTH),Mb=Ge(xe,xe.REFLECTIVITY),AJ=Ge(xe,xe.ROUGHNESS),wJ=Ge(xe,xe.METALNESS),RJ=Ge(xe,xe.NORMAL),CJ=Ge(xe,xe.CLEARCOAT),NJ=Ge(xe,xe.CLEARCOAT_ROUGHNESS),PJ=Ge(xe,xe.CLEARCOAT_NORMAL),DJ=Ge(xe,xe.ROTATION),LJ=Ge(xe,xe.SHEEN),UJ=Ge(xe,xe.SHEEN_ROUGHNESS),OJ=Ge(xe,xe.ANISOTROPY),BJ=Ge(xe,xe.IRIDESCENCE),IJ=Ge(xe,xe.IRIDESCENCE_IOR),FJ=Ge(xe,xe.IRIDESCENCE_THICKNESS),kJ=Ge(xe,xe.TRANSMISSION),zJ=Ge(xe,xe.THICKNESS),VJ=Ge(xe,xe.IOR),GJ=Ge(xe,xe.ATTENUATION_DISTANCE),HJ=Ge(xe,xe.ATTENUATION_COLOR),WJ=Ge(xe,xe.LINE_SCALE),jJ=Ge(xe,xe.LINE_DASH_SIZE),qJ=Ge(xe,xe.LINE_GAP_SIZE);xe.LINE_WIDTH;const $J=Ge(xe,xe.LINE_DASH_OFFSET),XJ=Ge(xe,xe.POINT_SIZE),YJ=Ge(xe,xe.DISPERSION),KB=Ge(xe,xe.LIGHT_MAP),KJ=Ge(xe,xe.AO),hd=Et(new Le).onReference(function(i){return i.material}).onRenderUpdate(function({material:i}){this.value.set(i.anisotropy*Math.cos(i.anisotropyRotation),i.anisotropy*Math.sin(i.anisotropyRotation))}),ZB=Ue(i=>i.context.setupModelViewProjection(),"vec4").once()().toVarying("v_modelViewProjection");class Ln extends Ot{static get type(){return"IndexNode"}constructor(e){super("uint"),this.scope=e,this.isIndexNode=!0}generate(e){const t=this.getNodeType(e),n=this.scope;let r;if(n===Ln.VERTEX)r=e.getVertexIndex();else if(n===Ln.INSTANCE)r=e.getInstanceIndex();else if(n===Ln.DRAW)r=e.getDrawIndex();else if(n===Ln.INVOCATION_LOCAL)r=e.getInvocationLocalIndex();else if(n===Ln.INVOCATION_SUBGROUP)r=e.getInvocationSubgroupIndex();else if(n===Ln.SUBGROUP)r=e.getSubgroupIndex();else throw new Error("THREE.IndexNode: Unknown scope: "+n);let s;return e.shaderStage==="vertex"||e.shaderStage==="compute"?s=r:s=Hs(this).build(e,t),s}}Ln.VERTEX="vertex";Ln.INSTANCE="instance";Ln.SUBGROUP="subgroup";Ln.INVOCATION_LOCAL="invocationLocal";Ln.INVOCATION_SUBGROUP="invocationSubgroup";Ln.DRAW="draw";const ZJ=Ge(Ln,Ln.VERTEX),LE=Ge(Ln,Ln.INSTANCE);Ln.SUBGROUP;Ln.INVOCATION_SUBGROUP;Ln.INVOCATION_LOCAL;const QJ=Ge(Ln,Ln.DRAW);class JJ extends Ot{static get type(){return"InstanceNode"}constructor(e,t,n=null){super("void"),this.count=e,this.instanceMatrix=t,this.instanceColor=n,this.instanceMatrixNode=null,this.instanceColorNode=null,this.updateType=Ht.FRAME,this.buffer=null,this.bufferColor=null}setup(e){const{count:t,instanceMatrix:n,instanceColor:r}=this;let{instanceMatrixNode:s,instanceColorNode:a}=this;if(s===null){if(t<=1e3)s=VB(n.array,"mat4",Math.max(t,1)).element(LE);else{const u=new rW(n.array,16,1);this.buffer=u;const h=n.usage===Wc?uD:lD,d=[h(u,"vec4",16,0),h(u,"vec4",16,4),h(u,"vec4",16,8),h(u,"vec4",16,12)];s=nh(...d)}this.instanceMatrixNode=s}if(r&&a===null){const u=new m8(r.array,3),h=r.usage===Wc?uD:lD;this.bufferColor=u,a=Ee(h(u,"vec3",3,0)),this.instanceColorNode=a}const l=s.mul(tr).xyz;if(tr.assign(l),e.hasGeometryAttribute("normal")){const u=eJ(ma,s);ma.assign(u)}this.instanceColorNode!==null&&nv("vec3","vInstanceColor").assign(this.instanceColorNode)}update(){this.instanceMatrix.usage!==Wc&&this.buffer!==null&&this.instanceMatrix.version!==this.buffer.version&&(this.buffer.version=this.instanceMatrix.version),this.instanceColor&&this.instanceColor.usage!==Wc&&this.bufferColor!==null&&this.instanceColor.version!==this.bufferColor.version&&(this.bufferColor.version=this.instanceColor.version)}}class eee extends JJ{static get type(){return"InstancedMeshNode"}constructor(e){const{count:t,instanceMatrix:n,instanceColor:r}=e;super(t,n,r),this.instancedMesh=e}}const tee=Oe(eee).setParameterLength(1);class nee extends Ot{static get type(){return"BatchNode"}constructor(e){super("void"),this.batchMesh=e,this.batchingIdNode=null}setup(e){this.batchingIdNode===null&&(e.getDrawIndex()===null?this.batchingIdNode=LE:this.batchingIdNode=QJ);const n=Ue(([v])=>{const S=Nn(rh(Us(this.batchMesh._indirectTexture),0).x),b=Nn(v).mod(S),_=Nn(v).div(S);return Us(this.batchMesh._indirectTexture,Xa(b,_)).x}).setLayout({name:"getIndirectIndex",type:"uint",inputs:[{name:"id",type:"int"}]})(Nn(this.batchingIdNode)),r=this.batchMesh._matricesTexture,s=Nn(rh(Us(r),0).x),a=Te(n).mul(4).toInt().toVar(),l=a.mod(s),u=a.div(s),h=nh(Us(r,Xa(l,u)),Us(r,Xa(l.add(1),u)),Us(r,Xa(l.add(2),u)),Us(r,Xa(l.add(3),u))),d=this.batchMesh._colorsTexture;if(d!==null){const S=Ue(([b])=>{const _=Nn(rh(Us(d),0).x),E=b,M=E.mod(_),A=E.div(_);return Us(d,Xa(M,A)).rgb}).setLayout({name:"getBatchingColor",type:"vec3",inputs:[{name:"id",type:"int"}]})(n);nv("vec3","vBatchColor").assign(S)}const p=_r(h);tr.assign(h.mul(tr));const g=ma.div(Ee(p[0].dot(p[0]),p[1].dot(p[1]),p[2].dot(p[2]))),y=p.mul(g).xyz;ma.assign(y),e.hasGeometryAttribute("tangent")&&DE.mulAssign(p)}}const iee=Oe(nee).setParameterLength(1),_D=new WeakMap;class ree extends Ot{static get type(){return"SkinningNode"}constructor(e){super("void"),this.skinnedMesh=e,this.updateType=Ht.OBJECT,this.skinIndexNode=ml("skinIndex","uvec4"),this.skinWeightNode=ml("skinWeight","vec4"),this.bindMatrixNode=Mn("bindMatrix","mat4"),this.bindMatrixInverseNode=Mn("bindMatrixInverse","mat4"),this.boneMatricesNode=mD("skeleton.boneMatrices","mat4",e.skeleton.bones.length),this.positionNode=tr,this.toPositionNode=tr,this.previousBoneMatricesNode=null}getSkinnedPosition(e=this.boneMatricesNode,t=this.positionNode){const{skinIndexNode:n,skinWeightNode:r,bindMatrixNode:s,bindMatrixInverseNode:a}=this,l=e.element(n.x),u=e.element(n.y),h=e.element(n.z),d=e.element(n.w),p=s.mul(t),g=xr(l.mul(r.x).mul(p),u.mul(r.y).mul(p),h.mul(r.z).mul(p),d.mul(r.w).mul(p));return a.mul(g).xyz}getSkinnedNormal(e=this.boneMatricesNode,t=ma){const{skinIndexNode:n,skinWeightNode:r,bindMatrixNode:s,bindMatrixInverseNode:a}=this,l=e.element(n.x),u=e.element(n.y),h=e.element(n.z),d=e.element(n.w);let p=xr(r.x.mul(l),r.y.mul(u),r.z.mul(h),r.w.mul(d));return p=a.mul(p).mul(s),p.transformDirection(t).xyz}getPreviousSkinnedPosition(e){const t=e.object;return this.previousBoneMatricesNode===null&&(t.skeleton.previousBoneMatrices=new Float32Array(t.skeleton.boneMatrices),this.previousBoneMatricesNode=mD("skeleton.previousBoneMatrices","mat4",t.skeleton.bones.length)),this.getSkinnedPosition(this.previousBoneMatricesNode,dD)}needsPreviousBoneMatrices(e){const t=e.renderer.getMRT();return t&&t.has("velocity")||aB(e.object).useVelocity===!0}setup(e){this.needsPreviousBoneMatrices(e)&&dD.assign(this.getPreviousSkinnedPosition(e));const t=this.getSkinnedPosition();if(this.toPositionNode&&this.toPositionNode.assign(t),e.hasGeometryAttribute("normal")){const n=this.getSkinnedNormal();ma.assign(n),e.hasGeometryAttribute("tangent")&&DE.assign(n)}return t}generate(e,t){if(t!=="void")return super.generate(e,t)}update(e){const t=e.object&&e.object.skeleton?e.object.skeleton:this.skinnedMesh.skeleton;_D.get(t)!==e.frameId&&(_D.set(t,e.frameId),this.previousBoneMatricesNode!==null&&t.previousBoneMatrices.set(t.boneMatrices),t.update())}}const see=i=>Ie(new ree(i));class aee extends Ot{static get type(){return"LoopNode"}constructor(e=[]){super(),this.params=e}getVarName(e){return String.fromCharCode(105+e)}getProperties(e){const t=e.getNodeProperties(this);if(t.stackNode!==void 0)return t;const n={};for(let a=0,l=this.params.length-1;a<l;a++){const u=this.params[a],h=u.isNode!==!0&&u.name||this.getVarName(a),d=u.isNode!==!0&&u.type||"int";n[h]=Oh(h,d)}const r=e.addStack();t.returnsNode=this.params[this.params.length-1](n,e),t.stackNode=r;const s=this.params[0];return s.isNode!==!0&&typeof s.update=="function"&&(t.updateNode=Ue(this.params[0].update)(n)),e.removeStack(),t}getNodeType(e){const{returnsNode:t}=this.getProperties(e);return t?t.getNodeType(e):"void"}setup(e){this.getProperties(e)}generate(e){const t=this.getProperties(e),n=this.params,r=t.stackNode;for(let l=0,u=n.length-1;l<u;l++){const h=n[l];let d=!1,p=null,g=null,y=null,v=null,S=null,b=null;h.isNode?h.getNodeType(e)==="bool"?(d=!0,v="bool",g=h.build(e,v)):(v="int",y=this.getVarName(l),p="0",g=h.build(e,v),S="<"):(v=h.type||"int",y=h.name||this.getVarName(l),p=h.start,g=h.end,S=h.condition,b=h.update,typeof p=="number"?p=e.generateConst(v,p):p&&p.isNode&&(p=p.build(e,v)),typeof g=="number"?g=e.generateConst(v,g):g&&g.isNode&&(g=g.build(e,v)),p!==void 0&&g===void 0?(p=p+" - 1",g="0",S=">="):g!==void 0&&p===void 0&&(p="0",S="<"),S===void 0&&(Number(p)>Number(g)?S=">=":S="<"));let _;if(d)_=`while ( ${g} )`;else{const E={start:p,end:g},M=E.start,A=E.end;let w;const R=()=>S.includes("<")?"+=":"-=";if(b!=null)switch(typeof b){case"function":w=e.flowStagesNode(t.updateNode,"void").code.replace(/\t|;/g,"");break;case"number":w=y+" "+R()+" "+e.generateConst(v,b);break;case"string":w=y+" "+b;break;default:b.isNode?w=y+" "+R()+" "+b.build(e):(console.error("THREE.TSL: 'Loop( { update: ... } )' is not a function, string or number."),w="break /* invalid update */")}else v==="int"||v==="uint"?b=S.includes("<")?"++":"--":b=R()+" 1.",w=y+" "+b;const C=e.getVar(v,y)+" = "+M,L=y+" "+S+" "+A;_=`for ( ${C}; ${L}; ${w} )`}e.addFlowCode((l===0?`
`:"")+e.tab+_+` {

`).addFlowTab()}const s=r.build(e,"void"),a=t.returnsNode?t.returnsNode.build(e):"";e.removeFlowTab().addFlowCode(`
`+e.tab+s);for(let l=0,u=this.params.length-1;l<u;l++)e.addFlowCode((l===0?"":e.tab)+`}

`).removeFlowTab();return e.addFlowTab(),a}}const Fs=(...i)=>Ie(new aee(th(i,"int"))).toStack(),oee=()=>Oh("break").toStack(),Eb=new WeakMap,Kr=new bt,xD=Ue(({bufferMap:i,influence:e,stride:t,width:n,depth:r,offset:s})=>{const a=Nn(ZJ).mul(t).add(s),l=a.div(n),u=a.sub(l.mul(n));return Us(i,Xa(u,l)).depth(r).xyz.mul(e)});function lee(i){const e=i.morphAttributes.position!==void 0,t=i.morphAttributes.normal!==void 0,n=i.morphAttributes.color!==void 0,r=i.morphAttributes.position||i.morphAttributes.normal||i.morphAttributes.color,s=r!==void 0?r.length:0;let a=Eb.get(i);if(a===void 0||a.count!==s){let E=function(){b.dispose(),Eb.delete(i),i.removeEventListener("dispose",E)};var l=E;a!==void 0&&a.texture.dispose();const u=i.morphAttributes.position||[],h=i.morphAttributes.normal||[],d=i.morphAttributes.color||[];let p=0;e===!0&&(p=1),t===!0&&(p=2),n===!0&&(p=3);let g=i.attributes.position.count*p,y=1;const v=4096;g>v&&(y=Math.ceil(g/v),g=v);const S=new Float32Array(g*y*4*s),b=new HM(S,g,y,s);b.type=Jn,b.needsUpdate=!0;const _=p*4;for(let M=0;M<s;M++){const A=u[M],w=h[M],R=d[M],C=g*y*4*M;for(let L=0;L<A.count;L++){const N=L*_;e===!0&&(Kr.fromBufferAttribute(A,L),S[C+N+0]=Kr.x,S[C+N+1]=Kr.y,S[C+N+2]=Kr.z,S[C+N+3]=0),t===!0&&(Kr.fromBufferAttribute(w,L),S[C+N+4]=Kr.x,S[C+N+5]=Kr.y,S[C+N+6]=Kr.z,S[C+N+7]=0),n===!0&&(Kr.fromBufferAttribute(R,L),S[C+N+8]=Kr.x,S[C+N+9]=Kr.y,S[C+N+10]=Kr.z,S[C+N+11]=R.itemSize===4?Kr.w:1)}}a={count:s,texture:b,stride:p,size:new Le(g,y)},Eb.set(i,a),i.addEventListener("dispose",E)}return a}class uee extends Ot{static get type(){return"MorphNode"}constructor(e){super("void"),this.mesh=e,this.morphBaseInfluence=Et(1),this.updateType=Ht.OBJECT}setup(e){const{geometry:t}=e,n=t.morphAttributes.position!==void 0,r=t.hasAttribute("normal")&&t.morphAttributes.normal!==void 0,s=t.morphAttributes.position||t.morphAttributes.normal||t.morphAttributes.color,a=s!==void 0?s.length:0,{texture:l,stride:u,size:h}=lee(t);n===!0&&tr.mulAssign(this.morphBaseInfluence),r===!0&&ma.mulAssign(this.morphBaseInfluence);const d=Nn(h.width);Fs(a,({i:p})=>{const g=Te(0).toVar();this.mesh.count>1&&this.mesh.morphTexture!==null&&this.mesh.morphTexture!==void 0?g.assign(Us(this.mesh.morphTexture,Xa(Nn(p).add(1),Nn(LE))).r):g.assign(Mn("morphTargetInfluences","float").element(p).toVar()),ii(g.notEqual(0),()=>{n===!0&&tr.addAssign(xD({bufferMap:l,influence:g,stride:u,width:d,depth:p,offset:Nn(0)})),r===!0&&ma.addAssign(xD({bufferMap:l,influence:g,stride:u,width:d,depth:p,offset:Nn(1)}))})})}update(){const e=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?e.value=1:e.value=1-this.mesh.morphTargetInfluences.reduce((t,n)=>t+n,0)}}const cee=Oe(uee).setParameterLength(1);class Zh extends Ot{static get type(){return"LightingNode"}constructor(){super("vec3"),this.isLightingNode=!0}}class hee extends Zh{static get type(){return"AONode"}constructor(e=null){super(),this.aoNode=e}setup(e){e.context.ambientOcclusion.mulAssign(this.aoNode)}}class fee extends UB{static get type(){return"LightingContextNode"}constructor(e,t=null,n=null,r=null){super(e),this.lightingModel=t,this.backdropNode=n,this.backdropAlphaNode=r,this._value=null}getContext(){const{backdropNode:e,backdropAlphaNode:t}=this,n=Ee().toVar("directDiffuse"),r=Ee().toVar("directSpecular"),s=Ee().toVar("indirectDiffuse"),a=Ee().toVar("indirectSpecular"),l={directDiffuse:n,directSpecular:r,indirectDiffuse:s,indirectSpecular:a};return{radiance:Ee().toVar("radiance"),irradiance:Ee().toVar("irradiance"),iblIrradiance:Ee().toVar("iblIrradiance"),ambientOcclusion:Te(1).toVar("ambientOcclusion"),reflectedLight:l,backdrop:e,backdropAlpha:t}}setup(e){return this.value=this._value||(this._value=this.getContext()),this.value.lightingModel=this.lightingModel||e.context.lightingModel,super.setup(e)}}const dee=Oe(fee);class pee extends Zh{static get type(){return"IrradianceNode"}constructor(e){super(),this.node=e}setup(e){e.context.irradiance.addAssign(this.node)}}let fd,dd;class ui extends Ot{static get type(){return"ScreenNode"}constructor(e){super(),this.scope=e,this.isViewportNode=!0}getNodeType(){return this.scope===ui.VIEWPORT?"vec4":"vec2"}getUpdateType(){let e=Ht.NONE;return(this.scope===ui.SIZE||this.scope===ui.VIEWPORT)&&(e=Ht.RENDER),this.updateType=e,e}update({renderer:e}){const t=e.getRenderTarget();this.scope===ui.VIEWPORT?t!==null?dd.copy(t.viewport):(e.getViewport(dd),dd.multiplyScalar(e.getPixelRatio())):t!==null?(fd.width=t.width,fd.height=t.height):e.getDrawingBufferSize(fd)}setup(){const e=this.scope;let t=null;return e===ui.SIZE?t=Et(fd||(fd=new Le)):e===ui.VIEWPORT?t=Et(dd||(dd=new bt)):t=We(Hv.div(hT)),t}generate(e){if(this.scope===ui.COORDINATE){let t=e.getFragCoord();if(e.isFlipY()){const n=e.getNodeProperties(hT).outputNode.build(e);t=`${e.getType("vec2")}( ${t}.x, ${n}.y - ${t}.y )`}return t}return super.generate(e)}}ui.COORDINATE="coordinate";ui.VIEWPORT="viewport";ui.SIZE="size";ui.UV="uv";const sh=Ge(ui,ui.UV),hT=Ge(ui,ui.SIZE),Hv=Ge(ui,ui.COORDINATE),$d=Ge(ui,ui.VIEWPORT);$d.zw;$d.xy;const pd=new Le;class QB extends Kh{static get type(){return"ViewportTextureNode"}constructor(e=sh,t=null,n=null){n===null&&(n=new x8,n.minFilter=Nr),super(n,e,t),this.generateMipmaps=!1,this.isOutputTextureNode=!0,this.updateBeforeType=Ht.FRAME}updateBefore(e){const t=e.renderer;t.getDrawingBufferSize(pd);const n=this.value;(n.image.width!==pd.width||n.image.height!==pd.height)&&(n.image.width=pd.width,n.image.height=pd.height,n.needsUpdate=!0);const r=n.generateMipmaps;n.generateMipmaps=this.generateMipmaps,t.copyFramebufferToTexture(n),n.generateMipmaps=r}clone(){const e=new this.constructor(this.uvNode,this.levelNode,this.value);return e.generateMipmaps=this.generateMipmaps,e}}const JB=Oe(QB,null,null,{generateMipmaps:!0}).setParameterLength(0,3);let Ab=null;class mee extends QB{static get type(){return"ViewportDepthTextureNode"}constructor(e=sh,t=null){Ab===null&&(Ab=new bs),super(e,t,Ab)}}const gee=Oe(mee).setParameterLength(0,2);class Pr extends Ot{static get type(){return"ViewportDepthNode"}constructor(e,t=null){super("float"),this.scope=e,this.valueNode=t,this.isViewportDepthNode=!0}generate(e){const{scope:t}=this;return t===Pr.DEPTH_BASE?e.getFragDepth():super.generate(e)}setup({camera:e}){const{scope:t}=this,n=this.valueNode;let r=null;if(t===Pr.DEPTH_BASE)n!==null&&(r=nI().assign(n));else if(t===Pr.DEPTH)e.isPerspectiveCamera?r=yee(hi.z,ou,lu):r=Xd(hi.z,ou,lu);else if(t===Pr.LINEAR_DEPTH)if(n!==null)if(e.isPerspectiveCamera){const s=eI(n,ou,lu);r=Xd(s,ou,lu)}else r=n;else r=Xd(hi.z,ou,lu);return r}}Pr.DEPTH_BASE="depthBase";Pr.DEPTH="depth";Pr.LINEAR_DEPTH="linearDepth";const Xd=(i,e,t)=>i.add(e).div(e.sub(t)),yee=(i,e,t)=>e.add(i).mul(t).div(t.sub(e).mul(i)),eI=(i,e,t)=>e.mul(t).div(t.sub(e).mul(i).sub(t)),tI=(i,e,t)=>{e=e.max(1e-6).toVar();const n=oo(i.negate().div(e)),r=oo(t.div(e));return n.div(r)},nI=Oe(Pr,Pr.DEPTH_BASE),iI=Ge(Pr,Pr.DEPTH),vee=Oe(Pr,Pr.LINEAR_DEPTH).setParameterLength(0,1);gee();iI.assign=i=>nI(i);class Ss extends Ot{static get type(){return"ClippingNode"}constructor(e=Ss.DEFAULT){super(),this.scope=e}setup(e){super.setup(e);const t=e.clippingContext,{intersectionPlanes:n,unionPlanes:r}=t;return this.hardwareClipping=e.material.hardwareClipping,this.scope===Ss.ALPHA_TO_COVERAGE?this.setupAlphaToCoverage(n,r):this.scope===Ss.HARDWARE?this.setupHardwareClipping(r,e):this.setupDefault(n,r)}setupAlphaToCoverage(e,t){return Ue(()=>{const n=Te().toVar("distanceToPlane"),r=Te().toVar("distanceToGradient"),s=Te(1).toVar("clipOpacity"),a=t.length;if(this.hardwareClipping===!1&&a>0){const u=ia(t);Fs(a,({i:h})=>{const d=u.element(h);n.assign(hi.dot(d.xyz).negate().add(d.w)),r.assign(n.fwidth().div(2)),s.mulAssign(pl(r.negate(),r,n))})}const l=e.length;if(l>0){const u=ia(e),h=Te(1).toVar("intersectionClipOpacity");Fs(l,({i:d})=>{const p=u.element(d);n.assign(hi.dot(p.xyz).negate().add(p.w)),r.assign(n.fwidth().div(2)),h.mulAssign(pl(r.negate(),r,n).oneMinus())}),s.mulAssign(h.oneMinus())}an.a.mulAssign(s),an.a.equal(0).discard()})()}setupDefault(e,t){return Ue(()=>{const n=t.length;if(this.hardwareClipping===!1&&n>0){const s=ia(t);Fs(n,({i:a})=>{const l=s.element(a);hi.dot(l.xyz).greaterThan(l.w).discard()})}const r=e.length;if(r>0){const s=ia(e),a=mE(!0).toVar("clipped");Fs(r,({i:l})=>{const u=s.element(l);a.assign(hi.dot(u.xyz).greaterThan(u.w).and(a))}),a.discard()}})()}setupHardwareClipping(e,t){const n=e.length;return t.enableHardwareClipping(n),Ue(()=>{const r=ia(e),s=kv(t.getClipDistance());Fs(n,({i:a})=>{const l=r.element(a),u=hi.dot(l.xyz).sub(l.w).negate();s.element(a).assign(u)})})()}}Ss.ALPHA_TO_COVERAGE="alphaToCoverage";Ss.DEFAULT="default";Ss.HARDWARE="hardware";const _ee=()=>Ie(new Ss),xee=()=>Ie(new Ss(Ss.ALPHA_TO_COVERAGE)),bee=()=>Ie(new Ss(Ss.HARDWARE)),See=.05,bD=Ue(([i])=>vl($t(1e4,Is($t(17,i.x).add($t(.1,i.y)))).mul(xr(.1,ys(Is($t(13,i.y).add(i.x))))))),SD=Ue(([i])=>bD(We(bD(i.xy),i.z))),Tee=Ue(([i])=>{const e=sr(lo(AB(i.xyz)),lo(wB(i.xyz))),t=Te(1).div(Te(See).mul(e)).toVar("pixScale"),n=We(wp(xu(oo(t))),wp(bE(oo(t)))),r=We(SD(xu(n.x.mul(i.xyz))),SD(xu(n.y.mul(i.xyz)))),s=vl(oo(t)),a=xr($t(s.oneMinus(),r.x),$t(s,r.y)),l=Uh(s,s.oneMinus()),u=Ee(a.mul(a).div($t(2,l).mul(hr(1,l))),a.sub($t(.5,l)).div(hr(1,l)),hr(1,hr(1,a).mul(hr(1,a)).div($t(2,l).mul(hr(1,l))))),h=a.lessThan(l.oneMinus()).select(a.lessThan(l).select(u.x,u.y),u.z);return fo(h,1e-6,1)}).setLayout({name:"getAlphaHashThreshold",type:"float",inputs:[{name:"position",type:"vec3"}]});class Mee extends FB{static get type(){return"VertexColorNode"}constructor(e){super(null,"vec4"),this.isVertexColorNode=!0,this.index=e}getAttributeName(){const e=this.index;return"color"+(e>0?e:"")}generate(e){const t=this.getAttributeName(e),n=e.hasGeometryAttribute(t);let r;return n===!0?r=super.generate(e):r=e.generateConst(this.nodeType,new bt(1,1,1,1)),r}serialize(e){super.serialize(e),e.index=this.index}deserialize(e){super.deserialize(e),this.index=e.index}}const Eee=(i=0)=>Ie(new Mee(i));class pi extends rr{static get type(){return"NodeMaterial"}get type(){return this.constructor.type}set type(e){}constructor(){super(),this.isNodeMaterial=!0,this.fog=!0,this.lights=!1,this.hardwareClipping=!1,this.lightsNode=null,this.envNode=null,this.aoNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.maskNode=null,this.positionNode=null,this.geometryNode=null,this.depthNode=null,this.receivedShadowPositionNode=null,this.castShadowPositionNode=null,this.receivedShadowNode=null,this.castShadowNode=null,this.outputNode=null,this.mrtNode=null,this.fragmentNode=null,this.vertexNode=null,Object.defineProperty(this,"shadowPositionNode",{get:()=>this.receivedShadowPositionNode,set:e=>{console.warn('THREE.NodeMaterial: ".shadowPositionNode" was renamed to ".receivedShadowPositionNode".'),this.receivedShadowPositionNode=e}})}customProgramCacheKey(){return this.type+rB(this)}build(e){this.setup(e)}setupObserver(e){return new yK(e)}setup(e){e.context.setupNormal=()=>this.setupNormal(e),e.context.setupPositionView=()=>this.setupPositionView(e),e.context.setupModelViewProjection=()=>this.setupModelViewProjection(e);const t=e.renderer,n=t.getRenderTarget();e.addStack();const r=this.setupVertex(e),s=this.vertexNode||r;e.stack.outputNode=s,this.setupHardwareClipping(e),this.geometryNode!==null&&(e.stack.outputNode=e.stack.outputNode.bypass(this.geometryNode)),e.addFlow("vertex",e.removeStack()),e.addStack();let a;const l=this.setupClipping(e);if((this.depthWrite===!0||this.depthTest===!0)&&(n!==null?n.depthBuffer===!0&&this.setupDepth(e):t.depth===!0&&this.setupDepth(e)),this.fragmentNode===null){this.setupDiffuseColor(e),this.setupVariants(e);const u=this.setupLighting(e);l!==null&&e.stack.add(l);const h=Ut(u,an.a).max(0);a=this.setupOutput(e,h),qd.assign(a);const d=this.outputNode!==null;if(d&&(a=this.outputNode),n!==null){const p=t.getMRT(),g=this.mrtNode;p!==null?(d&&qd.assign(a),a=p,g!==null&&(a=p.merge(g))):g!==null&&(a=g)}}else{let u=this.fragmentNode;u.isOutputStructNode!==!0&&(u=Ut(u)),a=this.setupOutput(e,u)}e.stack.outputNode=a,e.addFlow("fragment",e.removeStack()),e.observer=this.setupObserver(e)}setupClipping(e){if(e.clippingContext===null)return null;const{unionPlanes:t,intersectionPlanes:n}=e.clippingContext;let r=null;if(t.length>0||n.length>0){const s=e.renderer.samples;this.alphaToCoverage&&s>1?r=xee():e.stack.add(_ee())}return r}setupHardwareClipping(e){if(this.hardwareClipping=!1,e.clippingContext===null)return;const t=e.clippingContext.unionPlanes.length;t>0&&t<=8&&e.isAvailable("clipDistance")&&(e.stack.add(bee()),this.hardwareClipping=!0)}setupDepth(e){const{renderer:t,camera:n}=e;let r=this.depthNode;if(r===null){const s=t.getMRT();s&&s.has("depth")?r=s.get("depth"):t.logarithmicDepthBuffer===!0&&(n.isPerspectiveCamera?r=tI(hi.z,ou,lu):r=Xd(hi.z,ou,lu))}r!==null&&iI.assign(r).toStack()}setupPositionView(){return zv.mul(tr).xyz}setupModelViewProjection(){return RE.mul(hi)}setupVertex(e){return e.addStack(),this.setupPosition(e),e.context.vertex=e.removeStack(),ZB}setupPosition(e){const{object:t,geometry:n}=e;if((n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color)&&cee(t).toStack(),t.isSkinnedMesh===!0&&see(t).toStack(),this.displacementMap){const r=tl("displacementMap","texture"),s=tl("displacementScale","float"),a=tl("displacementBias","float");tr.addAssign(ma.normalize().mul(r.x.mul(s).add(a)))}return t.isBatchedMesh&&iee(t).toStack(),t.isInstancedMesh&&t.instanceMatrix&&t.instanceMatrix.isInstancedBufferAttribute===!0&&tee(t).toStack(),this.positionNode!==null&&tr.assign(NQ(this.positionNode,"POSITION")),tr}setupDiffuseColor({object:e,geometry:t}){this.maskNode!==null&&mE(this.maskNode).not().discard();let n=this.colorNode?Ut(this.colorNode):bJ;this.vertexColors===!0&&t.hasAttribute("color")&&(n=n.mul(Eee())),e.instanceColor&&(n=nv("vec3","vInstanceColor").mul(n)),e.isBatchedMesh&&e._colorsTexture&&(n=nv("vec3","vBatchColor").mul(n)),an.assign(n);const r=this.opacityNode?Te(this.opacityNode):YB;an.a.assign(an.a.mul(r));let s=null;(this.alphaTestNode!==null||this.alphaTest>0)&&(s=this.alphaTestNode!==null?Te(this.alphaTestNode):xJ,an.a.lessThanEqual(s).discard()),this.alphaHash===!0&&an.a.lessThan(Tee(tr)).discard(),this.transparent===!1&&this.blending===es&&this.alphaToCoverage===!1?an.a.assign(1):s===null&&an.a.lessThanEqual(0).discard()}setupVariants(){}setupOutgoingLight(){return this.lights===!0?Ee(0):an.rgb}setupNormal(){return this.normalNode?Ee(this.normalNode):RJ}setupEnvironment(){let e=null;return this.envNode?e=this.envNode:this.envMap&&(e=this.envMap.isCubeTexture?tl("envMap","cubeTexture"):tl("envMap","texture")),e}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new pee(KB)),t}setupLights(e){const t=[],n=this.setupEnvironment(e);n&&n.isLightingNode&&t.push(n);const r=this.setupLightMap(e);if(r&&r.isLightingNode&&t.push(r),this.aoNode!==null||e.material.aoMap){const a=this.aoNode!==null?this.aoNode:KJ;t.push(new hee(a))}let s=this.lightsNode||e.lightsNode;return t.length>0&&(s=e.renderer.lighting.createNode([...s.getLights(),...t])),s}setupLightingModel(){}setupLighting(e){const{material:t}=e,{backdropNode:n,backdropAlphaNode:r,emissiveNode:s}=this,l=this.lights===!0||this.lightsNode!==null?this.setupLights(e):null;let u=this.setupOutgoingLight(e);if(l&&l.getScope().hasLights){const h=this.setupLightingModel(e)||null;u=dee(l,h,n,r)}else n!==null&&(u=Ee(r!==null?Dn(u,n,r):n));return(s&&s.isNode===!0||t.emissive&&t.emissive.isColor===!0)&&(sD.assign(Ee(s||TJ)),u=u.add(sD)),u}setupFog(e,t){const n=e.fogNode;return n&&(qd.assign(t),t=Ut(n)),t}setupOutput(e,t){return this.fog===!0&&(t=this.setupFog(e,t)),t}setDefaultValues(e){for(const n in e){const r=e[n];this[n]===void 0&&(this[n]=r,r&&r.clone&&(this[n]=r.clone()))}const t=Object.getOwnPropertyDescriptors(e.constructor.prototype);for(const n in t)Object.getOwnPropertyDescriptor(this.constructor.prototype,n)===void 0&&t[n].get!==void 0&&Object.defineProperty(this.constructor.prototype,n,t[n])}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{},nodes:{}});const n=rr.prototype.toJSON.call(this,e),r=Jy(this);n.inputNodes={};for(const{property:a,childNode:l}of r)n.inputNodes[a]=l.toJSON(e).uuid;function s(a){const l=[];for(const u in a){const h=a[u];delete h.metadata,l.push(h)}return l}if(t){const a=s(e.textures),l=s(e.images),u=s(e.nodes);a.length>0&&(n.textures=a),l.length>0&&(n.images=l),u.length>0&&(n.nodes=u)}return n}copy(e){return this.lightsNode=e.lightsNode,this.envNode=e.envNode,this.colorNode=e.colorNode,this.normalNode=e.normalNode,this.opacityNode=e.opacityNode,this.backdropNode=e.backdropNode,this.backdropAlphaNode=e.backdropAlphaNode,this.alphaTestNode=e.alphaTestNode,this.maskNode=e.maskNode,this.positionNode=e.positionNode,this.geometryNode=e.geometryNode,this.depthNode=e.depthNode,this.receivedShadowPositionNode=e.receivedShadowPositionNode,this.castShadowPositionNode=e.castShadowPositionNode,this.receivedShadowNode=e.receivedShadowNode,this.castShadowNode=e.castShadowNode,this.outputNode=e.outputNode,this.mrtNode=e.mrtNode,this.fragmentNode=e.fragmentNode,this.vertexNode=e.vertexNode,super.copy(e)}}const Aee=new Av;class wee extends pi{static get type(){return"LineBasicNodeMaterial"}constructor(e){super(),this.isLineBasicNodeMaterial=!0,this.setDefaultValues(Aee),this.setValues(e)}}const Ree=new j8;class Cee extends pi{static get type(){return"LineDashedNodeMaterial"}constructor(e){super(),this.isLineDashedNodeMaterial=!0,this.setDefaultValues(Ree),this.dashOffset=0,this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(e)}setupVariants(){const e=this.offsetNode?Te(this.offsetNode):$J,t=this.dashScaleNode?Te(this.dashScaleNode):WJ,n=this.dashSizeNode?Te(this.dashSizeNode):jJ,r=this.gapSizeNode?Te(this.gapSizeNode):qJ;bb.assign(n),aD.assign(r);const s=Hs(ml("lineDistance").mul(t));(e?s.add(e):s).mod(bb.add(aD)).greaterThan(bb).discard()}}const Nee=i=>Ie(i).mul(.5).add(.5),Pee=new V8;class Dee extends pi{static get type(){return"MeshNormalNodeMaterial"}constructor(e){super(),this.isMeshNormalNodeMaterial=!0,this.setDefaultValues(Pee),this.setValues(e)}setupDiffuseColor(){const e=this.opacityNode?Te(this.opacityNode):YB;an.assign(AE(Ut(Nee(ci),e),Ji))}}class Lee extends mi{static get type(){return"EquirectUVNode"}constructor(e=HB){super("vec2"),this.dirNode=e}setup(){const e=this.dirNode,t=e.z.atan(e.x).mul(1/(Math.PI*2)).add(.5),n=e.y.clamp(-1,1).asin().mul(1/Math.PI).add(.5);return We(t,n)}}const rI=Oe(Lee).setParameterLength(0,1);class sI extends oO{constructor(e=1,t={}){super(e,t),this.isCubeRenderTarget=!0}fromEquirectangularTexture(e,t){const n=t.minFilter,r=t.generateMipmaps;t.generateMipmaps=!0,this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const s=new Du(5,5,5),a=rI(HB),l=new pi;l.colorNode=nn(t,a,0),l.side=An,l.blending=Ur;const u=new fi(s,l),h=new Ev;h.add(u),t.minFilter===Nr&&(t.minFilter=Ti);const d=new aO(1,10,this),p=e.getMRT();return e.setMRT(null),d.update(e,h),e.setMRT(p),t.minFilter=n,t.currentGenerateMipmaps=r,u.geometry.dispose(),u.material.dispose(),this}}const Yd=new WeakMap;class Uee extends mi{static get type(){return"CubeMapNode"}constructor(e){super("vec3"),this.envNode=e,this._cubeTexture=null,this._cubeTextureNode=Np(null);const t=new Wp;t.isRenderTargetTexture=!0,this._defaultTexture=t,this.updateBeforeType=Ht.RENDER}updateBefore(e){const{renderer:t,material:n}=e,r=this.envNode;if(r.isTextureNode||r.isMaterialReferenceNode){const s=r.isTextureNode?r.value:n[r.property];if(s&&s.isTexture){const a=s.mapping;if(a===hh||a===fh){if(Yd.has(s)){const l=Yd.get(s);TD(l,s.mapping),this._cubeTexture=l}else{const l=s.image;if(Oee(l)){const u=new sI(l.height);u.fromEquirectangularTexture(t,s),TD(u.texture,s.mapping),this._cubeTexture=u.texture,Yd.set(s,u.texture),s.addEventListener("dispose",aI)}else this._cubeTexture=this._defaultTexture}this._cubeTextureNode.value=this._cubeTexture}else this._cubeTextureNode=this.envNode}}}setup(e){return this.updateBefore(e),this._cubeTextureNode}}function Oee(i){return i==null?!1:i.height>0}function aI(i){const e=i.target;e.removeEventListener("dispose",aI);const t=Yd.get(e);t!==void 0&&(Yd.delete(e),t.dispose())}function TD(i,e){e===hh?i.mapping=ha:e===fh&&(i.mapping=fa)}const oI=Oe(Uee).setParameterLength(1);class UE extends Zh{static get type(){return"BasicEnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){e.context.environment=oI(this.envNode)}}class Bee extends Zh{static get type(){return"BasicLightMapNode"}constructor(e=null){super(),this.lightMapNode=e}setup(e){const t=Te(1/Math.PI);e.context.irradianceLightMap=this.lightMapNode.mul(t)}}class Wv{start(e){e.lightsNode.setupLights(e,e.lightsNode.getLightNodes(e)),this.indirect(e)}finish(){}direct(){}directRectArea(){}indirect(){}ambientOcclusion(){}}class lI extends Wv{constructor(){super()}indirect({context:e}){const t=e.ambientOcclusion,n=e.reflectedLight,r=e.irradianceLightMap;n.indirectDiffuse.assign(Ut(0)),r?n.indirectDiffuse.addAssign(r):n.indirectDiffuse.addAssign(Ut(1,1,1,0)),n.indirectDiffuse.mulAssign(t),n.indirectDiffuse.mulAssign(an.rgb)}finish(e){const{material:t,context:n}=e,r=n.outgoingLight,s=e.context.environment;if(s)switch(t.combine){case zp:r.rgb.assign(Dn(r.rgb,r.rgb.mul(s.rgb),Uy.mul(Mb)));break;case qU:r.rgb.assign(Dn(r.rgb,s.rgb,Uy.mul(Mb)));break;case $U:r.rgb.addAssign(s.rgb.mul(Uy.mul(Mb)));break;default:console.warn("THREE.BasicLightingModel: Unsupported .combine value:",t.combine);break}}}const Iee=new na;class Fee extends pi{static get type(){return"MeshBasicNodeMaterial"}constructor(e){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!0,this.setDefaultValues(Iee),this.setValues(e)}setupNormal(){return ga}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new UE(t):null}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new Bee(KB)),t}setupOutgoingLight(){return an.rgb}setupLightingModel(){return new lI}}const Pp=Ue(({f0:i,f90:e,dotVH:t})=>{const n=t.mul(-5.55473).sub(6.98316).mul(t).exp2();return i.mul(n.oneMinus()).add(e.mul(n))}),Bh=Ue(i=>i.diffuseColor.mul(1/Math.PI)),kee=()=>Te(.25),zee=Ue(({dotNH:i})=>uT.mul(Te(.5)).add(1).mul(Te(1/Math.PI)).mul(i.pow(uT))),Vee=Ue(({lightDirection:i})=>{const e=i.add(zn).normalize(),t=ci.dot(e).clamp(),n=zn.dot(e).clamp(),r=Pp({f0:Qr,f90:1,dotVH:n}),s=kee(),a=zee({dotNH:t});return r.mul(s).mul(a)});class uI extends lI{constructor(e=!0){super(),this.specular=e}direct({lightDirection:e,lightColor:t,reflectedLight:n}){const s=ci.dot(e).clamp().mul(t);n.directDiffuse.addAssign(s.mul(Bh({diffuseColor:an.rgb}))),this.specular===!0&&n.directSpecular.addAssign(s.mul(Vee({lightDirection:e})).mul(Uy))}indirect(e){const{ambientOcclusion:t,irradiance:n,reflectedLight:r}=e.context;r.indirectDiffuse.addAssign(n.mul(Bh({diffuseColor:an}))),r.indirectDiffuse.mulAssign(t)}}const Gee=new fO;class Hee extends pi{static get type(){return"MeshLambertNodeMaterial"}constructor(e){super(),this.isMeshLambertNodeMaterial=!0,this.lights=!0,this.setDefaultValues(Gee),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new UE(t):null}setupLightingModel(){return new uI(!1)}}const Wee=new k8;class jee extends pi{static get type(){return"MeshPhongNodeMaterial"}constructor(e){super(),this.isMeshPhongNodeMaterial=!0,this.lights=!0,this.shininessNode=null,this.specularNode=null,this.setDefaultValues(Wee),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new UE(t):null}setupLightingModel(){return new uI}setupVariants(){const e=(this.shininessNode?Te(this.shininessNode):SJ).max(1e-4);uT.assign(e);const t=this.specularNode||MJ;Qr.assign(t)}copy(e){return this.shininessNode=e.shininessNode,this.specularNode=e.specularNode,super.copy(e)}}const qee=Ue(i=>{if(i.geometry.hasAttribute("normal")===!1)return Te(0);const e=ga.dFdx().abs().max(ga.dFdy().abs());return e.x.max(e.y).max(e.z)}),cI=Ue(i=>{const{roughness:e}=i,t=qee();let n=e.max(.0525);return n=n.add(t),n=n.min(1),n}),$ee=Ue(({alpha:i,dotNL:e,dotNV:t})=>{const n=i.pow2(),r=e.mul(n.add(n.oneMinus().mul(t.pow2())).sqrt()),s=t.mul(n.add(n.oneMinus().mul(e.pow2())).sqrt());return pa(.5,r.add(s).max(PZ))}).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),Xee=Ue(({alphaT:i,alphaB:e,dotTV:t,dotBV:n,dotTL:r,dotBL:s,dotNV:a,dotNL:l})=>{const u=l.mul(Ee(i.mul(t),e.mul(n),a).length()),h=a.mul(Ee(i.mul(r),e.mul(s),l).length());return pa(.5,u.add(h)).saturate()}).setLayout({name:"V_GGX_SmithCorrelated_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotTV",type:"float",qualifier:"in"},{name:"dotBV",type:"float",qualifier:"in"},{name:"dotTL",type:"float",qualifier:"in"},{name:"dotBL",type:"float",qualifier:"in"},{name:"dotNV",type:"float",qualifier:"in"},{name:"dotNL",type:"float",qualifier:"in"}]}),Yee=Ue(({alpha:i,dotNH:e})=>{const t=i.pow2(),n=e.pow2().mul(t.oneMinus()).oneMinus();return t.div(n.pow2()).mul(1/Math.PI)}).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]}),Kee=Te(1/Math.PI),Zee=Ue(({alphaT:i,alphaB:e,dotNH:t,dotTH:n,dotBH:r})=>{const s=i.mul(e),a=Ee(e.mul(n),i.mul(r),s.mul(t)),l=a.dot(a),u=s.div(l);return Kee.mul(s.mul(u.pow2()))}).setLayout({name:"D_GGX_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotNH",type:"float",qualifier:"in"},{name:"dotTH",type:"float",qualifier:"in"},{name:"dotBH",type:"float",qualifier:"in"}]}),MD=Ue(i=>{const{lightDirection:e,f0:t,f90:n,roughness:r,f:s,USE_IRIDESCENCE:a,USE_ANISOTROPY:l}=i,u=i.normalView||ci,h=r.pow2(),d=e.add(zn).normalize(),p=u.dot(e).clamp(),g=u.dot(zn).clamp(),y=u.dot(d).clamp(),v=zn.dot(d).clamp();let S=Pp({f0:t,f90:n,dotVH:v}),b,_;if(rD(a)&&(S=vE.mix(S,s)),rD(l)){const E=Cy.dot(e),M=Cy.dot(zn),A=Cy.dot(d),w=ih.dot(e),R=ih.dot(zn),C=ih.dot(d);b=Xee({alphaT:lT,alphaB:h,dotTV:M,dotBV:R,dotTL:E,dotBL:w,dotNV:g,dotNL:p}),_=Zee({alphaT:lT,alphaB:h,dotNH:y,dotTH:A,dotBH:C})}else b=$ee({alpha:h,dotNL:p,dotNV:g}),_=Yee({alpha:h,dotNH:y});return S.mul(b).mul(_)}),hI=Ue(({roughness:i,dotNV:e})=>{const t=Ut(-1,-.0275,-.572,.022),n=Ut(1,.0425,1.04,-.04),r=i.mul(t).add(n),s=r.x.mul(r.x).min(e.mul(-9.28).exp2()).mul(r.x).add(r.y);return We(-1.04,1.04).mul(s).add(r.zw)}).setLayout({name:"DFGApprox",type:"vec2",inputs:[{name:"roughness",type:"float"},{name:"dotNV",type:"vec3"}]}),fI=Ue(i=>{const{dotNV:e,specularColor:t,specularF90:n,roughness:r}=i,s=hI({dotNV:e,roughness:r});return t.mul(s.x).add(n.mul(s.y))}),Qee=Ue(({f:i,f90:e,dotVH:t})=>{const n=t.oneMinus().saturate(),r=n.mul(n),s=n.mul(r,r).clamp(0,.9999);return i.sub(Ee(e).mul(s)).div(s.oneMinus())}).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]}),Jee=Ue(({roughness:i,dotNH:e})=>{const t=i.pow2(),n=Te(1).div(t),s=e.pow2().oneMinus().max(.0078125);return Te(2).add(n).mul(s.pow(n.mul(.5))).div(2*Math.PI)}).setLayout({name:"D_Charlie",type:"float",inputs:[{name:"roughness",type:"float"},{name:"dotNH",type:"float"}]}),ete=Ue(({dotNV:i,dotNL:e})=>Te(1).div(Te(4).mul(e.add(i).sub(e.mul(i))))).setLayout({name:"V_Neubelt",type:"float",inputs:[{name:"dotNV",type:"float"},{name:"dotNL",type:"float"}]}),tte=Ue(({lightDirection:i})=>{const e=i.add(zn).normalize(),t=ci.dot(i).clamp(),n=ci.dot(zn).clamp(),r=ci.dot(e).clamp(),s=Jee({roughness:yE,dotNH:r}),a=ete({dotNV:n,dotNL:t});return Xc.mul(s).mul(a)}),nte=Ue(({N:i,V:e,roughness:t})=>{const s=.0078125,a=i.dot(e).saturate(),l=We(t,a.oneMinus().sqrt());return l.assign(l.mul(.984375).add(s)),l}).setLayout({name:"LTC_Uv",type:"vec2",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"roughness",type:"float"}]}),ite=Ue(({f:i})=>{const e=i.length();return sr(e.mul(e).add(i.z).div(e.add(1)),0)}).setLayout({name:"LTC_ClippedSphereFormFactor",type:"float",inputs:[{name:"f",type:"vec3"}]}),Qg=Ue(({v1:i,v2:e})=>{const t=i.dot(e),n=t.abs().toVar(),r=n.mul(.0145206).add(.4965155).mul(n).add(.8543985).toVar(),s=n.add(4.1616724).mul(n).add(3.417594).toVar(),a=r.div(s),l=t.greaterThan(0).select(a,sr(t.mul(t).oneMinus(),1e-7).inverseSqrt().mul(.5).sub(a));return i.cross(e).mul(l)}).setLayout({name:"LTC_EdgeVectorFormFactor",type:"vec3",inputs:[{name:"v1",type:"vec3"},{name:"v2",type:"vec3"}]}),ED=Ue(({N:i,V:e,P:t,mInv:n,p0:r,p1:s,p2:a,p3:l})=>{const u=s.sub(r).toVar(),h=l.sub(r).toVar(),d=u.cross(h),p=Ee().toVar();return ii(d.dot(t.sub(r)).greaterThanEqual(0),()=>{const g=e.sub(i.mul(e.dot(i))).normalize(),y=i.cross(g).negate(),v=n.mul(_r(g,y,i).transpose()).toVar(),S=v.mul(r.sub(t)).normalize().toVar(),b=v.mul(s.sub(t)).normalize().toVar(),_=v.mul(a.sub(t)).normalize().toVar(),E=v.mul(l.sub(t)).normalize().toVar(),M=Ee(0).toVar();M.addAssign(Qg({v1:S,v2:b})),M.addAssign(Qg({v1:b,v2:_})),M.addAssign(Qg({v1:_,v2:E})),M.addAssign(Qg({v1:E,v2:S})),p.assign(Ee(ite({f:M})))}),p}).setLayout({name:"LTC_Evaluate",type:"vec3",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"P",type:"vec3"},{name:"mInv",type:"mat3"},{name:"p0",type:"vec3"},{name:"p1",type:"vec3"},{name:"p2",type:"vec3"},{name:"p3",type:"vec3"}]}),jv=1/6,dI=i=>$t(jv,$t(i,$t(i,i.negate().add(3)).sub(3)).add(1)),fT=i=>$t(jv,$t(i,$t(i,$t(3,i).sub(6))).add(4)),pI=i=>$t(jv,$t(i,$t(i,$t(-3,i).add(3)).add(3)).add(1)),dT=i=>$t(jv,Fv(i,3)),AD=i=>dI(i).add(fT(i)),wD=i=>pI(i).add(dT(i)),RD=i=>xr(-1,fT(i).div(dI(i).add(fT(i)))),CD=i=>xr(1,dT(i).div(pI(i).add(dT(i)))),ND=(i,e,t)=>{const n=i.uvNode,r=$t(n,e.zw).add(.5),s=xu(r),a=vl(r),l=AD(a.x),u=wD(a.x),h=RD(a.x),d=CD(a.x),p=RD(a.y),g=CD(a.y),y=We(s.x.add(h),s.y.add(p)).sub(.5).mul(e.xy),v=We(s.x.add(d),s.y.add(p)).sub(.5).mul(e.xy),S=We(s.x.add(h),s.y.add(g)).sub(.5).mul(e.xy),b=We(s.x.add(d),s.y.add(g)).sub(.5).mul(e.xy),_=AD(a.y).mul(xr(l.mul(i.sample(y).level(t)),u.mul(i.sample(v).level(t)))),E=wD(a.y).mul(xr(l.mul(i.sample(S).level(t)),u.mul(i.sample(b).level(t))));return _.add(E)},rte=Ue(([i,e=Te(3)])=>{const t=We(i.size(Nn(e))),n=We(i.size(Nn(e.add(1)))),r=pa(1,t),s=pa(1,n),a=ND(i,Ut(r,t),xu(e)),l=ND(i,Ut(s,n),bE(e));return vl(e).mix(a,l)}),PD=Ue(([i,e,t,n,r])=>{const s=Ee(LB(e.negate(),Rp(i),pa(1,n))),a=Ee(lo(r[0].xyz),lo(r[1].xyz),lo(r[2].xyz));return Rp(s).mul(t.mul(a))}).setLayout({name:"getVolumeTransmissionRay",type:"vec3",inputs:[{name:"n",type:"vec3"},{name:"v",type:"vec3"},{name:"thickness",type:"float"},{name:"ior",type:"float"},{name:"modelMatrix",type:"mat4"}]}),ste=Ue(([i,e])=>i.mul(fo(e.mul(2).sub(2),0,1))).setLayout({name:"applyIorToRoughness",type:"float",inputs:[{name:"roughness",type:"float"},{name:"ior",type:"float"}]}),ate=JB(),ote=JB(),DD=Ue(([i,e,t],{material:n})=>{const s=(n.side===An?ate:ote).sample(i),a=oo(hT.x).mul(ste(e,t));return rte(s,a)}),LD=Ue(([i,e,t])=>(ii(t.notEqual(0),()=>{const n=TB(e).negate().div(t);return SB(n.negate().mul(i))}),Ee(1))).setLayout({name:"volumeAttenuation",type:"vec3",inputs:[{name:"transmissionDistance",type:"float"},{name:"attenuationColor",type:"vec3"},{name:"attenuationDistance",type:"float"}]}),lte=Ue(([i,e,t,n,r,s,a,l,u,h,d,p,g,y,v])=>{let S,b;if(v){S=Ut().toVar(),b=Ee().toVar();const w=d.sub(1).mul(v.mul(.025)),R=Ee(d.sub(w),d,d.add(w));Fs({start:0,end:3},({i:C})=>{const L=R.element(C),N=PD(i,e,p,L,l),D=a.add(N),I=h.mul(u.mul(Ut(D,1))),W=We(I.xy.div(I.w)).toVar();W.addAssign(1),W.divAssign(2),W.assign(We(W.x,W.y.oneMinus()));const Y=DD(W,t,L);S.element(C).assign(Y.element(C)),S.a.addAssign(Y.a),b.element(C).assign(n.element(C).mul(LD(lo(N),g,y).element(C)))}),S.a.divAssign(3)}else{const w=PD(i,e,p,d,l),R=a.add(w),C=h.mul(u.mul(Ut(R,1))),L=We(C.xy.div(C.w)).toVar();L.addAssign(1),L.divAssign(2),L.assign(We(L.x,L.y.oneMinus())),S=DD(L,t,d),b=n.mul(LD(lo(w),g,y))}const _=b.rgb.mul(S.rgb),E=i.dot(e).clamp(),M=Ee(fI({dotNV:E,specularColor:r,specularF90:s,roughness:t})),A=b.r.add(b.g,b.b).div(3);return Ut(M.oneMinus().mul(_),S.a.oneMinus().mul(A).oneMinus())}),ute=_r(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),cte=i=>{const e=i.sqrt();return Ee(1).add(e).div(Ee(1).sub(e))},UD=(i,e)=>i.sub(e).div(i.add(e)).pow2(),hte=(i,e)=>{const t=i.mul(2*Math.PI*1e-9),n=Ee(54856e-17,44201e-17,52481e-17),r=Ee(1681e3,1795300,2208400),s=Ee(43278e5,93046e5,66121e5),a=Te(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(t.mul(2239900).add(e.x).cos()).mul(t.pow2().mul(-45282e5).exp());let l=n.mul(s.mul(2*Math.PI).sqrt()).mul(r.mul(t).add(e).cos()).mul(t.pow2().negate().mul(s).exp());return l=Ee(l.x.add(a),l.y,l.z).div(10685e-11),ute.mul(l)},fte=Ue(({outsideIOR:i,eta2:e,cosTheta1:t,thinFilmThickness:n,baseF0:r})=>{const s=Dn(i,e,pl(0,.03,n)),l=i.div(s).pow2().mul(t.pow2().oneMinus()).oneMinus();ii(l.lessThan(0),()=>Ee(1));const u=l.sqrt(),h=UD(s,i),d=Pp({f0:h,f90:1,dotVH:t}),p=d.oneMinus(),g=s.lessThan(i).select(Math.PI,0),y=Te(Math.PI).sub(g),v=cte(r.clamp(0,.9999)),S=UD(v,s.toVec3()),b=Pp({f0:S,f90:1,dotVH:u}),_=Ee(v.x.lessThan(s).select(Math.PI,0),v.y.lessThan(s).select(Math.PI,0),v.z.lessThan(s).select(Math.PI,0)),E=s.mul(n,u,2),M=Ee(y).add(_),A=d.mul(b).clamp(1e-5,.9999),w=A.sqrt(),R=p.pow2().mul(b).div(Ee(1).sub(A)),L=d.add(R).toVar(),N=R.sub(p).toVar();return Fs({start:1,end:2,condition:"<=",name:"m"},({m:D})=>{N.mulAssign(w);const I=hte(Te(D).mul(E),Te(D).mul(M)).mul(2);L.addAssign(N.mul(I))}),L.max(Ee(0))}).setLayout({name:"evalIridescence",type:"vec3",inputs:[{name:"outsideIOR",type:"float"},{name:"eta2",type:"float"},{name:"cosTheta1",type:"float"},{name:"thinFilmThickness",type:"float"},{name:"baseF0",type:"vec3"}]}),dte=Ue(({normal:i,viewDir:e,roughness:t})=>{const n=i.dot(e).saturate(),r=t.pow2(),s=ir(t.lessThan(.25),Te(-339.2).mul(r).add(Te(161.4).mul(t)).sub(25.9),Te(-8.48).mul(r).add(Te(14.3).mul(t)).sub(9.95)),a=ir(t.lessThan(.25),Te(44).mul(r).sub(Te(23.7).mul(t)).add(3.26),Te(1.97).mul(r).sub(Te(3.27).mul(t)).add(.72));return ir(t.lessThan(.25),0,Te(.1).mul(t).sub(.025)).add(s.mul(n).add(a).exp()).mul(1/Math.PI).saturate()}),wb=Ee(.04),Rb=Te(1);class mI extends Wv{constructor(e=!1,t=!1,n=!1,r=!1,s=!1,a=!1){super(),this.clearcoat=e,this.sheen=t,this.iridescence=n,this.anisotropy=r,this.transmission=s,this.dispersion=a,this.clearcoatRadiance=null,this.clearcoatSpecularDirect=null,this.clearcoatSpecularIndirect=null,this.sheenSpecularDirect=null,this.sheenSpecularIndirect=null,this.iridescenceFresnel=null,this.iridescenceF0=null}start(e){if(this.clearcoat===!0&&(this.clearcoatRadiance=Ee().toVar("clearcoatRadiance"),this.clearcoatSpecularDirect=Ee().toVar("clearcoatSpecularDirect"),this.clearcoatSpecularIndirect=Ee().toVar("clearcoatSpecularIndirect")),this.sheen===!0&&(this.sheenSpecularDirect=Ee().toVar("sheenSpecularDirect"),this.sheenSpecularIndirect=Ee().toVar("sheenSpecularIndirect")),this.iridescence===!0){const t=ci.dot(zn).clamp();this.iridescenceFresnel=fte({outsideIOR:Te(1),eta2:dB,cosTheta1:t,thinFilmThickness:pB,baseF0:Qr}),this.iridescenceF0=Qee({f:this.iridescenceFresnel,f90:1,dotVH:t})}if(this.transmission===!0){const t=Cp,n=$Q.sub(Cp).normalize(),r=NE,s=e.context;s.backdrop=lte(r,n,Qa,an,Qr,sv,t,wu,yo,RE,Ny,mB,yB,gB,this.dispersion?vB:null),s.backdropAlpha=cT,an.a.mulAssign(Dn(1,s.backdrop.a,cT))}super.start(e)}computeMultiscattering(e,t,n){const r=ci.dot(zn).clamp(),s=hI({roughness:Qa,dotNV:r}),l=(this.iridescenceF0?vE.mix(Qr,this.iridescenceF0):Qr).mul(s.x).add(n.mul(s.y)),h=s.x.add(s.y).oneMinus(),d=Qr.add(Qr.oneMinus().mul(.047619)),p=l.mul(d).div(h.mul(d).oneMinus());e.addAssign(l),t.addAssign(p.mul(h))}direct({lightDirection:e,lightColor:t,reflectedLight:n}){const s=ci.dot(e).clamp().mul(t);if(this.sheen===!0&&this.sheenSpecularDirect.addAssign(s.mul(tte({lightDirection:e}))),this.clearcoat===!0){const l=Pd.dot(e).clamp().mul(t);this.clearcoatSpecularDirect.addAssign(l.mul(MD({lightDirection:e,f0:wb,f90:Rb,roughness:rv,normalView:Pd})))}n.directDiffuse.addAssign(s.mul(Bh({diffuseColor:an.rgb}))),n.directSpecular.addAssign(s.mul(MD({lightDirection:e,f0:Qr,f90:1,roughness:Qa,iridescence:this.iridescence,f:this.iridescenceFresnel,USE_IRIDESCENCE:this.iridescence,USE_ANISOTROPY:this.anisotropy})))}directRectArea({lightColor:e,lightPosition:t,halfWidth:n,halfHeight:r,reflectedLight:s,ltc_1:a,ltc_2:l}){const u=t.add(n).sub(r),h=t.sub(n).sub(r),d=t.sub(n).add(r),p=t.add(n).add(r),g=ci,y=zn,v=hi.toVar(),S=nte({N:g,V:y,roughness:Qa}),b=a.sample(S).toVar(),_=l.sample(S).toVar(),E=_r(Ee(b.x,0,b.y),Ee(0,1,0),Ee(b.z,0,b.w)).toVar(),M=Qr.mul(_.x).add(Qr.oneMinus().mul(_.y)).toVar();s.directSpecular.addAssign(e.mul(M).mul(ED({N:g,V:y,P:v,mInv:E,p0:u,p1:h,p2:d,p3:p}))),s.directDiffuse.addAssign(e.mul(an).mul(ED({N:g,V:y,P:v,mInv:_r(1,0,0,0,1,0,0,0,1),p0:u,p1:h,p2:d,p3:p})))}indirect(e){this.indirectDiffuse(e),this.indirectSpecular(e),this.ambientOcclusion(e)}indirectDiffuse(e){const{irradiance:t,reflectedLight:n}=e.context;n.indirectDiffuse.addAssign(t.mul(Bh({diffuseColor:an})))}indirectSpecular(e){const{radiance:t,iblIrradiance:n,reflectedLight:r}=e.context;if(this.sheen===!0&&this.sheenSpecularIndirect.addAssign(n.mul(Xc,dte({normal:ci,viewDir:zn,roughness:yE}))),this.clearcoat===!0){const d=Pd.dot(zn).clamp(),p=fI({dotNV:d,specularColor:wb,specularF90:Rb,roughness:rv});this.clearcoatSpecularIndirect.addAssign(this.clearcoatRadiance.mul(p))}const s=Ee().toVar("singleScattering"),a=Ee().toVar("multiScattering"),l=n.mul(1/Math.PI);this.computeMultiscattering(s,a,sv);const u=s.add(a),h=an.mul(u.r.max(u.g).max(u.b).oneMinus());r.indirectSpecular.addAssign(t.mul(s)),r.indirectSpecular.addAssign(a.mul(l)),r.indirectDiffuse.addAssign(h.mul(l))}ambientOcclusion(e){const{ambientOcclusion:t,reflectedLight:n}=e.context,s=ci.dot(zn).clamp().add(t),a=Qa.mul(-16).oneMinus().negate().exp2(),l=t.sub(s.pow(a).oneMinus()).clamp();this.clearcoat===!0&&this.clearcoatSpecularIndirect.mulAssign(t),this.sheen===!0&&this.sheenSpecularIndirect.mulAssign(t),n.indirectDiffuse.mulAssign(t),n.indirectSpecular.mulAssign(l)}finish({context:e}){const{outgoingLight:t}=e;if(this.clearcoat===!0){const n=Pd.dot(zn).clamp(),r=Pp({dotVH:n,f0:wb,f90:Rb}),s=t.mul(oT.mul(r).oneMinus()).add(this.clearcoatSpecularDirect.add(this.clearcoatSpecularIndirect).mul(oT));t.assign(s)}if(this.sheen===!0){const n=Xc.r.max(Xc.g).max(Xc.b).mul(.157).oneMinus(),r=t.mul(n).add(this.sheenSpecularDirect,this.sheenSpecularIndirect);t.assign(r)}}}const OD=Te(1),pT=Te(-2),Jg=Te(.8),Cb=Te(-1),ey=Te(.4),Nb=Te(2),ty=Te(.305),Pb=Te(3),BD=Te(.21),pte=Te(4),ID=Te(4),mte=Te(16),gte=Ue(([i])=>{const e=Ee(ys(i)).toVar(),t=Te(-1).toVar();return ii(e.x.greaterThan(e.z),()=>{ii(e.x.greaterThan(e.y),()=>{t.assign(ir(i.x.greaterThan(0),0,3))}).Else(()=>{t.assign(ir(i.y.greaterThan(0),1,4))})}).Else(()=>{ii(e.z.greaterThan(e.y),()=>{t.assign(ir(i.z.greaterThan(0),2,5))}).Else(()=>{t.assign(ir(i.y.greaterThan(0),1,4))})}),t}).setLayout({name:"getFace",type:"float",inputs:[{name:"direction",type:"vec3"}]}),yte=Ue(([i,e])=>{const t=We().toVar();return ii(e.equal(0),()=>{t.assign(We(i.z,i.y).div(ys(i.x)))}).ElseIf(e.equal(1),()=>{t.assign(We(i.x.negate(),i.z.negate()).div(ys(i.y)))}).ElseIf(e.equal(2),()=>{t.assign(We(i.x.negate(),i.y).div(ys(i.z)))}).ElseIf(e.equal(3),()=>{t.assign(We(i.z.negate(),i.y).div(ys(i.x)))}).ElseIf(e.equal(4),()=>{t.assign(We(i.x.negate(),i.z).div(ys(i.y)))}).Else(()=>{t.assign(We(i.x,i.y).div(ys(i.z)))}),$t(.5,t.add(1))}).setLayout({name:"getUV",type:"vec2",inputs:[{name:"direction",type:"vec3"},{name:"face",type:"float"}]}),vte=Ue(([i])=>{const e=Te(0).toVar();return ii(i.greaterThanEqual(Jg),()=>{e.assign(OD.sub(i).mul(Cb.sub(pT)).div(OD.sub(Jg)).add(pT))}).ElseIf(i.greaterThanEqual(ey),()=>{e.assign(Jg.sub(i).mul(Nb.sub(Cb)).div(Jg.sub(ey)).add(Cb))}).ElseIf(i.greaterThanEqual(ty),()=>{e.assign(ey.sub(i).mul(Pb.sub(Nb)).div(ey.sub(ty)).add(Nb))}).ElseIf(i.greaterThanEqual(BD),()=>{e.assign(ty.sub(i).mul(pte.sub(Pb)).div(ty.sub(BD)).add(Pb))}).Else(()=>{e.assign(Te(-2).mul(oo($t(1.16,i))))}),e}).setLayout({name:"roughnessToMip",type:"float",inputs:[{name:"roughness",type:"float"}]}),_te=Ue(([i,e])=>{const t=i.toVar();t.assign($t(2,t).sub(1));const n=Ee(t,1).toVar();return ii(e.equal(0),()=>{n.assign(n.zyx)}).ElseIf(e.equal(1),()=>{n.assign(n.xzy),n.xz.mulAssign(-1)}).ElseIf(e.equal(2),()=>{n.x.mulAssign(-1)}).ElseIf(e.equal(3),()=>{n.assign(n.zyx),n.xz.mulAssign(-1)}).ElseIf(e.equal(4),()=>{n.assign(n.xzy),n.xy.mulAssign(-1)}).ElseIf(e.equal(5),()=>{n.z.mulAssign(-1)}),n}).setLayout({name:"getDirection",type:"vec3",inputs:[{name:"uv",type:"vec2"},{name:"face",type:"float"}]}),xte=Ue(([i,e,t,n,r,s])=>{const a=Te(t),l=Ee(e),u=fo(vte(a),pT,s),h=vl(u),d=xu(u),p=Ee(mT(i,l,d,n,r,s)).toVar();return ii(h.notEqual(0),()=>{const g=Ee(mT(i,l,d.add(1),n,r,s)).toVar();p.assign(Dn(p,g,h))}),p}),mT=Ue(([i,e,t,n,r,s])=>{const a=Te(t).toVar(),l=Ee(e),u=Te(gte(l)).toVar(),h=Te(sr(ID.sub(a),0)).toVar();a.assign(sr(a,ID));const d=Te(wp(a)).toVar(),p=We(yte(l,u).mul(d.sub(2)).add(1)).toVar();return ii(u.greaterThan(2),()=>{p.y.addAssign(d),u.subAssign(3)}),p.x.addAssign(u.mul(d)),p.x.addAssign(h.mul($t(3,mte))),p.y.addAssign($t(4,wp(s).sub(d))),p.x.mulAssign(n),p.y.mulAssign(r),i.sample(p).grad(We(),We())}),Db=Ue(({envMap:i,mipInt:e,outputDirection:t,theta:n,axis:r,CUBEUV_TEXEL_WIDTH:s,CUBEUV_TEXEL_HEIGHT:a,CUBEUV_MAX_MIP:l})=>{const u=el(n),h=t.mul(u).add(r.cross(t).mul(Is(n))).add(r.mul(r.dot(t).mul(u.oneMinus())));return mT(i,h,e,s,a,l)}),bte=Ue(({n:i,latitudinal:e,poleAxis:t,outputDirection:n,weights:r,samples:s,dTheta:a,mipInt:l,envMap:u,CUBEUV_TEXEL_WIDTH:h,CUBEUV_TEXEL_HEIGHT:d,CUBEUV_MAX_MIP:p})=>{const g=Ee(ir(e,t,CB(t,n))).toVar();ii(g.equal(Ee(0)),()=>{g.assign(Ee(n.z,0,n.x.negate()))}),g.assign(Rp(g));const y=Ee().toVar();return y.addAssign(r.element(0).mul(Db({theta:0,axis:g,outputDirection:n,mipInt:l,envMap:u,CUBEUV_TEXEL_WIDTH:h,CUBEUV_TEXEL_HEIGHT:d,CUBEUV_MAX_MIP:p}))),Fs({start:Nn(1),end:i},({i:v})=>{ii(v.greaterThanEqual(s),()=>{oee()});const S=Te(a.mul(Te(v))).toVar();y.addAssign(r.element(v).mul(Db({theta:S.mul(-1),axis:g,outputDirection:n,mipInt:l,envMap:u,CUBEUV_TEXEL_WIDTH:h,CUBEUV_TEXEL_HEIGHT:d,CUBEUV_MAX_MIP:p}))),y.addAssign(r.element(v).mul(Db({theta:S,axis:g,outputDirection:n,mipInt:l,envMap:u,CUBEUV_TEXEL_WIDTH:h,CUBEUV_TEXEL_HEIGHT:d,CUBEUV_MAX_MIP:p})))}),Ut(y,1)}),Yc=4,FD=[.125,.215,.35,.446,.526,.582],uu=20,Lb=new Yp(-1,1,1,-1,0,1),Ste=new Ui(90,1),kD=new ot;let Ub=null,Ob=0,Bb=0;const ru=(1+Math.sqrt(5))/2,Lc=1/ru,zD=[new V(-ru,Lc,0),new V(ru,Lc,0),new V(-Lc,0,ru),new V(Lc,0,ru),new V(0,ru,-Lc),new V(0,ru,Lc),new V(-1,1,-1),new V(1,1,-1),new V(-1,1,1),new V(1,1,1)],Tte=new V,gI=new WeakMap,Mte=[3,1,5,0,4,2],Ib=_te(Jp(),ml("faceIndex")).normalize(),OE=Ee(Ib.x,Ib.y,Ib.z);class Ete{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._backgroundBox=null}get _hasInitialized(){return this._renderer.hasInitialized()}fromScene(e,t=0,n=.1,r=100,s={}){const{size:a=256,position:l=Tte,renderTarget:u=null}=s;if(this._setSize(a),this._hasInitialized===!1){console.warn("THREE.PMREMGenerator: .fromScene() called before the backend is initialized. Try using .fromSceneAsync() instead.");const d=u||this._allocateTarget();return s.renderTarget=d,this.fromSceneAsync(e,t,n,r,s),d}Ub=this._renderer.getRenderTarget(),Ob=this._renderer.getActiveCubeFace(),Bb=this._renderer.getActiveMipmapLevel();const h=u||this._allocateTarget();return h.depthBuffer=!0,this._init(h),this._sceneToCubeUV(e,n,r,h,l),t>0&&this._blur(h,0,0,t),this._applyPMREM(h),this._cleanup(h),h}async fromSceneAsync(e,t=0,n=.1,r=100,s={}){return this._hasInitialized===!1&&await this._renderer.init(),this.fromScene(e,t,n,r,s)}fromEquirectangular(e,t=null){if(this._hasInitialized===!1){console.warn("THREE.PMREMGenerator: .fromEquirectangular() called before the backend is initialized. Try using .fromEquirectangularAsync() instead."),this._setSizeFromTexture(e);const n=t||this._allocateTarget();return this.fromEquirectangularAsync(e,n),n}return this._fromTexture(e,t)}async fromEquirectangularAsync(e,t=null){return this._hasInitialized===!1&&await this._renderer.init(),this._fromTexture(e,t)}fromCubemap(e,t=null){if(this._hasInitialized===!1){console.warn("THREE.PMREMGenerator: .fromCubemap() called before the backend is initialized. Try using .fromCubemapAsync() instead."),this._setSizeFromTexture(e);const n=t||this._allocateTarget();return this.fromCubemapAsync(e,t),n}return this._fromTexture(e,t)}async fromCubemapAsync(e,t=null){return this._hasInitialized===!1&&await this._renderer.init(),this._fromTexture(e,t)}async compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=GD(),await this._compileMaterial(this._cubemapMaterial))}async compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=HD(),await this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose(),this._backgroundBox!==null&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSizeFromTexture(e){e.mapping===ha||e.mapping===fa?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4)}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(Ub,Ob,Bb),e.scissorTest=!1,ny(e,0,0,e.width,e.height)}_fromTexture(e,t){this._setSizeFromTexture(e),Ub=this._renderer.getRenderTarget(),Ob=this._renderer.getActiveCubeFace(),Bb=this._renderer.getActiveMipmapLevel();const n=t||this._allocateTarget();return this._init(n),this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTarget(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize;return VD(e,t)}_init(e){if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e.width||this._pingPongRenderTarget.height!==e.height){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=VD(e.width,e.height);const{_lodMax:t}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas,lodMeshes:this._lodMeshes}=Ate(t)),this._blurMaterial=wte(t,e.width,e.height)}}async _compileMaterial(e){const t=new fi(this._lodPlanes[0],e);await this._renderer.compile(t,Lb)}_sceneToCubeUV(e,t,n,r,s){const a=Ste;a.near=t,a.far=n;const l=[1,1,1,1,-1,1],u=[1,-1,1,-1,1,-1],h=this._renderer,d=h.autoClear;h.getClearColor(kD),h.autoClear=!1;let p=this._backgroundBox;if(p===null){const v=new na({name:"PMREM.Background",side:An,depthWrite:!1,depthTest:!1});p=new fi(new Du,v)}let g=!1;const y=e.background;y?y.isColor&&(p.material.color.copy(y),e.background=null,g=!0):(p.material.color.copy(kD),g=!0),h.setRenderTarget(r),h.clear(),g&&h.render(p,a);for(let v=0;v<6;v++){const S=v%3;S===0?(a.up.set(0,l[v],0),a.position.set(s.x,s.y,s.z),a.lookAt(s.x+u[v],s.y,s.z)):S===1?(a.up.set(0,0,l[v]),a.position.set(s.x,s.y,s.z),a.lookAt(s.x,s.y+u[v],s.z)):(a.up.set(0,l[v],0),a.position.set(s.x,s.y,s.z),a.lookAt(s.x,s.y,s.z+u[v]));const b=this._cubeSize;ny(r,S*b,v>2?b:0,b,b),h.render(e,a)}h.autoClear=d,e.background=y}_textureToCubeUV(e,t){const n=this._renderer,r=e.mapping===ha||e.mapping===fa;r?this._cubemapMaterial===null&&(this._cubemapMaterial=GD(e)):this._equirectMaterial===null&&(this._equirectMaterial=HD(e));const s=r?this._cubemapMaterial:this._equirectMaterial;s.fragmentNode.value=e;const a=this._lodMeshes[0];a.material=s;const l=this._cubeSize;ny(t,0,0,3*l,2*l),n.setRenderTarget(t),n.render(a,Lb)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;const r=this._lodPlanes.length;for(let s=1;s<r;s++){const a=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),l=zD[(r-s-1)%zD.length];this._blur(e,s-1,s,a,l)}t.autoClear=n}_blur(e,t,n,r,s){const a=this._pingPongRenderTarget;this._halfBlur(e,a,t,n,r,"latitudinal",s),this._halfBlur(a,e,n,n,r,"longitudinal",s)}_halfBlur(e,t,n,r,s,a,l){const u=this._renderer,h=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const d=3,p=this._lodMeshes[r];p.material=h;const g=gI.get(h),y=this._sizeLods[n]-1,v=isFinite(s)?Math.PI/(2*y):2*Math.PI/(2*uu-1),S=s/v,b=isFinite(s)?1+Math.floor(d*S):uu;b>uu&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${b} samples when the maximum is set to ${uu}`);const _=[];let E=0;for(let C=0;C<uu;++C){const L=C/S,N=Math.exp(-L*L/2);_.push(N),C===0?E+=N:C<b&&(E+=2*N)}for(let C=0;C<_.length;C++)_[C]=_[C]/E;e.texture.frame=(e.texture.frame||0)+1,g.envMap.value=e.texture,g.samples.value=b,g.weights.array=_,g.latitudinal.value=a==="latitudinal"?1:0,l&&(g.poleAxis.value=l);const{_lodMax:M}=this;g.dTheta.value=v,g.mipInt.value=M-n;const A=this._sizeLods[r],w=3*A*(r>M-Yc?r-M+Yc:0),R=4*(this._cubeSize-A);ny(t,w,R,3*A,2*A),u.setRenderTarget(t),u.render(p,Lb)}}function Ate(i){const e=[],t=[],n=[],r=[];let s=i;const a=i-Yc+1+FD.length;for(let l=0;l<a;l++){const u=Math.pow(2,s);t.push(u);let h=1/u;l>i-Yc?h=FD[l-i+Yc-1]:l===0&&(h=0),n.push(h);const d=1/(u-2),p=-d,g=1+d,y=[p,p,g,p,g,g,p,p,g,g,p,g],v=6,S=6,b=3,_=2,E=1,M=new Float32Array(b*S*v),A=new Float32Array(_*S*v),w=new Float32Array(E*S*v);for(let C=0;C<v;C++){const L=C%3*2/3-1,N=C>2?0:-1,D=[L,N,0,L+2/3,N,0,L+2/3,N+1,0,L,N,0,L+2/3,N+1,0,L,N+1,0],I=Mte[C];M.set(D,b*S*I),A.set(y,_*S*I);const W=[I,I,I,I,I,I];w.set(W,E*S*I)}const R=new ar;R.setAttribute("position",new Wi(M,b)),R.setAttribute("uv",new Wi(A,_)),R.setAttribute("faceIndex",new Wi(w,E)),e.push(R),r.push(new fi(R,null)),s>Yc&&s--}return{lodPlanes:e,sizeLods:t,sigmas:n,lodMeshes:r}}function VD(i,e){const t={magFilter:Ti,minFilter:Ti,generateMipmaps:!1,type:Oi,format:Xn,colorSpace:ca},n=new Nu(i,e,t);return n.texture.mapping=Su,n.texture.name="PMREM.cubeUv",n.texture.isPMREMTexture=!0,n.scissorTest=!0,n}function ny(i,e,t,n,r){i.viewport.set(e,t,n,r),i.scissor.set(e,t,n,r)}function BE(i){const e=new pi;return e.depthTest=!1,e.depthWrite=!1,e.blending=Ur,e.name=`PMREM_${i}`,e}function wte(i,e,t){const n=ia(new Array(uu).fill(0)),r=Et(new V(0,1,0)),s=Et(0),a=Te(uu),l=Et(0),u=Et(1),h=nn(null),d=Et(0),p=Te(1/e),g=Te(1/t),y=Te(i),v={n:a,latitudinal:l,weights:n,poleAxis:r,outputDirection:OE,dTheta:s,samples:u,envMap:h,mipInt:d,CUBEUV_TEXEL_WIDTH:p,CUBEUV_TEXEL_HEIGHT:g,CUBEUV_MAX_MIP:y},S=BE("blur");return S.fragmentNode=bte({...v,latitudinal:l.equal(1)}),gI.set(S,v),S}function GD(i){const e=BE("cubemap");return e.fragmentNode=Np(i,OE),e}function HD(i){const e=BE("equirect");return e.fragmentNode=nn(i,rI(OE),0),e}const WD=new WeakMap;function Rte(i){const e=Math.log2(i)-2,t=1/i;return{texelWidth:1/(3*Math.max(Math.pow(2,e),7*16)),texelHeight:t,maxMip:e}}function Cte(i,e,t){const n=Nte(e);let r=n.get(i);if((r!==void 0?r.pmremVersion:-1)!==i.pmremVersion){const a=i.image;if(i.isCubeTexture)if(Dte(a))r=t.fromCubemap(i,r);else return null;else if(Lte(a))r=t.fromEquirectangular(i,r);else return null;r.pmremVersion=i.pmremVersion,n.set(i,r)}return r.texture}function Nte(i){let e=WD.get(i);return e===void 0&&(e=new WeakMap,WD.set(i,e)),e}class Pte extends mi{static get type(){return"PMREMNode"}constructor(e,t=null,n=null){super("vec3"),this._value=e,this._pmrem=null,this.uvNode=t,this.levelNode=n,this._generator=null;const r=new ei;r.isRenderTargetTexture=!0,this._texture=nn(r),this._width=Et(0),this._height=Et(0),this._maxMip=Et(0),this.updateBeforeType=Ht.RENDER}set value(e){this._value=e,this._pmrem=null}get value(){return this._value}updateFromTexture(e){const t=Rte(e.image.height);this._texture.value=e,this._width.value=t.texelWidth,this._height.value=t.texelHeight,this._maxMip.value=t.maxMip}updateBefore(e){let t=this._pmrem;const n=t?t.pmremVersion:-1,r=this._value;n!==r.pmremVersion&&(r.isPMREMTexture===!0?t=r:t=Cte(r,e.renderer,this._generator),t!==null&&(this._pmrem=t,this.updateFromTexture(t)))}setup(e){this._generator===null&&(this._generator=new Ete(e.renderer)),this.updateBefore(e);let t=this.uvNode;t===null&&e.context.getUV&&(t=e.context.getUV(this)),t=qB.mul(Ee(t.x,t.y.negate(),t.z));let n=this.levelNode;return n===null&&e.context.getTextureLevel&&(n=e.context.getTextureLevel(this)),xte(this._texture,t,n,this._width,this._height,this._maxMip)}dispose(){super.dispose(),this._generator!==null&&this._generator.dispose()}}function Dte(i){if(i==null)return!1;let e=0;const t=6;for(let n=0;n<t;n++)i[n]!==void 0&&e++;return e===t}function Lte(i){return i==null?!1:i.height>0}const yI=Oe(Pte).setParameterLength(1,3),jD=new WeakMap;class Ute extends Zh{static get type(){return"EnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){const{material:t}=e;let n=this.envNode;if(n.isTextureNode||n.isMaterialReferenceNode){const p=n.isTextureNode?n.value:t[n.property];let g=jD.get(p);g===void 0&&(g=yI(p),jD.set(p,g)),n=g}const s=t.useAnisotropy===!0||t.anisotropy>0?dJ:ci,a=n.context(qD(Qa,s)).mul(Tb),l=n.context(Ote(NE)).mul(Math.PI).mul(Tb),u=Dy(a),h=Dy(l);e.context.radiance.addAssign(u),e.context.iblIrradiance.addAssign(h);const d=e.context.lightingModel.clearcoatRadiance;if(d){const p=n.context(qD(rv,Pd)).mul(Tb),g=Dy(p);d.addAssign(g)}}}const qD=(i,e)=>{let t=null;return{getUV:()=>(t===null&&(t=zn.negate().reflect(e),t=i.mul(i).mix(t,e).normalize(),t=t.transformDirection(yo)),t),getTextureLevel:()=>i}},Ote=i=>({getUV:()=>i,getTextureLevel:()=>Te(1)}),Bte=new hO;class vI extends pi{static get type(){return"MeshStandardNodeMaterial"}constructor(e){super(),this.isMeshStandardNodeMaterial=!0,this.lights=!0,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.setDefaultValues(Bte),this.setValues(e)}setupEnvironment(e){let t=super.setupEnvironment(e);return t===null&&e.environmentNode&&(t=e.environmentNode),t?new Ute(t):null}setupLightingModel(){return new mI}setupSpecular(){const e=Dn(Ee(.04),an.rgb,iv);Qr.assign(e),sv.assign(1)}setupVariants(){const e=this.metalnessNode?Te(this.metalnessNode):wJ;iv.assign(e);let t=this.roughnessNode?Te(this.roughnessNode):AJ;t=cI({roughness:t}),Qa.assign(t),this.setupSpecular(),an.assign(Ut(an.rgb.mul(e.oneMinus()),an.a))}copy(e){return this.emissiveNode=e.emissiveNode,this.metalnessNode=e.metalnessNode,this.roughnessNode=e.roughnessNode,super.copy(e)}}const Ite=new F8;class Fte extends vI{static get type(){return"MeshPhysicalNodeMaterial"}constructor(e){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.iorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.dispersionNode=null,this.anisotropyNode=null,this.setDefaultValues(Ite),this.setValues(e)}get useClearcoat(){return this.clearcoat>0||this.clearcoatNode!==null}get useIridescence(){return this.iridescence>0||this.iridescenceNode!==null}get useSheen(){return this.sheen>0||this.sheenNode!==null}get useAnisotropy(){return this.anisotropy>0||this.anisotropyNode!==null}get useTransmission(){return this.transmission>0||this.transmissionNode!==null}get useDispersion(){return this.dispersion>0||this.dispersionNode!==null}setupSpecular(){const e=this.iorNode?Te(this.iorNode):VJ;Ny.assign(e),Qr.assign(Dn(Uh(NB(Ny.sub(1).div(Ny.add(1))).mul(EJ),Ee(1)).mul(vD),an.rgb,iv)),sv.assign(Dn(vD,1,iv))}setupLightingModel(){return new mI(this.useClearcoat,this.useSheen,this.useIridescence,this.useAnisotropy,this.useTransmission,this.useDispersion)}setupVariants(e){if(super.setupVariants(e),this.useClearcoat){const t=this.clearcoatNode?Te(this.clearcoatNode):CJ,n=this.clearcoatRoughnessNode?Te(this.clearcoatRoughnessNode):NJ;oT.assign(t),rv.assign(cI({roughness:n}))}if(this.useSheen){const t=this.sheenNode?Ee(this.sheenNode):LJ,n=this.sheenRoughnessNode?Te(this.sheenRoughnessNode):UJ;Xc.assign(t),yE.assign(n)}if(this.useIridescence){const t=this.iridescenceNode?Te(this.iridescenceNode):BJ,n=this.iridescenceIORNode?Te(this.iridescenceIORNode):IJ,r=this.iridescenceThicknessNode?Te(this.iridescenceThicknessNode):FJ;vE.assign(t),dB.assign(n),pB.assign(r)}if(this.useAnisotropy){const t=(this.anisotropyNode?We(this.anisotropyNode):OJ).toVar();iu.assign(t.length()),ii(iu.equal(0),()=>{t.assign(We(1,0))}).Else(()=>{t.divAssign(We(iu)),iu.assign(iu.saturate())}),lT.assign(iu.pow2().mix(Qa.pow2(),1)),Cy.assign(Dd[0].mul(t.x).add(Dd[1].mul(t.y))),ih.assign(Dd[1].mul(t.x).sub(Dd[0].mul(t.y)))}if(this.useTransmission){const t=this.transmissionNode?Te(this.transmissionNode):kJ,n=this.thicknessNode?Te(this.thicknessNode):zJ,r=this.attenuationDistanceNode?Te(this.attenuationDistanceNode):GJ,s=this.attenuationColorNode?Ee(this.attenuationColorNode):HJ;if(cT.assign(t),mB.assign(n),gB.assign(r),yB.assign(s),this.useDispersion){const a=this.dispersionNode?Te(this.dispersionNode):YJ;vB.assign(a)}}}setupClearcoatNormal(){return this.clearcoatNormalNode?Ee(this.clearcoatNormalNode):PJ}setup(e){e.context.setupClearcoatNormal=()=>this.setupClearcoatNormal(e),super.setup(e)}copy(e){return this.clearcoatNode=e.clearcoatNode,this.clearcoatRoughnessNode=e.clearcoatRoughnessNode,this.clearcoatNormalNode=e.clearcoatNormalNode,this.sheenNode=e.sheenNode,this.sheenRoughnessNode=e.sheenRoughnessNode,this.iridescenceNode=e.iridescenceNode,this.iridescenceIORNode=e.iridescenceIORNode,this.iridescenceThicknessNode=e.iridescenceThicknessNode,this.specularIntensityNode=e.specularIntensityNode,this.specularColorNode=e.specularColorNode,this.transmissionNode=e.transmissionNode,this.thicknessNode=e.thicknessNode,this.attenuationDistanceNode=e.attenuationDistanceNode,this.attenuationColorNode=e.attenuationColorNode,this.dispersionNode=e.dispersionNode,this.anisotropyNode=e.anisotropyNode,super.copy(e)}}const kte=Ue(({normal:i,lightDirection:e,builder:t})=>{const n=i.dot(e),r=We(n.mul(.5).add(.5),0);if(t.material.gradientMap){const s=tl("gradientMap","texture").context({getUV:()=>r});return Ee(s.r)}else{const s=r.fwidth().mul(.5);return Dn(Ee(.7),Ee(1),pl(Te(.7).sub(s.x),Te(.7).add(s.x),r.x))}});class zte extends Wv{direct({lightDirection:e,lightColor:t,reflectedLight:n},r){const s=kte({normal:WB,lightDirection:e,builder:r}).mul(t);n.directDiffuse.addAssign(s.mul(Bh({diffuseColor:an.rgb})))}indirect(e){const{ambientOcclusion:t,irradiance:n,reflectedLight:r}=e.context;r.indirectDiffuse.addAssign(n.mul(Bh({diffuseColor:an}))),r.indirectDiffuse.mulAssign(t)}}const Vte=new z8;class Gte extends pi{static get type(){return"MeshToonNodeMaterial"}constructor(e){super(),this.isMeshToonNodeMaterial=!0,this.lights=!0,this.setDefaultValues(Vte),this.setValues(e)}setupLightingModel(){return new zte}}class Hte extends mi{static get type(){return"MatcapUVNode"}constructor(){super("vec2")}setup(){const e=Ee(zn.z,0,zn.x.negate()).normalize(),t=zn.cross(e);return We(e.dot(ci),t.dot(ci)).mul(.495).add(.5)}}const Wte=Ge(Hte),jte=new W8;class qte extends pi{static get type(){return"MeshMatcapNodeMaterial"}constructor(e){super(),this.isMeshMatcapNodeMaterial=!0,this.setDefaultValues(jte),this.setValues(e)}setupVariants(e){const t=Wte;let n;e.material.matcap?n=tl("matcap","texture").context({getUV:()=>t}):n=Ee(Dn(.2,.8,t.y)),an.rgb.mulAssign(n.rgb)}}class $te extends mi{static get type(){return"RotateNode"}constructor(e,t){super(),this.positionNode=e,this.rotationNode=t}getNodeType(e){return this.positionNode.getNodeType(e)}setup(e){const{rotationNode:t,positionNode:n}=this;if(this.getNodeType(e)==="vec2"){const s=t.cos(),a=t.sin();return gE(s,a,a.negate(),s).mul(n)}else{const s=t,a=nh(Ut(1,0,0,0),Ut(0,el(s.x),Is(s.x).negate(),0),Ut(0,Is(s.x),el(s.x),0),Ut(0,0,0,1)),l=nh(Ut(el(s.y),0,Is(s.y),0),Ut(0,1,0,0),Ut(Is(s.y).negate(),0,el(s.y),0),Ut(0,0,0,1)),u=nh(Ut(el(s.z),Is(s.z).negate(),0,0),Ut(Is(s.z),el(s.z),0,0),Ut(0,0,1,0),Ut(0,0,0,1));return a.mul(l).mul(u).mul(Ut(n,1)).xyz}}}const _I=Oe($te).setParameterLength(2),Xte=new YM;class xI extends pi{static get type(){return"SpriteNodeMaterial"}constructor(e){super(),this.isSpriteNodeMaterial=!0,this._useSizeAttenuation=!0,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.transparent=!0,this.setDefaultValues(Xte),this.setValues(e)}setupPositionView(e){const{object:t,camera:n}=e,r=this.sizeAttenuation,{positionNode:s,rotationNode:a,scaleNode:l}=this,u=zv.mul(Ee(s||0));let h=We(wu[0].xyz.length(),wu[1].xyz.length());if(l!==null&&(h=h.mul(We(l))),r===!1)if(n.isPerspectiveCamera)h=h.mul(u.z.negate());else{const y=Te(2).div(RE.element(1).element(1));h=h.mul(y.mul(2))}let d=Vv.xy;if(t.center&&t.center.isVector2===!0){const y=_Q("center","vec2",t);d=d.sub(y.sub(.5))}d=d.mul(h);const p=Te(a||DJ),g=_I(d,p);return Ut(u.xy.add(g),u.zw)}copy(e){return this.positionNode=e.positionNode,this.rotationNode=e.rotationNode,this.scaleNode=e.scaleNode,super.copy(e)}get sizeAttenuation(){return this._useSizeAttenuation}set sizeAttenuation(e){this._useSizeAttenuation!==e&&(this._useSizeAttenuation=e,this.needsUpdate=!0)}}const Yte=new _8;class Kte extends xI{static get type(){return"PointsNodeMaterial"}constructor(e){super(),this.sizeNode=null,this.isPointsNodeMaterial=!0,this.setDefaultValues(Yte),this.setValues(e)}setupPositionView(){const{positionNode:e}=this;return zv.mul(Ee(e||tr)).xyz}setupVertex(e){const t=super.setupVertex(e);if(e.material.isNodeMaterial!==!0)return t;const{rotationNode:n,scaleNode:r,sizeNode:s}=this,a=Vv.xy.toVar(),l=$d.z.div($d.w);if(n&&n.isNode){const h=Te(n);a.assign(_I(a,h))}let u=s!==null?We(s):XJ;return this.sizeAttenuation===!0&&(u=u.mul(u.div(hi.z.negate()))),r&&r.isNode&&(u=u.mul(We(r))),a.mulAssign(u.mul(2)),a.assign(a.div($d.z)),a.y.assign(a.y.mul(l)),a.assign(a.mul(t.w)),t.addAssign(Ut(a,0,0)),t}get alphaToCoverage(){return this._useAlphaToCoverage}set alphaToCoverage(e){this._useAlphaToCoverage!==e&&(this._useAlphaToCoverage=e,this.needsUpdate=!0)}}class Zte extends Wv{constructor(){super(),this.shadowNode=Te(1).toVar("shadowMask")}direct({lightNode:e}){e.shadowNode!==null&&this.shadowNode.mulAssign(e.shadowNode)}finish({context:e}){an.a.mulAssign(this.shadowNode.oneMinus()),e.outgoingLight.rgb.assign(an.rgb)}}const Qte=new I8;class Jte extends pi{static get type(){return"ShadowNodeMaterial"}constructor(e){super(),this.isShadowNodeMaterial=!0,this.lights=!0,this.transparent=!0,this.setDefaultValues(Qte),this.setValues(e)}setupLightingModel(){return new Zte}}Zp("vec3");Zp("vec3");Zp("vec3");class ene{constructor(e,t){this.nodes=e,this.info=t,this._context=typeof self<"u"?self:null,this._animationLoop=null,this._requestId=null}start(){const e=(t,n)=>{this._requestId=this._context.requestAnimationFrame(e),this.info.autoReset===!0&&this.info.reset(),this.nodes.nodeFrame.update(),this.info.frame=this.nodes.nodeFrame.frameId,this._animationLoop!==null&&this._animationLoop(t,n)};e()}stop(){this._context.cancelAnimationFrame(this._requestId),this._requestId=null}getAnimationLoop(){return this._animationLoop}setAnimationLoop(e){this._animationLoop=e}getContext(){return this._context}setContext(e){this._context=e}dispose(){this.stop()}}class Gs{constructor(){this.weakMap=new WeakMap}get(e){let t=this.weakMap;for(let n=0;n<e.length-1;n++)if(t=t.get(e[n]),t===void 0)return;return t.get(e[e.length-1])}set(e,t){let n=this.weakMap;for(let r=0;r<e.length-1;r++){const s=e[r];n.has(s)===!1&&n.set(s,new WeakMap),n=n.get(s)}return n.set(e[e.length-1],t),this}delete(e){let t=this.weakMap;for(let n=0;n<e.length-1;n++)if(t=t.get(e[n]),t===void 0)return!1;return t.delete(e[e.length-1])}}let tne=0;function nne(i){const e=Object.keys(i);let t=Object.getPrototypeOf(i);for(;t;){const n=Object.getOwnPropertyDescriptors(t);for(const r in n)if(n[r]!==void 0){const s=n[r];s&&typeof s.get=="function"&&e.push(r)}t=Object.getPrototypeOf(t)}return e}class ine{constructor(e,t,n,r,s,a,l,u,h,d){this.id=tne++,this._nodes=e,this._geometries=t,this.renderer=n,this.object=r,this.material=s,this.scene=a,this.camera=l,this.lightsNode=u,this.context=h,this.geometry=r.geometry,this.version=s.version,this.drawRange=null,this.attributes=null,this.pipeline=null,this.group=null,this.vertexBuffers=null,this.drawParams=null,this.bundle=null,this.clippingContext=d,this.clippingContextCacheKey=d!==null?d.cacheKey:"",this.initialNodesCacheKey=this.getDynamicCacheKey(),this.initialCacheKey=this.getCacheKey(),this._nodeBuilderState=null,this._bindings=null,this._monitor=null,this.onDispose=null,this.isRenderObject=!0,this.onMaterialDispose=()=>{this.dispose()},this.material.addEventListener("dispose",this.onMaterialDispose)}updateClipping(e){this.clippingContext=e}get clippingNeedsUpdate(){return this.clippingContext===null||this.clippingContext.cacheKey===this.clippingContextCacheKey?!1:(this.clippingContextCacheKey=this.clippingContext.cacheKey,!0)}get hardwareClippingPlanes(){return this.material.hardwareClipping===!0?this.clippingContext.unionClippingCount:0}getNodeBuilderState(){return this._nodeBuilderState||(this._nodeBuilderState=this._nodes.getForRender(this))}getMonitor(){return this._monitor||(this._monitor=this.getNodeBuilderState().observer)}getBindings(){return this._bindings||(this._bindings=this.getNodeBuilderState().createBindings())}getBindingGroup(e){for(const t of this.getBindings())if(t.name===e)return t}getIndex(){return this._geometries.getIndex(this)}getIndirect(){return this._geometries.getIndirect(this)}getChainArray(){return[this.object,this.material,this.context,this.lightsNode]}setGeometry(e){this.geometry=e,this.attributes=null}getAttributes(){if(this.attributes!==null)return this.attributes;const e=this.getNodeBuilderState().nodeAttributes,t=this.geometry,n=[],r=new Set;for(const s of e){const a=s.node&&s.node.attribute?s.node.attribute:t.getAttribute(s.name);if(a===void 0)continue;n.push(a);const l=a.isInterleavedBufferAttribute?a.data:a;r.add(l)}return this.attributes=n,this.vertexBuffers=Array.from(r.values()),n}getVertexBuffers(){return this.vertexBuffers===null&&this.getAttributes(),this.vertexBuffers}getDrawParameters(){const{object:e,material:t,geometry:n,group:r,drawRange:s}=this,a=this.drawParams||(this.drawParams={vertexCount:0,firstVertex:0,instanceCount:0,firstInstance:0}),l=this.getIndex(),u=l!==null;let h=1;if(n.isInstancedBufferGeometry===!0?h=n.instanceCount:e.count!==void 0&&(h=Math.max(0,e.count)),h===0)return null;if(a.instanceCount=h,e.isBatchedMesh===!0)return a;let d=1;t.wireframe===!0&&!e.isPoints&&!e.isLineSegments&&!e.isLine&&!e.isLineLoop&&(d=2);let p=s.start*d,g=(s.start+s.count)*d;r!==null&&(p=Math.max(p,r.start*d),g=Math.min(g,(r.start+r.count)*d));const y=n.attributes.position;let v=1/0;u?v=l.count:y!=null&&(v=y.count),p=Math.max(p,0),g=Math.min(g,v);const S=g-p;return S<0||S===1/0?null:(a.vertexCount=S,a.firstVertex=p,a)}getGeometryCacheKey(){const{geometry:e}=this;let t="";for(const n of Object.keys(e.attributes).sort()){const r=e.attributes[n];t+=n+",",r.data&&(t+=r.data.stride+","),r.offset&&(t+=r.offset+","),r.itemSize&&(t+=r.itemSize+","),r.normalized&&(t+="n,")}for(const n of Object.keys(e.morphAttributes).sort()){const r=e.morphAttributes[n];t+="morph-"+n+",";for(let s=0,a=r.length;s<a;s++){const l=r[s];t+=l.id+","}}return e.index&&(t+="index,"),t}getMaterialCacheKey(){const{object:e,material:t}=this;let n=t.customProgramCacheKey();for(const r of nne(t)){if(/^(is[A-Z]|_)|^(visible|version|uuid|name|opacity|userData)$/.test(r))continue;const s=t[r];let a;if(s!==null){const l=typeof s;l==="number"?a=s!==0?"1":"0":l==="object"?(a="{",s.isTexture&&(a+=s.mapping),a+="}"):a=String(s)}else a=String(s);n+=a+","}return n+=this.clippingContextCacheKey+",",e.geometry&&(n+=this.getGeometryCacheKey()),e.skeleton&&(n+=e.skeleton.bones.length+","),e.isBatchedMesh&&(n+=e._matricesTexture.uuid+",",e._colorsTexture!==null&&(n+=e._colorsTexture.uuid+",")),e.count>1&&(n+=e.uuid+","),n+=e.receiveShadow+",",vK(n)}get needsGeometryUpdate(){return this.geometry.id!==this.object.geometry.id}get needsUpdate(){return this.initialNodesCacheKey!==this.getDynamicCacheKey()||this.clippingNeedsUpdate}getDynamicCacheKey(){let e=0;return this.material.isShadowPassMaterial!==!0&&(e=this._nodes.getCacheKey(this.scene,this.lightsNode)),this.camera.isArrayCamera&&(e=Qy(e,this.camera.cameras.length)),this.object.receiveShadow&&(e=Qy(e,1)),e}getCacheKey(){return this.getMaterialCacheKey()+this.getDynamicCacheKey()}dispose(){this.material.removeEventListener("dispose",this.onMaterialDispose),this.onDispose()}}const Yl=[];class rne{constructor(e,t,n,r,s,a){this.renderer=e,this.nodes=t,this.geometries=n,this.pipelines=r,this.bindings=s,this.info=a,this.chainMaps={}}get(e,t,n,r,s,a,l,u){const h=this.getChainMap(u);Yl[0]=e,Yl[1]=t,Yl[2]=a,Yl[3]=s;let d=h.get(Yl);return d===void 0?(d=this.createRenderObject(this.nodes,this.geometries,this.renderer,e,t,n,r,s,a,l,u),h.set(Yl,d)):(d.updateClipping(l),d.needsGeometryUpdate&&d.setGeometry(e.geometry),(d.version!==t.version||d.needsUpdate)&&(d.initialCacheKey!==d.getCacheKey()?(d.dispose(),d=this.get(e,t,n,r,s,a,l,u)):d.version=t.version)),Yl.length=0,d}getChainMap(e="default"){return this.chainMaps[e]||(this.chainMaps[e]=new Gs)}dispose(){this.chainMaps={}}createRenderObject(e,t,n,r,s,a,l,u,h,d,p){const g=this.getChainMap(p),y=new ine(e,t,n,r,s,a,l,u,h,d);return y.onDispose=()=>{this.pipelines.delete(y),this.bindings.delete(y),this.nodes.delete(y),g.delete(y.getChainArray())},y}}class _l{constructor(){this.data=new WeakMap}get(e){let t=this.data.get(e);return t===void 0&&(t={},this.data.set(e,t)),t}delete(e){let t=null;return this.data.has(e)&&(t=this.data.get(e),this.data.delete(e)),t}has(e){return this.data.has(e)}dispose(){this.data=new WeakMap}}const _s={VERTEX:1,INDEX:2,STORAGE:3,INDIRECT:4},nl=16,sne=211,ane=212;class one extends _l{constructor(e){super(),this.backend=e}delete(e){const t=super.delete(e);return t!==null&&this.backend.destroyAttribute(e),t}update(e,t){const n=this.get(e);if(n.version===void 0)t===_s.VERTEX?this.backend.createAttribute(e):t===_s.INDEX?this.backend.createIndexAttribute(e):t===_s.STORAGE?this.backend.createStorageAttribute(e):t===_s.INDIRECT&&this.backend.createIndirectStorageAttribute(e),n.version=this._getBufferAttribute(e).version;else{const r=this._getBufferAttribute(e);(n.version<r.version||r.usage===Wc)&&(this.backend.updateAttribute(e),n.version=r.version)}}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}function bI(i){return i.index!==null?i.index.version:i.attributes.position.version}function $D(i){const e=[],t=i.index,n=i.attributes.position;if(t!==null){const s=t.array;for(let a=0,l=s.length;a<l;a+=3){const u=s[a+0],h=s[a+1],d=s[a+2];e.push(u,h,h,d,d,u)}}else{const s=n.array;for(let a=0,l=s.length/3-1;a<l;a+=3){const u=a+0,h=a+1,d=a+2;e.push(u,h,h,d,d,u)}}const r=new(VM(e)?qM:jM)(e,1);return r.version=bI(i),r}class lne extends _l{constructor(e,t){super(),this.attributes=e,this.info=t,this.wireframes=new WeakMap,this.attributeCall=new WeakMap}has(e){const t=e.geometry;return super.has(t)&&this.get(t).initialized===!0}updateForRender(e){this.has(e)===!1&&this.initGeometry(e),this.updateAttributes(e)}initGeometry(e){const t=e.geometry,n=this.get(t);n.initialized=!0,this.info.memory.geometries++;const r=()=>{this.info.memory.geometries--;const s=t.index,a=e.getAttributes();s!==null&&this.attributes.delete(s);for(const u of a)this.attributes.delete(u);const l=this.wireframes.get(t);l!==void 0&&this.attributes.delete(l),t.removeEventListener("dispose",r)};t.addEventListener("dispose",r)}updateAttributes(e){const t=e.getAttributes();for(const s of t)s.isStorageBufferAttribute||s.isStorageInstancedBufferAttribute?this.updateAttribute(s,_s.STORAGE):this.updateAttribute(s,_s.VERTEX);const n=this.getIndex(e);n!==null&&this.updateAttribute(n,_s.INDEX);const r=e.geometry.indirect;r!==null&&this.updateAttribute(r,_s.INDIRECT)}updateAttribute(e,t){const n=this.info.render.calls;e.isInterleavedBufferAttribute?this.attributeCall.get(e)===void 0?(this.attributes.update(e,t),this.attributeCall.set(e,n)):this.attributeCall.get(e.data)!==n&&(this.attributes.update(e,t),this.attributeCall.set(e.data,n),this.attributeCall.set(e,n)):this.attributeCall.get(e)!==n&&(this.attributes.update(e,t),this.attributeCall.set(e,n))}getIndirect(e){return e.geometry.indirect}getIndex(e){const{geometry:t,material:n}=e;let r=t.index;if(n.wireframe===!0){const s=this.wireframes;let a=s.get(t);a===void 0?(a=$D(t),s.set(t,a)):a.version!==bI(t)&&(this.attributes.delete(a),a=$D(t),s.set(t,a)),r=a}return r}}class une{constructor(){this.autoReset=!0,this.frame=0,this.calls=0,this.render={calls:0,frameCalls:0,drawCalls:0,triangles:0,points:0,lines:0,timestamp:0},this.compute={calls:0,frameCalls:0,timestamp:0},this.memory={geometries:0,textures:0}}update(e,t,n){this.render.drawCalls++,e.isMesh||e.isSprite?this.render.triangles+=n*(t/3):e.isPoints?this.render.points+=n*t:e.isLineSegments?this.render.lines+=n*(t/2):e.isLine?this.render.lines+=n*(t-1):console.error("THREE.WebGPUInfo: Unknown object type.")}reset(){this.render.drawCalls=0,this.render.frameCalls=0,this.compute.frameCalls=0,this.render.triangles=0,this.render.points=0,this.render.lines=0}dispose(){this.reset(),this.calls=0,this.render.calls=0,this.compute.calls=0,this.render.timestamp=0,this.compute.timestamp=0,this.memory.geometries=0,this.memory.textures=0}}class SI{constructor(e){this.cacheKey=e,this.usedTimes=0}}class cne extends SI{constructor(e,t,n){super(e),this.vertexProgram=t,this.fragmentProgram=n}}class hne extends SI{constructor(e,t){super(e),this.computeProgram=t,this.isComputePipeline=!0}}let fne=0;class Fb{constructor(e,t,n,r=null,s=null){this.id=fne++,this.code=e,this.stage=t,this.name=n,this.transforms=r,this.attributes=s,this.usedTimes=0}}class dne extends _l{constructor(e,t){super(),this.backend=e,this.nodes=t,this.bindings=null,this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}getForCompute(e,t){const{backend:n}=this,r=this.get(e);if(this._needsComputeUpdate(e)){const s=r.pipeline;s&&(s.usedTimes--,s.computeProgram.usedTimes--);const a=this.nodes.getForCompute(e);let l=this.programs.compute.get(a.computeShader);l===void 0&&(s&&s.computeProgram.usedTimes===0&&this._releaseProgram(s.computeProgram),l=new Fb(a.computeShader,"compute",e.name,a.transforms,a.nodeAttributes),this.programs.compute.set(a.computeShader,l),n.createProgram(l));const u=this._getComputeCacheKey(e,l);let h=this.caches.get(u);h===void 0&&(s&&s.usedTimes===0&&this._releasePipeline(s),h=this._getComputePipeline(e,l,u,t)),h.usedTimes++,l.usedTimes++,r.version=e.version,r.pipeline=h}return r.pipeline}getForRender(e,t=null){const{backend:n}=this,r=this.get(e);if(this._needsRenderUpdate(e)){const s=r.pipeline;s&&(s.usedTimes--,s.vertexProgram.usedTimes--,s.fragmentProgram.usedTimes--);const a=e.getNodeBuilderState(),l=e.material?e.material.name:"";let u=this.programs.vertex.get(a.vertexShader);u===void 0&&(s&&s.vertexProgram.usedTimes===0&&this._releaseProgram(s.vertexProgram),u=new Fb(a.vertexShader,"vertex",l),this.programs.vertex.set(a.vertexShader,u),n.createProgram(u));let h=this.programs.fragment.get(a.fragmentShader);h===void 0&&(s&&s.fragmentProgram.usedTimes===0&&this._releaseProgram(s.fragmentProgram),h=new Fb(a.fragmentShader,"fragment",l),this.programs.fragment.set(a.fragmentShader,h),n.createProgram(h));const d=this._getRenderCacheKey(e,u,h);let p=this.caches.get(d);p===void 0?(s&&s.usedTimes===0&&this._releasePipeline(s),p=this._getRenderPipeline(e,u,h,d,t)):e.pipeline=p,p.usedTimes++,u.usedTimes++,h.usedTimes++,r.pipeline=p}return r.pipeline}delete(e){const t=this.get(e).pipeline;return t&&(t.usedTimes--,t.usedTimes===0&&this._releasePipeline(t),t.isComputePipeline?(t.computeProgram.usedTimes--,t.computeProgram.usedTimes===0&&this._releaseProgram(t.computeProgram)):(t.fragmentProgram.usedTimes--,t.vertexProgram.usedTimes--,t.vertexProgram.usedTimes===0&&this._releaseProgram(t.vertexProgram),t.fragmentProgram.usedTimes===0&&this._releaseProgram(t.fragmentProgram))),super.delete(e)}dispose(){super.dispose(),this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}updateForRender(e){this.getForRender(e)}_getComputePipeline(e,t,n,r){n=n||this._getComputeCacheKey(e,t);let s=this.caches.get(n);return s===void 0&&(s=new hne(n,t),this.caches.set(n,s),this.backend.createComputePipeline(s,r)),s}_getRenderPipeline(e,t,n,r,s){r=r||this._getRenderCacheKey(e,t,n);let a=this.caches.get(r);return a===void 0&&(a=new cne(r,t,n),this.caches.set(r,a),e.pipeline=a,this.backend.createRenderPipeline(e,s)),a}_getComputeCacheKey(e,t){return e.id+","+t.id}_getRenderCacheKey(e,t,n){return t.id+","+n.id+","+this.backend.getRenderCacheKey(e)}_releasePipeline(e){this.caches.delete(e.cacheKey)}_releaseProgram(e){const t=e.code,n=e.stage;this.programs[n].delete(t)}_needsComputeUpdate(e){const t=this.get(e);return t.pipeline===void 0||t.version!==e.version}_needsRenderUpdate(e){return this.get(e).pipeline===void 0||this.backend.needsRenderUpdate(e)}}class pne extends _l{constructor(e,t,n,r,s,a){super(),this.backend=e,this.textures=n,this.pipelines=s,this.attributes=r,this.nodes=t,this.info=a,this.pipelines.bindings=this}getForRender(e){const t=e.getBindings();for(const n of t){const r=this.get(n);r.bindGroup===void 0&&(this._init(n),this.backend.createBindings(n,t,0),r.bindGroup=n)}return t}getForCompute(e){const t=this.nodes.getForCompute(e).bindings;for(const n of t){const r=this.get(n);r.bindGroup===void 0&&(this._init(n),this.backend.createBindings(n,t,0),r.bindGroup=n)}return t}updateForCompute(e){this._updateBindings(this.getForCompute(e))}updateForRender(e){this._updateBindings(this.getForRender(e))}_updateBindings(e){for(const t of e)this._update(t,e)}_init(e){for(const t of e.bindings)if(t.isSampledTexture)this.textures.updateTexture(t.texture);else if(t.isStorageBuffer){const n=t.attribute,r=n.isIndirectStorageBufferAttribute?_s.INDIRECT:_s.STORAGE;this.attributes.update(n,r)}}_update(e,t){const{backend:n}=this;let r=!1,s=!0,a=0,l=0;for(const u of e.bindings)if(!(u.isNodeUniformsGroup&&this.nodes.updateGroup(u)===!1)){if(u.isStorageBuffer){const h=u.attribute,d=h.isIndirectStorageBufferAttribute?_s.INDIRECT:_s.STORAGE;this.attributes.update(h,d)}if(u.isUniformBuffer)u.update()&&n.updateBinding(u);else if(u.isSampler)u.update();else if(u.isSampledTexture){const h=this.textures.get(u.texture);u.needsBindingsUpdate(h.generation)&&(r=!0);const d=u.update(),p=u.texture;d&&this.textures.updateTexture(p);const g=n.get(p);if(g.externalTexture!==void 0||h.isDefaultTexture?s=!1:(a=a*10+p.id,l+=p.version),n.isWebGPUBackend===!0&&g.texture===void 0&&g.externalTexture===void 0&&(console.error("Bindings._update: binding should be available:",u,d,p,u.textureNode.value,r),this.textures.updateTexture(p),r=!0),p.isStorageTexture===!0){const y=this.get(p);u.store===!0?y.needsMipmap=!0:this.textures.needsMipmaps(p)&&y.needsMipmap===!0&&(this.backend.generateMipmaps(p),y.needsMipmap=!1)}}}r===!0&&this.backend.updateBindings(e,t,s?a:0,l)}}function mne(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.z!==e.z?i.z-e.z:i.id-e.id}function XD(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.z!==e.z?e.z-i.z:i.id-e.id}function YD(i){return(i.transmission>0||i.transmissionNode)&&i.side===dr&&i.forceSinglePass===!1}class gne{constructor(e,t,n){this.renderItems=[],this.renderItemsIndex=0,this.opaque=[],this.transparentDoublePass=[],this.transparent=[],this.bundles=[],this.lightsNode=e.getNode(t,n),this.lightsArray=[],this.scene=t,this.camera=n,this.occlusionQueryCount=0}begin(){return this.renderItemsIndex=0,this.opaque.length=0,this.transparentDoublePass.length=0,this.transparent.length=0,this.bundles.length=0,this.lightsArray.length=0,this.occlusionQueryCount=0,this}getNextRenderItem(e,t,n,r,s,a,l){let u=this.renderItems[this.renderItemsIndex];return u===void 0?(u={id:e.id,object:e,geometry:t,material:n,groupOrder:r,renderOrder:e.renderOrder,z:s,group:a,clippingContext:l},this.renderItems[this.renderItemsIndex]=u):(u.id=e.id,u.object=e,u.geometry=t,u.material=n,u.groupOrder=r,u.renderOrder=e.renderOrder,u.z=s,u.group=a,u.clippingContext=l),this.renderItemsIndex++,u}push(e,t,n,r,s,a,l){const u=this.getNextRenderItem(e,t,n,r,s,a,l);e.occlusionTest===!0&&this.occlusionQueryCount++,n.transparent===!0||n.transmission>0?(YD(n)&&this.transparentDoublePass.push(u),this.transparent.push(u)):this.opaque.push(u)}unshift(e,t,n,r,s,a,l){const u=this.getNextRenderItem(e,t,n,r,s,a,l);n.transparent===!0||n.transmission>0?(YD(n)&&this.transparentDoublePass.unshift(u),this.transparent.unshift(u)):this.opaque.unshift(u)}pushBundle(e){this.bundles.push(e)}pushLight(e){this.lightsArray.push(e)}sort(e,t){this.opaque.length>1&&this.opaque.sort(e||mne),this.transparentDoublePass.length>1&&this.transparentDoublePass.sort(t||XD),this.transparent.length>1&&this.transparent.sort(t||XD)}finish(){this.lightsNode.setLights(this.lightsArray);for(let e=this.renderItemsIndex,t=this.renderItems.length;e<t;e++){const n=this.renderItems[e];if(n.id===null)break;n.id=null,n.object=null,n.geometry=null,n.material=null,n.groupOrder=null,n.renderOrder=null,n.z=null,n.group=null,n.clippingContext=null}}}const md=[];class yne{constructor(e){this.lighting=e,this.lists=new Gs}get(e,t){const n=this.lists;md[0]=e,md[1]=t;let r=n.get(md);return r===void 0&&(r=new gne(this.lighting,e,t),n.set(md,r)),md.length=0,r}dispose(){this.lists=new Gs}}let vne=0;class _ne{constructor(){this.id=vne++,this.color=!0,this.clearColor=!0,this.clearColorValue={r:0,g:0,b:0,a:1},this.depth=!0,this.clearDepth=!0,this.clearDepthValue=1,this.stencil=!1,this.clearStencil=!0,this.clearStencilValue=1,this.viewport=!1,this.viewportValue=new bt,this.scissor=!1,this.scissorValue=new bt,this.renderTarget=null,this.textures=null,this.depthTexture=null,this.activeCubeFace=0,this.activeMipmapLevel=0,this.sampleCount=1,this.width=0,this.height=0,this.occlusionQueryCount=0,this.clippingContext=null,this.isRenderContext=!0}getCacheKey(){return TI(this)}}function TI(i){const{textures:e,activeCubeFace:t}=i,n=[t];for(const r of e)n.push(r.id);return cE(n)}const gd=[],xne=new Ev,bne=new $M;class Sne{constructor(){this.chainMaps={}}get(e,t,n=null){gd[0]=e,gd[1]=t;let r;if(n===null)r="default";else{const l=n.texture.format;r=`${n.textures.length}:${l}:${n.samples}:${n.depthBuffer}:${n.stencilBuffer}`}const s=this._getChainMap(r);let a=s.get(gd);return a===void 0&&(a=new _ne,s.set(gd,a)),gd.length=0,n!==null&&(a.sampleCount=n.samples===0?1:n.samples),a}getForClear(e=null){return this.get(xne,bne,e)}_getChainMap(e){return this.chainMaps[e]||(this.chainMaps[e]=new Gs)}dispose(){this.chainMaps={}}}const Tne=new V;class Mne extends _l{constructor(e,t,n){super(),this.renderer=e,this.backend=t,this.info=n}updateRenderTarget(e,t=0){const n=this.get(e),r=e.samples===0?1:e.samples,s=n.depthTextureMips||(n.depthTextureMips={}),a=e.textures,l=this.getSize(a[0]),u=l.width>>t,h=l.height>>t;let d=e.depthTexture||s[t];const p=e.depthBuffer===!0||e.stencilBuffer===!0;let g=!1;d===void 0&&p&&(d=new bs,d.format=e.stencilBuffer?is:ns,d.type=e.stencilBuffer?ts:En,d.image.width=u,d.image.height=h,d.image.depth=l.depth,d.isArrayTexture=e.multiview===!0&&l.depth>1,s[t]=d),(n.width!==l.width||l.height!==n.height)&&(g=!0,d&&(d.needsUpdate=!0,d.image.width=u,d.image.height=h,d.image.depth=d.isArrayTexture?d.image.depth:1)),n.width=l.width,n.height=l.height,n.textures=a,n.depthTexture=d||null,n.depth=e.depthBuffer,n.stencil=e.stencilBuffer,n.renderTarget=e,n.sampleCount!==r&&(g=!0,d&&(d.needsUpdate=!0),n.sampleCount=r);const y={sampleCount:r};if(e.isXRRenderTarget!==!0){for(let v=0;v<a.length;v++){const S=a[v];g&&(S.needsUpdate=!0),this.updateTexture(S,y)}d&&this.updateTexture(d,y)}if(n.initialized!==!0){n.initialized=!0;const v=()=>{e.removeEventListener("dispose",v);for(let S=0;S<a.length;S++)this._destroyTexture(a[S]);d&&this._destroyTexture(d),this.delete(e)};e.addEventListener("dispose",v)}}updateTexture(e,t={}){const n=this.get(e);if(n.initialized===!0&&n.version===e.version)return;const r=e.isRenderTargetTexture||e.isDepthTexture||e.isFramebufferTexture,s=this.backend;if(r&&n.initialized===!0&&(s.destroySampler(e),s.destroyTexture(e)),e.isFramebufferTexture){const h=this.renderer.getRenderTarget();h?e.type=h.texture.type:e.type=Gn}const{width:a,height:l,depth:u}=this.getSize(e);if(t.width=a,t.height=l,t.depth=u,t.needsMipmaps=this.needsMipmaps(e),t.levels=t.needsMipmaps?this.getMipLevels(e,a,l):1,r||e.isStorageTexture===!0)s.createSampler(e),s.createTexture(e,t),n.generation=e.version;else if(n.initialized!==!0&&s.createSampler(e),e.version>0){const d=e.image;if(d===void 0)console.warn("THREE.Renderer: Texture marked for update but image is undefined.");else if(d.complete===!1)console.warn("THREE.Renderer: Texture marked for update but image is incomplete.");else{if(e.images){const p=[];for(const g of e.images)p.push(g);t.images=p}else t.image=d;(n.isDefaultTexture===void 0||n.isDefaultTexture===!0)&&(s.createTexture(e,t),n.isDefaultTexture=!1,n.generation=e.version),e.source.dataReady===!0&&s.updateTexture(e,t),t.needsMipmaps&&e.mipmaps.length===0&&s.generateMipmaps(e)}}else s.createDefaultTexture(e),n.isDefaultTexture=!0,n.generation=e.version;if(n.initialized!==!0){n.initialized=!0,n.generation=e.version,this.info.memory.textures++;const h=()=>{e.removeEventListener("dispose",h),this._destroyTexture(e)};e.addEventListener("dispose",h)}n.version=e.version}getSize(e,t=Tne){let n=e.images?e.images[0]:e.image;return n?(n.image!==void 0&&(n=n.image),t.width=n.width||1,t.height=n.height||1,t.depth=e.isCubeTexture?6:n.depth||1):t.width=t.height=t.depth=1,t}getMipLevels(e,t,n){let r;return e.isCompressedTexture?e.mipmaps?r=e.mipmaps.length:r=1:r=Math.floor(Math.log2(Math.max(t,n)))+1,r}needsMipmaps(e){return e.isCompressedTexture===!0||e.generateMipmaps}_destroyTexture(e){this.has(e)===!0&&(this.backend.destroySampler(e),this.backend.destroyTexture(e),this.delete(e),this.info.memory.textures--)}}class IE extends ot{constructor(e,t,n,r=1){super(e,t,n),this.a=r}set(e,t,n,r=1){return this.a=r,super.set(e,t,n)}copy(e){return e.a!==void 0&&(this.a=e.a),super.copy(e)}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}}class Ene extends hn{static get type(){return"ParameterNode"}constructor(e,t=null){super(e,t),this.isParameterNode=!0}getHash(){return this.uuid}generate(){return this.name}}class Ane extends Ot{static get type(){return"StackNode"}constructor(e=null){super(),this.nodes=[],this.outputNode=null,this.parent=e,this._currentCond=null,this._expressionNode=null,this.isStackNode=!0}getNodeType(e){return this.outputNode?this.outputNode.getNodeType(e):"void"}getMemberType(e,t){return this.outputNode?this.outputNode.getMemberType(e,t):"void"}add(e){return this.nodes.push(e),this}If(e,t){const n=new Nd(t);return this._currentCond=ir(e,n),this.add(this._currentCond)}ElseIf(e,t){const n=new Nd(t),r=ir(e,n);return this._currentCond.elseNode=r,this._currentCond=r,this}Else(e){return this._currentCond.elseNode=new Nd(e),this}Switch(e){return this._expressionNode=Ie(e),this}Case(...e){const t=[];if(e.length>=2)for(let l=0;l<e.length-1;l++)t.push(this._expressionNode.equal(Ie(e[l])));else throw new Error("TSL: Invalid parameter length. Case() requires at least two parameters.");const n=e[e.length-1],r=new Nd(n);let s=t[0];for(let l=1;l<t.length;l++)s=s.or(t[l]);const a=ir(s,r);return this._currentCond===null?(this._currentCond=a,this.add(this._currentCond)):(this._currentCond.elseNode=a,this._currentCond=a,this)}Default(e){return this.Else(e),this}build(e,...t){const n=hB();tv(this);const r=e.buildStage;for(const s of this.nodes)if(r==="setup")s.build(e);else if(r==="analyze")s.build(e,this);else if(r==="generate"){const a=e.getDataFromNode(s,"any").stages,l=a&&a[e.shaderStage];if(s.isVarNode&&l&&l.length===1&&l[0]&&l[0].isStackNode)continue;s.build(e,"void")}return tv(n),this.outputNode?this.outputNode.build(e,...t):super.build(e,...t)}else(...e){return console.warn("THREE.TSL: .else() has been renamed to .Else()."),this.Else(...e)}elseif(...e){return console.warn("THREE.TSL: .elseif() has been renamed to .ElseIf()."),this.ElseIf(...e)}}const kb=Oe(Ane).setParameterLength(0,1);new Bs;new V;new V;new V;new Wt;new V(0,0,-1);new bt;new V;new V;new bt;new Le;const wne=new Nu;sh.flipX();wne.depthTexture=new bs(1,1);const zb=new Yp(-1,1,1,-1,0,1);class Rne extends ar{constructor(e=!1){super();const t=e===!1?[0,-1,0,1,2,1]:[0,2,0,0,2,0];this.setAttribute("position",new ni([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new ni(t,2))}}const Cne=new Rne;class FE extends fi{constructor(e=null){super(Cne,e),this.camera=zb,this.isQuadMesh=!0}async renderAsync(e){return e.renderAsync(this,zb)}render(e){e.render(this,zb)}}const yd=new Br,Vb=new Wt;class Dr extends Ot{static get type(){return"SceneNode"}constructor(e=Dr.BACKGROUND_BLURRINESS,t=null){super(),this.scope=e,this.scene=t}setup(e){const t=this.scope,n=this.scene!==null?this.scene:e.scene;let r;return t===Dr.BACKGROUND_BLURRINESS?r=Mn("backgroundBlurriness","float",n):t===Dr.BACKGROUND_INTENSITY?r=Mn("backgroundIntensity","float",n):t===Dr.BACKGROUND_ROTATION?r=Et("mat4").label("backgroundRotation").setGroup(Mt).onRenderUpdate(()=>{const s=n.background;return s!==null&&s.isTexture&&s.mapping!==NM?(yd.copy(n.backgroundRotation),yd.x*=-1,yd.y*=-1,yd.z*=-1,Vb.makeRotationFromEuler(yd)):Vb.identity(),Vb}):console.error("THREE.SceneNode: Unknown scope:",t),r}}Dr.BACKGROUND_BLURRINESS="backgroundBlurriness";Dr.BACKGROUND_INTENSITY="backgroundIntensity";Dr.BACKGROUND_ROTATION="backgroundRotation";const Nne=Ge(Dr,Dr.BACKGROUND_BLURRINESS),KD=Ge(Dr,Dr.BACKGROUND_INTENSITY),Pne=Ge(Dr,Dr.BACKGROUND_ROTATION),Dne=Ue(({texture:i,uv:e})=>{const n=Ee().toVar();return ii(e.x.lessThan(1e-4),()=>{n.assign(Ee(1,0,0))}).ElseIf(e.y.lessThan(1e-4),()=>{n.assign(Ee(0,1,0))}).ElseIf(e.z.lessThan(1e-4),()=>{n.assign(Ee(0,0,1))}).ElseIf(e.x.greaterThan(1-1e-4),()=>{n.assign(Ee(-1,0,0))}).ElseIf(e.y.greaterThan(1-1e-4),()=>{n.assign(Ee(0,-1,0))}).ElseIf(e.z.greaterThan(1-1e-4),()=>{n.assign(Ee(0,0,-1))}).Else(()=>{const s=i.sample(e.add(Ee(-.01,0,0))).r.sub(i.sample(e.add(Ee(.01,0,0))).r),a=i.sample(e.add(Ee(0,-.01,0))).r.sub(i.sample(e.add(Ee(0,.01,0))).r),l=i.sample(e.add(Ee(0,0,-.01))).r.sub(i.sample(e.add(Ee(0,0,.01))).r);n.assign(Ee(s,a,l))}),n.normalize()});class Lne extends Kh{static get type(){return"Texture3DNode"}constructor(e,t=null,n=null){super(e,t,n),this.isTexture3DNode=!0}getInputType(){return"texture3D"}getDefaultUV(){return Ee(.5,.5,.5)}setUpdateMatrix(){}setupUV(e,t){const n=this.value;return e.isFlipY()&&(n.isRenderTargetTexture===!0||n.isFramebufferTexture===!0)&&(this.sampler?t=t.flipY():t=t.setY(Nn(rh(this,this.levelNode).y).sub(t.y).sub(1))),t}generateUV(e,t){return t.build(e,"vec3")}normal(e){return Dne({texture:this,uv:e})}}const Une=Oe(Lne).setParameterLength(1,3),iy=new Le;class One extends Kh{static get type(){return"PassTextureNode"}constructor(e,t){super(t),this.passNode=e,this.setUpdateMatrix(!1)}setup(e){return e.object.isQuadMesh&&this.passNode.build(e),super.setup(e)}clone(){return new this.constructor(this.passNode,this.value)}}class ZD extends One{static get type(){return"PassMultipleTextureNode"}constructor(e,t,n=!1){super(e,null),this.textureName=t,this.previousTexture=n}updateTexture(){this.value=this.previousTexture?this.passNode.getPreviousTexture(this.textureName):this.passNode.getTexture(this.textureName)}setup(e){return this.updateTexture(),super.setup(e)}clone(){return new this.constructor(this.passNode,this.textureName,this.previousTexture)}}class qv extends mi{static get type(){return"PassNode"}constructor(e,t,n,r={}){super("vec4"),this.scope=e,this.scene=t,this.camera=n,this.options=r,this._pixelRatio=1,this._width=1,this._height=1;const s=new bs;s.isRenderTargetTexture=!0,s.name="depth";const a=new Nu(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:Oi,...r});a.texture.name="output",a.depthTexture=s,this.renderTarget=a,this._textures={output:a.texture,depth:s},this._textureNodes={},this._linearDepthNodes={},this._viewZNodes={},this._previousTextures={},this._previousTextureNodes={},this._cameraNear=Et(0),this._cameraFar=Et(0),this._mrt=null,this._layers=null,this._resolution=1,this.isPassNode=!0,this.updateBeforeType=Ht.FRAME,this.global=!0}setResolution(e){return this._resolution=e,this}getResolution(){return this._resolution}setLayers(e){return this._layers=e,this}getLayers(){return this._layers}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}getTexture(e){let t=this._textures[e];return t===void 0&&(t=this.renderTarget.texture.clone(),t.name=e,this._textures[e]=t,this.renderTarget.textures.push(t)),t}getPreviousTexture(e){let t=this._previousTextures[e];return t===void 0&&(t=this.getTexture(e).clone(),this._previousTextures[e]=t),t}toggleTexture(e){const t=this._previousTextures[e];if(t!==void 0){const n=this._textures[e],r=this.renderTarget.textures.indexOf(n);this.renderTarget.textures[r]=t,this._textures[e]=t,this._previousTextures[e]=n,this._textureNodes[e].updateTexture(),this._previousTextureNodes[e].updateTexture()}}getTextureNode(e="output"){let t=this._textureNodes[e];return t===void 0&&(t=Ie(new ZD(this,e)),t.updateTexture(),this._textureNodes[e]=t),t}getPreviousTextureNode(e="output"){let t=this._previousTextureNodes[e];return t===void 0&&(this._textureNodes[e]===void 0&&this.getTextureNode(e),t=Ie(new ZD(this,e,!0)),t.updateTexture(),this._previousTextureNodes[e]=t),t}getViewZNode(e="depth"){let t=this._viewZNodes[e];if(t===void 0){const n=this._cameraNear,r=this._cameraFar;this._viewZNodes[e]=t=eI(this.getTextureNode(e),n,r)}return t}getLinearDepthNode(e="depth"){let t=this._linearDepthNodes[e];if(t===void 0){const n=this._cameraNear,r=this._cameraFar,s=this.getViewZNode(e);this._linearDepthNodes[e]=t=Xd(s,n,r)}return t}setup({renderer:e}){return this.renderTarget.samples=this.options.samples===void 0?e.samples:this.options.samples,e.backend.isWebGLBackend===!0&&(this.renderTarget.samples=0),this.renderTarget.texture.type=e.getColorBufferType(),this.scope===qv.COLOR?this.getTextureNode():this.getLinearDepthNode()}updateBefore(e){const{renderer:t}=e,{scene:n}=this;let r,s;const a=t.getOutputRenderTarget();a&&a.isXRRenderTarget===!0?(s=1,r=t.xr.getCamera(),t.xr.updateCamera(r),iy.set(a.width,a.height)):(r=this.camera,s=t.getPixelRatio(),t.getSize(iy)),this._pixelRatio=s,this.setSize(iy.width,iy.height);const l=t.getRenderTarget(),u=t.getMRT(),h=r.layers.mask;this._cameraNear.value=r.near,this._cameraFar.value=r.far,this._layers!==null&&(r.layers.mask=this._layers.mask);for(const d in this._previousTextures)this.toggleTexture(d);t.setRenderTarget(this.renderTarget),t.setMRT(this._mrt),t.render(n,r),t.setRenderTarget(l),t.setMRT(u),r.layers.mask=h}setSize(e,t){this._width=e,this._height=t;const n=this._width*this._pixelRatio*this._resolution,r=this._height*this._pixelRatio*this._resolution;this.renderTarget.setSize(n,r)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}}qv.COLOR="color";qv.DEPTH="depth";const Bne=Ue(([i,e])=>i.mul(e).clamp()).setLayout({name:"linearToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),Ine=Ue(([i,e])=>(i=i.mul(e),i.div(i.add(1)).clamp())).setLayout({name:"reinhardToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),Fne=Ue(([i,e])=>{i=i.mul(e),i=i.sub(.004).max(0);const t=i.mul(i.mul(6.2).add(.5)),n=i.mul(i.mul(6.2).add(1.7)).add(.06);return t.div(n).pow(2.2)}).setLayout({name:"cineonToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),kne=Ue(([i])=>{const e=i.mul(i.add(.0245786)).sub(90537e-9),t=i.mul(i.add(.432951).mul(.983729)).add(.238081);return e.div(t)}),zne=Ue(([i,e])=>{const t=_r(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),n=_r(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return i=i.mul(e).div(.6),i=t.mul(i),i=kne(i),i=n.mul(i),i.clamp()}).setLayout({name:"acesFilmicToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),Vne=_r(Ee(1.6605,-.1246,-.0182),Ee(-.5876,1.1329,-.1006),Ee(-.0728,-.0083,1.1187)),Gne=_r(Ee(.6274,.0691,.0164),Ee(.3293,.9195,.088),Ee(.0433,.0113,.8956)),Hne=Ue(([i])=>{const e=Ee(i).toVar(),t=Ee(e.mul(e)).toVar(),n=Ee(t.mul(t)).toVar();return Te(15.5).mul(n.mul(t)).sub($t(40.14,n.mul(e))).add($t(31.96,n).sub($t(6.868,t.mul(e))).add($t(.4298,t).add($t(.1191,e).sub(.00232))))}),Wne=Ue(([i,e])=>{const t=Ee(i).toVar(),n=_r(Ee(.856627153315983,.137318972929847,.11189821299995),Ee(.0951212405381588,.761241990602591,.0767994186031903),Ee(.0482516061458583,.101439036467562,.811302368396859)),r=_r(Ee(1.1271005818144368,-.1413297634984383,-.14132976349843826),Ee(-.11060664309660323,1.157823702216272,-.11060664309660294),Ee(-.016493938717834573,-.016493938717834257,1.2519364065950405)),s=Te(-12.47393),a=Te(4.026069);return t.mulAssign(e),t.assign(Gne.mul(t)),t.assign(n.mul(t)),t.assign(sr(t,1e-10)),t.assign(oo(t)),t.assign(t.sub(s).div(a.sub(s))),t.assign(fo(t,0,1)),t.assign(Hne(t)),t.assign(r.mul(t)),t.assign(Fv(sr(Ee(0),t),Ee(2.2))),t.assign(Vne.mul(t)),t.assign(fo(t,0,1)),t}).setLayout({name:"agxToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),jne=Ue(([i,e])=>{const t=Te(.76),n=Te(.15);i=i.mul(e);const r=Uh(i.r,Uh(i.g,i.b)),s=ir(r.lessThan(.08),r.sub($t(6.25,r.mul(r))),.04);i.subAssign(s);const a=sr(i.r,sr(i.g,i.b));ii(a.lessThan(t),()=>i);const l=hr(1,t),u=hr(1,l.mul(l).div(a.add(l.sub(t))));i.mulAssign(u.div(a));const h=hr(1,pa(1,n.mul(a.sub(u)).add(1)));return Dn(i,Ee(u),h)}).setLayout({name:"neutralToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]});class Si extends Ot{static get type(){return"CodeNode"}constructor(e="",t=[],n=""){super("code"),this.isCodeNode=!0,this.global=!0,this.code=e,this.includes=t,this.language=n}setIncludes(e){return this.includes=e,this}getIncludes(){return this.includes}generate(e){const t=this.getIncludes(e);for(const r of t)r.build(e);const n=e.getCodeFromNode(this,this.getNodeType(e));return n.code=this.code,n.code}serialize(e){super.serialize(e),e.code=this.code,e.language=this.language}deserialize(e){super.deserialize(e),this.code=e.code,this.language=e.language}}class qne extends Si{static get type(){return"FunctionNode"}constructor(e="",t=[],n=""){super(e,t,n)}getNodeType(e){return this.getNodeFunction(e).type}getInputs(e){return this.getNodeFunction(e).inputs}getNodeFunction(e){const t=e.getDataFromNode(this);let n=t.nodeFunction;return n===void 0&&(n=e.parser.parseFunction(this.code),t.nodeFunction=n),n}generate(e,t){super.generate(e);const n=this.getNodeFunction(e),r=n.name,s=n.type,a=e.getCodeFromNode(this,s);r!==""&&(a.name=r);const l=e.getPropertyName(a),u=this.getNodeFunction(e).getCode(l);return a.code=u+`
`,t==="property"?l:e.format(`${l}()`,s,t)}}function MI(i){let e;const t=i.context.getViewZ;return t!==void 0&&(e=t(this)),(e||hi.z).negate()}const $ne=Ue(([i,e],t)=>{const n=MI(t);return pl(i,e,n)}),Xne=Ue(([i],e)=>{const t=MI(e);return i.mul(i,t,t).negate().exp().oneMinus()}),QD=Ue(([i,e])=>Ut(e.toFloat().mix(qd.rgb,i.toVec3()),qd.a));class Yne extends Ot{constructor(e){super(),this.scope=e}generate(e){const{scope:t}=this,{renderer:n}=e;n.backend.isWebGLBackend===!0?e.addFlowCode(`	// ${t}Barrier 
`):e.addLineFlowCode(`${t}Barrier()`,this)}}Oe(Yne);class va extends Ot{static get type(){return"AtomicFunctionNode"}constructor(e,t,n){super("uint"),this.method=e,this.pointerNode=t,this.valueNode=n,this.parents=!0}getInputType(e){return this.pointerNode.getNodeType(e)}getNodeType(e){return this.getInputType(e)}generate(e){const t=e.getNodeProperties(this),n=t.parents,r=this.method,s=this.getNodeType(e),a=this.getInputType(e),l=this.pointerNode,u=this.valueNode,h=[];h.push(`&${l.build(e,a)}`),u!==null&&h.push(u.build(e,a));const d=`${e.getMethod(r,s)}( ${h.join(", ")} )`;if(n.length===1&&n[0].isStackNode===!0)e.addLineFlowCode(d,this);else return t.constNode===void 0&&(t.constNode=Oh(d,s).toConst()),t.constNode.build(e)}}va.ATOMIC_LOAD="atomicLoad";va.ATOMIC_STORE="atomicStore";va.ATOMIC_ADD="atomicAdd";va.ATOMIC_SUB="atomicSub";va.ATOMIC_MAX="atomicMax";va.ATOMIC_MIN="atomicMin";va.ATOMIC_AND="atomicAnd";va.ATOMIC_OR="atomicOr";va.ATOMIC_XOR="atomicXor";Oe(va);let ry;function $v(i){ry=ry||new WeakMap;let e=ry.get(i);return e===void 0&&ry.set(i,e={}),e}function EI(i){const e=$v(i);return e.shadowMatrix||(e.shadowMatrix=Et("mat4").setGroup(Mt).onRenderUpdate(t=>((i.castShadow!==!0||t.renderer.shadowMap.enabled===!1)&&i.shadow.updateMatrices(i),i.shadow.matrix)))}function Kne(i,e=Cp){const t=EI(i).mul(e);return t.xyz.div(t.w)}function AI(i){const e=$v(i);return e.position||(e.position=Et(new V).setGroup(Mt).onRenderUpdate((t,n)=>n.value.setFromMatrixPosition(i.matrixWorld)))}function Zne(i){const e=$v(i);return e.targetPosition||(e.targetPosition=Et(new V).setGroup(Mt).onRenderUpdate((t,n)=>n.value.setFromMatrixPosition(i.target.matrixWorld)))}function wI(i){const e=$v(i);return e.viewPosition||(e.viewPosition=Et(new V).setGroup(Mt).onRenderUpdate(({camera:t},n)=>{n.value=n.value||new V,n.value.setFromMatrixPosition(i.matrixWorld),n.value.applyMatrix4(t.matrixWorldInverse)}))}const RI=i=>yo.transformDirection(AI(i).sub(Zne(i))),Qne=i=>i.sort((e,t)=>e.id-t.id),Jne=(i,e)=>{for(const t of e)if(t.isAnalyticLightNode&&t.light.id===i)return t;return null},Gb=new WeakMap,vd=[];class CI extends Ot{static get type(){return"LightsNode"}constructor(){super("vec3"),this.totalDiffuseNode=Ee().toVar(),this.totalSpecularNode=Ee().toVar(),this.outgoingLightNode=Ee().toVar(),this._lights=[],this._lightNodes=null,this._lightNodesHash=null,this.global=!0}customCacheKey(){const e=this._lights;for(let n=0;n<e.length;n++){const r=e[n];if(vd.push(r.id),vd.push(r.castShadow?1:0),r.isSpotLight===!0){const s=r.map!==null?r.map.id:-1,a=r.colorNode?r.colorNode.getCacheKey():-1;vd.push(s,a)}}const t=cE(vd);return vd.length=0,t}getHash(e){if(this._lightNodesHash===null){this._lightNodes===null&&this.setupLightsNode(e);const t=[];for(const n of this._lightNodes)t.push(n.getSelf().getHash());this._lightNodesHash="lights-"+t.join(",")}return this._lightNodesHash}analyze(e){const t=e.getNodeProperties(this);for(const n of t.nodes)n.build(e);t.outputNode.build(e)}setupLightsNode(e){const t=[],n=this._lightNodes,r=Qne(this._lights),s=e.renderer.library;for(const a of r)if(a.isNode)t.push(Ie(a));else{let l=null;if(n!==null&&(l=Jne(a.id,n)),l===null){const u=s.getLightNodeClass(a.constructor);if(u===null){console.warn(`LightsNode.setupNodeLights: Light node not found for ${a.constructor.name}`);continue}let h=null;Gb.has(a)?h=Gb.get(a):(h=Ie(new u(a)),Gb.set(a,h)),t.push(h)}}this._lightNodes=t}setupDirectLight(e,t,n){const{lightingModel:r,reflectedLight:s}=e.context;r.direct({...n,lightNode:t,reflectedLight:s},e)}setupDirectRectAreaLight(e,t,n){const{lightingModel:r,reflectedLight:s}=e.context;r.directRectArea({...n,lightNode:t,reflectedLight:s},e)}setupLights(e,t){for(const n of t)n.build(e)}getLightNodes(e){return this._lightNodes===null&&this.setupLightsNode(e),this._lightNodes}setup(e){const t=e.lightsNode;e.lightsNode=this;let n=this.outgoingLightNode;const r=e.context,s=r.lightingModel,a=e.getNodeProperties(this);if(s){const{totalDiffuseNode:l,totalSpecularNode:u}=this;r.outgoingLight=n;const h=e.addStack();a.nodes=h.nodes,s.start(e);const{backdrop:d,backdropAlpha:p}=r,{directDiffuse:g,directSpecular:y,indirectDiffuse:v,indirectSpecular:S}=r.reflectedLight;let b=g.add(v);d!==null&&(p!==null?b=Ee(p.mix(b,d)):b=Ee(d),r.material.transparent=!0),l.assign(b),u.assign(y.add(S)),n.assign(l.add(u)),s.finish(e),n=n.bypass(e.removeStack())}else a.nodes=[];return e.lightsNode=t,n}setLights(e){return this._lights=e,this._lightNodes=null,this._lightNodesHash=null,this}getLights(){return this._lights}get hasLights(){return this._lights.length>0}}class eie extends Ot{static get type(){return"ShadowBaseNode"}constructor(e){super(),this.light=e,this.updateBeforeType=Ht.RENDER,this.isShadowBaseNode=!0}setupShadowPosition({context:e,material:t}){NI.assign(t.receivedShadowPositionNode||e.shadowPositionWorld||Cp)}}const NI=Zp("vec3","shadowPositionWorld");function tie(i,e={}){return e.toneMapping=i.toneMapping,e.toneMappingExposure=i.toneMappingExposure,e.outputColorSpace=i.outputColorSpace,e.renderTarget=i.getRenderTarget(),e.activeCubeFace=i.getActiveCubeFace(),e.activeMipmapLevel=i.getActiveMipmapLevel(),e.renderObjectFunction=i.getRenderObjectFunction(),e.pixelRatio=i.getPixelRatio(),e.mrt=i.getMRT(),e.clearColor=i.getClearColor(e.clearColor||new ot),e.clearAlpha=i.getClearAlpha(),e.autoClear=i.autoClear,e.scissorTest=i.getScissorTest(),e}function nie(i,e){return e=tie(i,e),i.setMRT(null),i.setRenderObjectFunction(null),i.setClearColor(0,1),i.autoClear=!0,e}function iie(i,e){i.toneMapping=e.toneMapping,i.toneMappingExposure=e.toneMappingExposure,i.outputColorSpace=e.outputColorSpace,i.setRenderTarget(e.renderTarget,e.activeCubeFace,e.activeMipmapLevel),i.setRenderObjectFunction(e.renderObjectFunction),i.setPixelRatio(e.pixelRatio),i.setMRT(e.mrt),i.setClearColor(e.clearColor,e.clearAlpha),i.autoClear=e.autoClear,i.setScissorTest(e.scissorTest)}function rie(i,e={}){return e.background=i.background,e.backgroundNode=i.backgroundNode,e.overrideMaterial=i.overrideMaterial,e}function sie(i,e){return e=rie(i,e),i.background=null,i.backgroundNode=null,i.overrideMaterial=null,e}function aie(i,e){i.background=e.background,i.backgroundNode=e.backgroundNode,i.overrideMaterial=e.overrideMaterial}function oie(i,e,t){return t=nie(i,t),t=sie(e,t),t}function lie(i,e,t){iie(i,t),aie(e,t)}const JD=new WeakMap,uie=Ue(({depthTexture:i,shadowCoord:e,depthLayer:t})=>{let n=nn(i,e.xy).label("t_basic");return i.isArrayTexture&&(n=n.depth(t)),n.compare(e.z)}),cie=Ue(({depthTexture:i,shadowCoord:e,shadow:t,depthLayer:n})=>{const r=(b,_)=>{let E=nn(i,b);return i.isArrayTexture&&(E=E.depth(n)),E.compare(_)},s=Mn("mapSize","vec2",t).setGroup(Mt),a=Mn("radius","float",t).setGroup(Mt),l=We(1).div(s),u=l.x.negate().mul(a),h=l.y.negate().mul(a),d=l.x.mul(a),p=l.y.mul(a),g=u.div(2),y=h.div(2),v=d.div(2),S=p.div(2);return xr(r(e.xy.add(We(u,h)),e.z),r(e.xy.add(We(0,h)),e.z),r(e.xy.add(We(d,h)),e.z),r(e.xy.add(We(g,y)),e.z),r(e.xy.add(We(0,y)),e.z),r(e.xy.add(We(v,y)),e.z),r(e.xy.add(We(u,0)),e.z),r(e.xy.add(We(g,0)),e.z),r(e.xy,e.z),r(e.xy.add(We(v,0)),e.z),r(e.xy.add(We(d,0)),e.z),r(e.xy.add(We(g,S)),e.z),r(e.xy.add(We(0,S)),e.z),r(e.xy.add(We(v,S)),e.z),r(e.xy.add(We(u,p)),e.z),r(e.xy.add(We(0,p)),e.z),r(e.xy.add(We(d,p)),e.z)).mul(1/17)}),hie=Ue(({depthTexture:i,shadowCoord:e,shadow:t,depthLayer:n})=>{const r=(p,g)=>{let y=nn(i,p);return i.isArrayTexture&&(y=y.depth(n)),y.compare(g)},s=Mn("mapSize","vec2",t).setGroup(Mt),a=We(1).div(s),l=a.x,u=a.y,h=e.xy,d=vl(h.mul(s).add(.5));return h.subAssign(d.mul(a)),xr(r(h,e.z),r(h.add(We(l,0)),e.z),r(h.add(We(0,u)),e.z),r(h.add(a),e.z),Dn(r(h.add(We(l.negate(),0)),e.z),r(h.add(We(l.mul(2),0)),e.z),d.x),Dn(r(h.add(We(l.negate(),u)),e.z),r(h.add(We(l.mul(2),u)),e.z),d.x),Dn(r(h.add(We(0,u.negate())),e.z),r(h.add(We(0,u.mul(2))),e.z),d.y),Dn(r(h.add(We(l,u.negate())),e.z),r(h.add(We(l,u.mul(2))),e.z),d.y),Dn(Dn(r(h.add(We(l.negate(),u.negate())),e.z),r(h.add(We(l.mul(2),u.negate())),e.z),d.x),Dn(r(h.add(We(l.negate(),u.mul(2))),e.z),r(h.add(We(l.mul(2),u.mul(2))),e.z),d.x),d.y)).mul(1/9)}),fie=Ue(({depthTexture:i,shadowCoord:e,depthLayer:t})=>{const n=Te(1).toVar();let r=nn(i).sample(e.xy);i.isArrayTexture&&(r=r.depth(t)),r=r.rg;const s=RB(e.z,r.x);return ii(s.notEqual(Te(1)),()=>{const a=e.z.sub(r.x),l=sr(0,r.y.mul(r.y));let u=l.div(l.add(a.mul(a)));u=fo(hr(u,.3).div(.95-.3)),n.assign(fo(sr(s,u)))}),n}),die=Ue(([i,e,t])=>{let n=Cp.sub(i).length();return n=n.sub(e).div(t.sub(e)),n=n.saturate(),n}),pie=i=>{const e=i.shadow.camera,t=Mn("near","float",e).setGroup(Mt),n=Mn("far","float",e).setGroup(Mt),r=XQ(i);return die(r,t,n)},mie=i=>{let e=JD.get(i);if(e===void 0){const t=i.isPointLight?pie(i):null;e=new pi,e.colorNode=Ut(0,0,0,1),e.depthNode=t,e.isShadowPassMaterial=!0,e.name="ShadowMaterial",e.fog=!1,JD.set(i,e)}return e},e2=new Gs,Uc=[],gie=(i,e,t,n)=>{Uc[0]=i,Uc[1]=e;let r=e2.get(Uc);return(r===void 0||r.shadowType!==t||r.useVelocity!==n)&&(r=(s,a,l,u,h,d,...p)=>{(s.castShadow===!0||s.receiveShadow&&t===Jr)&&(n&&(aB(s).useVelocity=!0),s.onBeforeShadow(i,s,l,e.camera,u,a.overrideMaterial,d),i.renderObject(s,a,l,u,h,d,...p),s.onAfterShadow(i,s,l,e.camera,u,a.overrideMaterial,d))},r.shadowType=t,r.useVelocity=n,e2.set(Uc,r)),Uc[0]=null,Uc[1]=null,r},yie=Ue(({samples:i,radius:e,size:t,shadowPass:n,depthLayer:r})=>{const s=Te(0).toVar("meanVertical"),a=Te(0).toVar("squareMeanVertical"),l=i.lessThanEqual(Te(1)).select(Te(0),Te(2).div(i.sub(1))),u=i.lessThanEqual(Te(1)).select(Te(0),Te(-1));Fs({start:Nn(0),end:Nn(i),type:"int",condition:"<"},({i:d})=>{const p=u.add(Te(d).mul(l));let g=n.sample(xr(Hv.xy,We(0,p).mul(e)).div(t));n.value.isArrayTexture&&(g=g.depth(r)),g=g.x,s.addAssign(g),a.addAssign(g.mul(g))}),s.divAssign(i),a.divAssign(i);const h=xE(a.sub(s.mul(s)));return We(s,h)}),vie=Ue(({samples:i,radius:e,size:t,shadowPass:n,depthLayer:r})=>{const s=Te(0).toVar("meanHorizontal"),a=Te(0).toVar("squareMeanHorizontal"),l=i.lessThanEqual(Te(1)).select(Te(0),Te(2).div(i.sub(1))),u=i.lessThanEqual(Te(1)).select(Te(0),Te(-1));Fs({start:Nn(0),end:Nn(i),type:"int",condition:"<"},({i:d})=>{const p=u.add(Te(d).mul(l));let g=n.sample(xr(Hv.xy,We(p,0).mul(e)).div(t));n.value.isArrayTexture&&(g=g.depth(r)),s.addAssign(g.x),a.addAssign(xr(g.y.mul(g.y),g.x.mul(g.x)))}),s.divAssign(i),a.divAssign(i);const h=xE(a.sub(s.mul(s)));return We(s,h)}),_ie=[uie,cie,hie,fie];let Hb;const sy=new FE;class PI extends eie{static get type(){return"ShadowNode"}constructor(e,t=null){super(e),this.shadow=t||e.shadow,this.shadowMap=null,this.vsmShadowMapVertical=null,this.vsmShadowMapHorizontal=null,this.vsmMaterialVertical=null,this.vsmMaterialHorizontal=null,this._node=null,this._cameraFrameId=new WeakMap,this.isShadowNode=!0,this.depthLayer=0}setupShadowFilter(e,{filterFn:t,depthTexture:n,shadowCoord:r,shadow:s,depthLayer:a}){const l=r.x.greaterThanEqual(0).and(r.x.lessThanEqual(1)).and(r.y.greaterThanEqual(0)).and(r.y.lessThanEqual(1)).and(r.z.lessThanEqual(1)),u=t({depthTexture:n,shadowCoord:r,shadow:s,depthLayer:a});return l.select(u,Te(1))}setupShadowCoord(e,t){const{shadow:n}=this,{renderer:r}=e,s=Mn("bias","float",n).setGroup(Mt);let a=t,l;if(n.camera.isOrthographicCamera||r.logarithmicDepthBuffer!==!0)a=a.xyz.div(a.w),l=a.z,r.coordinateSystem===fl&&(l=l.mul(2).sub(1));else{const u=a.w;a=a.xy.div(u);const h=Mn("near","float",n.camera).setGroup(Mt),d=Mn("far","float",n.camera).setGroup(Mt);l=tI(u.negate(),h,d)}return a=Ee(a.x,a.y.oneMinus(),l.add(s)),a}getShadowFilterFn(e){return _ie[e]}setupRenderTarget(e,t){const n=new bs(e.mapSize.width,e.mapSize.height);n.name="ShadowDepthTexture",n.compareFunction=Sv;const r=t.createRenderTarget(e.mapSize.width,e.mapSize.height);return r.texture.name="ShadowMap",r.texture.type=e.mapType,r.depthTexture=n,{shadowMap:r,depthTexture:n}}setupShadow(e){const{renderer:t}=e,{light:n,shadow:r}=this,s=t.shadowMap.type,{depthTexture:a,shadowMap:l}=this.setupRenderTarget(r,e);if(r.camera.updateProjectionMatrix(),s===Jr&&r.isPointLightShadow!==!0){a.compareFunction=null,l.depth>1?(l._vsmShadowMapVertical||(l._vsmShadowMapVertical=e.createRenderTarget(r.mapSize.width,r.mapSize.height,{format:to,type:Oi,depth:l.depth,depthBuffer:!1}),l._vsmShadowMapVertical.texture.name="VSMVertical"),this.vsmShadowMapVertical=l._vsmShadowMapVertical,l._vsmShadowMapHorizontal||(l._vsmShadowMapHorizontal=e.createRenderTarget(r.mapSize.width,r.mapSize.height,{format:to,type:Oi,depth:l.depth,depthBuffer:!1}),l._vsmShadowMapHorizontal.texture.name="VSMHorizontal"),this.vsmShadowMapHorizontal=l._vsmShadowMapHorizontal):(this.vsmShadowMapVertical=e.createRenderTarget(r.mapSize.width,r.mapSize.height,{format:to,type:Oi,depthBuffer:!1}),this.vsmShadowMapHorizontal=e.createRenderTarget(r.mapSize.width,r.mapSize.height,{format:to,type:Oi,depthBuffer:!1}));let _=nn(a);a.isArrayTexture&&(_=_.depth(this.depthLayer));let E=nn(this.vsmShadowMapVertical.texture);a.isArrayTexture&&(E=E.depth(this.depthLayer));const M=Mn("blurSamples","float",r).setGroup(Mt),A=Mn("radius","float",r).setGroup(Mt),w=Mn("mapSize","vec2",r).setGroup(Mt);let R=this.vsmMaterialVertical||(this.vsmMaterialVertical=new pi);R.fragmentNode=yie({samples:M,radius:A,size:w,shadowPass:_,depthLayer:this.depthLayer}).context(e.getSharedContext()),R.name="VSMVertical",R=this.vsmMaterialHorizontal||(this.vsmMaterialHorizontal=new pi),R.fragmentNode=vie({samples:M,radius:A,size:w,shadowPass:E,depthLayer:this.depthLayer}).context(e.getSharedContext()),R.name="VSMHorizontal"}const u=Mn("intensity","float",r).setGroup(Mt),h=Mn("normalBias","float",r).setGroup(Mt),d=EI(n).mul(NI.add(NE.mul(h))),p=this.setupShadowCoord(e,d),g=r.filterNode||this.getShadowFilterFn(t.shadowMap.type)||null;if(g===null)throw new Error("THREE.WebGPURenderer: Shadow map type not supported yet.");const y=s===Jr&&r.isPointLightShadow!==!0?this.vsmShadowMapHorizontal.texture:a,v=this.setupShadowFilter(e,{filterFn:g,shadowTexture:l.texture,depthTexture:y,shadowCoord:p,shadow:r,depthLayer:this.depthLayer});let S=nn(l.texture,p);a.isArrayTexture&&(S=S.depth(this.depthLayer));const b=Dn(1,v.rgb.mix(S,1),u.mul(S.a)).toVar();return this.shadowMap=l,this.shadow.map=l,b}setup(e){if(e.renderer.shadowMap.enabled!==!1)return Ue(()=>{let t=this._node;return this.setupShadowPosition(e),t===null&&(this._node=t=this.setupShadow(e)),e.material.shadowNode&&console.warn('THREE.NodeMaterial: ".shadowNode" is deprecated. Use ".castShadowNode" instead.'),e.material.receivedShadowNode&&(t=e.material.receivedShadowNode(t)),t})()}renderShadow(e){const{shadow:t,shadowMap:n,light:r}=this,{renderer:s,scene:a}=e;t.updateMatrices(r),n.setSize(t.mapSize.width,t.mapSize.height,n.depth),s.render(a,t.camera)}updateShadow(e){const{shadowMap:t,light:n,shadow:r}=this,{renderer:s,scene:a,camera:l}=e,u=s.shadowMap.type,h=t.depthTexture.version;this._depthVersionCached=h;const d=r.camera.layers.mask;(r.camera.layers.mask&4294967294)===0&&(r.camera.layers.mask=l.layers.mask);const p=s.getRenderObjectFunction(),g=s.getMRT(),y=g?g.has("velocity"):!1;Hb=oie(s,a,Hb),a.overrideMaterial=mie(n),s.setRenderObjectFunction(gie(s,r,u,y)),s.setClearColor(0,0),s.setRenderTarget(t),this.renderShadow(e),s.setRenderObjectFunction(p),u===Jr&&r.isPointLightShadow!==!0&&this.vsmPass(s),r.camera.layers.mask=d,lie(s,a,Hb)}vsmPass(e){const{shadow:t}=this,n=this.shadowMap.depth;this.vsmShadowMapVertical.setSize(t.mapSize.width,t.mapSize.height,n),this.vsmShadowMapHorizontal.setSize(t.mapSize.width,t.mapSize.height,n),e.setRenderTarget(this.vsmShadowMapVertical),sy.material=this.vsmMaterialVertical,sy.render(e),e.setRenderTarget(this.vsmShadowMapHorizontal),sy.material=this.vsmMaterialHorizontal,sy.render(e)}dispose(){this.shadowMap.dispose(),this.shadowMap=null,this.vsmShadowMapVertical!==null&&(this.vsmShadowMapVertical.dispose(),this.vsmShadowMapVertical=null,this.vsmMaterialVertical.dispose(),this.vsmMaterialVertical=null),this.vsmShadowMapHorizontal!==null&&(this.vsmShadowMapHorizontal.dispose(),this.vsmShadowMapHorizontal=null,this.vsmMaterialHorizontal.dispose(),this.vsmMaterialHorizontal=null),super.dispose()}updateBefore(e){const{shadow:t}=this;let n=t.needsUpdate||t.autoUpdate;n&&(this._cameraFrameId[e.camera]===e.frameId&&(n=!1),this._cameraFrameId[e.camera]=e.frameId),n&&(this.updateShadow(e),this.shadowMap.depthTexture.version===this._depthVersionCached&&(t.needsUpdate=!1))}}const xie=(i,e)=>Ie(new PI(i,e)),bie=new ot,ea=Ue(([i,e])=>{const t=i.toVar(),n=ys(t),r=pa(1,sr(n.x,sr(n.y,n.z)));n.mulAssign(r),t.mulAssign(r.mul(e.mul(2).oneMinus()));const s=We(t.xy).toVar(),l=e.mul(1.5).oneMinus();return ii(n.z.greaterThanEqual(l),()=>{ii(t.z.greaterThan(0),()=>{s.x.assign(hr(4,t.x))})}).ElseIf(n.x.greaterThanEqual(l),()=>{const u=av(t.x);s.x.assign(t.z.mul(u).add(u.mul(2)))}).ElseIf(n.y.greaterThanEqual(l),()=>{const u=av(t.y);s.x.assign(t.x.add(u.mul(2)).add(2)),s.y.assign(t.z.mul(u).sub(2))}),We(.125,.25).mul(s).add(We(.375,.75)).flipY()}).setLayout({name:"cubeToUV",type:"vec2",inputs:[{name:"pos",type:"vec3"},{name:"texelSizeY",type:"float"}]}),Sie=Ue(({depthTexture:i,bd3D:e,dp:t,texelSize:n})=>nn(i,ea(e,n.y)).compare(t)),Tie=Ue(({depthTexture:i,bd3D:e,dp:t,texelSize:n,shadow:r})=>{const s=Mn("radius","float",r).setGroup(Mt),a=We(-1,1).mul(s).mul(n.y);return nn(i,ea(e.add(a.xyy),n.y)).compare(t).add(nn(i,ea(e.add(a.yyy),n.y)).compare(t)).add(nn(i,ea(e.add(a.xyx),n.y)).compare(t)).add(nn(i,ea(e.add(a.yyx),n.y)).compare(t)).add(nn(i,ea(e,n.y)).compare(t)).add(nn(i,ea(e.add(a.xxy),n.y)).compare(t)).add(nn(i,ea(e.add(a.yxy),n.y)).compare(t)).add(nn(i,ea(e.add(a.xxx),n.y)).compare(t)).add(nn(i,ea(e.add(a.yxx),n.y)).compare(t)).mul(1/9)}),Mie=Ue(({filterFn:i,depthTexture:e,shadowCoord:t,shadow:n})=>{const r=t.xyz.toVar(),s=r.length(),a=Et("float").setGroup(Mt).onRenderUpdate(()=>n.camera.near),l=Et("float").setGroup(Mt).onRenderUpdate(()=>n.camera.far),u=Mn("bias","float",n).setGroup(Mt),h=Et(n.mapSize).setGroup(Mt),d=Te(1).toVar();return ii(s.sub(l).lessThanEqual(0).and(s.sub(a).greaterThanEqual(0)),()=>{const p=s.sub(a).div(l.sub(a)).toVar();p.addAssign(u);const g=r.normalize(),y=We(1).div(h.mul(We(4,2)));d.assign(i({depthTexture:e,bd3D:g,dp:p,texelSize:y,shadow:n}))}),d}),t2=new bt,Oc=new Le,_d=new Le;class Eie extends PI{static get type(){return"PointShadowNode"}constructor(e,t=null){super(e,t)}getShadowFilterFn(e){return e===i6?Sie:Tie}setupShadowCoord(e,t){return t}setupShadowFilter(e,{filterFn:t,shadowTexture:n,depthTexture:r,shadowCoord:s,shadow:a}){return Mie({filterFn:t,shadowTexture:n,depthTexture:r,shadowCoord:s,shadow:a})}renderShadow(e){const{shadow:t,shadowMap:n,light:r}=this,{renderer:s,scene:a}=e,l=t.getFrameExtents();_d.copy(t.mapSize),_d.multiply(l),n.setSize(_d.width,_d.height),Oc.copy(t.mapSize);const u=s.autoClear,h=s.getClearColor(bie),d=s.getClearAlpha();s.autoClear=!1,s.setClearColor(t.clearColor,t.clearAlpha),s.clear();const p=t.getViewportCount();for(let g=0;g<p;g++){const y=t.getViewport(g),v=Oc.x*y.x,S=_d.y-Oc.y-Oc.y*y.y;t2.set(v,S,Oc.x*y.z,Oc.y*y.w),n.viewport.copy(t2),t.updateMatrices(r,g),s.render(a,t.camera)}s.autoClear=u,s.setClearColor(h,d)}}const Aie=(i,e)=>Ie(new Eie(i,e));class Uu extends Zh{static get type(){return"AnalyticLightNode"}constructor(e=null){super(),this.light=e,this.color=new ot,this.colorNode=e&&e.colorNode||Et(this.color).setGroup(Mt),this.baseColorNode=null,this.shadowNode=null,this.shadowColorNode=null,this.isAnalyticLightNode=!0,this.updateType=Ht.FRAME}getHash(){return this.light.uuid}getLightVector(e){return wI(this.light).sub(e.context.positionView||hi)}setupDirect(){}setupDirectRectArea(){}setupShadowNode(){return xie(this.light)}setupShadow(e){const{renderer:t}=e;if(t.shadowMap.enabled===!1)return;let n=this.shadowColorNode;if(n===null){const r=this.light.shadow.shadowNode;let s;r!==void 0?s=Ie(r):s=this.setupShadowNode(),this.shadowNode=s,this.shadowColorNode=n=this.colorNode.mul(s),this.baseColorNode=this.colorNode}this.colorNode=n}setup(e){this.colorNode=this.baseColorNode||this.colorNode,this.light.castShadow?e.object.receiveShadow&&this.setupShadow(e):this.shadowNode!==null&&(this.shadowNode.dispose(),this.shadowNode=null,this.shadowColorNode=null);const t=this.setupDirect(e),n=this.setupDirectRectArea(e);t&&e.lightsNode.setupDirectLight(e,this,t),n&&e.lightsNode.setupDirectRectAreaLight(e,this,n)}update(){const{light:e}=this;this.color.copy(e.color).multiplyScalar(e.intensity)}}const DI=Ue(({lightDistance:i,cutoffDistance:e,decayExponent:t})=>{const n=i.pow(t).max(.01).reciprocal();return e.greaterThan(0).select(n.mul(i.div(e).pow4().oneMinus().clamp().pow2()),n)}),wie=({color:i,lightVector:e,cutoffDistance:t,decayExponent:n})=>{const r=e.normalize(),s=e.length(),a=DI({lightDistance:s,cutoffDistance:t,decayExponent:n}),l=i.mul(a);return{lightDirection:r,lightColor:l}};class Rie extends Uu{static get type(){return"PointLightNode"}constructor(e=null){super(e),this.cutoffDistanceNode=Et(0).setGroup(Mt),this.decayExponentNode=Et(2).setGroup(Mt)}update(e){const{light:t}=this;super.update(e),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}setupShadowNode(){return Aie(this.light)}setupDirect(e){return wie({color:this.colorNode,lightVector:this.getLightVector(e),cutoffDistance:this.cutoffDistanceNode,decayExponent:this.decayExponentNode})}}Ue(([i=Jp()],{renderer:e,material:t})=>{const n=PB(i.mul(2).sub(1));let r;if(t.alphaToCoverage&&e.samples>1){const s=Te(n.fwidth()).toVar();r=pl(s.oneMinus(),s.add(1),n).oneMinus()}else r=ir(n.greaterThan(1),0,1);return r});const Cie=Ue(([i,e])=>{const t=i.x,n=i.y,r=i.z;let s=e.element(0).mul(.886227);return s=s.add(e.element(1).mul(2*.511664).mul(n)),s=s.add(e.element(2).mul(2*.511664).mul(r)),s=s.add(e.element(3).mul(2*.511664).mul(t)),s=s.add(e.element(4).mul(2*.429043).mul(t).mul(n)),s=s.add(e.element(5).mul(2*.429043).mul(n).mul(r)),s=s.add(e.element(6).mul(r.mul(r).mul(.743125).sub(.247708))),s=s.add(e.element(7).mul(2*.429043).mul(t).mul(r)),s=s.add(e.element(8).mul(.429043).mul($t(t,t).sub($t(n,n)))),s}),Ps=new IE;class Nie extends _l{constructor(e,t){super(),this.renderer=e,this.nodes=t}update(e,t,n){const r=this.renderer,s=this.nodes.getBackgroundNode(e)||e.background;let a=!1;if(s===null)r._clearColor.getRGB(Ps),Ps.a=r._clearColor.a;else if(s.isColor===!0)s.getRGB(Ps),Ps.a=1,a=!0;else if(s.isNode===!0){const h=this.get(e),d=s;Ps.copy(r._clearColor);let p=h.backgroundMesh;if(p===void 0){let b=function(){s.removeEventListener("dispose",b),p.material.dispose(),p.geometry.dispose()};var u=b;const y=TE(Ut(d).mul(KD),{getUV:()=>Pne.mul(CE),getTextureLevel:()=>Nne});let v=ZB;v=v.setZ(v.w);const S=new pi;S.name="Background.material",S.side=An,S.depthTest=!1,S.depthWrite=!1,S.allowOverride=!1,S.fog=!1,S.lights=!1,S.vertexNode=v,S.colorNode=y,h.backgroundMeshNode=y,h.backgroundMesh=p=new fi(new Xp(1,32,32),S),p.frustumCulled=!1,p.name="Background.mesh",p.onBeforeRender=function(_,E,M){this.matrixWorld.copyPosition(M.matrixWorld)},s.addEventListener("dispose",b)}const g=d.getCacheKey();h.backgroundCacheKey!==g&&(h.backgroundMeshNode.node=Ut(d).mul(KD),h.backgroundMeshNode.needsUpdate=!0,p.material.needsUpdate=!0,h.backgroundCacheKey=g),t.unshift(p,p.geometry,p.material,0,0,null,null)}else console.error("THREE.Renderer: Unsupported background configuration.",s);const l=r.xr.getEnvironmentBlendMode();if(l==="additive"?Ps.set(0,0,0,1):l==="alpha-blend"&&Ps.set(0,0,0,0),r.autoClear===!0||a===!0){const h=n.clearColorValue;h.r=Ps.r,h.g=Ps.g,h.b=Ps.b,h.a=Ps.a,(r.backend.isWebGLBackend===!0||r.alpha===!0)&&(h.r*=h.a,h.g*=h.a,h.b*=h.a),n.depthClearValue=r._clearDepth,n.stencilClearValue=r._clearStencil,n.clearColor=r.autoClearColor===!0,n.clearDepth=r.autoClearDepth===!0,n.clearStencil=r.autoClearStencil===!0}else n.clearColor=!1,n.clearDepth=!1,n.clearStencil=!1}}let Pie=0;class gT{constructor(e="",t=[],n=0,r=[]){this.name=e,this.bindings=t,this.index=n,this.bindingsReference=r,this.id=Pie++}}class Die{constructor(e,t,n,r,s,a,l,u,h,d=[]){this.vertexShader=e,this.fragmentShader=t,this.computeShader=n,this.transforms=d,this.nodeAttributes=r,this.bindings=s,this.updateNodes=a,this.updateBeforeNodes=l,this.updateAfterNodes=u,this.observer=h,this.usedTimes=0}createBindings(){const e=[];for(const t of this.bindings)if(t.bindings[0].groupNode.shared!==!0){const r=new gT(t.name,[],t.index,t);e.push(r);for(const s of t.bindings)r.bindings.push(s.clone())}else e.push(t);return e}}class n2{constructor(e,t,n=null){this.isNodeAttribute=!0,this.name=e,this.type=t,this.node=n}}class Lie{constructor(e,t,n){this.isNodeUniform=!0,this.name=e,this.type=t,this.node=n.getSelf()}get value(){return this.node.value}set value(e){this.node.value=e}get id(){return this.node.id}get groupNode(){return this.node.groupNode}}class LI{constructor(e,t,n=!1,r=null){this.isNodeVar=!0,this.name=e,this.type=t,this.readOnly=n,this.count=r}}class Uie extends LI{constructor(e,t,n=null,r=null){super(e,t),this.needsInterpolation=!1,this.isNodeVarying=!0,this.interpolationType=n,this.interpolationSampling=r}}class Oie{constructor(e,t,n=""){this.name=e,this.type=t,this.code=n,Object.defineProperty(this,"isNodeCode",{value:!0})}}let Bie=0;class Wb{constructor(e=null){this.id=Bie++,this.nodesData=new WeakMap,this.parent=e}getData(e){let t=this.nodesData.get(e);return t===void 0&&this.parent!==null&&(t=this.parent.getData(e)),t}setData(e,t){this.nodesData.set(e,t)}}class Iie{constructor(e,t){this.name=e,this.members=t,this.output=!1}}class xl{constructor(e,t){this.name=e,this.value=t,this.boundary=0,this.itemSize=0,this.offset=0}setValue(e){this.value=e}getValue(){return this.value}}class Fie extends xl{constructor(e,t=0){super(e,t),this.isNumberUniform=!0,this.boundary=4,this.itemSize=1}}class kie extends xl{constructor(e,t=new Le){super(e,t),this.isVector2Uniform=!0,this.boundary=8,this.itemSize=2}}class zie extends xl{constructor(e,t=new V){super(e,t),this.isVector3Uniform=!0,this.boundary=16,this.itemSize=3}}class Vie extends xl{constructor(e,t=new bt){super(e,t),this.isVector4Uniform=!0,this.boundary=16,this.itemSize=4}}class Gie extends xl{constructor(e,t=new ot){super(e,t),this.isColorUniform=!0,this.boundary=16,this.itemSize=3}}class Hie extends xl{constructor(e,t=new wv){super(e,t),this.isMatrix2Uniform=!0,this.boundary=8,this.itemSize=4}}class Wie extends xl{constructor(e,t=new Nt){super(e,t),this.isMatrix3Uniform=!0,this.boundary=48,this.itemSize=12}}class jie extends xl{constructor(e,t=new Wt){super(e,t),this.isMatrix4Uniform=!0,this.boundary=64,this.itemSize=16}}class qie extends Fie{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class $ie extends kie{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class Xie extends zie{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class Yie extends Vie{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class Kie extends Gie{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class Zie extends Hie{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class Qie extends Wie{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class Jie extends jie{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}const i2=new WeakMap,ere=new Map([[Int8Array,"int"],[Int16Array,"int"],[Int32Array,"int"],[Uint8Array,"uint"],[Uint16Array,"uint"],[Uint32Array,"uint"],[Float32Array,"float"]]),ay=i=>/e/g.test(i)?String(i).replace(/\+/g,""):(i=Number(i),i+(i%1?"":".0"));class UI{constructor(e,t,n){this.object=e,this.material=e&&e.material||null,this.geometry=e&&e.geometry||null,this.renderer=t,this.parser=n,this.scene=null,this.camera=null,this.nodes=[],this.sequentialNodes=[],this.updateNodes=[],this.updateBeforeNodes=[],this.updateAfterNodes=[],this.hashNodes={},this.observer=null,this.lightsNode=null,this.environmentNode=null,this.fogNode=null,this.clippingContext=null,this.vertexShader=null,this.fragmentShader=null,this.computeShader=null,this.flowNodes={vertex:[],fragment:[],compute:[]},this.flowCode={vertex:"",fragment:"",compute:""},this.uniforms={vertex:[],fragment:[],compute:[],index:0},this.structs={vertex:[],fragment:[],compute:[],index:0},this.bindings={vertex:{},fragment:{},compute:{}},this.bindingsIndexes={},this.bindGroups=null,this.attributes=[],this.bufferAttributes=[],this.varyings=[],this.codes={},this.vars={},this.declarations={},this.flow={code:""},this.chaining=[],this.stack=kb(),this.stacks=[],this.tab="	",this.currentFunctionNode=null,this.context={material:this.material},this.cache=new Wb,this.globalCache=this.cache,this.flowsData=new WeakMap,this.shaderStage=null,this.buildStage=null}getBindGroupsCache(){let e=i2.get(this.renderer);return e===void 0&&(e=new Gs,i2.set(this.renderer,e)),e}createRenderTarget(e,t,n){return new Nu(e,t,n)}createCubeRenderTarget(e,t){return new sI(e,t)}includes(e){return this.nodes.includes(e)}getOutputStructName(){}_getBindGroup(e,t){const n=this.getBindGroupsCache(),r=[];let s=!0;for(const l of t)r.push(l),s=s&&l.groupNode.shared!==!0;let a;return s?(a=n.get(r),a===void 0&&(a=new gT(e,r,this.bindingsIndexes[e].group,r),n.set(r,a))):a=new gT(e,r,this.bindingsIndexes[e].group,r),a}getBindGroupArray(e,t){const n=this.bindings[t];let r=n[e];return r===void 0&&(this.bindingsIndexes[e]===void 0&&(this.bindingsIndexes[e]={binding:0,group:Object.keys(this.bindingsIndexes).length}),n[e]=r=[]),r}getBindings(){let e=this.bindGroups;if(e===null){const t={},n=this.bindings;for(const r of QP)for(const s in n[r]){const a=n[r][s];(t[s]||(t[s]=[])).push(...a)}e=[];for(const r in t){const s=t[r],a=this._getBindGroup(r,s);e.push(a)}this.bindGroups=e}return e}sortBindingGroups(){const e=this.getBindings();e.sort((t,n)=>t.bindings[0].groupNode.order-n.bindings[0].groupNode.order);for(let t=0;t<e.length;t++){const n=e[t];this.bindingsIndexes[n.name].group=t,n.index=t}}setHashNode(e,t){this.hashNodes[t]=e}addNode(e){this.nodes.includes(e)===!1&&(this.nodes.push(e),this.setHashNode(e,e.getHash(this)))}addSequentialNode(e){this.sequentialNodes.includes(e)===!1&&this.sequentialNodes.push(e)}buildUpdateNodes(){for(const e of this.nodes)e.getUpdateType()!==Ht.NONE&&this.updateNodes.push(e.getSelf());for(const e of this.sequentialNodes){const t=e.getUpdateBeforeType(),n=e.getUpdateAfterType();t!==Ht.NONE&&this.updateBeforeNodes.push(e.getSelf()),n!==Ht.NONE&&this.updateAfterNodes.push(e.getSelf())}}get currentNode(){return this.chaining[this.chaining.length-1]}isFilteredTexture(e){return e.magFilter===Ti||e.magFilter===Qc||e.magFilter===eo||e.magFilter===Nr||e.minFilter===Ti||e.minFilter===Qc||e.minFilter===eo||e.minFilter===Nr}addChain(e){this.chaining.push(e)}removeChain(e){if(this.chaining.pop()!==e)throw new Error("NodeBuilder: Invalid node chaining!")}getMethod(e){return e}getNodeFromHash(e){return this.hashNodes[e]}addFlow(e,t){return this.flowNodes[e].push(t),t}setContext(e){this.context=e}getContext(){return this.context}getSharedContext(){return{...this.context},this.context}setCache(e){this.cache=e}getCache(){return this.cache}getCacheFromNode(e,t=!0){const n=this.getDataFromNode(e);return n.cache===void 0&&(n.cache=new Wb(t?this.getCache():null)),n.cache}isAvailable(){return!1}getVertexIndex(){console.warn("Abstract function.")}getInstanceIndex(){console.warn("Abstract function.")}getDrawIndex(){console.warn("Abstract function.")}getFrontFacing(){console.warn("Abstract function.")}getFragCoord(){console.warn("Abstract function.")}isFlipY(){return!1}increaseUsage(e){const t=this.getDataFromNode(e);return t.usageCount=t.usageCount===void 0?1:t.usageCount+1,t.usageCount}generateTexture(){console.warn("Abstract function.")}generateTextureLod(){console.warn("Abstract function.")}generateArrayDeclaration(e,t){return this.getType(e)+"[ "+t+" ]"}generateArray(e,t,n=null){let r=this.generateArrayDeclaration(e,t)+"( ";for(let s=0;s<t;s++){const a=n?n[s]:null;a!==null?r+=a.build(this,e):r+=this.generateConst(e),s<t-1&&(r+=", ")}return r+=" )",r}generateStruct(e,t,n=null){const r=[];for(const s of t){const{name:a,type:l}=s;n&&n[a]&&n[a].isNode?r.push(n[a].build(this,l)):r.push(this.generateConst(l))}return e+"( "+r.join(", ")+" )"}generateConst(e,t=null){if(t===null&&(e==="float"||e==="int"||e==="uint"?t=0:e==="bool"?t=!1:e==="color"?t=new ot:e==="vec2"?t=new Le:e==="vec3"?t=new V:e==="vec4"&&(t=new bt)),e==="float")return ay(t);if(e==="int")return`${Math.round(t)}`;if(e==="uint")return t>=0?`${Math.round(t)}u`:"0u";if(e==="bool")return t?"true":"false";if(e==="color")return`${this.getType("vec3")}( ${ay(t.r)}, ${ay(t.g)}, ${ay(t.b)} )`;const n=this.getTypeLength(e),r=this.getComponentType(e),s=a=>this.generateConst(r,a);if(n===2)return`${this.getType(e)}( ${s(t.x)}, ${s(t.y)} )`;if(n===3)return`${this.getType(e)}( ${s(t.x)}, ${s(t.y)}, ${s(t.z)} )`;if(n===4&&e!=="mat2")return`${this.getType(e)}( ${s(t.x)}, ${s(t.y)}, ${s(t.z)}, ${s(t.w)} )`;if(n>=4&&t&&(t.isMatrix2||t.isMatrix3||t.isMatrix4))return`${this.getType(e)}( ${t.elements.map(s).join(", ")} )`;if(n>4)return`${this.getType(e)}()`;throw new Error(`NodeBuilder: Type '${e}' not found in generate constant attempt.`)}getType(e){return e==="color"?"vec3":e}hasGeometryAttribute(e){return this.geometry&&this.geometry.getAttribute(e)!==void 0}getAttribute(e,t){const n=this.attributes;for(const s of n)if(s.name===e)return s;const r=new n2(e,t);return this.registerDeclaration(r),n.push(r),r}getPropertyName(e){return e.name}isVector(e){return/vec\d/.test(e)}isMatrix(e){return/mat\d/.test(e)}isReference(e){return e==="void"||e==="property"||e==="sampler"||e==="samplerComparison"||e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="depthTexture"||e==="texture3D"}needsToWorkingColorSpace(){return!1}getComponentTypeFromTexture(e){const t=e.type;if(e.isDataTexture){if(t===Li)return"int";if(t===En)return"uint"}return"float"}getElementType(e){return e==="mat2"?"vec2":e==="mat3"?"vec3":e==="mat4"?"vec4":this.getComponentType(e)}getComponentType(e){if(e=this.getVectorType(e),e==="float"||e==="bool"||e==="int"||e==="uint")return e;const t=/(b|i|u|)(vec|mat)([2-4])/.exec(e);return t===null?null:t[1]==="b"?"bool":t[1]==="i"?"int":t[1]==="u"?"uint":"float"}getVectorType(e){return e==="color"?"vec3":e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="texture3D"?"vec4":e}getTypeFromLength(e,t="float"){if(e===1)return t;let n=xK(e);const r=t==="float"?"":t[0];return/mat2/.test(t)===!0&&(n=n.replace("vec","mat")),r+n}getTypeFromArray(e){return ere.get(e.constructor)}isInteger(e){return/int|uint|(i|u)vec/.test(e)}getTypeFromAttribute(e){let t=e;e.isInterleavedBufferAttribute&&(t=e.data);const n=t.array,r=e.itemSize,s=e.normalized;let a;return!(e instanceof iO)&&s!==!0&&(a=this.getTypeFromArray(n)),this.getTypeFromLength(r,a)}getTypeLength(e){const t=this.getVectorType(e),n=/vec([2-4])/.exec(t);return n!==null?Number(n[1]):t==="float"||t==="bool"||t==="int"||t==="uint"?1:/mat2/.test(e)===!0?4:/mat3/.test(e)===!0?9:/mat4/.test(e)===!0?16:0}getVectorFromMatrix(e){return e.replace("mat","vec")}changeComponentType(e,t){return this.getTypeFromLength(this.getTypeLength(e),t)}getIntegerType(e){const t=this.getComponentType(e);return t==="int"||t==="uint"?e:this.changeComponentType(e,"int")}addStack(){return this.stack=kb(this.stack),this.stacks.push(hB()||this.stack),tv(this.stack),this.stack}removeStack(){const e=this.stack;return this.stack=e.parent,tv(this.stacks.pop()),e}getDataFromNode(e,t=this.shaderStage,n=null){n=n===null?e.isGlobal(this)?this.globalCache:this.cache:n;let r=n.getData(e);return r===void 0&&(r={},n.setData(e,r)),r[t]===void 0&&(r[t]={}),r[t]}getNodeProperties(e,t="any"){const n=this.getDataFromNode(e,t);return n.properties||(n.properties={outputNode:null})}getBufferAttributeFromNode(e,t){const n=this.getDataFromNode(e);let r=n.bufferAttribute;if(r===void 0){const s=this.uniforms.index++;r=new n2("nodeAttribute"+s,t,e),this.bufferAttributes.push(r),n.bufferAttribute=r}return r}getStructTypeFromNode(e,t,n=null,r=this.shaderStage){const s=this.getDataFromNode(e,r,this.globalCache);let a=s.structType;if(a===void 0){const l=this.structs.index++;n===null&&(n="StructType"+l),a=new Iie(n,t),this.structs[r].push(a),s.structType=a}return a}getOutputStructTypeFromNode(e,t){const n=this.getStructTypeFromNode(e,t,"OutputType","fragment");return n.output=!0,n}getUniformFromNode(e,t,n=this.shaderStage,r=null){const s=this.getDataFromNode(e,n,this.globalCache);let a=s.uniform;if(a===void 0){const l=this.uniforms.index++;a=new Lie(r||"nodeUniform"+l,t,e),this.uniforms[n].push(a),this.registerDeclaration(a),s.uniform=a}return a}getArrayCount(e){let t=null;return e.isArrayNode?t=e.count:e.isVarNode&&e.node.isArrayNode&&(t=e.node.count),t}getVarFromNode(e,t=null,n=e.getNodeType(this),r=this.shaderStage,s=!1){const a=this.getDataFromNode(e,r);let l=a.variable;if(l===void 0){const u=s?"_const":"_var",h=this.vars[r]||(this.vars[r]=[]),d=this.vars[u]||(this.vars[u]=0);t===null&&(t=(s?"nodeConst":"nodeVar")+d,this.vars[u]++);const p=this.getArrayCount(e);l=new LI(t,n,s,p),s||h.push(l),this.registerDeclaration(l),a.variable=l}return l}isDeterministic(e){if(e.isMathNode)return this.isDeterministic(e.aNode)&&(e.bNode?this.isDeterministic(e.bNode):!0)&&(e.cNode?this.isDeterministic(e.cNode):!0);if(e.isOperatorNode)return this.isDeterministic(e.aNode)&&(e.bNode?this.isDeterministic(e.bNode):!0);if(e.isArrayNode){if(e.values!==null){for(const t of e.values)if(!this.isDeterministic(t))return!1}return!0}else if(e.isConstNode)return!0;return!1}getVaryingFromNode(e,t=null,n=e.getNodeType(this),r=null,s=null){const a=this.getDataFromNode(e,"any");let l=a.varying;if(l===void 0){const u=this.varyings,h=u.length;t===null&&(t="nodeVarying"+h),l=new Uie(t,n,r,s),u.push(l),this.registerDeclaration(l),a.varying=l}return l}get namespace(){return this.context.namespace}getOutputNamespace(){return this.getNamespace("outputNode")}getNamespace(e=""){const t=this.namespace;let n;return t?n=e?t+"_"+e:t:n=e,n}registerDeclaration(e){const t=this.shaderStage,n=this.declarations[t]||(this.declarations[t]={}),r=this.getPropertyName(e);let s=1,a=r;for(;n[a]!==void 0;)a=r+"_"+s++;s>1&&(e.name=a,console.warn(`THREE.TSL: Declaration name '${r}' of '${e.type}' already in use. Renamed to '${a}'.`)),n[a]=e}getCodeFromNode(e,t,n=this.shaderStage){const r=this.getDataFromNode(e);let s=r.code;if(s===void 0){const a=this.codes[n]||(this.codes[n]=[]),l=a.length;s=new Oie("nodeCode"+l,t),a.push(s),r.code=s}return s}addFlowCodeHierarchy(e,t){const{flowCodes:n,flowCodeBlock:r}=this.getDataFromNode(e);let s=!0,a=t;for(;a;){if(r.get(a)===!0){s=!1;break}a=this.getDataFromNode(a).parentNodeBlock}if(s)for(const l of n)this.addLineFlowCode(l)}addLineFlowCodeBlock(e,t,n){const r=this.getDataFromNode(e),s=r.flowCodes||(r.flowCodes=[]),a=r.flowCodeBlock||(r.flowCodeBlock=new WeakMap);s.push(t),a.set(n,!0)}addLineFlowCode(e,t=null){return e===""?this:(t!==null&&this.context.nodeBlock&&this.addLineFlowCodeBlock(t,e,this.context.nodeBlock),e=this.tab+e,/;\s*$/.test(e)||(e=e+`;
`),this.flow.code+=e,this)}addFlowCode(e){return this.flow.code+=e,this}addFlowTab(){return this.tab+="	",this}removeFlowTab(){return this.tab=this.tab.slice(0,-1),this}getFlowData(e){return this.flowsData.get(e)}flowNode(e){const t=e.getNodeType(this),n=this.flowChildNode(e,t);return this.flowsData.set(e,n),n}addInclude(e){this.currentFunctionNode!==null&&this.currentFunctionNode.includes.push(e)}buildFunctionNode(e){const t=new qne,n=this.currentFunctionNode;return this.currentFunctionNode=t,t.code=this.buildFunctionCode(e),this.currentFunctionNode=n,t}flowShaderNode(e){const t=e.layout,n={[Symbol.iterator](){let a=0;const l=Object.values(this);return{next:()=>({value:l[a],done:a++>=l.length})}}};for(const a of t.inputs)n[a.name]=new Ene(a.type,a.name);e.layout=null;const r=e.call(n),s=this.flowStagesNode(r,t.type);return e.layout=t,s}flowStagesNode(e,t=null){const n=this.flow,r=this.vars,s=this.declarations,a=this.cache,l=this.buildStage,u=this.stack,h={code:""};this.flow=h,this.vars={},this.declarations={},this.cache=new Wb,this.stack=kb();for(const d of ZP)this.setBuildStage(d),h.result=e.build(this,t);return h.vars=this.getVars(this.shaderStage),this.flow=n,this.vars=r,this.declarations=s,this.cache=a,this.stack=u,this.setBuildStage(l),h}getFunctionOperator(){return null}buildFunctionCode(){console.warn("Abstract function.")}flowChildNode(e,t=null){const n=this.flow,r={code:""};return this.flow=r,r.result=e.build(this,t),this.flow=n,r}flowNodeFromShaderStage(e,t,n=null,r=null){const s=this.tab,a=this.cache,l=this.shaderStage,u=this.context;this.setShaderStage(e);const h={...this.context};delete h.nodeBlock,this.cache=this.globalCache,this.tab="	",this.context=h;let d=null;if(this.buildStage==="generate"){const p=this.flowChildNode(t,n);r!==null&&(p.code+=`${this.tab+r} = ${p.result};
`),this.flowCode[e]=this.flowCode[e]+p.code,d=p}else d=t.build(this);return this.setShaderStage(l),this.cache=a,this.tab=s,this.context=u,d}getAttributesArray(){return this.attributes.concat(this.bufferAttributes)}getAttributes(){console.warn("Abstract function.")}getVaryings(){console.warn("Abstract function.")}getVar(e,t,n=null){return`${n!==null?this.generateArrayDeclaration(e,n):this.getType(e)} ${t}`}getVars(e){let t="";const n=this.vars[e];if(n!==void 0)for(const r of n)t+=`${this.getVar(r.type,r.name)}; `;return t}getUniforms(){console.warn("Abstract function.")}getCodes(e){const t=this.codes[e];let n="";if(t!==void 0)for(const r of t)n+=r.code+`
`;return n}getHash(){return this.vertexShader+this.fragmentShader+this.computeShader}setShaderStage(e){this.shaderStage=e}getShaderStage(){return this.shaderStage}setBuildStage(e){this.buildStage=e}getBuildStage(){return this.buildStage}buildCode(){console.warn("Abstract function.")}build(){const{object:e,material:t,renderer:n}=this;if(t!==null){let r=n.library.fromMaterial(t);r===null&&(console.error(`NodeMaterial: Material "${t.type}" is not compatible.`),r=new pi),r.build(this)}else this.addFlow("compute",e);for(const r of ZP){this.setBuildStage(r),this.context.vertex&&this.context.vertex.isNode&&this.flowNodeFromShaderStage("vertex",this.context.vertex);for(const s of QP){this.setShaderStage(s);const a=this.flowNodes[s];for(const l of a)r==="generate"?this.flowNode(l):l.build(this)}}return this.setBuildStage(null),this.setShaderStage(null),this.buildCode(),this.buildUpdateNodes(),this}getNodeUniform(e,t){if(t==="float"||t==="int"||t==="uint")return new qie(e);if(t==="vec2"||t==="ivec2"||t==="uvec2")return new $ie(e);if(t==="vec3"||t==="ivec3"||t==="uvec3")return new Xie(e);if(t==="vec4"||t==="ivec4"||t==="uvec4")return new Yie(e);if(t==="color")return new Kie(e);if(t==="mat2")return new Zie(e);if(t==="mat3")return new Qie(e);if(t==="mat4")return new Jie(e);throw new Error(`Uniform "${t}" not declared.`)}format(e,t,n){if(t=this.getVectorType(t),n=this.getVectorType(n),t===n||n===null||this.isReference(n))return e;const r=this.getTypeLength(t),s=this.getTypeLength(n);return r===16&&s===9?`${this.getType(n)}( ${e}[ 0 ].xyz, ${e}[ 1 ].xyz, ${e}[ 2 ].xyz )`:r===9&&s===4?`${this.getType(n)}( ${e}[ 0 ].xy, ${e}[ 1 ].xy )`:r>4||s>4||s===0?e:r===s?`${this.getType(n)}( ${e} )`:r>s?(e=n==="bool"?`all( ${e} )`:`${e}.${"xyz".slice(0,s)}`,this.format(e,this.getTypeFromLength(s,this.getComponentType(t)),n)):s===4&&r>1?`${this.getType(n)}( ${this.format(e,t,"vec3")}, 1.0 )`:r===2?`${this.getType(n)}( ${this.format(e,t,"vec2")}, 0.0 )`:(r===1&&s>1&&t!==this.getComponentType(n)&&(e=`${this.getType(this.getComponentType(n))}( ${e} )`),`${this.getType(n)}( ${e} )`)}getSignature(){return`// Three.js r${Hh} - Node System
`}*[Symbol.iterator](){}createNodeMaterial(e="NodeMaterial"){throw new Error(`THREE.NodeBuilder: createNodeMaterial() was deprecated. Use new ${e}() instead.`)}}class r2{constructor(){this.time=0,this.deltaTime=0,this.frameId=0,this.renderId=0,this.updateMap=new WeakMap,this.updateBeforeMap=new WeakMap,this.updateAfterMap=new WeakMap,this.renderer=null,this.material=null,this.camera=null,this.object=null,this.scene=null}_getMaps(e,t){let n=e.get(t);return n===void 0&&(n={renderMap:new WeakMap,frameMap:new WeakMap},e.set(t,n)),n}updateBeforeNode(e){const t=e.getUpdateBeforeType(),n=e.updateReference(this);if(t===Ht.FRAME){const{frameMap:r}=this._getMaps(this.updateBeforeMap,n);r.get(n)!==this.frameId&&e.updateBefore(this)!==!1&&r.set(n,this.frameId)}else if(t===Ht.RENDER){const{renderMap:r}=this._getMaps(this.updateBeforeMap,n);r.get(n)!==this.renderId&&e.updateBefore(this)!==!1&&r.set(n,this.renderId)}else t===Ht.OBJECT&&e.updateBefore(this)}updateAfterNode(e){const t=e.getUpdateAfterType(),n=e.updateReference(this);if(t===Ht.FRAME){const{frameMap:r}=this._getMaps(this.updateAfterMap,n);r.get(n)!==this.frameId&&e.updateAfter(this)!==!1&&r.set(n,this.frameId)}else if(t===Ht.RENDER){const{renderMap:r}=this._getMaps(this.updateAfterMap,n);r.get(n)!==this.renderId&&e.updateAfter(this)!==!1&&r.set(n,this.renderId)}else t===Ht.OBJECT&&e.updateAfter(this)}updateNode(e){const t=e.getUpdateType(),n=e.updateReference(this);if(t===Ht.FRAME){const{frameMap:r}=this._getMaps(this.updateMap,n);r.get(n)!==this.frameId&&e.update(this)!==!1&&r.set(n,this.frameId)}else if(t===Ht.RENDER){const{renderMap:r}=this._getMaps(this.updateMap,n);r.get(n)!==this.renderId&&e.update(this)!==!1&&r.set(n,this.renderId)}else t===Ht.OBJECT&&e.update(this)}update(){this.frameId++,this.lastTime===void 0&&(this.lastTime=performance.now()),this.deltaTime=(performance.now()-this.lastTime)/1e3,this.lastTime=performance.now(),this.time+=this.deltaTime}}class kE{constructor(e,t,n=null,r="",s=!1){this.type=e,this.name=t,this.count=n,this.qualifier=r,this.isConst=s}}kE.isNodeFunctionInput=!0;class tre extends Uu{static get type(){return"DirectionalLightNode"}constructor(e=null){super(e)}setupDirect(){const e=this.colorNode;return{lightDirection:RI(this.light),lightColor:e}}}const jb=new Wt,oy=new Wt;let xd=null;class nre extends Uu{static get type(){return"RectAreaLightNode"}constructor(e=null){super(e),this.halfHeight=Et(new V).setGroup(Mt),this.halfWidth=Et(new V).setGroup(Mt),this.updateType=Ht.RENDER}update(e){super.update(e);const{light:t}=this,n=e.camera.matrixWorldInverse;oy.identity(),jb.copy(t.matrixWorld),jb.premultiply(n),oy.extractRotation(jb),this.halfWidth.value.set(t.width*.5,0,0),this.halfHeight.value.set(0,t.height*.5,0),this.halfWidth.value.applyMatrix4(oy),this.halfHeight.value.applyMatrix4(oy)}setupDirectRectArea(e){let t,n;e.isAvailable("float32Filterable")?(t=nn(xd.LTC_FLOAT_1),n=nn(xd.LTC_FLOAT_2)):(t=nn(xd.LTC_HALF_1),n=nn(xd.LTC_HALF_2));const{colorNode:r,light:s}=this,a=wI(s);return{lightColor:r,lightPosition:a,halfWidth:this.halfWidth,halfHeight:this.halfHeight,ltc_1:t,ltc_2:n}}static setLTC(e){xd=e}}class zE extends Uu{static get type(){return"SpotLightNode"}constructor(e=null){super(e),this.coneCosNode=Et(0).setGroup(Mt),this.penumbraCosNode=Et(0).setGroup(Mt),this.cutoffDistanceNode=Et(0).setGroup(Mt),this.decayExponentNode=Et(0).setGroup(Mt),this.colorNode=Et(this.color).setGroup(Mt)}update(e){super.update(e);const{light:t}=this;this.coneCosNode.value=Math.cos(t.angle),this.penumbraCosNode.value=Math.cos(t.angle*(1-t.penumbra)),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}getSpotAttenuation(e,t){const{coneCosNode:n,penumbraCosNode:r}=this;return pl(n,r,t)}getLightCoord(e){const t=e.getNodeProperties(this);let n=t.projectionUV;return n===void 0&&(n=Kne(this.light,e.context.positionWorld),t.projectionUV=n),n}setupDirect(e){const{colorNode:t,cutoffDistanceNode:n,decayExponentNode:r,light:s}=this,a=this.getLightVector(e),l=a.normalize(),u=l.dot(RI(s)),h=this.getSpotAttenuation(e,u),d=a.length(),p=DI({lightDistance:d,cutoffDistance:n,decayExponent:r});let g=t.mul(h).mul(p),y,v;return s.colorNode?(v=this.getLightCoord(e),y=s.colorNode(v)):s.map&&(v=this.getLightCoord(e),y=nn(s.map,v.xy).onRenderUpdate(()=>s.map)),y&&(g=v.mul(2).sub(1).abs().lessThan(1).all().select(g.mul(y),g)),{lightColor:g,lightDirection:l}}}class ire extends zE{static get type(){return"IESSpotLightNode"}getSpotAttenuation(e,t){const n=this.light.iesMap;let r=null;if(n&&n.isTexture===!0){const s=t.acos().mul(1/Math.PI);r=nn(n,We(s,0),0).r}else r=super.getSpotAttenuation(t);return r}}const rre=Ue(([i,e])=>{const t=i.abs().sub(e);return lo(sr(t,0)).add(Uh(sr(t.x,t.y),0))});class sre extends zE{static get type(){return"ProjectorLightNode"}update(e){super.update(e);const t=this.light;if(this.penumbraCosNode.value=Math.min(Math.cos(t.angle*(1-t.penumbra)),.99999),t.aspect===null){let n=1;t.map!==null&&(n=t.map.width/t.map.height),t.shadow.aspect=n}else t.shadow.aspect=t.aspect}getSpotAttenuation(e){const t=this.penumbraCosNode,n=this.getLightCoord(e),r=n.xyz.div(n.w),s=rre(r.xy.sub(We(.5)),We(.5)),a=pa(-1,hr(1,MB(t)).sub(1));return DB(s.mul(-2).mul(a))}}class are extends Uu{static get type(){return"AmbientLightNode"}constructor(e=null){super(e)}setup({context:e}){e.irradiance.addAssign(this.colorNode)}}class ore extends Uu{static get type(){return"HemisphereLightNode"}constructor(e=null){super(e),this.lightPositionNode=AI(e),this.lightDirectionNode=this.lightPositionNode.normalize(),this.groundColorNode=Et(new ot).setGroup(Mt)}update(e){const{light:t}=this;super.update(e),this.lightPositionNode.object3d=t,this.groundColorNode.value.copy(t.groundColor).multiplyScalar(t.intensity)}setup(e){const{colorNode:t,groundColorNode:n,lightDirectionNode:r}=this,a=CE.dot(r).mul(.5).add(.5),l=Dn(n,t,a);e.context.irradiance.addAssign(l)}}class lre extends Uu{static get type(){return"LightProbeNode"}constructor(e=null){super(e);const t=[];for(let n=0;n<9;n++)t.push(new V);this.lightProbe=ia(t)}update(e){const{light:t}=this;super.update(e);for(let n=0;n<9;n++)this.lightProbe.array[n].copy(t.sh.coefficients[n]).multiplyScalar(t.intensity)}setup(e){const t=Cie(CE,this.lightProbe);e.context.irradiance.addAssign(t)}}class OI{parseFunction(){console.warn("Abstract function.")}}class VE{constructor(e,t,n="",r=""){this.type=e,this.inputs=t,this.name=n,this.precision=r}getCode(){console.warn("Abstract function.")}}VE.isNodeFunction=!0;const ure=/^\s*(highp|mediump|lowp)?\s*([a-z_0-9]+)\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)/i,cre=/[a-z_0-9]+/ig,s2="#pragma main",hre=i=>{i=i.trim();const e=i.indexOf(s2),t=e!==-1?i.slice(e+s2.length):i,n=t.match(ure);if(n!==null&&n.length===5){const r=n[4],s=[];let a=null;for(;(a=cre.exec(r))!==null;)s.push(a);const l=[];let u=0;for(;u<s.length;){const v=s[u][0]==="const";v===!0&&u++;let S=s[u][0];S==="in"||S==="out"||S==="inout"?u++:S="";const b=s[u++][0];let _=Number.parseInt(s[u][0]);Number.isNaN(_)===!1?u++:_=null;const E=s[u++][0];l.push(new kE(b,E,_,S,v))}const h=t.substring(n[0].length),d=n[3]!==void 0?n[3]:"",p=n[2],g=n[1]!==void 0?n[1]:"",y=e!==-1?i.slice(0,e):"";return{type:p,inputs:l,name:d,precision:g,inputsCode:r,blockCode:h,headerCode:y}}else throw new Error("FunctionNode: Function is not a GLSL code.")};class fre extends VE{constructor(e){const{type:t,inputs:n,name:r,precision:s,inputsCode:a,blockCode:l,headerCode:u}=hre(e);super(t,n,r,s),this.inputsCode=a,this.blockCode=l,this.headerCode=u}getCode(e=this.name){let t;const n=this.blockCode;if(n!==""){const{type:r,inputsCode:s,headerCode:a,precision:l}=this;let u=`${r} ${e} ( ${s.trim()} )`;l!==""&&(u=`${l} ${u}`),t=a+u+n}else t="";return t}}class dre extends OI{parseFunction(e){return new fre(e)}}const a2=new WeakMap,Qs=[],Kl=[];class pre extends _l{constructor(e,t){super(),this.renderer=e,this.backend=t,this.nodeFrame=new r2,this.nodeBuilderCache=new Map,this.callHashCache=new Gs,this.groupsData=new Gs,this.cacheLib={}}updateGroup(e){const t=e.groupNode,n=t.name;if(n===xB.name)return!0;if(n===Mt.name){const s=this.get(e),a=this.nodeFrame.renderId;return s.renderId!==a?(s.renderId=a,!0):!1}if(n===iZ.name){const s=this.get(e),a=this.nodeFrame.frameId;return s.frameId!==a?(s.frameId=a,!0):!1}Qs[0]=t,Qs[1]=e;let r=this.groupsData.get(Qs);return r===void 0&&this.groupsData.set(Qs,r={}),Qs.length=0,r.version!==t.version?(r.version=t.version,!0):!1}getForRenderCacheKey(e){return e.initialCacheKey}getForRender(e){const t=this.get(e);let n=t.nodeBuilderState;if(n===void 0){const{nodeBuilderCache:r}=this,s=this.getForRenderCacheKey(e);if(n=r.get(s),n===void 0){const a=this.backend.createNodeBuilder(e.object,this.renderer);a.scene=e.scene,a.material=e.material,a.camera=e.camera,a.context.material=e.material,a.lightsNode=e.lightsNode,a.environmentNode=this.getEnvironmentNode(e.scene),a.fogNode=this.getFogNode(e.scene),a.clippingContext=e.clippingContext,this.renderer.getOutputRenderTarget()&&this.renderer.getOutputRenderTarget().multiview&&a.enableMultiview(),a.build(),n=this._createNodeBuilderState(a),r.set(s,n)}n.usedTimes++,t.nodeBuilderState=n}return n}delete(e){if(e.isRenderObject){const t=this.get(e).nodeBuilderState;t.usedTimes--,t.usedTimes===0&&this.nodeBuilderCache.delete(this.getForRenderCacheKey(e))}return super.delete(e)}getForCompute(e){const t=this.get(e);let n=t.nodeBuilderState;if(n===void 0){const r=this.backend.createNodeBuilder(e,this.renderer);r.build(),n=this._createNodeBuilderState(r),t.nodeBuilderState=n}return n}_createNodeBuilderState(e){return new Die(e.vertexShader,e.fragmentShader,e.computeShader,e.getAttributesArray(),e.getBindings(),e.updateNodes,e.updateBeforeNodes,e.updateAfterNodes,e.observer,e.transforms)}getEnvironmentNode(e){this.updateEnvironment(e);let t=null;if(e.environmentNode&&e.environmentNode.isNode)t=e.environmentNode;else{const n=this.get(e);n.environmentNode&&(t=n.environmentNode)}return t}getBackgroundNode(e){this.updateBackground(e);let t=null;if(e.backgroundNode&&e.backgroundNode.isNode)t=e.backgroundNode;else{const n=this.get(e);n.backgroundNode&&(t=n.backgroundNode)}return t}getFogNode(e){return this.updateFog(e),e.fogNode||this.get(e).fogNode||null}getCacheKey(e,t){Qs[0]=e,Qs[1]=t;const n=this.renderer.info.calls,r=this.callHashCache.get(Qs)||{};if(r.callId!==n){const s=this.getEnvironmentNode(e),a=this.getFogNode(e);t&&Kl.push(t.getCacheKey(!0)),s&&Kl.push(s.getCacheKey()),a&&Kl.push(a.getCacheKey()),Kl.push(this.renderer.getOutputRenderTarget()&&this.renderer.getOutputRenderTarget().multiview?1:0),Kl.push(this.renderer.shadowMap.enabled?1:0),r.callId=n,r.cacheKey=cE(Kl),this.callHashCache.set(Qs,r),Kl.length=0}return Qs.length=0,r.cacheKey}get isToneMappingState(){return!this.renderer.getRenderTarget()}updateBackground(e){const t=this.get(e),n=e.background;if(n){const r=e.backgroundBlurriness===0&&t.backgroundBlurriness>0||e.backgroundBlurriness>0&&t.backgroundBlurriness===0;if(t.background!==n||r){const s=this.getCacheNode("background",n,()=>{if(n.isCubeTexture===!0||n.mapping===hh||n.mapping===fh||n.mapping===Su){if(e.backgroundBlurriness>0||n.mapping===Su)return yI(n);{let a;return n.isCubeTexture===!0?a=Np(n):a=nn(n),oI(a)}}else{if(n.isTexture===!0)return nn(n,sh.flipY()).setUpdateMatrix(!0);n.isColor!==!0&&console.error("WebGPUNodes: Unsupported background configuration.",n)}},r);t.backgroundNode=s,t.background=n,t.backgroundBlurriness=e.backgroundBlurriness}}else t.backgroundNode&&(delete t.backgroundNode,delete t.background)}getCacheNode(e,t,n,r=!1){const s=this.cacheLib[e]||(this.cacheLib[e]=new WeakMap);let a=s.get(t);return(a===void 0||r)&&(a=n(),s.set(t,a)),a}updateFog(e){const t=this.get(e),n=e.fog;if(n){if(t.fog!==n){const r=this.getCacheNode("fog",n,()=>{if(n.isFogExp2){const s=Mn("color","color",n).setGroup(Mt),a=Mn("density","float",n).setGroup(Mt);return QD(s,Xne(a))}else if(n.isFog){const s=Mn("color","color",n).setGroup(Mt),a=Mn("near","float",n).setGroup(Mt),l=Mn("far","float",n).setGroup(Mt);return QD(s,$ne(a,l))}else console.error("THREE.Renderer: Unsupported fog configuration.",n)});t.fogNode=r,t.fog=n}}else delete t.fogNode,delete t.fog}updateEnvironment(e){const t=this.get(e),n=e.environment;if(n){if(t.environment!==n){const r=this.getCacheNode("environment",n,()=>{if(n.isCubeTexture===!0)return Np(n);if(n.isTexture===!0)return nn(n);console.error("Nodes: Unsupported environment configuration.",n)});t.environmentNode=r,t.environment=n}}else t.environmentNode&&(delete t.environmentNode,delete t.environment)}getNodeFrame(e=this.renderer,t=null,n=null,r=null,s=null){const a=this.nodeFrame;return a.renderer=e,a.scene=t,a.object=n,a.camera=r,a.material=s,a}getNodeFrameForRender(e){return this.getNodeFrame(e.renderer,e.scene,e.object,e.camera,e.material)}getOutputCacheKey(){const e=this.renderer;return e.toneMapping+","+e.currentColorSpace+","+e.xr.isPresenting}hasOutputChange(e){return a2.get(e)!==this.getOutputCacheKey()}getOutputNode(e){const t=this.renderer,n=this.getOutputCacheKey(),r=e.isArrayTexture?Une(e,Ee(sh,kv("gl_ViewID_OVR"))).renderOutput(t.toneMapping,t.currentColorSpace):nn(e,sh).renderOutput(t.toneMapping,t.currentColorSpace);return a2.set(e,n),r}updateBefore(e){const t=e.getNodeBuilderState();for(const n of t.updateBeforeNodes)this.getNodeFrameForRender(e).updateBeforeNode(n)}updateAfter(e){const t=e.getNodeBuilderState();for(const n of t.updateAfterNodes)this.getNodeFrameForRender(e).updateAfterNode(n)}updateForCompute(e){const t=this.getNodeFrame(),n=this.getForCompute(e);for(const r of n.updateNodes)t.updateNode(r)}updateForRender(e){const t=this.getNodeFrameForRender(e),n=e.getNodeBuilderState();for(const r of n.updateNodes)t.updateNode(r)}needsRefresh(e){const t=this.getNodeFrameForRender(e);return e.getMonitor().needsRefresh(e,t)}dispose(){super.dispose(),this.nodeFrame=new r2,this.nodeBuilderCache=new Map,this.cacheLib={}}}const qb=new Bs;class ov{constructor(e=null){this.version=0,this.clipIntersection=null,this.cacheKey="",this.shadowPass=!1,this.viewNormalMatrix=new Nt,this.clippingGroupContexts=new WeakMap,this.intersectionPlanes=[],this.unionPlanes=[],this.parentVersion=null,e!==null&&(this.viewNormalMatrix=e.viewNormalMatrix,this.clippingGroupContexts=e.clippingGroupContexts,this.shadowPass=e.shadowPass,this.viewMatrix=e.viewMatrix)}projectPlanes(e,t,n){const r=e.length;for(let s=0;s<r;s++){qb.copy(e[s]).applyMatrix4(this.viewMatrix,this.viewNormalMatrix);const a=t[n+s],l=qb.normal;a.x=-l.x,a.y=-l.y,a.z=-l.z,a.w=qb.constant}}updateGlobal(e,t){this.shadowPass=e.overrideMaterial!==null&&e.overrideMaterial.isShadowPassMaterial,this.viewMatrix=t.matrixWorldInverse,this.viewNormalMatrix.getNormalMatrix(this.viewMatrix)}update(e,t){let n=!1;e.version!==this.parentVersion&&(this.intersectionPlanes=Array.from(e.intersectionPlanes),this.unionPlanes=Array.from(e.unionPlanes),this.parentVersion=e.version),this.clipIntersection!==t.clipIntersection&&(this.clipIntersection=t.clipIntersection,this.clipIntersection?this.unionPlanes.length=e.unionPlanes.length:this.intersectionPlanes.length=e.intersectionPlanes.length);const r=t.clippingPlanes,s=r.length;let a,l;if(this.clipIntersection?(a=this.intersectionPlanes,l=e.intersectionPlanes.length):(a=this.unionPlanes,l=e.unionPlanes.length),a.length!==l+s){a.length=l+s;for(let u=0;u<s;u++)a[l+u]=new bt;n=!0}this.projectPlanes(r,a,l),n&&(this.version++,this.cacheKey=`${this.intersectionPlanes.length}:${this.unionPlanes.length}`)}getGroupContext(e){if(this.shadowPass&&!e.clipShadows)return this;let t=this.clippingGroupContexts.get(e);return t===void 0&&(t=new ov(this),this.clippingGroupContexts.set(e,t)),t.update(this,e),t}get unionClippingCount(){return this.unionPlanes.length}}class mre{constructor(e,t){this.bundleGroup=e,this.camera=t}}const bd=[];class gre{constructor(){this.bundles=new Gs}get(e,t){const n=this.bundles;bd[0]=e,bd[1]=t;let r=n.get(bd);return r===void 0&&(r=new mre(e,t),n.set(bd,r)),bd.length=0,r}dispose(){this.bundles=new Gs}}class BI{constructor(){this.lightNodes=new WeakMap,this.materialNodes=new Map,this.toneMappingNodes=new Map}fromMaterial(e){if(e.isNodeMaterial)return e;let t=null;const n=this.getMaterialNodeClass(e.type);if(n!==null){t=new n;for(const r in e)t[r]=e[r]}return t}addToneMapping(e,t){this.addType(e,t,this.toneMappingNodes)}getToneMappingFunction(e){return this.toneMappingNodes.get(e)||null}getMaterialNodeClass(e){return this.materialNodes.get(e)||null}addMaterial(e,t){this.addType(e,t,this.materialNodes)}getLightNodeClass(e){return this.lightNodes.get(e)||null}addLight(e,t){this.addClass(e,t,this.lightNodes)}addType(e,t,n){if(n.has(t)){console.warn(`Redefinition of node ${t}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof t=="function"||typeof t=="object")throw new Error(`Base class ${t} is not a class.`);n.set(t,e)}addClass(e,t,n){if(n.has(t)){console.warn(`Redefinition of node ${t.name}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof t!="function")throw new Error(`Base class ${t.name} is not a class.`);n.set(t,e)}}const yre=new CI,Sd=[];class vre extends Gs{constructor(){super()}createNode(e=[]){return new CI().setLights(e)}getNode(e,t){if(e.isQuadMesh)return yre;Sd[0]=e,Sd[1]=t;let n=this.get(Sd);return n===void 0&&(n=this.createNode(),this.set(Sd,n)),Sd.length=0,n}}class Ld extends Nu{constructor(e=1,t=1,n={}){super(e,t,n),this.isXRRenderTarget=!0,this.hasExternalTextures=!1,this.autoAllocateDepthBuffer=!0}copy(e){return super.copy(e),this.hasExternalTextures=e.hasExternalTextures,this.autoAllocateDepthBuffer=e.autoAllocateDepthBuffer,this}}const o2=new V,l2=new V;class _re extends po{constructor(e,t=!1){super(),this.enabled=!1,this.isPresenting=!1,this.cameraAutoUpdate=!0,this._renderer=e,this._cameraL=new Ui,this._cameraL.viewport=new bt,this._cameraR=new Ui,this._cameraR.viewport=new bt,this._cameras=[this._cameraL,this._cameraR],this._cameraXR=new mO,this._currentDepthNear=null,this._currentDepthFar=null,this._controllers=[],this._controllerInputSources=[],this._xrRenderTarget=null,this._layers=[],this._supportsLayers=!1,this._frameBufferTargets=null,this._createXRLayer=Ere.bind(this),this._gl=null,this._currentAnimationContext=null,this._currentAnimationLoop=null,this._currentPixelRatio=null,this._currentSize=new Le,this._onSessionEvent=Sre.bind(this),this._onSessionEnd=Tre.bind(this),this._onInputSourcesChange=Mre.bind(this),this._onAnimationFrame=Are.bind(this),this._referenceSpace=null,this._referenceSpaceType="local-floor",this._customReferenceSpace=null,this._framebufferScaleFactor=1,this._foveation=1,this._session=null,this._glBaseLayer=null,this._glBinding=null,this._glProjLayer=null,this._xrFrame=null,this._useLayers=typeof XRWebGLBinding<"u"&&"createProjectionLayer"in XRWebGLBinding.prototype,this._useMultiviewIfPossible=t,this._useMultiview=!1}getController(e){return this._getController(e).getTargetRaySpace()}getControllerGrip(e){return this._getController(e).getGripSpace()}getHand(e){return this._getController(e).getHandSpace()}getFoveation(){if(!(this._glProjLayer===null&&this._glBaseLayer===null))return this._foveation}setFoveation(e){this._foveation=e,this._glProjLayer!==null&&(this._glProjLayer.fixedFoveation=e),this._glBaseLayer!==null&&this._glBaseLayer.fixedFoveation!==void 0&&(this._glBaseLayer.fixedFoveation=e)}getFramebufferScaleFactor(){return this._framebufferScaleFactor}setFramebufferScaleFactor(e){this._framebufferScaleFactor=e,this.isPresenting===!0&&console.warn("THREE.XRManager: Cannot change framebuffer scale while presenting.")}getReferenceSpaceType(){return this._referenceSpaceType}setReferenceSpaceType(e){this._referenceSpaceType=e,this.isPresenting===!0&&console.warn("THREE.XRManager: Cannot change reference space type while presenting.")}getReferenceSpace(){return this._customReferenceSpace||this._referenceSpace}setReferenceSpace(e){this._customReferenceSpace=e}getCamera(){return this._cameraXR}getEnvironmentBlendMode(){if(this._session!==null)return this._session.environmentBlendMode}getFrame(){return this._xrFrame}useMultiview(){return this._useMultiview}createQuadLayer(e,t,n,r,s,a,l,u={}){const h=new $p(e,t),d=new Ld(s,a,{format:Xn,type:Gn,depthTexture:new bs(s,a,u.stencil?ts:En,void 0,void 0,void 0,void 0,void 0,void 0,u.stencil?is:ns),stencilBuffer:u.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1});d.autoAllocateDepthBuffer=!0;const p=new na({color:16777215,side:Lr});p.map=d.texture,p.map.offset.y=1,p.map.repeat.y=-1;const g=new fi(h,p);g.position.copy(n),g.quaternion.copy(r);const y={type:"quad",width:e,height:t,translation:n,quaternion:r,pixelwidth:s,pixelheight:a,plane:g,material:p,rendercall:l,renderTarget:d};if(this._layers.push(y),this._session!==null){y.plane.material=new na({color:16777215,side:Lr}),y.plane.material.blending=Zc,y.plane.material.blendEquation=er,y.plane.material.blendSrc=qa,y.plane.material.blendDst=qa,y.xrlayer=this._createXRLayer(y);const v=this._session.renderState.layers;v.unshift(y.xrlayer),this._session.updateRenderState({layers:v})}else d.isXRRenderTarget=!1;return g}createCylinderLayer(e,t,n,r,s,a,l,u,h={}){const d=new qp(e,e,e*t/n,64,64,!0,Math.PI-t/2,t),p=new Ld(a,l,{format:Xn,type:Gn,depthTexture:new bs(a,l,h.stencil?ts:En,void 0,void 0,void 0,void 0,void 0,void 0,h.stencil?is:ns),stencilBuffer:h.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1});p.autoAllocateDepthBuffer=!0;const g=new na({color:16777215,side:An});g.map=p.texture,g.map.offset.y=1,g.map.repeat.y=-1;const y=new fi(d,g);y.position.copy(r),y.quaternion.copy(s);const v={type:"cylinder",radius:e,centralAngle:t,aspectratio:n,translation:r,quaternion:s,pixelwidth:a,pixelheight:l,plane:y,material:g,rendercall:u,renderTarget:p};if(this._layers.push(v),this._session!==null){v.plane.material=new na({color:16777215,side:An}),v.plane.material.blending=Zc,v.plane.material.blendEquation=er,v.plane.material.blendSrc=qa,v.plane.material.blendDst=qa,v.xrlayer=this._createXRLayer(v);const S=this._session.renderState.layers;S.unshift(v.xrlayer),this._session.updateRenderState({layers:S})}else p.isXRRenderTarget=!1;return y}renderLayers(){const e=new V,t=new Vs,n=this._renderer,r=this.isPresenting,s=n.getOutputRenderTarget(),a=n._frameBufferTarget;this.isPresenting=!1;const l=new Le;n.getSize(l);const u=n._quad;for(const h of this._layers)if(h.renderTarget.isXRRenderTarget=this._session!==null,h.renderTarget.hasExternalTextures=h.renderTarget.isXRRenderTarget,h.renderTarget.isXRRenderTarget&&this._supportsLayers){h.xrlayer.transform=new XRRigidTransform(h.plane.getWorldPosition(e),h.plane.getWorldQuaternion(t));const d=this._glBinding.getSubImage(h.xrlayer,this._xrFrame);n.backend.setXRRenderTargetTextures(h.renderTarget,d.colorTexture,void 0),n._setXRLayerSize(h.renderTarget.width,h.renderTarget.height),n.setOutputRenderTarget(h.renderTarget),n.setRenderTarget(null),n._frameBufferTarget=null,this._frameBufferTargets||(this._frameBufferTargets=new WeakMap);const{frameBufferTarget:p,quad:g}=this._frameBufferTargets.get(h.renderTarget)||{frameBufferTarget:null,quad:null};p?(n._frameBufferTarget=p,n._quad=g):(n._quad=new FE(new pi),this._frameBufferTargets.set(h.renderTarget,{frameBufferTarget:n._getFrameBufferTarget(),quad:n._quad})),h.rendercall(),n._frameBufferTarget=null}else n.setRenderTarget(h.renderTarget),h.rendercall();n.setRenderTarget(null),n.setOutputRenderTarget(s),n._frameBufferTarget=a,n._setXRLayerSize(l.x,l.y),n._quad=u,this.isPresenting=r}getSession(){return this._session}async setSession(e){const t=this._renderer,n=t.backend;this._gl=t.getContext();const r=this._gl,s=r.getContextAttributes();if(this._session=e,e!==null){if(n.isWebGPUBackend===!0)throw new Error('THREE.XRManager: XR is currently not supported with a WebGPU backend. Use WebGL by passing "{ forceWebGL: true }" to the constructor of the renderer.');if(e.addEventListener("select",this._onSessionEvent),e.addEventListener("selectstart",this._onSessionEvent),e.addEventListener("selectend",this._onSessionEvent),e.addEventListener("squeeze",this._onSessionEvent),e.addEventListener("squeezestart",this._onSessionEvent),e.addEventListener("squeezeend",this._onSessionEvent),e.addEventListener("end",this._onSessionEnd),e.addEventListener("inputsourceschange",this._onInputSourcesChange),await n.makeXRCompatible(),this._currentPixelRatio=t.getPixelRatio(),t.getSize(this._currentSize),this._currentAnimationContext=t._animation.getContext(),this._currentAnimationLoop=t._animation.getAnimationLoop(),t._animation.stop(),this._useLayers===!0){let a=null,l=null,u=null;t.depth&&(u=t.stencil?r.DEPTH24_STENCIL8:r.DEPTH_COMPONENT24,a=t.stencil?is:ns,l=t.stencil?ts:En);const h={colorFormat:r.RGBA8,depthFormat:u,scaleFactor:this._framebufferScaleFactor,clearOnAccess:!1};this._useMultiviewIfPossible&&t.hasFeature("OVR_multiview2")&&(h.textureType="texture-array",this._useMultiview=!0);const d=new XRWebGLBinding(e,r),p=d.createProjectionLayer(h),g=[p];this._glBinding=d,this._glProjLayer=p,t.setPixelRatio(1),t._setXRLayerSize(p.textureWidth,p.textureHeight);const y=this._useMultiview?2:1,v=new bs(p.textureWidth,p.textureHeight,l,void 0,void 0,void 0,void 0,void 0,void 0,a,y);if(this._xrRenderTarget=new Ld(p.textureWidth,p.textureHeight,{format:Xn,type:Gn,colorSpace:t.outputColorSpace,depthTexture:v,stencilBuffer:t.stencil,samples:s.antialias?4:0,resolveDepthBuffer:p.ignoreDepthValues===!1,resolveStencilBuffer:p.ignoreDepthValues===!1,depth:this._useMultiview?2:1,multiview:this._useMultiview}),this._xrRenderTarget.hasExternalTextures=!0,this._xrRenderTarget.depth=this._useMultiview?2:1,this._supportsLayers=e.enabledFeatures.includes("layers"),this._referenceSpace=await e.requestReferenceSpace(this.getReferenceSpaceType()),this._supportsLayers)for(const S of this._layers)S.plane.material=new na({color:16777215,side:S.type==="cylinder"?An:Lr}),S.plane.material.blending=Zc,S.plane.material.blendEquation=er,S.plane.material.blendSrc=qa,S.plane.material.blendDst=qa,S.xrlayer=this._createXRLayer(S),g.unshift(S.xrlayer);e.updateRenderState({layers:g})}else{const a={antialias:t.samples>0,alpha:!0,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:this.getFramebufferScaleFactor()},l=new XRWebGLLayer(e,r,a);this._glBaseLayer=l,e.updateRenderState({baseLayer:l}),t.setPixelRatio(1),t._setXRLayerSize(l.framebufferWidth,l.framebufferHeight),this._xrRenderTarget=new Ld(l.framebufferWidth,l.framebufferHeight,{format:Xn,type:Gn,colorSpace:t.outputColorSpace,stencilBuffer:t.stencil,resolveDepthBuffer:l.ignoreDepthValues===!1,resolveStencilBuffer:l.ignoreDepthValues===!1}),this._referenceSpace=await e.requestReferenceSpace(this.getReferenceSpaceType())}this.setFoveation(this.getFoveation()),t._animation.setAnimationLoop(this._onAnimationFrame),t._animation.setContext(e),t._animation.start(),this.isPresenting=!0,this.dispatchEvent({type:"sessionstart"})}}updateCamera(e){const t=this._session;if(t===null)return;const n=e.near,r=e.far,s=this._cameraXR,a=this._cameraL,l=this._cameraR;s.near=l.near=a.near=n,s.far=l.far=a.far=r,s.isMultiViewCamera=this._useMultiview,(this._currentDepthNear!==s.near||this._currentDepthFar!==s.far)&&(t.updateRenderState({depthNear:s.near,depthFar:s.far}),this._currentDepthNear=s.near,this._currentDepthFar=s.far),a.layers.mask=e.layers.mask|2,l.layers.mask=e.layers.mask|4,s.layers.mask=a.layers.mask|l.layers.mask;const u=e.parent,h=s.cameras;u2(s,u);for(let d=0;d<h.length;d++)u2(h[d],u);h.length===2?xre(s,a,l):s.projectionMatrix.copy(a.projectionMatrix),bre(e,s,u)}_getController(e){let t=this._controllers[e];return t===void 0&&(t=new Ey,this._controllers[e]=t),t}}function xre(i,e,t){o2.setFromMatrixPosition(e.matrixWorld),l2.setFromMatrixPosition(t.matrixWorld);const n=o2.distanceTo(l2),r=e.projectionMatrix.elements,s=t.projectionMatrix.elements,a=r[14]/(r[10]-1),l=r[14]/(r[10]+1),u=(r[9]+1)/r[5],h=(r[9]-1)/r[5],d=(r[8]-1)/r[0],p=(s[8]+1)/s[0],g=a*d,y=a*p,v=n/(-d+p),S=v*-d;if(e.matrixWorld.decompose(i.position,i.quaternion,i.scale),i.translateX(S),i.translateZ(v),i.matrixWorld.compose(i.position,i.quaternion,i.scale),i.matrixWorldInverse.copy(i.matrixWorld).invert(),r[10]===-1)i.projectionMatrix.copy(e.projectionMatrix),i.projectionMatrixInverse.copy(e.projectionMatrixInverse);else{const b=a+v,_=l+v,E=g-S,M=y+(n-S),A=u*l/_*b,w=h*l/_*b;i.projectionMatrix.makePerspective(E,M,A,w,b,_),i.projectionMatrixInverse.copy(i.projectionMatrix).invert()}}function u2(i,e){e===null?i.matrixWorld.copy(i.matrix):i.matrixWorld.multiplyMatrices(e.matrixWorld,i.matrix),i.matrixWorldInverse.copy(i.matrixWorld).invert()}function bre(i,e,t){t===null?i.matrix.copy(e.matrixWorld):(i.matrix.copy(t.matrixWorld),i.matrix.invert(),i.matrix.multiply(e.matrixWorld)),i.matrix.decompose(i.position,i.quaternion,i.scale),i.updateMatrixWorld(!0),i.projectionMatrix.copy(e.projectionMatrix),i.projectionMatrixInverse.copy(e.projectionMatrixInverse),i.isPerspectiveCamera&&(i.fov=Eu*2*Math.atan(1/i.projectionMatrix.elements[5]),i.zoom=1)}function Sre(i){const e=this._controllerInputSources.indexOf(i.inputSource);if(e===-1)return;const t=this._controllers[e];if(t!==void 0){const n=this.getReferenceSpace();t.update(i.inputSource,i.frame,n),t.dispatchEvent({type:i.type,data:i.inputSource})}}function Tre(){const i=this._session,e=this._renderer;i.removeEventListener("select",this._onSessionEvent),i.removeEventListener("selectstart",this._onSessionEvent),i.removeEventListener("selectend",this._onSessionEvent),i.removeEventListener("squeeze",this._onSessionEvent),i.removeEventListener("squeezestart",this._onSessionEvent),i.removeEventListener("squeezeend",this._onSessionEvent),i.removeEventListener("end",this._onSessionEnd),i.removeEventListener("inputsourceschange",this._onInputSourcesChange);for(let t=0;t<this._controllers.length;t++){const n=this._controllerInputSources[t];n!==null&&(this._controllerInputSources[t]=null,this._controllers[t].disconnect(n))}if(this._currentDepthNear=null,this._currentDepthFar=null,e._resetXRState(),this._session=null,this._xrRenderTarget=null,this._supportsLayers===!0)for(const t of this._layers)t.renderTarget=new Ld(t.pixelwidth,t.pixelheight,{format:Xn,type:Gn,depthTexture:new bs(t.pixelwidth,t.pixelheight,t.stencilBuffer?ts:En,void 0,void 0,void 0,void 0,void 0,void 0,t.stencilBuffer?is:ns),stencilBuffer:t.stencilBuffer,resolveDepthBuffer:!1,resolveStencilBuffer:!1}),t.renderTarget.isXRRenderTarget=!1,t.plane.material=t.material,t.material.map=t.renderTarget.texture,t.material.map.offset.y=1,t.material.map.repeat.y=-1,delete t.xrlayer;this.isPresenting=!1,this._useMultiview=!1,e._animation.stop(),e._animation.setAnimationLoop(this._currentAnimationLoop),e._animation.setContext(this._currentAnimationContext),e._animation.start(),e.setPixelRatio(this._currentPixelRatio),e.setSize(this._currentSize.width,this._currentSize.height,!1),this.dispatchEvent({type:"sessionend"})}function Mre(i){const e=this._controllers,t=this._controllerInputSources;for(let n=0;n<i.removed.length;n++){const r=i.removed[n],s=t.indexOf(r);s>=0&&(t[s]=null,e[s].disconnect(r))}for(let n=0;n<i.added.length;n++){const r=i.added[n];let s=t.indexOf(r);if(s===-1){for(let l=0;l<e.length;l++)if(l>=t.length){t.push(r),s=l;break}else if(t[l]===null){t[l]=r,s=l;break}if(s===-1)break}const a=e[s];a&&a.connect(r)}}function Ere(i){return i.type==="quad"?this._glBinding.createQuadLayer({transform:new XRRigidTransform(i.translation,i.quaternion),width:i.width/2,height:i.height/2,space:this._referenceSpace,viewPixelWidth:i.pixelwidth,viewPixelHeight:i.pixelheight,clearOnAccess:!1}):this._glBinding.createCylinderLayer({transform:new XRRigidTransform(i.translation,i.quaternion),radius:i.radius,centralAngle:i.centralAngle,aspectRatio:i.aspectRatio,space:this._referenceSpace,viewPixelWidth:i.pixelwidth,viewPixelHeight:i.pixelheight,clearOnAccess:!1})}function Are(i,e){if(e===void 0)return;const t=this._cameraXR,n=this._renderer,r=n.backend,s=this._glBaseLayer,a=this.getReferenceSpace(),l=e.getViewerPose(a);if(this._xrFrame=e,l!==null){const u=l.views;this._glBaseLayer!==null&&r.setXRTarget(s.framebuffer);let h=!1;u.length!==t.cameras.length&&(t.cameras.length=0,h=!0);for(let d=0;d<u.length;d++){const p=u[d];let g;if(this._useLayers===!0){const v=this._glBinding.getViewSubImage(this._glProjLayer,p);g=v.viewport,d===0&&r.setXRRenderTargetTextures(this._xrRenderTarget,v.colorTexture,this._glProjLayer.ignoreDepthValues&&!this._useMultiview?void 0:v.depthStencilTexture)}else g=s.getViewport(p);let y=this._cameras[d];y===void 0&&(y=new Ui,y.layers.enable(d),y.viewport=new bt,this._cameras[d]=y),y.matrix.fromArray(p.transform.matrix),y.matrix.decompose(y.position,y.quaternion,y.scale),y.projectionMatrix.fromArray(p.projectionMatrix),y.projectionMatrixInverse.copy(y.projectionMatrix).invert(),y.viewport.set(g.x,g.y,g.width,g.height),d===0&&(t.matrix.copy(y.matrix),t.matrix.decompose(t.position,t.quaternion,t.scale)),h===!0&&t.cameras.push(y)}n.setOutputRenderTarget(this._xrRenderTarget)}for(let u=0;u<this._controllers.length;u++){const h=this._controllerInputSources[u],d=this._controllers[u];h!==null&&d!==void 0&&d.update(h,e,a)}this._currentAnimationLoop&&this._currentAnimationLoop(i,e),e.detectedPlanes&&this.dispatchEvent({type:"planesdetected",data:e}),this._xrFrame=null}const c2=new Ev,ly=new Le,$b=new bt,Xb=new jp,Yb=new KM,uy=new Wt,Ko=new bt;class wre{constructor(e,t={}){this.isRenderer=!0;const{logarithmicDepthBuffer:n=!1,alpha:r=!0,depth:s=!0,stencil:a=!1,antialias:l=!1,samples:u=0,getFallback:h=null,colorBufferType:d=Oi,multiview:p=!1}=t;this.domElement=e.getDomElement(),this.backend=e,this.samples=u||l===!0?4:0,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.alpha=r,this.logarithmicDepthBuffer=n,this.outputColorSpace=Ji,this.toneMapping=Or,this.toneMappingExposure=1,this.sortObjects=!0,this.depth=s,this.stencil=a,this.info=new une,this.overrideNodes={modelViewMatrix:null,modelNormalViewMatrix:null},this.library=new BI,this.lighting=new vre,this._getFallback=h,this._pixelRatio=1,this._width=this.domElement.width,this._height=this.domElement.height,this._viewport=new bt(0,0,this._width,this._height),this._scissor=new bt(0,0,this._width,this._height),this._scissorTest=!1,this._attributes=null,this._geometries=null,this._nodes=null,this._animation=null,this._bindings=null,this._objects=null,this._pipelines=null,this._bundles=null,this._renderLists=null,this._renderContexts=null,this._textures=null,this._background=null,this._quad=new FE(new pi),this._quad.material.name="Renderer_output",this._currentRenderContext=null,this._opaqueSort=null,this._transparentSort=null,this._frameBufferTarget=null;const g=this.alpha===!0?0:1;this._clearColor=new IE(0,0,0,g),this._clearDepth=1,this._clearStencil=0,this._renderTarget=null,this._activeCubeFace=0,this._activeMipmapLevel=0,this._outputRenderTarget=null,this._mrt=null,this._renderObjectFunction=null,this._currentRenderObjectFunction=null,this._currentRenderBundle=null,this._handleObjectFunction=this._renderObjectDirect,this._isDeviceLost=!1,this.onDeviceLost=this._onDeviceLost,this._colorBufferType=d,this._initialized=!1,this._initPromise=null,this._compilationPromises=null,this.transparent=!0,this.opaque=!0,this.shadowMap={enabled:!1,type:_M},this.xr=new _re(this,p),this.debug={checkShaderErrors:!0,onShaderError:null,getShaderAsync:async(y,v,S)=>{await this.compileAsync(y,v);const b=this._renderLists.get(y,v),_=this._renderContexts.get(y,v,this._renderTarget),E=y.overrideMaterial||S.material,M=this._objects.get(S,E,y,v,b.lightsNode,_,_.clippingContext),{fragmentShader:A,vertexShader:w}=M.getNodeBuilderState();return{fragmentShader:A,vertexShader:w}}}}async init(){if(this._initialized)throw new Error("Renderer: Backend has already been initialized.");return this._initPromise!==null?this._initPromise:(this._initPromise=new Promise(async(e,t)=>{let n=this.backend;try{await n.init(this)}catch(r){if(this._getFallback!==null)try{this.backend=n=this._getFallback(r),await n.init(this)}catch(s){t(s);return}else{t(r);return}}this._nodes=new pre(this,n),this._animation=new ene(this._nodes,this.info),this._attributes=new one(n),this._background=new Nie(this,this._nodes),this._geometries=new lne(this._attributes,this.info),this._textures=new Mne(this,n,this.info),this._pipelines=new dne(n,this._nodes),this._bindings=new pne(n,this._nodes,this._textures,this._attributes,this._pipelines,this.info),this._objects=new rne(this,this._nodes,this._geometries,this._pipelines,this._bindings,this.info),this._renderLists=new yne(this.lighting),this._bundles=new gre,this._renderContexts=new Sne,this._animation.start(),this._initialized=!0,e(this)}),this._initPromise)}get coordinateSystem(){return this.backend.coordinateSystem}async compileAsync(e,t,n=null){if(this._isDeviceLost===!0)return;this._initialized===!1&&await this.init();const r=this._nodes.nodeFrame,s=r.renderId,a=this._currentRenderContext,l=this._currentRenderObjectFunction,u=this._compilationPromises,h=e.isScene===!0?e:c2;n===null&&(n=e);const d=this._renderTarget,p=this._renderContexts.get(n,t,d),g=this._activeMipmapLevel,y=[];this._currentRenderContext=p,this._currentRenderObjectFunction=this.renderObject,this._handleObjectFunction=this._createObjectPipeline,this._compilationPromises=y,r.renderId++,r.update(),p.depth=this.depth,p.stencil=this.stencil,p.clippingContext||(p.clippingContext=new ov),p.clippingContext.updateGlobal(h,t),h.onBeforeRender(this,e,t,d);const v=this._renderLists.get(e,t);if(v.begin(),this._projectObject(e,t,0,v,p.clippingContext),n!==e&&n.traverseVisible(function(M){M.isLight&&M.layers.test(t.layers)&&v.pushLight(M)}),v.finish(),d!==null){this._textures.updateRenderTarget(d,g);const M=this._textures.get(d);p.textures=M.textures,p.depthTexture=M.depthTexture}else p.textures=null,p.depthTexture=null;this._background.update(h,v,p);const S=v.opaque,b=v.transparent,_=v.transparentDoublePass,E=v.lightsNode;this.opaque===!0&&S.length>0&&this._renderObjects(S,t,h,E),this.transparent===!0&&b.length>0&&this._renderTransparents(b,_,t,h,E),r.renderId=s,this._currentRenderContext=a,this._currentRenderObjectFunction=l,this._compilationPromises=u,this._handleObjectFunction=this._renderObjectDirect,await Promise.all(y)}async renderAsync(e,t){this._initialized===!1&&await this.init(),this._renderScene(e,t)}async waitForGPU(){await this.backend.waitForGPU()}set highPrecision(e){e===!0?(this.overrideNodes.modelViewMatrix=hD,this.overrideNodes.modelNormalViewMatrix=fD):this.highPrecision&&(this.overrideNodes.modelViewMatrix=null,this.overrideNodes.modelNormalViewMatrix=null)}get highPrecision(){return this.overrideNodes.modelViewMatrix===hD&&this.overrideNodes.modelNormalViewMatrix===fD}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}getColorBufferType(){return this._colorBufferType}_onDeviceLost(e){let t=`THREE.WebGPURenderer: ${e.api} Device Lost:

Message: ${e.message}`;e.reason&&(t+=`
Reason: ${e.reason}`),console.error(t),this._isDeviceLost=!0}_renderBundle(e,t,n){const{bundleGroup:r,camera:s,renderList:a}=e,l=this._currentRenderContext,u=this._bundles.get(r,s),h=this.backend.get(u);h.renderContexts===void 0&&(h.renderContexts=new Set);const d=r.version!==h.version,p=h.renderContexts.has(l)===!1||d;if(h.renderContexts.add(l),p){this.backend.beginBundle(l),(h.renderObjects===void 0||d)&&(h.renderObjects=[]),this._currentRenderBundle=u;const{transparentDoublePass:g,transparent:y,opaque:v}=a;this.opaque===!0&&v.length>0&&this._renderObjects(v,s,t,n),this.transparent===!0&&y.length>0&&this._renderTransparents(y,g,s,t,n),this._currentRenderBundle=null,this.backend.finishBundle(l,u),h.version=r.version}else{const{renderObjects:g}=h;for(let y=0,v=g.length;y<v;y++){const S=g[y];this._nodes.needsRefresh(S)&&(this._nodes.updateBefore(S),this._nodes.updateForRender(S),this._bindings.updateForRender(S),this._nodes.updateAfter(S))}}this.backend.addBundle(l,u)}render(e,t){if(this._initialized===!1)return console.warn("THREE.Renderer: .render() called before the backend is initialized. Try using .renderAsync() instead."),this.renderAsync(e,t);this._renderScene(e,t)}_getFrameBufferTarget(){const{currentToneMapping:e,currentColorSpace:t}=this;if(e!==Or===!1&&t!==ca===!1)return null;const{width:s,height:a}=this.getDrawingBufferSize(ly),{depth:l,stencil:u}=this;let h=this._frameBufferTarget;h===null&&(h=new Nu(s,a,{depthBuffer:l,stencilBuffer:u,type:this._colorBufferType,format:Xn,colorSpace:ca,generateMipmaps:!1,minFilter:Ti,magFilter:Ti,samples:this.samples}),h.isPostProcessingRenderTarget=!0,this._frameBufferTarget=h);const d=this.getOutputRenderTarget();return h.depthBuffer=l,h.stencilBuffer=u,d!==null?h.setSize(d.width,d.height,d.depth):h.setSize(s,a,1),h.viewport.copy(this._viewport),h.scissor.copy(this._scissor),h.viewport.multiplyScalar(this._pixelRatio),h.scissor.multiplyScalar(this._pixelRatio),h.scissorTest=this._scissorTest,h.multiview=d!==null?d.multiview:!1,h.resolveDepthBuffer=d!==null?d.resolveDepthBuffer:!0,h.autoAllocateDepthBuffer=d!==null?d.autoAllocateDepthBuffer:!1,h}_renderScene(e,t,n=!0){if(this._isDeviceLost===!0)return;const r=n?this._getFrameBufferTarget():null,s=this._nodes.nodeFrame,a=s.renderId,l=this._currentRenderContext,u=this._currentRenderObjectFunction,h=e.isScene===!0?e:c2,d=this._renderTarget||this._outputRenderTarget,p=this._activeCubeFace,g=this._activeMipmapLevel;let y;r!==null?(y=r,this.setRenderTarget(y)):y=d;const v=this._renderContexts.get(e,t,y);this._currentRenderContext=v,this._currentRenderObjectFunction=this._renderObjectFunction||this.renderObject,this.info.calls++,this.info.render.calls++,this.info.render.frameCalls++,s.renderId=this.info.calls;const S=this.coordinateSystem,b=this.xr;if(t.coordinateSystem!==S&&b.isPresenting===!1&&(t.coordinateSystem=S,t.updateProjectionMatrix(),t.isArrayCamera))for(const Y of t.cameras)Y.coordinateSystem=S,Y.updateProjectionMatrix();e.matrixWorldAutoUpdate===!0&&e.updateMatrixWorld(),t.parent===null&&t.matrixWorldAutoUpdate===!0&&t.updateMatrixWorld(),b.enabled===!0&&b.isPresenting===!0&&(b.cameraAutoUpdate===!0&&b.updateCamera(t),t=b.getCamera());let _=this._viewport,E=this._scissor,M=this._pixelRatio;y!==null&&(_=y.viewport,E=y.scissor,M=1),this.getDrawingBufferSize(ly),$b.set(0,0,ly.width,ly.height);const A=_.minDepth===void 0?0:_.minDepth,w=_.maxDepth===void 0?1:_.maxDepth;v.viewportValue.copy(_).multiplyScalar(M).floor(),v.viewportValue.width>>=g,v.viewportValue.height>>=g,v.viewportValue.minDepth=A,v.viewportValue.maxDepth=w,v.viewport=v.viewportValue.equals($b)===!1,v.scissorValue.copy(E).multiplyScalar(M).floor(),v.scissor=this._scissorTest&&v.scissorValue.equals($b)===!1,v.scissorValue.width>>=g,v.scissorValue.height>>=g,v.clippingContext||(v.clippingContext=new ov),v.clippingContext.updateGlobal(h,t),h.onBeforeRender(this,e,t,y);const R=t.isArrayCamera?Yb:Xb;t.isArrayCamera||(uy.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),R.setFromProjectionMatrix(uy,S));const C=this._renderLists.get(e,t);if(C.begin(),this._projectObject(e,t,0,C,v.clippingContext),C.finish(),this.sortObjects===!0&&C.sort(this._opaqueSort,this._transparentSort),y!==null){this._textures.updateRenderTarget(y,g);const Y=this._textures.get(y);v.textures=Y.textures,v.depthTexture=Y.depthTexture,v.width=Y.width,v.height=Y.height,v.renderTarget=y,v.depth=y.depthBuffer,v.stencil=y.stencilBuffer}else v.textures=null,v.depthTexture=null,v.width=this.domElement.width,v.height=this.domElement.height,v.depth=this.depth,v.stencil=this.stencil;v.width>>=g,v.height>>=g,v.activeCubeFace=p,v.activeMipmapLevel=g,v.occlusionQueryCount=C.occlusionQueryCount,this._background.update(h,C,v),v.camera=t,this.backend.beginRender(v);const{bundles:L,lightsNode:N,transparentDoublePass:D,transparent:I,opaque:W}=C;return L.length>0&&this._renderBundles(L,h,N),this.opaque===!0&&W.length>0&&this._renderObjects(W,t,h,N),this.transparent===!0&&I.length>0&&this._renderTransparents(I,D,t,h,N),this.backend.finishRender(v),s.renderId=a,this._currentRenderContext=l,this._currentRenderObjectFunction=u,r!==null&&(this.setRenderTarget(d,p,g),this._renderOutput(y)),h.onAfterRender(this,e,t,y),v}_setXRLayerSize(e,t){this._width=e,this._height=t,this.setViewport(0,0,e,t)}_renderOutput(e){const t=this._quad;this._nodes.hasOutputChange(e.texture)&&(t.material.fragmentNode=this._nodes.getOutputNode(e.texture),t.material.needsUpdate=!0);const n=this.autoClear,r=this.xr.enabled;this.autoClear=!1,this.xr.enabled=!1,this._renderScene(t,t.camera,!1),this.autoClear=n,this.xr.enabled=r}getMaxAnisotropy(){return this.backend.getMaxAnisotropy()}getActiveCubeFace(){return this._activeCubeFace}getActiveMipmapLevel(){return this._activeMipmapLevel}async setAnimationLoop(e){this._initialized===!1&&await this.init(),this._animation.setAnimationLoop(e)}async getArrayBufferAsync(e){return await this.backend.getArrayBufferAsync(e)}getContext(){return this.backend.getContext()}getPixelRatio(){return this._pixelRatio}getDrawingBufferSize(e){return e.set(this._width*this._pixelRatio,this._height*this._pixelRatio).floor()}getSize(e){return e.set(this._width,this._height)}setPixelRatio(e=1){this._pixelRatio!==e&&(this._pixelRatio=e,this.setSize(this._width,this._height,!1))}setDrawingBufferSize(e,t,n){this.xr&&this.xr.isPresenting||(this._width=e,this._height=t,this._pixelRatio=n,this.domElement.width=Math.floor(e*n),this.domElement.height=Math.floor(t*n),this.setViewport(0,0,e,t),this._initialized&&this.backend.updateSize())}setSize(e,t,n=!0){this.xr&&this.xr.isPresenting||(this._width=e,this._height=t,this.domElement.width=Math.floor(e*this._pixelRatio),this.domElement.height=Math.floor(t*this._pixelRatio),n===!0&&(this.domElement.style.width=e+"px",this.domElement.style.height=t+"px"),this.setViewport(0,0,e,t),this._initialized&&this.backend.updateSize())}setOpaqueSort(e){this._opaqueSort=e}setTransparentSort(e){this._transparentSort=e}getScissor(e){const t=this._scissor;return e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,e}setScissor(e,t,n,r){const s=this._scissor;e.isVector4?s.copy(e):s.set(e,t,n,r)}getScissorTest(){return this._scissorTest}setScissorTest(e){this._scissorTest=e,this.backend.setScissorTest(e)}getViewport(e){return e.copy(this._viewport)}setViewport(e,t,n,r,s=0,a=1){const l=this._viewport;e.isVector4?l.copy(e):l.set(e,t,n,r),l.minDepth=s,l.maxDepth=a}getClearColor(e){return e.copy(this._clearColor)}setClearColor(e,t=1){this._clearColor.set(e),this._clearColor.a=t}getClearAlpha(){return this._clearColor.a}setClearAlpha(e){this._clearColor.a=e}getClearDepth(){return this._clearDepth}setClearDepth(e){this._clearDepth=e}getClearStencil(){return this._clearStencil}setClearStencil(e){this._clearStencil=e}isOccluded(e){const t=this._currentRenderContext;return t&&this.backend.isOccluded(t,e)}clear(e=!0,t=!0,n=!0){if(this._initialized===!1)return console.warn("THREE.Renderer: .clear() called before the backend is initialized. Try using .clearAsync() instead."),this.clearAsync(e,t,n);const r=this._renderTarget||this._getFrameBufferTarget();let s=null;if(r!==null){this._textures.updateRenderTarget(r);const a=this._textures.get(r);s=this._renderContexts.getForClear(r),s.textures=a.textures,s.depthTexture=a.depthTexture,s.width=a.width,s.height=a.height,s.renderTarget=r,s.depth=r.depthBuffer,s.stencil=r.stencilBuffer,s.clearColorValue=this.backend.getClearColor(),s.activeCubeFace=this.getActiveCubeFace(),s.activeMipmapLevel=this.getActiveMipmapLevel()}this.backend.clear(e,t,n,s),r!==null&&this._renderTarget===null&&this._renderOutput(r)}clearColor(){return this.clear(!0,!1,!1)}clearDepth(){return this.clear(!1,!0,!1)}clearStencil(){return this.clear(!1,!1,!0)}async clearAsync(e=!0,t=!0,n=!0){this._initialized===!1&&await this.init(),this.clear(e,t,n)}async clearColorAsync(){this.clearAsync(!0,!1,!1)}async clearDepthAsync(){this.clearAsync(!1,!0,!1)}async clearStencilAsync(){this.clearAsync(!1,!1,!0)}get currentToneMapping(){return this.isOutputTarget?this.toneMapping:Or}get currentColorSpace(){return this.isOutputTarget?this.outputColorSpace:ca}get isOutputTarget(){return this._renderTarget===this._outputRenderTarget||this._renderTarget===null}dispose(){this.info.dispose(),this.backend.dispose(),this._animation.dispose(),this._objects.dispose(),this._pipelines.dispose(),this._nodes.dispose(),this._bindings.dispose(),this._renderLists.dispose(),this._renderContexts.dispose(),this._textures.dispose(),this._frameBufferTarget!==null&&this._frameBufferTarget.dispose(),Object.values(this.backend.timestampQueryPool).forEach(e=>{e!==null&&e.dispose()}),this.setRenderTarget(null),this.setAnimationLoop(null)}setRenderTarget(e,t=0,n=0){this._renderTarget=e,this._activeCubeFace=t,this._activeMipmapLevel=n}getRenderTarget(){return this._renderTarget}setOutputRenderTarget(e){this._outputRenderTarget=e}getOutputRenderTarget(){return this._outputRenderTarget}_resetXRState(){this.backend.setXRTarget(null),this.setOutputRenderTarget(null),this.setRenderTarget(null),this._frameBufferTarget.dispose(),this._frameBufferTarget=null}setRenderObjectFunction(e){this._renderObjectFunction=e}getRenderObjectFunction(){return this._renderObjectFunction}compute(e){if(this._isDeviceLost===!0)return;if(this._initialized===!1)return console.warn("THREE.Renderer: .compute() called before the backend is initialized. Try using .computeAsync() instead."),this.computeAsync(e);const t=this._nodes.nodeFrame,n=t.renderId;this.info.calls++,this.info.compute.calls++,this.info.compute.frameCalls++,t.renderId=this.info.calls;const r=this.backend,s=this._pipelines,a=this._bindings,l=this._nodes,u=Array.isArray(e)?e:[e];if(u[0]===void 0||u[0].isComputeNode!==!0)throw new Error("THREE.Renderer: .compute() expects a ComputeNode.");r.beginCompute(e);for(const h of u){if(s.has(h)===!1){const g=()=>{h.removeEventListener("dispose",g),s.delete(h),a.delete(h),l.delete(h)};h.addEventListener("dispose",g);const y=h.onInitFunction;y!==null&&y.call(h,{renderer:this})}l.updateForCompute(h),a.updateForCompute(h);const d=a.getForCompute(h),p=s.getForCompute(h,d);r.compute(e,h,d,p)}r.finishCompute(e),t.renderId=n}async computeAsync(e){this._initialized===!1&&await this.init(),this.compute(e)}async hasFeatureAsync(e){return this._initialized===!1&&await this.init(),this.backend.hasFeature(e)}async resolveTimestampsAsync(e="render"){return this._initialized===!1&&await this.init(),this.backend.resolveTimestampsAsync(e)}hasFeature(e){return this._initialized===!1?(console.warn("THREE.Renderer: .hasFeature() called before the backend is initialized. Try using .hasFeatureAsync() instead."),!1):this.backend.hasFeature(e)}hasInitialized(){return this._initialized}async initTextureAsync(e){this._initialized===!1&&await this.init(),this._textures.updateTexture(e)}initTexture(e){this._initialized===!1&&console.warn("THREE.Renderer: .initTexture() called before the backend is initialized. Try using .initTextureAsync() instead."),this._textures.updateTexture(e)}copyFramebufferToTexture(e,t=null){if(t!==null)if(t.isVector2)t=Ko.set(t.x,t.y,e.image.width,e.image.height).floor();else if(t.isVector4)t=Ko.copy(t).floor();else{console.error("THREE.Renderer.copyFramebufferToTexture: Invalid rectangle.");return}else t=Ko.set(0,0,e.image.width,e.image.height);let n=this._currentRenderContext,r;n!==null?r=n.renderTarget:(r=this._renderTarget||this._getFrameBufferTarget(),r!==null&&(this._textures.updateRenderTarget(r),n=this._textures.get(r))),this._textures.updateTexture(e,{renderTarget:r}),this.backend.copyFramebufferToTexture(e,n,t)}copyTextureToTexture(e,t,n=null,r=null,s=0,a=0){this._textures.updateTexture(e),this._textures.updateTexture(t),this.backend.copyTextureToTexture(e,t,n,r,s,a)}async readRenderTargetPixelsAsync(e,t,n,r,s,a=0,l=0){return this.backend.copyTextureToBuffer(e.textures[a],t,n,r,s,l)}_projectObject(e,t,n,r,s){if(e.visible===!1)return;if(e.layers.test(t.layers)){if(e.isGroup)n=e.renderOrder,e.isClippingGroup&&e.enabled&&(s=s.getGroupContext(e));else if(e.isLOD)e.autoUpdate===!0&&e.update(t);else if(e.isLight)r.pushLight(e);else if(e.isSprite){const u=t.isArrayCamera?Yb:Xb;if(!e.frustumCulled||u.intersectsSprite(e,t)){this.sortObjects===!0&&Ko.setFromMatrixPosition(e.matrixWorld).applyMatrix4(uy);const{geometry:h,material:d}=e;d.visible&&r.push(e,h,d,n,Ko.z,null,s)}}else if(e.isLineLoop)console.error("THREE.Renderer: Objects of type THREE.LineLoop are not supported. Please use THREE.Line or THREE.LineSegments.");else if(e.isMesh||e.isLine||e.isPoints){const u=t.isArrayCamera?Yb:Xb;if(!e.frustumCulled||u.intersectsObject(e,t)){const{geometry:h,material:d}=e;if(this.sortObjects===!0&&(h.boundingSphere===null&&h.computeBoundingSphere(),Ko.copy(h.boundingSphere.center).applyMatrix4(e.matrixWorld).applyMatrix4(uy)),Array.isArray(d)){const p=h.groups;for(let g=0,y=p.length;g<y;g++){const v=p[g],S=d[v.materialIndex];S&&S.visible&&r.push(e,h,S,n,Ko.z,v,s)}}else d.visible&&r.push(e,h,d,n,Ko.z,null,s)}}}if(e.isBundleGroup===!0&&this.backend.beginBundle!==void 0){const u=r;r=this._renderLists.get(e,t),r.begin(),u.pushBundle({bundleGroup:e,camera:t,renderList:r}),r.finish()}const l=e.children;for(let u=0,h=l.length;u<h;u++)this._projectObject(l[u],t,n,r,s)}_renderBundles(e,t,n){for(const r of e)this._renderBundle(r,t,n)}_renderTransparents(e,t,n,r,s){if(t.length>0){for(const{material:a}of t)a.side=An;this._renderObjects(t,n,r,s,"backSide");for(const{material:a}of t)a.side=Lr;this._renderObjects(e,n,r,s);for(const{material:a}of t)a.side=dr}else this._renderObjects(e,n,r,s)}_renderObjects(e,t,n,r,s=null){for(let a=0,l=e.length;a<l;a++){const{object:u,geometry:h,material:d,group:p,clippingContext:g}=e[a];this._currentRenderObjectFunction(u,n,t,h,d,p,r,g,s)}}renderObject(e,t,n,r,s,a,l,u=null,h=null){let d,p,g;if(e.onBeforeRender(this,t,n,r,s,a),s.allowOverride===!0&&t.overrideMaterial!==null){const y=t.overrideMaterial;s.positionNode&&s.positionNode.isNode&&(d=y.positionNode,y.positionNode=s.positionNode),y.alphaTest=s.alphaTest,y.alphaMap=s.alphaMap,y.transparent=s.transparent||s.transmission>0,y.isShadowPassMaterial&&(y.side=s.shadowSide===null?s.side:s.shadowSide,s.depthNode&&s.depthNode.isNode&&(g=y.depthNode,y.depthNode=s.depthNode),s.castShadowNode&&s.castShadowNode.isNode&&(p=y.colorNode,y.colorNode=s.castShadowNode),s.castShadowPositionNode&&s.castShadowPositionNode.isNode&&(d=y.positionNode,y.positionNode=s.castShadowPositionNode)),s=y}s.transparent===!0&&s.side===dr&&s.forceSinglePass===!1?(s.side=An,this._handleObjectFunction(e,s,t,n,l,a,u,"backSide"),s.side=Lr,this._handleObjectFunction(e,s,t,n,l,a,u,h),s.side=dr):this._handleObjectFunction(e,s,t,n,l,a,u,h),d!==void 0&&(t.overrideMaterial.positionNode=d),g!==void 0&&(t.overrideMaterial.depthNode=g),p!==void 0&&(t.overrideMaterial.colorNode=p),e.onAfterRender(this,t,n,r,s,a)}_renderObjectDirect(e,t,n,r,s,a,l,u){const h=this._objects.get(e,t,n,r,s,this._currentRenderContext,l,u);h.drawRange=e.geometry.drawRange,h.group=a;const d=this._nodes.needsRefresh(h);d&&(this._nodes.updateBefore(h),this._geometries.updateForRender(h),this._nodes.updateForRender(h),this._bindings.updateForRender(h)),this._pipelines.updateForRender(h),this._currentRenderBundle!==null&&(this.backend.get(this._currentRenderBundle).renderObjects.push(h),h.bundle=this._currentRenderBundle.bundleGroup),this.backend.draw(h,this.info),d&&this._nodes.updateAfter(h)}_createObjectPipeline(e,t,n,r,s,a,l,u){const h=this._objects.get(e,t,n,r,s,this._currentRenderContext,l,u);h.drawRange=e.geometry.drawRange,h.group=a,this._nodes.updateBefore(h),this._geometries.updateForRender(h),this._nodes.updateForRender(h),this._bindings.updateForRender(h),this._pipelines.getForRender(h,this._compilationPromises),this._nodes.updateAfter(h)}get compile(){return this.compileAsync}}class GE{constructor(e=""){this.name=e,this.visibility=0}setVisibility(e){this.visibility|=e}clone(){return Object.assign(new this.constructor,this)}}function Rre(i){return i+(nl-i%nl)%nl}class II extends GE{constructor(e,t=null){super(e),this.isBuffer=!0,this.bytesPerElement=Float32Array.BYTES_PER_ELEMENT,this._buffer=t}get byteLength(){return Rre(this._buffer.byteLength)}get buffer(){return this._buffer}update(){return!0}}class FI extends II{constructor(e,t=null){super(e,t),this.isUniformBuffer=!0}}let Cre=0;class kI extends FI{constructor(e,t){super("UniformBuffer_"+Cre++,e?e.value:null),this.nodeUniform=e,this.groupNode=t}get buffer(){return this.nodeUniform.value}}class Nre extends FI{constructor(e){super(e),this.isUniformsGroup=!0,this._values=null,this.uniforms=[]}addUniform(e){return this.uniforms.push(e),this}removeUniform(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}get values(){return this._values===null&&(this._values=Array.from(this.buffer)),this._values}get buffer(){let e=this._buffer;if(e===null){const t=this.byteLength;e=new Float32Array(new ArrayBuffer(t)),this._buffer=e}return e}get byteLength(){const e=this.bytesPerElement;let t=0;for(let n=0,r=this.uniforms.length;n<r;n++){const s=this.uniforms[n],a=s.boundary,l=s.itemSize*e,u=t%nl,h=u%a,d=u+h;t+=h,d!==0&&nl-d<l&&(t+=nl-d),s.offset=t/e,t+=l}return Math.ceil(t/nl)*nl}update(){let e=!1;for(const t of this.uniforms)this.updateByType(t)===!0&&(e=!0);return e}updateByType(e){if(e.isNumberUniform)return this.updateNumber(e);if(e.isVector2Uniform)return this.updateVector2(e);if(e.isVector3Uniform)return this.updateVector3(e);if(e.isVector4Uniform)return this.updateVector4(e);if(e.isColorUniform)return this.updateColor(e);if(e.isMatrix3Uniform)return this.updateMatrix3(e);if(e.isMatrix4Uniform)return this.updateMatrix4(e);console.error("THREE.WebGPUUniformsGroup: Unsupported uniform type.",e)}updateNumber(e){let t=!1;const n=this.values,r=e.getValue(),s=e.offset,a=e.getType();if(n[s]!==r){const l=this._getBufferForType(a);l[s]=n[s]=r,t=!0}return t}updateVector2(e){let t=!1;const n=this.values,r=e.getValue(),s=e.offset,a=e.getType();if(n[s+0]!==r.x||n[s+1]!==r.y){const l=this._getBufferForType(a);l[s+0]=n[s+0]=r.x,l[s+1]=n[s+1]=r.y,t=!0}return t}updateVector3(e){let t=!1;const n=this.values,r=e.getValue(),s=e.offset,a=e.getType();if(n[s+0]!==r.x||n[s+1]!==r.y||n[s+2]!==r.z){const l=this._getBufferForType(a);l[s+0]=n[s+0]=r.x,l[s+1]=n[s+1]=r.y,l[s+2]=n[s+2]=r.z,t=!0}return t}updateVector4(e){let t=!1;const n=this.values,r=e.getValue(),s=e.offset,a=e.getType();if(n[s+0]!==r.x||n[s+1]!==r.y||n[s+2]!==r.z||n[s+4]!==r.w){const l=this._getBufferForType(a);l[s+0]=n[s+0]=r.x,l[s+1]=n[s+1]=r.y,l[s+2]=n[s+2]=r.z,l[s+3]=n[s+3]=r.w,t=!0}return t}updateColor(e){let t=!1;const n=this.values,r=e.getValue(),s=e.offset;if(n[s+0]!==r.r||n[s+1]!==r.g||n[s+2]!==r.b){const a=this.buffer;a[s+0]=n[s+0]=r.r,a[s+1]=n[s+1]=r.g,a[s+2]=n[s+2]=r.b,t=!0}return t}updateMatrix3(e){let t=!1;const n=this.values,r=e.getValue().elements,s=e.offset;if(n[s+0]!==r[0]||n[s+1]!==r[1]||n[s+2]!==r[2]||n[s+4]!==r[3]||n[s+5]!==r[4]||n[s+6]!==r[5]||n[s+8]!==r[6]||n[s+9]!==r[7]||n[s+10]!==r[8]){const a=this.buffer;a[s+0]=n[s+0]=r[0],a[s+1]=n[s+1]=r[1],a[s+2]=n[s+2]=r[2],a[s+4]=n[s+4]=r[3],a[s+5]=n[s+5]=r[4],a[s+6]=n[s+6]=r[5],a[s+8]=n[s+8]=r[6],a[s+9]=n[s+9]=r[7],a[s+10]=n[s+10]=r[8],t=!0}return t}updateMatrix4(e){let t=!1;const n=this.values,r=e.getValue().elements,s=e.offset;return Dre(n,r,s)===!1&&(this.buffer.set(r,s),Pre(n,r,s),t=!0),t}_getBufferForType(e){return e==="int"||e==="ivec2"||e==="ivec3"||e==="ivec4"?new Int32Array(this.buffer.buffer):e==="uint"||e==="uvec2"||e==="uvec3"||e==="uvec4"?new Uint32Array(this.buffer.buffer):this.buffer}}function Pre(i,e,t){for(let n=0,r=e.length;n<r;n++)i[t+n]=e[n]}function Dre(i,e,t){for(let n=0,r=e.length;n<r;n++)if(i[t+n]!==e[n])return!1;return!0}let Lre=0;class zI extends Nre{constructor(e,t){super(e),this.id=Lre++,this.groupNode=t,this.isNodeUniformsGroup=!0}}let Ure=0;class Ore extends GE{constructor(e,t){super(e),this.id=Ure++,this.texture=t,this.version=t?t.version:0,this.store=!1,this.generation=null,this.isSampledTexture=!0}needsBindingsUpdate(e){const{texture:t}=this;return e!==this.generation?(this.generation=e,!0):t.isVideoTexture}update(){const{texture:e,version:t}=this;return t!==e.version?(this.version=e.version,!0):!1}}class Xv extends Ore{constructor(e,t,n,r=null){super(e,t?t.value:null),this.textureNode=t,this.groupNode=n,this.access=r}needsBindingsUpdate(e){return this.textureNode.value!==this.texture||super.needsBindingsUpdate(e)}update(){const{textureNode:e}=this;return this.texture!==e.value?(this.texture=e.value,!0):super.update()}}class VI extends Xv{constructor(e,t,n,r=null){super(e,t,n,r),this.isSampledCubeTexture=!0}}class GI extends Xv{constructor(e,t,n,r=null){super(e,t,n,r),this.isSampledTexture3D=!0}}const Bre={textureDimensions:"textureSize",equals:"equal"},Ire={low:"lowp",medium:"mediump",high:"highp"},h2={swizzleAssign:!0,storageBuffer:!1},f2={perspective:"smooth",linear:"noperspective"},d2={centroid:"centroid","flat first":"flat","flat either":"flat"},p2=`
precision highp float;
precision highp int;
precision highp sampler2D;
precision highp sampler3D;
precision highp samplerCube;
precision highp sampler2DArray;

precision highp usampler2D;
precision highp usampler3D;
precision highp usamplerCube;
precision highp usampler2DArray;

precision highp isampler2D;
precision highp isampler3D;
precision highp isamplerCube;
precision highp isampler2DArray;

precision lowp sampler2DShadow;
precision lowp sampler2DArrayShadow;
precision lowp samplerCubeShadow;
`;class Fre extends UI{constructor(e,t){super(e,t,new dre),this.uniformGroups={},this.transforms=[],this.extensions={},this.builtins={vertex:[],fragment:[],compute:[]}}needsToWorkingColorSpace(e){return e.isVideoTexture===!0&&e.colorSpace!==pr}getMethod(e){return Bre[e]||e}getOutputStructName(){return""}buildFunctionCode(e){const t=e.layout,n=this.flowShaderNode(e),r=[];for(const a of t.inputs)r.push(this.getType(a.type)+" "+a.name);return`${this.getType(t.type)} ${t.name}( ${r.join(", ")} ) {

	${n.vars}

${n.code}
	return ${n.result};

}`}setupPBO(e){const t=e.value;if(t.pbo===void 0){const n=t.array,r=t.count*t.itemSize,{itemSize:s}=t,a=t.array.constructor.name.toLowerCase().includes("int");let l=a?Wh:Gp;s===2?l=a?jh:to:s===3?l=a?c6:Vp:s===4&&(l=a?qh:Xn);const u={Float32Array:Jn,Uint8Array:Gn,Uint16Array:ks,Uint32Array:En,Int8Array:gu,Int16Array:yu,Int32Array:Li,Uint8ClampedArray:Gn},h=Math.pow(2,Math.ceil(Math.log2(Math.sqrt(r/s))));let d=Math.ceil(r/s/h);h*d*s<r&&d++;const p=h*d*s,g=new n.constructor(p);g.set(n,0),t.array=g;const y=new p8(t.array,h,d,l,u[t.array.constructor.name]||Jn);y.needsUpdate=!0,y.isPBOTexture=!0;const v=new Kh(y,null,null);v.setPrecision("high"),t.pboNode=v,t.pbo=v.value,this.getUniformFromNode(t.pboNode,"texture",this.shaderStage,this.context.label)}}getPropertyName(e,t=this.shaderStage){return e.isNodeUniform&&e.node.isTextureNode!==!0&&e.node.isBufferNode!==!0?t.charAt(0)+"_"+e.name:super.getPropertyName(e,t)}generatePBO(e){const{node:t,indexNode:n}=e,r=t.value;if(this.renderer.backend.has(r)){const d=this.renderer.backend.get(r);d.pbo=r.pbo}const s=this.getUniformFromNode(r.pboNode,"texture",this.shaderStage,this.context.label),a=this.getPropertyName(s);this.increaseUsage(n);const l=n.build(this,"uint"),u=this.getDataFromNode(e);let h=u.propertyName;if(h===void 0){const d=this.getVarFromNode(e);h=this.getPropertyName(d);const p=this.getDataFromNode(t);let g=p.propertySizeName;g===void 0&&(g=h+"Size",this.getVarFromNode(t,g,"uint"),this.addLineFlowCode(`${g} = uint( textureSize( ${a}, 0 ).x )`,e),p.propertySizeName=g);const{itemSize:y}=r,v="."+Yh.join("").slice(0,y),S=`ivec2(${l} % ${g}, ${l} / ${g})`,b=this.generateTextureLoad(null,a,S,null,"0");let _="vec4";r.pbo.type===En?_="uvec4":r.pbo.type===Li&&(_="ivec4"),this.addLineFlowCode(`${h} = ${_}(${b})${v}`,e),u.propertyName=h}return h}generateTextureLoad(e,t,n,r,s="0"){return r?`texelFetch( ${t}, ivec3( ${n}, ${r} ), ${s} )`:`texelFetch( ${t}, ${n}, ${s} )`}generateTexture(e,t,n,r){return e.isDepthTexture?(r&&(n=`vec4( ${n}, ${r} )`),`texture( ${t}, ${n} ).x`):(r&&(n=`vec3( ${n}, ${r} )`),`texture( ${t}, ${n} )`)}generateTextureLevel(e,t,n,r){return`textureLod( ${t}, ${n}, ${r} )`}generateTextureBias(e,t,n,r){return`texture( ${t}, ${n}, ${r} )`}generateTextureGrad(e,t,n,r){return`textureGrad( ${t}, ${n}, ${r[0]}, ${r[1]} )`}generateTextureCompare(e,t,n,r,s,a=this.shaderStage){if(a==="fragment")return s?`texture( ${t}, vec4( ${n}, ${s}, ${r} ) )`:`texture( ${t}, vec3( ${n}, ${r} ) )`;console.error(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${a} shader.`)}getVars(e){const t=[],n=this.vars[e];if(n!==void 0)for(const r of n)t.push(`${this.getVar(r.type,r.name,r.count)};`);return t.join(`
	`)}getUniforms(e){const t=this.uniforms[e],n=[],r={};for(const a of t){let l=null,u=!1;if(a.type==="texture"||a.type==="texture3D"){const d=a.node.value;let p="";(d.isDataTexture===!0||d.isData3DTexture===!0)&&(d.type===En?p="u":d.type===Li&&(p="i")),a.type==="texture3D"&&d.isArrayTexture===!1?l=`${p}sampler3D ${a.name};`:d.compareFunction?d.isArrayTexture===!0?l=`sampler2DArrayShadow ${a.name};`:l=`sampler2DShadow ${a.name};`:d.isArrayTexture===!0||d.isDataArrayTexture===!0||d.isCompressedArrayTexture===!0?l=`${p}sampler2DArray ${a.name};`:l=`${p}sampler2D ${a.name};`}else if(a.type==="cubeTexture")l=`samplerCube ${a.name};`;else if(a.type==="buffer"){const d=a.node,p=this.getType(d.bufferType),g=d.bufferCount,y=g>0?g:"";l=`${d.name} {
	${p} ${a.name}[${y}];
};
`}else l=`${this.getVectorType(a.type)} ${this.getPropertyName(a,e)};`,u=!0;const h=a.node.precision;if(h!==null&&(l=Ire[h]+" "+l),u){l="	"+l;const d=a.groupNode.name;(r[d]||(r[d]=[])).push(l)}else l="uniform "+l,n.push(l)}let s="";for(const a in r){const l=r[a];s+=this._getGLSLUniformStruct(e+"_"+a,l.join(`
`))+`
`}return s+=n.join(`
`),s}getTypeFromAttribute(e){let t=super.getTypeFromAttribute(e);if(/^[iu]/.test(t)&&e.gpuType!==Li){let n=e;e.isInterleavedBufferAttribute&&(n=e.data);const r=n.array;r instanceof Uint32Array||r instanceof Int32Array||(t=t.slice(1))}return t}getAttributes(e){let t="";if(e==="vertex"||e==="compute"){const n=this.getAttributesArray();let r=0;for(const s of n)t+=`layout( location = ${r++} ) in ${s.type} ${s.name};
`}return t}getStructMembers(e){const t=[];for(const n of e.members)t.push(`	${n.type} ${n.name};`);return t.join(`
`)}getStructs(e){const t=[],n=this.structs[e],r=[];for(const s of n)if(s.output)for(const a of s.members)r.push(`layout( location = ${a.index} ) out ${a.type} ${a.name};`);else{let a="struct "+s.name+` {
`;a+=this.getStructMembers(s),a+=`
};
`,t.push(a)}return r.length===0&&r.push("layout( location = 0 ) out vec4 fragColor;"),`
`+r.join(`
`)+`

`+t.join(`
`)}getVaryings(e){let t="";const n=this.varyings;if(e==="vertex"||e==="compute")for(const r of n){e==="compute"&&(r.needsInterpolation=!0);const s=this.getType(r.type);if(r.needsInterpolation)if(r.interpolationType){const a=f2[r.interpolationType]||r.interpolationType,l=d2[r.interpolationSampling]||"";t+=`${a} ${l} out ${s} ${r.name};
`}else{const a=s.includes("int")||s.includes("uv")||s.includes("iv")?"flat ":"";t+=`${a}out ${s} ${r.name};
`}else t+=`${s} ${r.name};
`}else if(e==="fragment"){for(const r of n)if(r.needsInterpolation){const s=this.getType(r.type);if(r.interpolationType){const a=f2[r.interpolationType]||r.interpolationType,l=d2[r.interpolationSampling]||"";t+=`${a} ${l} in ${s} ${r.name};
`}else{const a=s.includes("int")||s.includes("uv")||s.includes("iv")?"flat ":"";t+=`${a}in ${s} ${r.name};
`}}}for(const r of this.builtins[e])t+=`${r};
`;return t}getVertexIndex(){return"uint( gl_VertexID )"}getInstanceIndex(){return"uint( gl_InstanceID )"}getInvocationLocalIndex(){return`uint( gl_InstanceID ) % ${this.object.workgroupSize.reduce((n,r)=>n*r,1)}u`}getDrawIndex(){return this.renderer.backend.extensions.has("WEBGL_multi_draw")?"uint( gl_DrawID )":null}getFrontFacing(){return"gl_FrontFacing"}getFragCoord(){return"gl_FragCoord.xy"}getFragDepth(){return"gl_FragDepth"}enableExtension(e,t,n=this.shaderStage){const r=this.extensions[n]||(this.extensions[n]=new Map);r.has(e)===!1&&r.set(e,{name:e,behavior:t})}getExtensions(e){const t=[];if(e==="vertex"){const r=this.renderer.backend.extensions;this.object.isBatchedMesh&&r.has("WEBGL_multi_draw")&&this.enableExtension("GL_ANGLE_multi_draw","require",e)}const n=this.extensions[e];if(n!==void 0)for(const{name:r,behavior:s}of n.values())t.push(`#extension ${r} : ${s}`);return t.join(`
`)}getClipDistance(){return"gl_ClipDistance"}isAvailable(e){let t=h2[e];if(t===void 0){let n;switch(t=!1,e){case"float32Filterable":n="OES_texture_float_linear";break;case"clipDistance":n="WEBGL_clip_cull_distance";break}if(n!==void 0){const r=this.renderer.backend.extensions;r.has(n)&&(r.get(n),t=!0)}h2[e]=t}return t}isFlipY(){return!0}enableHardwareClipping(e){this.enableExtension("GL_ANGLE_clip_cull_distance","require"),this.builtins.vertex.push(`out float gl_ClipDistance[ ${e} ]`)}enableMultiview(){this.enableExtension("GL_OVR_multiview2","require","fragment"),this.enableExtension("GL_OVR_multiview2","require","vertex"),this.builtins.vertex.push("layout(num_views = 2) in")}registerTransform(e,t){this.transforms.push({varyingName:e,attributeNode:t})}getTransforms(){const e=this.transforms;let t="";for(let n=0;n<e.length;n++){const r=e[n],s=this.getPropertyName(r.attributeNode);s&&(t+=`${r.varyingName} = ${s};
	`)}return t}_getGLSLUniformStruct(e,t){return`
layout( std140 ) uniform ${e} {
${t}
};`}_getGLSLVertexCode(e){return`#version 300 es

${this.getSignature()}

// extensions
${e.extensions}

// precision
${p2}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// attributes
${e.attributes}

// codes
${e.codes}

void main() {

	// vars
	${e.vars}

	// transforms
	${e.transforms}

	// flow
	${e.flow}

	gl_PointSize = 1.0;

}
`}_getGLSLFragmentCode(e){return`#version 300 es

${this.getSignature()}

// extensions
${e.extensions}

// precision
${p2}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// codes
${e.codes}

// structs
${e.structs}

void main() {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}buildCode(){const e=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){let n=`// code

`;n+=this.flowCode[t];const r=this.flowNodes[t],s=r[r.length-1];for(const l of r){const u=this.getFlowData(l),h=l.name;h&&(n.length>0&&(n+=`
`),n+=`	// flow -> ${h}
	`),n+=`${u.code}
	`,l===s&&t!=="compute"&&(n+=`// result
	`,t==="vertex"?(n+="gl_Position = ",n+=`${u.result};`):t==="fragment"&&(l.outputNode.isOutputStructNode||(n+="fragColor = ",n+=`${u.result};`)))}const a=e[t];a.extensions=this.getExtensions(t),a.uniforms=this.getUniforms(t),a.attributes=this.getAttributes(t),a.varyings=this.getVaryings(t),a.vars=this.getVars(t),a.structs=this.getStructs(t),a.codes=this.getCodes(t),a.transforms=this.getTransforms(t),a.flow=n}this.material!==null?(this.vertexShader=this._getGLSLVertexCode(e.vertex),this.fragmentShader=this._getGLSLFragmentCode(e.fragment)):this.computeShader=this._getGLSLVertexCode(e.compute)}getUniformFromNode(e,t,n,r=null){const s=super.getUniformFromNode(e,t,n,r),a=this.getDataFromNode(e,n,this.globalCache);let l=a.uniformGPU;if(l===void 0){const u=e.groupNode,h=u.name,d=this.getBindGroupArray(h,n);if(t==="texture")l=new Xv(s.name,s.node,u),d.push(l);else if(t==="cubeTexture")l=new VI(s.name,s.node,u),d.push(l);else if(t==="texture3D")l=new GI(s.name,s.node,u),d.push(l);else if(t==="buffer"){e.name=`NodeBuffer_${e.id}`,s.name=`buffer${e.id}`;const p=new kI(e,u);p.name=e.name,d.push(p),l=p}else{const p=this.uniformGroups[n]||(this.uniformGroups[n]={});let g=p[h];g===void 0&&(g=new zI(n+"_"+h,u),p[h]=g,d.push(g)),l=this.getNodeUniform(s,t),g.addUniform(l)}a.uniformGPU=l}return s}}let Kb=null,Bc=null;class HI{constructor(e={}){this.parameters=Object.assign({},e),this.data=new WeakMap,this.renderer=null,this.domElement=null,this.timestampQueryPool={render:null,compute:null},this.trackTimestamp=e.trackTimestamp===!0}async init(e){this.renderer=e}get coordinateSystem(){}beginRender(){}finishRender(){}beginCompute(){}finishCompute(){}draw(){}compute(){}createProgram(){}destroyProgram(){}createBindings(){}updateBindings(){}updateBinding(){}createRenderPipeline(){}createComputePipeline(){}needsRenderUpdate(){}getRenderCacheKey(){}createNodeBuilder(){}createSampler(){}destroySampler(){}createDefaultTexture(){}createTexture(){}updateTexture(){}generateMipmaps(){}destroyTexture(){}async copyTextureToBuffer(){}copyTextureToTexture(){}copyFramebufferToTexture(){}createAttribute(){}createIndexAttribute(){}createStorageAttribute(){}updateAttribute(){}destroyAttribute(){}getContext(){}updateSize(){}updateViewport(){}isOccluded(){}async resolveTimestampsAsync(e="render"){if(!this.trackTimestamp){rs("WebGPURenderer: Timestamp tracking is disabled.");return}const t=this.timestampQueryPool[e];if(!t){rs(`WebGPURenderer: No timestamp query pool for type '${e}' found.`);return}const n=await t.resolveQueriesAsync();return this.renderer.info[e].timestamp=n,n}async waitForGPU(){}async getArrayBufferAsync(){}async hasFeatureAsync(){}hasFeature(){}getMaxAnisotropy(){}getDrawingBufferSize(){return Kb=Kb||new Le,this.renderer.getDrawingBufferSize(Kb)}setScissorTest(){}getClearColor(){const e=this.renderer;return Bc=Bc||new IE,e.getClearColor(Bc),Bc.getRGB(Bc),Bc}getDomElement(){let e=this.domElement;return e===null&&(e=this.parameters.canvas!==void 0?this.parameters.canvas:tO(),"setAttribute"in e&&e.setAttribute("data-engine",`three.js r${Hh} webgpu`),this.domElement=e),e}set(e,t){this.data.set(e,t)}get(e){let t=this.data.get(e);return t===void 0&&(t={},this.data.set(e,t)),t}has(e){return this.data.has(e)}delete(e){this.data.delete(e)}dispose(){}}let kre=0;class zre{constructor(e,t){this.buffers=[e.bufferGPU,t],this.type=e.type,this.bufferType=e.bufferType,this.pbo=e.pbo,this.byteLength=e.byteLength,this.bytesPerElement=e.BYTES_PER_ELEMENT,this.version=e.version,this.isInteger=e.isInteger,this.activeBufferIndex=0,this.baseId=e.id}get id(){return`${this.baseId}|${this.activeBufferIndex}`}get bufferGPU(){return this.buffers[this.activeBufferIndex]}get transformBuffer(){return this.buffers[this.activeBufferIndex^1]}switchBuffers(){this.activeBufferIndex^=1}}class Vre{constructor(e){this.backend=e}createAttribute(e,t){const n=this.backend,{gl:r}=n,s=e.array,a=e.usage||r.STATIC_DRAW,l=e.isInterleavedBufferAttribute?e.data:e,u=n.get(l);let h=u.bufferGPU;h===void 0&&(h=this._createBuffer(r,t,s,a),u.bufferGPU=h,u.bufferType=t,u.version=l.version);let d;if(s instanceof Float32Array)d=r.FLOAT;else if(s instanceof Uint16Array)e.isFloat16BufferAttribute?d=r.HALF_FLOAT:d=r.UNSIGNED_SHORT;else if(s instanceof Int16Array)d=r.SHORT;else if(s instanceof Uint32Array)d=r.UNSIGNED_INT;else if(s instanceof Int32Array)d=r.INT;else if(s instanceof Int8Array)d=r.BYTE;else if(s instanceof Uint8Array)d=r.UNSIGNED_BYTE;else if(s instanceof Uint8ClampedArray)d=r.UNSIGNED_BYTE;else throw new Error("THREE.WebGLBackend: Unsupported buffer data format: "+s);let p={bufferGPU:h,bufferType:t,type:d,byteLength:s.byteLength,bytesPerElement:s.BYTES_PER_ELEMENT,version:e.version,pbo:e.pbo,isInteger:d===r.INT||d===r.UNSIGNED_INT||e.gpuType===Li,id:kre++};if(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute){const g=this._createBuffer(r,t,s,a);p=new zre(p,g)}n.set(e,p)}updateAttribute(e){const t=this.backend,{gl:n}=t,r=e.array,s=e.isInterleavedBufferAttribute?e.data:e,a=t.get(s),l=a.bufferType,u=e.isInterleavedBufferAttribute?e.data.updateRanges:e.updateRanges;if(n.bindBuffer(l,a.bufferGPU),u.length===0)n.bufferSubData(l,0,r);else{for(let h=0,d=u.length;h<d;h++){const p=u[h];n.bufferSubData(l,p.start*r.BYTES_PER_ELEMENT,r,p.start,p.count)}s.clearUpdateRanges()}n.bindBuffer(l,null),a.version=s.version}destroyAttribute(e){const t=this.backend,{gl:n}=t;e.isInterleavedBufferAttribute&&t.delete(e.data);const r=t.get(e);n.deleteBuffer(r.bufferGPU),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,{gl:n}=t,r=e.isInterleavedBufferAttribute?e.data:e,{bufferGPU:s}=t.get(r),a=e.array,l=a.byteLength;n.bindBuffer(n.COPY_READ_BUFFER,s);const u=n.createBuffer();n.bindBuffer(n.COPY_WRITE_BUFFER,u),n.bufferData(n.COPY_WRITE_BUFFER,l,n.STREAM_READ),n.copyBufferSubData(n.COPY_READ_BUFFER,n.COPY_WRITE_BUFFER,0,0,l),await t.utils._clientWaitAsync();const h=new e.array.constructor(a.length);return n.bindBuffer(n.COPY_WRITE_BUFFER,u),n.getBufferSubData(n.COPY_WRITE_BUFFER,0,h),n.deleteBuffer(u),n.bindBuffer(n.COPY_READ_BUFFER,null),n.bindBuffer(n.COPY_WRITE_BUFFER,null),h.buffer}_createBuffer(e,t,n,r){const s=e.createBuffer();return e.bindBuffer(t,s),e.bufferData(t,n,r),e.bindBuffer(t,null),s}}let Zb,Td;class Gre{constructor(e){this.backend=e,this.gl=this.backend.gl,this.enabled={},this.currentFlipSided=null,this.currentCullFace=null,this.currentProgram=null,this.currentBlendingEnabled=!1,this.currentBlending=null,this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentPremultipledAlpha=null,this.currentPolygonOffsetFactor=null,this.currentPolygonOffsetUnits=null,this.currentColorMask=null,this.currentDepthFunc=null,this.currentDepthMask=null,this.currentStencilFunc=null,this.currentStencilRef=null,this.currentStencilFuncMask=null,this.currentStencilFail=null,this.currentStencilZFail=null,this.currentStencilZPass=null,this.currentStencilMask=null,this.currentLineWidth=null,this.currentClippingPlanes=0,this.currentVAO=null,this.currentIndex=null,this.currentBoundFramebuffers={},this.currentDrawbuffers=new WeakMap,this.maxTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this.currentTextureSlot=null,this.currentBoundTextures={},this.currentBoundBufferBases={},this._init()}_init(){const e=this.gl;Zb={[er]:e.FUNC_ADD,[xM]:e.FUNC_SUBTRACT,[bM]:e.FUNC_REVERSE_SUBTRACT},Td={[qa]:e.ZERO,[SM]:e.ONE,[TM]:e.SRC_COLOR,[ap]:e.SRC_ALPHA,[CM]:e.SRC_ALPHA_SATURATE,[wM]:e.DST_COLOR,[EM]:e.DST_ALPHA,[MM]:e.ONE_MINUS_SRC_COLOR,[op]:e.ONE_MINUS_SRC_ALPHA,[RM]:e.ONE_MINUS_DST_COLOR,[AM]:e.ONE_MINUS_DST_ALPHA};const t=e.getParameter(e.SCISSOR_BOX),n=e.getParameter(e.VIEWPORT);this.currentScissor=new bt().fromArray(t),this.currentViewport=new bt().fromArray(n),this._tempVec4=new bt}enable(e){const{enabled:t}=this;t[e]!==!0&&(this.gl.enable(e),t[e]=!0)}disable(e){const{enabled:t}=this;t[e]!==!1&&(this.gl.disable(e),t[e]=!1)}setFlipSided(e){if(this.currentFlipSided!==e){const{gl:t}=this;e?t.frontFace(t.CW):t.frontFace(t.CCW),this.currentFlipSided=e}}setCullFace(e){const{gl:t}=this;e!==GU?(this.enable(t.CULL_FACE),e!==this.currentCullFace&&(e===HS?t.cullFace(t.BACK):e===HU?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):this.disable(t.CULL_FACE),this.currentCullFace=e}setLineWidth(e){const{currentLineWidth:t,gl:n}=this;e!==t&&(n.lineWidth(e),this.currentLineWidth=e)}setBlending(e,t,n,r,s,a,l,u){const{gl:h}=this;if(e===Ur){this.currentBlendingEnabled===!0&&(this.disable(h.BLEND),this.currentBlendingEnabled=!1);return}if(this.currentBlendingEnabled===!1&&(this.enable(h.BLEND),this.currentBlendingEnabled=!0),e!==Zc){if(e!==this.currentBlending||u!==this.currentPremultipledAlpha){if((this.currentBlendEquation!==er||this.currentBlendEquationAlpha!==er)&&(h.blendEquation(h.FUNC_ADD),this.currentBlendEquation=er,this.currentBlendEquationAlpha=er),u)switch(e){case es:h.blendFuncSeparate(h.ONE,h.ONE_MINUS_SRC_ALPHA,h.ONE,h.ONE_MINUS_SRC_ALPHA);break;case lh:h.blendFunc(h.ONE,h.ONE);break;case uh:h.blendFuncSeparate(h.ZERO,h.ONE_MINUS_SRC_COLOR,h.ZERO,h.ONE);break;case ch:h.blendFuncSeparate(h.ZERO,h.SRC_COLOR,h.ZERO,h.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",e);break}else switch(e){case es:h.blendFuncSeparate(h.SRC_ALPHA,h.ONE_MINUS_SRC_ALPHA,h.ONE,h.ONE_MINUS_SRC_ALPHA);break;case lh:h.blendFunc(h.SRC_ALPHA,h.ONE);break;case uh:h.blendFuncSeparate(h.ZERO,h.ONE_MINUS_SRC_COLOR,h.ZERO,h.ONE);break;case ch:h.blendFunc(h.ZERO,h.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",e);break}this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentBlending=e,this.currentPremultipledAlpha=u}return}s=s||t,a=a||n,l=l||r,(t!==this.currentBlendEquation||s!==this.currentBlendEquationAlpha)&&(h.blendEquationSeparate(Zb[t],Zb[s]),this.currentBlendEquation=t,this.currentBlendEquationAlpha=s),(n!==this.currentBlendSrc||r!==this.currentBlendDst||a!==this.currentBlendSrcAlpha||l!==this.currentBlendDstAlpha)&&(h.blendFuncSeparate(Td[n],Td[r],Td[a],Td[l]),this.currentBlendSrc=n,this.currentBlendDst=r,this.currentBlendSrcAlpha=a,this.currentBlendDstAlpha=l),this.currentBlending=e,this.currentPremultipledAlpha=!1}setColorMask(e){this.currentColorMask!==e&&(this.gl.colorMask(e,e,e,e),this.currentColorMask=e)}setDepthTest(e){const{gl:t}=this;e?this.enable(t.DEPTH_TEST):this.disable(t.DEPTH_TEST)}setDepthMask(e){this.currentDepthMask!==e&&(this.gl.depthMask(e),this.currentDepthMask=e)}setDepthFunc(e){if(this.currentDepthFunc!==e){const{gl:t}=this;switch(e){case lp:t.depthFunc(t.NEVER);break;case up:t.depthFunc(t.ALWAYS);break;case cp:t.depthFunc(t.LESS);break;case hl:t.depthFunc(t.LEQUAL);break;case hp:t.depthFunc(t.EQUAL);break;case fp:t.depthFunc(t.GEQUAL);break;case dp:t.depthFunc(t.GREATER);break;case pp:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}this.currentDepthFunc=e}}scissor(e,t,n,r){const s=this._tempVec4.set(e,t,n,r);if(this.currentScissor.equals(s)===!1){const{gl:a}=this;a.scissor(s.x,s.y,s.z,s.w),this.currentScissor.copy(s)}}viewport(e,t,n,r){const s=this._tempVec4.set(e,t,n,r);if(this.currentViewport.equals(s)===!1){const{gl:a}=this;a.viewport(s.x,s.y,s.z,s.w),this.currentViewport.copy(s)}}setScissorTest(e){const t=this.gl;e?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST)}setStencilTest(e){const{gl:t}=this;e?this.enable(t.STENCIL_TEST):this.disable(t.STENCIL_TEST)}setStencilMask(e){this.currentStencilMask!==e&&(this.gl.stencilMask(e),this.currentStencilMask=e)}setStencilFunc(e,t,n){(this.currentStencilFunc!==e||this.currentStencilRef!==t||this.currentStencilFuncMask!==n)&&(this.gl.stencilFunc(e,t,n),this.currentStencilFunc=e,this.currentStencilRef=t,this.currentStencilFuncMask=n)}setStencilOp(e,t,n){(this.currentStencilFail!==e||this.currentStencilZFail!==t||this.currentStencilZPass!==n)&&(this.gl.stencilOp(e,t,n),this.currentStencilFail=e,this.currentStencilZFail=t,this.currentStencilZPass=n)}setMaterial(e,t,n){const{gl:r}=this;e.side===dr?this.disable(r.CULL_FACE):this.enable(r.CULL_FACE);let s=e.side===An;t&&(s=!s),this.setFlipSided(s),e.blending===es&&e.transparent===!1?this.setBlending(Ur):this.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),this.setDepthFunc(e.depthFunc),this.setDepthTest(e.depthTest),this.setDepthMask(e.depthWrite),this.setColorMask(e.colorWrite);const a=e.stencilWrite;if(this.setStencilTest(a),a&&(this.setStencilMask(e.stencilWriteMask),this.setStencilFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),this.setStencilOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),this.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),e.alphaToCoverage===!0&&this.backend.renderer.samples>1?this.enable(r.SAMPLE_ALPHA_TO_COVERAGE):this.disable(r.SAMPLE_ALPHA_TO_COVERAGE),n>0&&this.currentClippingPlanes!==n)for(let u=0;u<8;u++)u<n?this.enable(12288+u):this.disable(12288+u)}setPolygonOffset(e,t,n){const{gl:r}=this;e?(this.enable(r.POLYGON_OFFSET_FILL),(this.currentPolygonOffsetFactor!==t||this.currentPolygonOffsetUnits!==n)&&(r.polygonOffset(t,n),this.currentPolygonOffsetFactor=t,this.currentPolygonOffsetUnits=n)):this.disable(r.POLYGON_OFFSET_FILL)}useProgram(e){return this.currentProgram!==e?(this.gl.useProgram(e),this.currentProgram=e,!0):!1}setVertexState(e,t=null){const n=this.gl;return this.currentVAO!==e||this.currentIndex!==t?(n.bindVertexArray(e),t!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),this.currentVAO=e,this.currentIndex=t,!0):!1}resetVertexState(){const e=this.gl;e.bindVertexArray(null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),this.currentVAO=null,this.currentIndex=null}bindFramebuffer(e,t){const{gl:n,currentBoundFramebuffers:r}=this;return r[e]!==t?(n.bindFramebuffer(e,t),r[e]=t,e===n.DRAW_FRAMEBUFFER&&(r[n.FRAMEBUFFER]=t),e===n.FRAMEBUFFER&&(r[n.DRAW_FRAMEBUFFER]=t),!0):!1}drawBuffers(e,t){const{gl:n}=this;let r=[],s=!1;if(e.textures!==null){r=this.currentDrawbuffers.get(t),r===void 0&&(r=[],this.currentDrawbuffers.set(t,r));const a=e.textures;if(r.length!==a.length||r[0]!==n.COLOR_ATTACHMENT0){for(let l=0,u=a.length;l<u;l++)r[l]=n.COLOR_ATTACHMENT0+l;r.length=a.length,s=!0}}else r[0]!==n.BACK&&(r[0]=n.BACK,s=!0);s&&n.drawBuffers(r)}activeTexture(e){const{gl:t,currentTextureSlot:n,maxTextures:r}=this;e===void 0&&(e=t.TEXTURE0+r-1),n!==e&&(t.activeTexture(e),this.currentTextureSlot=e)}bindTexture(e,t,n){const{gl:r,currentTextureSlot:s,currentBoundTextures:a,maxTextures:l}=this;n===void 0&&(s===null?n=r.TEXTURE0+l-1:n=s);let u=a[n];u===void 0&&(u={type:void 0,texture:void 0},a[n]=u),(u.type!==e||u.texture!==t)&&(s!==n&&(r.activeTexture(n),this.currentTextureSlot=n),r.bindTexture(e,t),u.type=e,u.texture=t)}bindBufferBase(e,t,n){const{gl:r}=this,s=`${e}-${t}`;return this.currentBoundBufferBases[s]!==n?(r.bindBufferBase(e,t,n),this.currentBoundBufferBases[s]=n,!0):!1}unbindTexture(){const{gl:e,currentTextureSlot:t,currentBoundTextures:n}=this,r=n[t];r!==void 0&&r.type!==void 0&&(e.bindTexture(r.type,null),r.type=void 0,r.texture=void 0)}}class Hre{constructor(e){this.backend=e,this.gl=this.backend.gl,this.extensions=e.extensions}convert(e,t=pr){const{gl:n,extensions:r}=this;let s;const a=wt.getTransfer(t);if(e===Gn)return n.UNSIGNED_BYTE;if(e===_v)return n.UNSIGNED_SHORT_4_4_4_4;if(e===xv)return n.UNSIGNED_SHORT_5_5_5_1;if(e===bv)return n.UNSIGNED_INT_5_9_9_9_REV;if(e===gu)return n.BYTE;if(e===yu)return n.SHORT;if(e===ks)return n.UNSIGNED_SHORT;if(e===Li)return n.INT;if(e===En)return n.UNSIGNED_INT;if(e===Jn)return n.FLOAT;if(e===Oi)return n.HALF_FLOAT;if(e===DM)return n.ALPHA;if(e===Vp)return n.RGB;if(e===Xn)return n.RGBA;if(e===ns)return n.DEPTH_COMPONENT;if(e===is)return n.DEPTH_STENCIL;if(e===Gp)return n.RED;if(e===Wh)return n.RED_INTEGER;if(e===to)return n.RG;if(e===jh)return n.RG_INTEGER;if(e===qh)return n.RGBA_INTEGER;if(e===vu||e===sl||e===al||e===ol)if(a===Ze)if(s=r.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(e===vu)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(e===sl)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(e===al)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(e===ol)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=r.get("WEBGL_compressed_texture_s3tc"),s!==null){if(e===vu)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===sl)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===al)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===ol)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(e===mp||e===gp||e===yp||e===vp)if(s=r.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(e===mp)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===gp)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===yp)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===vp)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(e===_p||e===dh||e===ph)if(s=r.get("WEBGL_compressed_texture_etc"),s!==null){if(e===_p||e===dh)return a===Ze?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(e===ph)return a===Ze?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(e===mh||e===gh||e===yh||e===vh||e===_h||e===xh||e===bh||e===Sh||e===Th||e===Mh||e===Eh||e===Ah||e===wh||e===Rh)if(s=r.get("WEBGL_compressed_texture_astc"),s!==null){if(e===mh)return a===Ze?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(e===gh)return a===Ze?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(e===yh)return a===Ze?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(e===vh)return a===Ze?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(e===_h)return a===Ze?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(e===xh)return a===Ze?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(e===bh)return a===Ze?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(e===Sh)return a===Ze?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(e===Th)return a===Ze?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(e===Mh)return a===Ze?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(e===Eh)return a===Ze?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(e===Ah)return a===Ze?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(e===wh)return a===Ze?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(e===Rh)return a===Ze?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(e===_u)if(s=r.get("EXT_texture_compression_bptc"),s!==null){if(e===_u)return a===Ze?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(e===LM||e===xp||e===bp||e===Sp)if(s=r.get("EXT_texture_compression_rgtc"),s!==null){if(e===_u)return s.COMPRESSED_RED_RGTC1_EXT;if(e===xp)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(e===bp)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(e===Sp)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return e===ts?n.UNSIGNED_INT_24_8:n[e]!==void 0?n[e]:null}_clientWaitAsync(){const{gl:e}=this,t=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);return e.flush(),new Promise((n,r)=>{function s(){const a=e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0);if(a===e.WAIT_FAILED){e.deleteSync(t),r();return}if(a===e.TIMEOUT_EXPIRED){requestAnimationFrame(s);return}e.deleteSync(t),n()}s()})}}let m2=!1,cy,Qb,g2;class Wre{constructor(e){this.backend=e,this.gl=e.gl,this.extensions=e.extensions,this.defaultTextures={},m2===!1&&(this._init(),m2=!0)}_init(){const e=this.gl;cy={[Tu]:e.REPEAT,[ra]:e.CLAMP_TO_EDGE,[Mu]:e.MIRRORED_REPEAT},Qb={[Pn]:e.NEAREST,[PM]:e.NEAREST_MIPMAP_NEAREST,[eo]:e.NEAREST_MIPMAP_LINEAR,[Ti]:e.LINEAR,[Qc]:e.LINEAR_MIPMAP_NEAREST,[Nr]:e.LINEAR_MIPMAP_LINEAR},g2={[UM]:e.NEVER,[kM]:e.ALWAYS,[Sv]:e.LESS,[Tv]:e.LEQUAL,[OM]:e.EQUAL,[FM]:e.GEQUAL,[BM]:e.GREATER,[IM]:e.NOTEQUAL}}getGLTextureType(e){const{gl:t}=this;let n;return e.isCubeTexture===!0?n=t.TEXTURE_CUBE_MAP:e.isArrayTexture===!0||e.isDataArrayTexture===!0||e.isCompressedArrayTexture===!0?n=t.TEXTURE_2D_ARRAY:e.isData3DTexture===!0?n=t.TEXTURE_3D:n=t.TEXTURE_2D,n}getInternalFormat(e,t,n,r,s=!1){const{gl:a,extensions:l}=this;if(e!==null){if(a[e]!==void 0)return a[e];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+e+"'")}let u=t;if(t===a.RED&&(n===a.FLOAT&&(u=a.R32F),n===a.HALF_FLOAT&&(u=a.R16F),n===a.UNSIGNED_BYTE&&(u=a.R8),n===a.UNSIGNED_SHORT&&(u=a.R16),n===a.UNSIGNED_INT&&(u=a.R32UI),n===a.BYTE&&(u=a.R8I),n===a.SHORT&&(u=a.R16I),n===a.INT&&(u=a.R32I)),t===a.RED_INTEGER&&(n===a.UNSIGNED_BYTE&&(u=a.R8UI),n===a.UNSIGNED_SHORT&&(u=a.R16UI),n===a.UNSIGNED_INT&&(u=a.R32UI),n===a.BYTE&&(u=a.R8I),n===a.SHORT&&(u=a.R16I),n===a.INT&&(u=a.R32I)),t===a.RG&&(n===a.FLOAT&&(u=a.RG32F),n===a.HALF_FLOAT&&(u=a.RG16F),n===a.UNSIGNED_BYTE&&(u=a.RG8),n===a.UNSIGNED_SHORT&&(u=a.RG16),n===a.UNSIGNED_INT&&(u=a.RG32UI),n===a.BYTE&&(u=a.RG8I),n===a.SHORT&&(u=a.RG16I),n===a.INT&&(u=a.RG32I)),t===a.RG_INTEGER&&(n===a.UNSIGNED_BYTE&&(u=a.RG8UI),n===a.UNSIGNED_SHORT&&(u=a.RG16UI),n===a.UNSIGNED_INT&&(u=a.RG32UI),n===a.BYTE&&(u=a.RG8I),n===a.SHORT&&(u=a.RG16I),n===a.INT&&(u=a.RG32I)),t===a.RGB){const h=s?Ch:wt.getTransfer(r);n===a.FLOAT&&(u=a.RGB32F),n===a.HALF_FLOAT&&(u=a.RGB16F),n===a.UNSIGNED_BYTE&&(u=a.RGB8),n===a.UNSIGNED_SHORT&&(u=a.RGB16),n===a.UNSIGNED_INT&&(u=a.RGB32UI),n===a.BYTE&&(u=a.RGB8I),n===a.SHORT&&(u=a.RGB16I),n===a.INT&&(u=a.RGB32I),n===a.UNSIGNED_BYTE&&(u=h===Ze?a.SRGB8:a.RGB8),n===a.UNSIGNED_SHORT_5_6_5&&(u=a.RGB565),n===a.UNSIGNED_SHORT_5_5_5_1&&(u=a.RGB5_A1),n===a.UNSIGNED_SHORT_4_4_4_4&&(u=a.RGB4),n===a.UNSIGNED_INT_5_9_9_9_REV&&(u=a.RGB9_E5)}if(t===a.RGB_INTEGER&&(n===a.UNSIGNED_BYTE&&(u=a.RGB8UI),n===a.UNSIGNED_SHORT&&(u=a.RGB16UI),n===a.UNSIGNED_INT&&(u=a.RGB32UI),n===a.BYTE&&(u=a.RGB8I),n===a.SHORT&&(u=a.RGB16I),n===a.INT&&(u=a.RGB32I)),t===a.RGBA){const h=s?Ch:wt.getTransfer(r);n===a.FLOAT&&(u=a.RGBA32F),n===a.HALF_FLOAT&&(u=a.RGBA16F),n===a.UNSIGNED_BYTE&&(u=a.RGBA8),n===a.UNSIGNED_SHORT&&(u=a.RGBA16),n===a.UNSIGNED_INT&&(u=a.RGBA32UI),n===a.BYTE&&(u=a.RGBA8I),n===a.SHORT&&(u=a.RGBA16I),n===a.INT&&(u=a.RGBA32I),n===a.UNSIGNED_BYTE&&(u=h===Ze?a.SRGB8_ALPHA8:a.RGBA8),n===a.UNSIGNED_SHORT_4_4_4_4&&(u=a.RGBA4),n===a.UNSIGNED_SHORT_5_5_5_1&&(u=a.RGB5_A1)}return t===a.RGBA_INTEGER&&(n===a.UNSIGNED_BYTE&&(u=a.RGBA8UI),n===a.UNSIGNED_SHORT&&(u=a.RGBA16UI),n===a.UNSIGNED_INT&&(u=a.RGBA32UI),n===a.BYTE&&(u=a.RGBA8I),n===a.SHORT&&(u=a.RGBA16I),n===a.INT&&(u=a.RGBA32I)),t===a.DEPTH_COMPONENT&&(n===a.UNSIGNED_SHORT&&(u=a.DEPTH_COMPONENT16),n===a.UNSIGNED_INT&&(u=a.DEPTH_COMPONENT24),n===a.FLOAT&&(u=a.DEPTH_COMPONENT32F)),t===a.DEPTH_STENCIL&&n===a.UNSIGNED_INT_24_8&&(u=a.DEPTH24_STENCIL8),(u===a.R16F||u===a.R32F||u===a.RG16F||u===a.RG32F||u===a.RGBA16F||u===a.RGBA32F)&&l.get("EXT_color_buffer_float"),u}setTextureParameters(e,t){const{gl:n,extensions:r,backend:s}=this,a=wt.getPrimaries(wt.workingColorSpace),l=t.colorSpace===pr?null:wt.getPrimaries(t.colorSpace),u=t.colorSpace===pr||a===l?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,t.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,u),n.texParameteri(e,n.TEXTURE_WRAP_S,cy[t.wrapS]),n.texParameteri(e,n.TEXTURE_WRAP_T,cy[t.wrapT]),(e===n.TEXTURE_3D||e===n.TEXTURE_2D_ARRAY)&&(t.isArrayTexture||n.texParameteri(e,n.TEXTURE_WRAP_R,cy[t.wrapR])),n.texParameteri(e,n.TEXTURE_MAG_FILTER,Qb[t.magFilter]);const h=t.mipmaps!==void 0&&t.mipmaps.length>0,d=t.minFilter===Ti&&h?Nr:t.minFilter;if(n.texParameteri(e,n.TEXTURE_MIN_FILTER,Qb[d]),t.compareFunction&&(n.texParameteri(e,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(e,n.TEXTURE_COMPARE_FUNC,g2[t.compareFunction])),r.has("EXT_texture_filter_anisotropic")===!0){if(t.magFilter===Pn||t.minFilter!==eo&&t.minFilter!==Nr||t.type===Jn&&r.has("OES_texture_float_linear")===!1)return;if(t.anisotropy>1){const p=r.get("EXT_texture_filter_anisotropic");n.texParameterf(e,p.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,s.getMaxAnisotropy()))}}}createDefaultTexture(e){const{gl:t,backend:n,defaultTextures:r}=this,s=this.getGLTextureType(e);let a=r[s];a===void 0&&(a=t.createTexture(),n.state.bindTexture(s,a),t.texParameteri(s,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(s,t.TEXTURE_MAG_FILTER,t.NEAREST),r[s]=a),n.set(e,{textureGPU:a,glTextureType:s,isDefault:!0})}createTexture(e,t){const{gl:n,backend:r}=this,{levels:s,width:a,height:l,depth:u}=t,h=r.utils.convert(e.format,e.colorSpace),d=r.utils.convert(e.type),p=this.getInternalFormat(e.internalFormat,h,d,e.colorSpace,e.isVideoTexture),g=n.createTexture(),y=this.getGLTextureType(e);r.state.bindTexture(y,g),this.setTextureParameters(y,e),e.isArrayTexture||e.isDataArrayTexture||e.isCompressedArrayTexture?n.texStorage3D(n.TEXTURE_2D_ARRAY,s,p,a,l,u):e.isData3DTexture?n.texStorage3D(n.TEXTURE_3D,s,p,a,l,u):e.isVideoTexture||n.texStorage2D(y,s,p,a,l),r.set(e,{textureGPU:g,glTextureType:y,glFormat:h,glType:d,glInternalFormat:p})}copyBufferToTexture(e,t){const{gl:n,backend:r}=this,{textureGPU:s,glTextureType:a,glFormat:l,glType:u}=r.get(t),{width:h,height:d}=t.source.data;n.bindBuffer(n.PIXEL_UNPACK_BUFFER,e),r.state.bindTexture(a,s),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),n.texSubImage2D(a,0,0,0,h,d,l,u,0),n.bindBuffer(n.PIXEL_UNPACK_BUFFER,null),r.state.unbindTexture()}updateTexture(e,t){const{gl:n}=this,{width:r,height:s}=t,{textureGPU:a,glTextureType:l,glFormat:u,glType:h,glInternalFormat:d}=this.backend.get(e);if(!(e.isRenderTargetTexture||a===void 0))if(this.backend.state.bindTexture(l,a),this.setTextureParameters(l,e),e.isCompressedTexture){const p=e.mipmaps,g=t.image;for(let y=0;y<p.length;y++){const v=p[y];e.isCompressedArrayTexture?e.format!==n.RGBA?u!==null?n.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,y,0,0,0,v.width,v.height,g.depth,u,v.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texSubImage3D(n.TEXTURE_2D_ARRAY,y,0,0,0,v.width,v.height,g.depth,u,h,v.data):u!==null?n.compressedTexSubImage2D(n.TEXTURE_2D,y,0,0,v.width,v.height,u,v.data):console.warn("Unsupported compressed texture format")}}else if(e.isCubeTexture){const p=t.images;for(let g=0;g<6;g++){const y=y2(p[g]);n.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+g,0,0,0,r,s,u,h,y)}}else if(e.isDataArrayTexture||e.isArrayTexture){const p=t.image;n.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,p.width,p.height,p.depth,u,h,p.data)}else if(e.isData3DTexture){const p=t.image;n.texSubImage3D(n.TEXTURE_3D,0,0,0,0,p.width,p.height,p.depth,u,h,p.data)}else if(e.isVideoTexture)e.update(),n.texImage2D(l,0,d,u,h,t.image);else{const p=y2(t.image);n.texSubImage2D(l,0,0,0,r,s,u,h,p)}}generateMipmaps(e){const{gl:t,backend:n}=this,{textureGPU:r,glTextureType:s}=n.get(e);n.state.bindTexture(s,r),t.generateMipmap(s)}deallocateRenderBuffers(e){const{gl:t,backend:n}=this;if(e){const r=n.get(e);if(r.renderBufferStorageSetup=void 0,r.framebuffers){for(const s in r.framebuffers)t.deleteFramebuffer(r.framebuffers[s]);delete r.framebuffers}if(r.depthRenderbuffer&&(t.deleteRenderbuffer(r.depthRenderbuffer),delete r.depthRenderbuffer),r.stencilRenderbuffer&&(t.deleteRenderbuffer(r.stencilRenderbuffer),delete r.stencilRenderbuffer),r.msaaFrameBuffer&&(t.deleteFramebuffer(r.msaaFrameBuffer),delete r.msaaFrameBuffer),r.msaaRenderbuffers){for(let s=0;s<r.msaaRenderbuffers.length;s++)t.deleteRenderbuffer(r.msaaRenderbuffers[s]);delete r.msaaRenderbuffers}}}destroyTexture(e){const{gl:t,backend:n}=this,{textureGPU:r,renderTarget:s}=n.get(e);this.deallocateRenderBuffers(s),t.deleteTexture(r),n.delete(e)}copyTextureToTexture(e,t,n=null,r=null,s=0,a=0){const{gl:l,backend:u}=this,{state:h}=this.backend,{textureGPU:d,glTextureType:p,glType:g,glFormat:y}=u.get(t);h.bindTexture(p,d);let v,S,b,_,E,M,A,w,R;const C=e.isCompressedTexture?e.mipmaps[a]:e.image;if(n!==null)v=n.max.x-n.min.x,S=n.max.y-n.min.y,b=n.isBox3?n.max.z-n.min.z:1,_=n.min.x,E=n.min.y,M=n.isBox3?n.min.z:0;else{const oe=Math.pow(2,-s);v=Math.floor(C.width*oe),S=Math.floor(C.height*oe),e.isDataArrayTexture||e.isArrayTexture?b=C.depth:e.isData3DTexture?b=Math.floor(C.depth*oe):b=1,_=0,E=0,M=0}r!==null?(A=r.x,w=r.y,R=r.z):(A=0,w=0,R=0),l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,t.flipY),l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),l.pixelStorei(l.UNPACK_ALIGNMENT,t.unpackAlignment);const L=l.getParameter(l.UNPACK_ROW_LENGTH),N=l.getParameter(l.UNPACK_IMAGE_HEIGHT),D=l.getParameter(l.UNPACK_SKIP_PIXELS),I=l.getParameter(l.UNPACK_SKIP_ROWS),W=l.getParameter(l.UNPACK_SKIP_IMAGES);l.pixelStorei(l.UNPACK_ROW_LENGTH,C.width),l.pixelStorei(l.UNPACK_IMAGE_HEIGHT,C.height),l.pixelStorei(l.UNPACK_SKIP_PIXELS,_),l.pixelStorei(l.UNPACK_SKIP_ROWS,E),l.pixelStorei(l.UNPACK_SKIP_IMAGES,M);const Y=t.isDataArrayTexture||t.isData3DTexture||t.isArrayTexture;if(e.isRenderTargetTexture||e.isDepthTexture){const oe=u.get(e),le=u.get(t),z=u.get(oe.renderTarget),k=u.get(le.renderTarget),G=z.framebuffers[oe.cacheKey],he=k.framebuffers[le.cacheKey];h.bindFramebuffer(l.READ_FRAMEBUFFER,G),h.bindFramebuffer(l.DRAW_FRAMEBUFFER,he);let F=l.COLOR_BUFFER_BIT;e.isDepthTexture&&(F=l.DEPTH_BUFFER_BIT),l.blitFramebuffer(_,E,v,S,A,w,v,S,F,l.NEAREST),h.bindFramebuffer(l.READ_FRAMEBUFFER,null),h.bindFramebuffer(l.DRAW_FRAMEBUFFER,null)}else Y?e.isDataTexture||e.isData3DTexture?l.texSubImage3D(p,a,A,w,R,v,S,b,y,g,C.data):t.isCompressedArrayTexture?l.compressedTexSubImage3D(p,a,A,w,R,v,S,b,y,C.data):l.texSubImage3D(p,a,A,w,R,v,S,b,y,g,C):e.isDataTexture?l.texSubImage2D(p,a,A,w,v,S,y,g,C.data):e.isCompressedTexture?l.compressedTexSubImage2D(p,a,A,w,C.width,C.height,y,C.data):l.texSubImage2D(p,a,A,w,v,S,y,g,C);l.pixelStorei(l.UNPACK_ROW_LENGTH,L),l.pixelStorei(l.UNPACK_IMAGE_HEIGHT,N),l.pixelStorei(l.UNPACK_SKIP_PIXELS,D),l.pixelStorei(l.UNPACK_SKIP_ROWS,I),l.pixelStorei(l.UNPACK_SKIP_IMAGES,W),a===0&&t.generateMipmaps&&l.generateMipmap(p),h.unbindTexture()}copyFramebufferToTexture(e,t,n){const{gl:r}=this,{state:s}=this.backend,{textureGPU:a}=this.backend.get(e),{x:l,y:u,z:h,w:d}=n,p=e.isDepthTexture===!0||t.renderTarget&&t.renderTarget.samples>0,g=t.renderTarget?t.renderTarget.height:this.backend.getDrawingBufferSize().y;if(p){const y=l!==0||u!==0;let v,S;if(e.isDepthTexture===!0?(v=r.DEPTH_BUFFER_BIT,S=r.DEPTH_ATTACHMENT,t.stencil&&(v|=r.STENCIL_BUFFER_BIT)):(v=r.COLOR_BUFFER_BIT,S=r.COLOR_ATTACHMENT0),y){const b=this.backend.get(t.renderTarget),_=b.framebuffers[t.getCacheKey()],E=b.msaaFrameBuffer;s.bindFramebuffer(r.DRAW_FRAMEBUFFER,_),s.bindFramebuffer(r.READ_FRAMEBUFFER,E);const M=g-u-d;r.blitFramebuffer(l,M,l+h,M+d,l,M,l+h,M+d,v,r.NEAREST),s.bindFramebuffer(r.READ_FRAMEBUFFER,_),s.bindTexture(r.TEXTURE_2D,a),r.copyTexSubImage2D(r.TEXTURE_2D,0,0,0,l,M,h,d),s.unbindTexture()}else{const b=r.createFramebuffer();s.bindFramebuffer(r.DRAW_FRAMEBUFFER,b),r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,S,r.TEXTURE_2D,a,0),r.blitFramebuffer(0,0,h,d,0,0,h,d,v,r.NEAREST),r.deleteFramebuffer(b)}}else s.bindTexture(r.TEXTURE_2D,a),r.copyTexSubImage2D(r.TEXTURE_2D,0,0,0,l,g-d-u,h,d),s.unbindTexture();e.generateMipmaps&&this.generateMipmaps(e),this.backend._setFramebuffer(t)}setupRenderBufferStorage(e,t,n,r=!1){const{gl:s}=this,a=t.renderTarget,{depthTexture:l,depthBuffer:u,stencilBuffer:h,width:d,height:p}=a;if(s.bindRenderbuffer(s.RENDERBUFFER,e),u&&!h){let g=s.DEPTH_COMPONENT24;r===!0?this.extensions.get("WEBGL_multisampled_render_to_texture").renderbufferStorageMultisampleEXT(s.RENDERBUFFER,a.samples,g,d,p):n>0?(l&&l.isDepthTexture&&l.type===s.FLOAT&&(g=s.DEPTH_COMPONENT32F),s.renderbufferStorageMultisample(s.RENDERBUFFER,n,g,d,p)):s.renderbufferStorage(s.RENDERBUFFER,g,d,p),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,e)}else u&&h&&(n>0?s.renderbufferStorageMultisample(s.RENDERBUFFER,n,s.DEPTH24_STENCIL8,d,p):s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_STENCIL,d,p),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,e))}async copyTextureToBuffer(e,t,n,r,s,a){const{backend:l,gl:u}=this,{textureGPU:h,glFormat:d,glType:p}=this.backend.get(e),g=u.createFramebuffer();u.bindFramebuffer(u.READ_FRAMEBUFFER,g);const y=e.isCubeTexture?u.TEXTURE_CUBE_MAP_POSITIVE_X+a:u.TEXTURE_2D;u.framebufferTexture2D(u.READ_FRAMEBUFFER,u.COLOR_ATTACHMENT0,y,h,0);const v=this._getTypedArrayType(p),S=this._getBytesPerTexel(p,d),_=r*s*S,E=u.createBuffer();u.bindBuffer(u.PIXEL_PACK_BUFFER,E),u.bufferData(u.PIXEL_PACK_BUFFER,_,u.STREAM_READ),u.readPixels(t,n,r,s,d,p,0),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),await l.utils._clientWaitAsync();const M=new v(_/v.BYTES_PER_ELEMENT);return u.bindBuffer(u.PIXEL_PACK_BUFFER,E),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,M),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),u.deleteFramebuffer(g),M}_getTypedArrayType(e){const{gl:t}=this;if(e===t.UNSIGNED_BYTE)return Uint8Array;if(e===t.UNSIGNED_SHORT_4_4_4_4||e===t.UNSIGNED_SHORT_5_5_5_1||e===t.UNSIGNED_SHORT_5_6_5||e===t.UNSIGNED_SHORT)return Uint16Array;if(e===t.UNSIGNED_INT)return Uint32Array;if(e===t.HALF_FLOAT)return Uint16Array;if(e===t.FLOAT)return Float32Array;throw new Error(`Unsupported WebGL type: ${e}`)}_getBytesPerTexel(e,t){const{gl:n}=this;let r=0;if(e===n.UNSIGNED_BYTE&&(r=1),(e===n.UNSIGNED_SHORT_4_4_4_4||e===n.UNSIGNED_SHORT_5_5_5_1||e===n.UNSIGNED_SHORT_5_6_5||e===n.UNSIGNED_SHORT||e===n.HALF_FLOAT)&&(r=2),(e===n.UNSIGNED_INT||e===n.FLOAT)&&(r=4),t===n.RGBA)return r*4;if(t===n.RGB)return r*3;if(t===n.ALPHA)return r}}function y2(i){return i.isDataTexture?i.image.data:typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&i instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas?i:i.data}class jre{constructor(e){this.backend=e,this.gl=this.backend.gl,this.availableExtensions=this.gl.getSupportedExtensions(),this.extensions={}}get(e){let t=this.extensions[e];return t===void 0&&(t=this.gl.getExtension(e),this.extensions[e]=t),t}has(e){return this.availableExtensions.includes(e)}}class qre{constructor(e){this.backend=e,this.maxAnisotropy=null}getMaxAnisotropy(){if(this.maxAnisotropy!==null)return this.maxAnisotropy;const e=this.backend.gl,t=this.backend.extensions;if(t.has("EXT_texture_filter_anisotropic")===!0){const n=t.get("EXT_texture_filter_anisotropic");this.maxAnisotropy=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else this.maxAnisotropy=0;return this.maxAnisotropy}}const v2={WEBGL_multi_draw:"WEBGL_multi_draw",WEBGL_compressed_texture_astc:"texture-compression-astc",WEBGL_compressed_texture_etc:"texture-compression-etc2",WEBGL_compressed_texture_etc1:"texture-compression-etc1",WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBKIT_WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBGL_compressed_texture_s3tc:"texture-compression-bc",EXT_texture_compression_bptc:"texture-compression-bptc",EXT_disjoint_timer_query_webgl2:"timestamp-query",OVR_multiview2:"OVR_multiview2"};class $re{constructor(e){this.gl=e.gl,this.extensions=e.extensions,this.info=e.renderer.info,this.mode=null,this.index=0,this.type=null,this.object=null}render(e,t){const{gl:n,mode:r,object:s,type:a,info:l,index:u}=this;u!==0?n.drawElements(r,t,a,e):n.drawArrays(r,e,t),l.update(s,t,1)}renderInstances(e,t,n){const{gl:r,mode:s,type:a,index:l,object:u,info:h}=this;n!==0&&(l!==0?r.drawElementsInstanced(s,t,a,e,n):r.drawArraysInstanced(s,e,t,n),h.update(u,t,n))}renderMultiDraw(e,t,n){const{extensions:r,mode:s,object:a,info:l}=this;if(n===0)return;const u=r.get("WEBGL_multi_draw");if(u===null)for(let h=0;h<n;h++)this.render(e[h],t[h]);else{this.index!==0?u.multiDrawElementsWEBGL(s,t,0,this.type,e,0,n):u.multiDrawArraysWEBGL(s,e,0,t,0,n);let h=0;for(let d=0;d<n;d++)h+=t[d];l.update(a,h,1)}}renderMultiDrawInstances(e,t,n,r){const{extensions:s,mode:a,object:l,info:u}=this;if(n===0)return;const h=s.get("WEBGL_multi_draw");if(h===null)for(let d=0;d<n;d++)this.renderInstances(e[d],t[d],r[d]);else{this.index!==0?h.multiDrawElementsInstancedWEBGL(a,t,0,this.type,e,0,r,0,n):h.multiDrawArraysInstancedWEBGL(a,e,0,t,0,r,0,n);let d=0;for(let p=0;p<n;p++)d+=t[p]*r[p];u.update(l,d,1)}}}class WI{constructor(e=256){this.trackTimestamp=!0,this.maxQueries=e,this.currentQueryIndex=0,this.queryOffsets=new Map,this.isDisposed=!1,this.lastValue=0,this.pendingResolve=!1}allocateQueriesForContext(){}async resolveQueriesAsync(){}dispose(){}}class Xre extends WI{constructor(e,t,n=2048){if(super(n),this.gl=e,this.type=t,this.ext=e.getExtension("EXT_disjoint_timer_query_webgl2")||e.getExtension("EXT_disjoint_timer_query"),!this.ext){console.warn("EXT_disjoint_timer_query not supported; timestamps will be disabled."),this.trackTimestamp=!1;return}this.queries=[];for(let r=0;r<this.maxQueries;r++)this.queries.push(e.createQuery());this.activeQuery=null,this.queryStates=new Map}allocateQueriesForContext(e){if(!this.trackTimestamp)return null;if(this.currentQueryIndex+2>this.maxQueries)return rs(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const t=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryStates.set(t,"inactive"),this.queryOffsets.set(e.id,t),t}beginQuery(e){if(!this.trackTimestamp||this.isDisposed)return;const t=this.queryOffsets.get(e.id);if(t==null||this.activeQuery!==null)return;const n=this.queries[t];if(n)try{this.queryStates.get(t)==="inactive"&&(this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,n),this.activeQuery=t,this.queryStates.set(t,"started"))}catch(r){console.error("Error in beginQuery:",r),this.activeQuery=null,this.queryStates.set(t,"inactive")}}endQuery(e){if(!this.trackTimestamp||this.isDisposed)return;const t=this.queryOffsets.get(e.id);if(t!=null&&this.activeQuery===t)try{this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.queryStates.set(t,"ended"),this.activeQuery=null}catch(n){console.error("Error in endQuery:",n),this.queryStates.set(t,"inactive"),this.activeQuery=null}}async resolveQueriesAsync(){if(!this.trackTimestamp||this.pendingResolve)return this.lastValue;this.pendingResolve=!0;try{const e=[];for(const[r,s]of this.queryStates)if(s==="ended"){const a=this.queries[r];e.push(this.resolveQuery(a))}if(e.length===0)return this.lastValue;const n=(await Promise.all(e)).reduce((r,s)=>r+s,0);return this.lastValue=n,this.currentQueryIndex=0,this.queryOffsets.clear(),this.queryStates.clear(),this.activeQuery=null,n}catch(e){return console.error("Error resolving queries:",e),this.lastValue}finally{this.pendingResolve=!1}}async resolveQuery(e){return new Promise(t=>{if(this.isDisposed){t(this.lastValue);return}let n,r=!1;const s=()=>{n&&(clearTimeout(n),n=null)},a=u=>{r||(r=!0,s(),t(u))},l=()=>{if(this.isDisposed){a(this.lastValue);return}try{if(this.gl.getParameter(this.ext.GPU_DISJOINT_EXT)){a(this.lastValue);return}if(!this.gl.getQueryParameter(e,this.gl.QUERY_RESULT_AVAILABLE)){n=setTimeout(l,1);return}const d=this.gl.getQueryParameter(e,this.gl.QUERY_RESULT);t(Number(d)/1e6)}catch(u){console.error("Error checking query:",u),t(this.lastValue)}};l()})}dispose(){if(!this.isDisposed&&(this.isDisposed=!0,!!this.trackTimestamp)){for(const e of this.queries)this.gl.deleteQuery(e);this.queries=[],this.queryStates.clear(),this.queryOffsets.clear(),this.lastValue=0,this.activeQuery=null}}}const _2=new Le;class x2 extends HI{constructor(e={}){super(e),this.isWebGLBackend=!0,this.attributeUtils=null,this.extensions=null,this.capabilities=null,this.textureUtils=null,this.bufferRenderer=null,this.gl=null,this.state=null,this.utils=null,this.vaoCache={},this.transformFeedbackCache={},this.discard=!1,this.disjoint=null,this.parallel=null,this._currentContext=null,this._knownBindings=new WeakSet,this._supportsInvalidateFramebuffer=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),this._xrFramebuffer=null}init(e){super.init(e);const t=this.parameters,n={antialias:e.samples>0,alpha:!0,depth:e.depth,stencil:e.stencil},r=t.context!==void 0?t.context:e.domElement.getContext("webgl2",n);function s(a){a.preventDefault();const l={api:"WebGL",message:a.statusMessage||"Unknown reason",reason:null,originalEvent:a};e.onDeviceLost(l)}this._onContextLost=s,e.domElement.addEventListener("webglcontextlost",s,!1),this.gl=r,this.extensions=new jre(this),this.capabilities=new qre(this),this.attributeUtils=new Vre(this),this.textureUtils=new Wre(this),this.bufferRenderer=new $re(this),this.state=new Gre(this),this.utils=new Hre(this),this.extensions.get("EXT_color_buffer_float"),this.extensions.get("WEBGL_clip_cull_distance"),this.extensions.get("OES_texture_float_linear"),this.extensions.get("EXT_color_buffer_half_float"),this.extensions.get("WEBGL_multisampled_render_to_texture"),this.extensions.get("WEBGL_render_shared_exponent"),this.extensions.get("WEBGL_multi_draw"),this.extensions.get("OVR_multiview2"),this.disjoint=this.extensions.get("EXT_disjoint_timer_query_webgl2"),this.parallel=this.extensions.get("KHR_parallel_shader_compile")}get coordinateSystem(){return vr}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}async waitForGPU(){await this.utils._clientWaitAsync()}async makeXRCompatible(){this.gl.getContextAttributes().xrCompatible!==!0&&await this.gl.makeXRCompatible()}setXRTarget(e){this._xrFramebuffer=e}setXRRenderTargetTextures(e,t,n=null){const r=this.gl;if(this.set(e.texture,{textureGPU:t,glInternalFormat:r.RGBA8}),n!==null){const s=e.stencilBuffer?r.DEPTH24_STENCIL8:r.DEPTH_COMPONENT24;this.set(e.depthTexture,{textureGPU:n,glInternalFormat:s}),this.extensions.has("WEBGL_multisampled_render_to_texture")===!0&&e.autoAllocateDepthBuffer===!0&&e.multiview===!1&&console.warn("THREE.WebGLBackend: Render-to-texture extension was disabled because an external texture was provided"),e.autoAllocateDepthBuffer=!1}}initTimestampQuery(e){if(!this.disjoint||!this.trackTimestamp)return;const t=e.isComputeNode?"compute":"render";this.timestampQueryPool[t]||(this.timestampQueryPool[t]=new Xre(this.gl,t,2048));const n=this.timestampQueryPool[t];n.allocateQueriesForContext(e)!==null&&n.beginQuery(e)}prepareTimestampBuffer(e){if(!this.disjoint||!this.trackTimestamp)return;const t=e.isComputeNode?"compute":"render";this.timestampQueryPool[t].endQuery(e)}getContext(){return this.gl}beginRender(e){const{state:t}=this,n=this.get(e);if(e.viewport)this.updateViewport(e);else{const{width:s,height:a}=this.getDrawingBufferSize(_2);t.viewport(0,0,s,a)}if(e.scissor){const{x:s,y:a,width:l,height:u}=e.scissorValue;t.scissor(s,e.height-u-a,l,u)}this.initTimestampQuery(e),n.previousContext=this._currentContext,this._currentContext=e,this._setFramebuffer(e),this.clear(e.clearColor,e.clearDepth,e.clearStencil,e,!1);const r=e.occlusionQueryCount;r>0&&(n.currentOcclusionQueries=n.occlusionQueries,n.currentOcclusionQueryObjects=n.occlusionQueryObjects,n.lastOcclusionObject=null,n.occlusionQueries=new Array(r),n.occlusionQueryObjects=new Array(r),n.occlusionQueryIndex=0)}finishRender(e){const{gl:t,state:n}=this,r=this.get(e),s=r.previousContext;n.resetVertexState();const a=e.occlusionQueryCount;a>0&&(a>r.occlusionQueryIndex&&t.endQuery(t.ANY_SAMPLES_PASSED),this.resolveOccludedAsync(e));const l=e.textures;if(l!==null)for(let u=0;u<l.length;u++){const h=l[u];h.generateMipmaps&&this.generateMipmaps(h)}if(this._currentContext=s,e.textures!==null&&e.renderTarget){const u=this.get(e.renderTarget),{resolveDepthBuffer:h,samples:d}=e.renderTarget;if(d>0&&this._useMultisampledExtension(e.renderTarget)===!1){const p=u.framebuffers[e.getCacheKey()],g=t.COLOR_BUFFER_BIT,y=u.msaaFrameBuffer,v=e.textures;n.bindFramebuffer(t.READ_FRAMEBUFFER,y),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,p);for(let S=0;S<v.length;S++)if(e.scissor){const{x:b,y:_,width:E,height:M}=e.scissorValue,A=e.height-M-_;t.blitFramebuffer(b,A,b+E,A+M,b,A,b+E,A+M,g,t.NEAREST),this._supportsInvalidateFramebuffer===!0&&t.invalidateSubFramebuffer(t.READ_FRAMEBUFFER,u.invalidationArray,b,A,E,M)}else t.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,g,t.NEAREST),this._supportsInvalidateFramebuffer===!0&&t.invalidateFramebuffer(t.READ_FRAMEBUFFER,u.invalidationArray)}else if(h===!1&&u.framebuffers){const p=u.framebuffers[e.getCacheKey()];n.bindFramebuffer(t.DRAW_FRAMEBUFFER,p),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,u.depthInvalidationArray)}}if(s!==null)if(this._setFramebuffer(s),s.viewport)this.updateViewport(s);else{const{width:u,height:h}=this.getDrawingBufferSize(_2);n.viewport(0,0,u,h)}this.prepareTimestampBuffer(e)}resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueries:n,currentOcclusionQueryObjects:r}=t;if(n&&r){const s=new WeakSet,{gl:a}=this;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueries=null;const l=()=>{let u=0;for(let h=0;h<n.length;h++){const d=n[h];d!==null&&a.getQueryParameter(d,a.QUERY_RESULT_AVAILABLE)&&(a.getQueryParameter(d,a.QUERY_RESULT)===0&&s.add(r[h]),n[h]=null,a.deleteQuery(d),u++)}u<n.length?requestAnimationFrame(l):t.occluded=s};l()}}isOccluded(e,t){const n=this.get(e);return n.occluded&&n.occluded.has(t)}updateViewport(e){const{state:t}=this,{x:n,y:r,width:s,height:a}=e.viewportValue;t.viewport(n,e.height-a-r,s,a)}setScissorTest(e){this.state.setScissorTest(e)}getClearColor(){const e=super.getClearColor();return e.r*=e.a,e.g*=e.a,e.b*=e.a,e}clear(e,t,n,r=null,s=!0){const{gl:a,renderer:l}=this;r===null&&(r={textures:null,clearColorValue:this.getClearColor()});let u=0;if(e&&(u|=a.COLOR_BUFFER_BIT),t&&(u|=a.DEPTH_BUFFER_BIT),n&&(u|=a.STENCIL_BUFFER_BIT),u!==0){let h;r.clearColorValue?h=r.clearColorValue:h=this.getClearColor();const d=l.getClearDepth(),p=l.getClearStencil();if(t&&this.state.setDepthMask(!0),r.textures===null)a.clearColor(h.r,h.g,h.b,h.a),a.clear(u);else{if(s&&this._setFramebuffer(r),e)for(let g=0;g<r.textures.length;g++)g===0?a.clearBufferfv(a.COLOR,g,[h.r,h.g,h.b,h.a]):a.clearBufferfv(a.COLOR,g,[0,0,0,1]);t&&n?a.clearBufferfi(a.DEPTH_STENCIL,0,d,p):t?a.clearBufferfv(a.DEPTH,0,[d]):n&&a.clearBufferiv(a.STENCIL,0,[p])}}}beginCompute(e){const{state:t,gl:n}=this;t.bindFramebuffer(n.FRAMEBUFFER,null),this.initTimestampQuery(e)}compute(e,t,n,r){const{state:s,gl:a}=this;this.discard===!1&&(a.enable(a.RASTERIZER_DISCARD),this.discard=!0);const{programGPU:l,transformBuffers:u,attributes:h}=this.get(r),d=this._getVaoKey(h),p=this.vaoCache[d];p===void 0?this._createVao(h):s.setVertexState(p),s.useProgram(l),this._bindUniforms(n);const g=this._getTransformFeedback(u);a.bindTransformFeedback(a.TRANSFORM_FEEDBACK,g),a.beginTransformFeedback(a.POINTS),h[0].isStorageInstancedBufferAttribute?a.drawArraysInstanced(a.POINTS,0,1,t.count):a.drawArrays(a.POINTS,0,t.count),a.endTransformFeedback(),a.bindTransformFeedback(a.TRANSFORM_FEEDBACK,null);for(let y=0;y<u.length;y++){const v=u[y];v.pbo&&this.textureUtils.copyBufferToTexture(v.transformBuffer,v.pbo),v.switchBuffers()}}finishCompute(e){const t=this.gl;this.discard=!1,t.disable(t.RASTERIZER_DISCARD),this.prepareTimestampBuffer(e),this._currentContext&&this._setFramebuffer(this._currentContext)}_isRenderCameraDepthArray(e){return e.depthTexture&&e.depthTexture.isArrayTexture&&e.camera.isArrayCamera}draw(e){const{object:t,pipeline:n,material:r,context:s,hardwareClippingPlanes:a}=e,{programGPU:l}=this.get(n),{gl:u,state:h}=this,d=this.get(s),p=e.getDrawParameters();if(p===null)return;this._bindUniforms(e.getBindings());const g=t.isMesh&&t.matrixWorld.determinant()<0;h.setMaterial(r,g,a),h.useProgram(l);const y=this.get(e);let v=y.staticVao;if(v===void 0||y.geometryId!==e.geometry.id){const C=this._getVaoKey(e.getAttributes());if(v=this.vaoCache[C],v===void 0){let L;({vaoGPU:v,staticVao:L}=this._createVao(e.getAttributes())),L&&(y.staticVao=v,y.geometryId=e.geometry.id)}}const S=e.getIndex(),b=S!==null?this.get(S).bufferGPU:null;h.setVertexState(v,b);const _=d.lastOcclusionObject;if(_!==t&&_!==void 0){if(_!==null&&_.occlusionTest===!0&&(u.endQuery(u.ANY_SAMPLES_PASSED),d.occlusionQueryIndex++),t.occlusionTest===!0){const C=u.createQuery();u.beginQuery(u.ANY_SAMPLES_PASSED,C),d.occlusionQueries[d.occlusionQueryIndex]=C,d.occlusionQueryObjects[d.occlusionQueryIndex]=t}d.lastOcclusionObject=t}const E=this.bufferRenderer;t.isPoints?E.mode=u.POINTS:t.isLineSegments?E.mode=u.LINES:t.isLine?E.mode=u.LINE_STRIP:t.isLineLoop?E.mode=u.LINE_LOOP:r.wireframe===!0?(h.setLineWidth(r.wireframeLinewidth*this.renderer.getPixelRatio()),E.mode=u.LINES):E.mode=u.TRIANGLES;const{vertexCount:M,instanceCount:A}=p;let{firstVertex:w}=p;if(E.object=t,S!==null){w*=S.array.BYTES_PER_ELEMENT;const C=this.get(S);E.index=S.count,E.type=C.type}else E.index=0;const R=()=>{t.isBatchedMesh?t._multiDrawInstances!==null?(rs("THREE.WebGLBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),E.renderMultiDrawInstances(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount,t._multiDrawInstances)):this.hasFeature("WEBGL_multi_draw")?E.renderMultiDraw(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount):rs("THREE.WebGLRenderer: WEBGL_multi_draw not supported."):A>1?E.renderInstances(w,M,A):E.render(w,M)};if(e.camera.isArrayCamera===!0&&e.camera.cameras.length>0&&e.camera.isMultiViewCamera===!1){const C=this.get(e.camera),L=e.camera.cameras,N=e.getBindingGroup("cameraIndex").bindings[0];if(C.indexesGPU===void 0||C.indexesGPU.length!==L.length){const le=new Uint32Array([0,0,0,0]),z=[];for(let k=0,G=L.length;k<G;k++){const he=u.createBuffer();le[0]=k,u.bindBuffer(u.UNIFORM_BUFFER,he),u.bufferData(u.UNIFORM_BUFFER,le,u.STATIC_DRAW),z.push(he)}C.indexesGPU=z}const D=this.get(N),I=this.renderer.getPixelRatio(),W=this._currentContext.renderTarget,Y=this._isRenderCameraDepthArray(this._currentContext),oe=this._currentContext.activeCubeFace;if(Y){const le=this.get(W.depthTexture);if(le.clearedRenderId!==this.renderer._nodes.nodeFrame.renderId){le.clearedRenderId=this.renderer._nodes.nodeFrame.renderId;const{stencilBuffer:z}=W;for(let k=0,G=L.length;k<G;k++)this.renderer._activeCubeFace=k,this._currentContext.activeCubeFace=k,this._setFramebuffer(this._currentContext),this.clear(!1,!0,z,this._currentContext,!1);this.renderer._activeCubeFace=oe,this._currentContext.activeCubeFace=oe}}for(let le=0,z=L.length;le<z;le++){const k=L[le];if(t.layers.test(k.layers)){Y&&(this.renderer._activeCubeFace=le,this._currentContext.activeCubeFace=le,this._setFramebuffer(this._currentContext));const G=k.viewport;if(G!==void 0){const he=G.x*I,F=G.y*I,se=G.width*I,Me=G.height*I;h.viewport(Math.floor(he),Math.floor(e.context.height-Me-F),Math.floor(se),Math.floor(Me))}h.bindBufferBase(u.UNIFORM_BUFFER,D.index,C.indexesGPU[le]),R()}this._currentContext.activeCubeFace=oe,this.renderer._activeCubeFace=oe}}else R()}needsRenderUpdate(){return!1}getRenderCacheKey(){return""}createDefaultTexture(e){this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e){this.textureUtils.destroyTexture(e)}async copyTextureToBuffer(e,t,n,r,s,a){return this.textureUtils.copyTextureToBuffer(e,t,n,r,s,a)}createSampler(){}destroySampler(){}createNodeBuilder(e,t){return new Fre(e,t)}createProgram(e){const t=this.gl,{stage:n,code:r}=e,s=n==="fragment"?t.createShader(t.FRAGMENT_SHADER):t.createShader(t.VERTEX_SHADER);t.shaderSource(s,r),t.compileShader(s),this.set(e,{shaderGPU:s})}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){const n=this.gl,r=e.pipeline,{fragmentProgram:s,vertexProgram:a}=r,l=n.createProgram(),u=this.get(s).shaderGPU,h=this.get(a).shaderGPU;if(n.attachShader(l,u),n.attachShader(l,h),n.linkProgram(l),this.set(r,{programGPU:l,fragmentShader:u,vertexShader:h}),t!==null&&this.parallel){const d=new Promise(p=>{const g=this.parallel,y=()=>{n.getProgramParameter(l,g.COMPLETION_STATUS_KHR)?(this._completeCompile(e,r),p()):requestAnimationFrame(y)};y()});t.push(d);return}this._completeCompile(e,r)}_handleSource(e,t){const n=e.split(`
`),r=[],s=Math.max(t-6,0),a=Math.min(t+6,n.length);for(let l=s;l<a;l++){const u=l+1;r.push(`${u===t?">":" "} ${u}: ${n[l]}`)}return r.join(`
`)}_getShaderErrors(e,t,n){const r=e.getShaderParameter(t,e.COMPILE_STATUS),s=e.getShaderInfoLog(t).trim();if(r&&s==="")return"";const a=/ERROR: 0:(\d+)/.exec(s);if(a){const l=parseInt(a[1]);return n.toUpperCase()+`

`+s+`

`+this._handleSource(e.getShaderSource(t),l)}else return s}_logProgramError(e,t,n){if(this.renderer.debug.checkShaderErrors){const r=this.gl,s=r.getProgramInfoLog(e).trim();if(r.getProgramParameter(e,r.LINK_STATUS)===!1)if(typeof this.renderer.debug.onShaderError=="function")this.renderer.debug.onShaderError(r,e,n,t);else{const a=this._getShaderErrors(r,n,"vertex"),l=this._getShaderErrors(r,t,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(e,r.VALIDATE_STATUS)+`

Program Info Log: `+s+`
`+a+`
`+l)}else s!==""&&console.warn("THREE.WebGLProgram: Program Info Log:",s)}}_completeCompile(e,t){const{state:n,gl:r}=this,s=this.get(t),{programGPU:a,fragmentShader:l,vertexShader:u}=s;r.getProgramParameter(a,r.LINK_STATUS)===!1&&this._logProgramError(a,l,u),n.useProgram(a);const h=e.getBindings();this._setupBindings(h,a),this.set(t,{programGPU:a})}createComputePipeline(e,t){const{state:n,gl:r}=this,s={stage:"fragment",code:`#version 300 es
precision highp float;
void main() {}`};this.createProgram(s);const{computeProgram:a}=e,l=r.createProgram(),u=this.get(s).shaderGPU,h=this.get(a).shaderGPU,d=a.transforms,p=[],g=[];for(let b=0;b<d.length;b++){const _=d[b];p.push(_.varyingName),g.push(_.attributeNode)}r.attachShader(l,u),r.attachShader(l,h),r.transformFeedbackVaryings(l,p,r.SEPARATE_ATTRIBS),r.linkProgram(l),r.getProgramParameter(l,r.LINK_STATUS)===!1&&this._logProgramError(l,u,h),n.useProgram(l),this._setupBindings(t,l);const y=a.attributes,v=[],S=[];for(let b=0;b<y.length;b++){const _=y[b].node.attribute;v.push(_),this.has(_)||this.attributeUtils.createAttribute(_,r.ARRAY_BUFFER)}for(let b=0;b<g.length;b++){const _=g[b].attribute;this.has(_)||this.attributeUtils.createAttribute(_,r.ARRAY_BUFFER);const E=this.get(_);S.push(E)}this.set(e,{programGPU:l,transformBuffers:S,attributes:v})}createBindings(e,t){if(this._knownBindings.has(t)===!1){this._knownBindings.add(t);let n=0,r=0;for(const s of t){this.set(s,{textures:r,uniformBuffers:n});for(const a of s.bindings)a.isUniformBuffer&&n++,a.isSampledTexture&&r++}}this.updateBindings(e,t)}updateBindings(e){const{gl:t}=this,n=this.get(e);let r=n.uniformBuffers,s=n.textures;for(const a of e.bindings)if(a.isUniformsGroup||a.isUniformBuffer){const l=a.buffer,u=t.createBuffer();t.bindBuffer(t.UNIFORM_BUFFER,u),t.bufferData(t.UNIFORM_BUFFER,l,t.DYNAMIC_DRAW),this.set(a,{index:r++,bufferGPU:u})}else if(a.isSampledTexture){const{textureGPU:l,glTextureType:u}=this.get(a.texture);this.set(a,{index:s++,textureGPU:l,glTextureType:u})}}updateBinding(e){const t=this.gl;if(e.isUniformsGroup||e.isUniformBuffer){const r=this.get(e).bufferGPU,s=e.buffer;t.bindBuffer(t.UNIFORM_BUFFER,r),t.bufferData(t.UNIFORM_BUFFER,s,t.DYNAMIC_DRAW)}}createIndexAttribute(e){const t=this.gl;this.attributeUtils.createAttribute(e,t.ELEMENT_ARRAY_BUFFER)}createAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}createStorageAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}hasFeature(e){const t=Object.keys(v2).filter(r=>v2[r]===e),n=this.extensions;for(let r=0;r<t.length;r++)if(n.has(t[r]))return!0;return!1}getMaxAnisotropy(){return this.capabilities.getMaxAnisotropy()}copyTextureToTexture(e,t,n=null,r=null,s=0,a=0){this.textureUtils.copyTextureToTexture(e,t,n,r,s,a)}copyFramebufferToTexture(e,t,n){this.textureUtils.copyFramebufferToTexture(e,t,n)}_setFramebuffer(e){const{gl:t,state:n}=this;let r=null;if(e.textures!==null){const s=e.renderTarget,a=this.get(s),{samples:l,depthBuffer:u,stencilBuffer:h}=s,d=s.isWebGLCubeRenderTarget===!0,p=s.isRenderTarget3D===!0,g=s.depth>1,y=s.isXRRenderTarget===!0,v=y===!0&&s.hasExternalTextures===!0;let S=a.msaaFrameBuffer,b=a.depthRenderbuffer;const _=this.extensions.get("WEBGL_multisampled_render_to_texture"),E=this.extensions.get("OVR_multiview2"),M=this._useMultisampledExtension(s),A=TI(e);let w;if(d?(a.cubeFramebuffers||(a.cubeFramebuffers={}),w=a.cubeFramebuffers[A]):y&&v===!1?w=this._xrFramebuffer:(a.framebuffers||(a.framebuffers={}),w=a.framebuffers[A]),w===void 0){w=t.createFramebuffer(),n.bindFramebuffer(t.FRAMEBUFFER,w);const R=e.textures,C=[];if(d){a.cubeFramebuffers[A]=w;const{textureGPU:N}=this.get(R[0]),D=this.renderer._activeCubeFace;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+D,N,0)}else{a.framebuffers[A]=w;for(let N=0;N<R.length;N++){const D=R[N],I=this.get(D);I.renderTarget=e.renderTarget,I.cacheKey=A;const W=t.COLOR_ATTACHMENT0+N;if(s.multiview)E.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,W,I.textureGPU,0,l,0,2);else if(p||g){const Y=this.renderer._activeCubeFace;t.framebufferTextureLayer(t.FRAMEBUFFER,W,I.textureGPU,0,Y)}else M?_.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,W,t.TEXTURE_2D,I.textureGPU,0,l):t.framebufferTexture2D(t.FRAMEBUFFER,W,t.TEXTURE_2D,I.textureGPU,0)}n.drawBuffers(e,w)}const L=h?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;if(s.autoAllocateDepthBuffer===!0){const N=t.createRenderbuffer();this.textureUtils.setupRenderBufferStorage(N,e,0,M),a.xrDepthRenderbuffer=N,C.push(h?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT),t.bindRenderbuffer(t.RENDERBUFFER,N),t.framebufferRenderbuffer(t.FRAMEBUFFER,L,t.RENDERBUFFER,N)}else if(e.depthTexture!==null){C.push(h?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT);const N=this.get(e.depthTexture);if(N.renderTarget=e.renderTarget,N.cacheKey=A,s.multiview)E.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,L,N.textureGPU,0,l,0,2);else if(v&&M)_.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,L,t.TEXTURE_2D,N.textureGPU,0,l);else if(e.depthTexture.isArrayTexture){const D=this.renderer._activeCubeFace;t.framebufferTextureLayer(t.FRAMEBUFFER,L,N.textureGPU,0,D)}else t.framebufferTexture2D(t.FRAMEBUFFER,L,t.TEXTURE_2D,N.textureGPU,0)}a.depthInvalidationArray=C}else{if(this._isRenderCameraDepthArray(e)){n.bindFramebuffer(t.FRAMEBUFFER,w);const C=this.renderer._activeCubeFace,L=this.get(e.depthTexture),N=h?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;t.framebufferTextureLayer(t.FRAMEBUFFER,N,L.textureGPU,0,C)}if(y||M||s.multiview){n.bindFramebuffer(t.FRAMEBUFFER,w);const C=this.get(e.textures[0]);s.multiview?E.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,C.textureGPU,0,l,0,2):M?_.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,C.textureGPU,0,l):t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,C.textureGPU,0);const L=h?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;if(s.autoAllocateDepthBuffer===!0){const N=a.xrDepthRenderbuffer;t.bindRenderbuffer(t.RENDERBUFFER,N),t.framebufferRenderbuffer(t.FRAMEBUFFER,L,t.RENDERBUFFER,N)}else{const N=this.get(e.depthTexture);s.multiview?E.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,L,N.textureGPU,0,l,0,2):M?_.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,L,t.TEXTURE_2D,N.textureGPU,0,l):t.framebufferTexture2D(t.FRAMEBUFFER,L,t.TEXTURE_2D,N.textureGPU,0)}}}if(l>0&&M===!1&&!s.multiview){if(S===void 0){const R=[];S=t.createFramebuffer(),n.bindFramebuffer(t.FRAMEBUFFER,S);const C=[],L=e.textures;for(let N=0;N<L.length;N++){if(C[N]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,C[N]),R.push(t.COLOR_ATTACHMENT0+N),u){const W=h?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;R.push(W)}const D=e.textures[N],I=this.get(D);t.renderbufferStorageMultisample(t.RENDERBUFFER,l,I.glInternalFormat,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+N,t.RENDERBUFFER,C[N])}if(a.msaaFrameBuffer=S,a.msaaRenderbuffers=C,b===void 0){b=t.createRenderbuffer(),this.textureUtils.setupRenderBufferStorage(b,e,l),a.depthRenderbuffer=b;const N=h?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;R.push(N)}a.invalidationArray=R}r=a.msaaFrameBuffer}else r=w}n.bindFramebuffer(t.FRAMEBUFFER,r)}_getVaoKey(e){let t="";for(let n=0;n<e.length;n++){const r=this.get(e[n]);t+=":"+r.id}return t}_createVao(e){const{gl:t}=this,n=t.createVertexArray();let r="",s=!0;t.bindVertexArray(n);for(let a=0;a<e.length;a++){const l=e[a],u=this.get(l);r+=":"+u.id,t.bindBuffer(t.ARRAY_BUFFER,u.bufferGPU),t.enableVertexAttribArray(a),(l.isStorageBufferAttribute||l.isStorageInstancedBufferAttribute)&&(s=!1);let h,d;l.isInterleavedBufferAttribute===!0?(h=l.data.stride*u.bytesPerElement,d=l.offset*u.bytesPerElement):(h=0,d=0),u.isInteger?t.vertexAttribIPointer(a,l.itemSize,u.type,h,d):t.vertexAttribPointer(a,l.itemSize,u.type,l.normalized,h,d),l.isInstancedBufferAttribute&&!l.isInterleavedBufferAttribute?t.vertexAttribDivisor(a,l.meshPerAttribute):l.isInterleavedBufferAttribute&&l.data.isInstancedInterleavedBuffer&&t.vertexAttribDivisor(a,l.data.meshPerAttribute)}return t.bindBuffer(t.ARRAY_BUFFER,null),this.vaoCache[r]=n,{vaoGPU:n,staticVao:s}}_getTransformFeedback(e){let t="";for(let s=0;s<e.length;s++)t+=":"+e[s].id;let n=this.transformFeedbackCache[t];if(n!==void 0)return n;const{gl:r}=this;n=r.createTransformFeedback(),r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,n);for(let s=0;s<e.length;s++){const a=e[s];r.bindBufferBase(r.TRANSFORM_FEEDBACK_BUFFER,s,a.transformBuffer)}return r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,null),this.transformFeedbackCache[t]=n,n}_setupBindings(e,t){const n=this.gl;for(const r of e)for(const s of r.bindings){const l=this.get(s).index;if(s.isUniformsGroup||s.isUniformBuffer){const u=n.getUniformBlockIndex(t,s.name);n.uniformBlockBinding(t,u,l)}else if(s.isSampledTexture){const u=n.getUniformLocation(t,s.name);n.uniform1i(u,l)}}}_bindUniforms(e){const{gl:t,state:n}=this;for(const r of e)for(const s of r.bindings){const a=this.get(s),l=a.index;s.isUniformsGroup||s.isUniformBuffer?n.bindBufferBase(t.UNIFORM_BUFFER,l,a.bufferGPU):s.isSampledTexture&&n.bindTexture(a.glTextureType,a.textureGPU,t.TEXTURE0+l)}}_useMultisampledExtension(e){return e.multiview===!0?!0:e.samples>0&&this.extensions.has("WEBGL_multisampled_render_to_texture")===!0&&e.autoAllocateDepthBuffer!==!1}dispose(){const e=this.extensions.get("WEBGL_lose_context");e&&e.loseContext(),this.renderer.domElement.removeEventListener("webglcontextlost",this._onContextLost)}}const Kc={PointList:"point-list",LineList:"line-list",LineStrip:"line-strip",TriangleList:"triangle-list",TriangleStrip:"triangle-strip"},Vi={Never:"never",Less:"less",Equal:"equal",LessEqual:"less-equal",Greater:"greater",NotEqual:"not-equal",GreaterEqual:"greater-equal",Always:"always"},cr={Store:"store"},un={Load:"load",Clear:"clear"},Jb={CCW:"ccw"},eS={None:"none",Front:"front",Back:"back"},Ih={Uint16:"uint16",Uint32:"uint32"},K={R8Unorm:"r8unorm",R8Snorm:"r8snorm",R8Uint:"r8uint",R8Sint:"r8sint",R16Uint:"r16uint",R16Sint:"r16sint",R16Float:"r16float",RG8Unorm:"rg8unorm",RG8Snorm:"rg8snorm",RG8Uint:"rg8uint",RG8Sint:"rg8sint",R32Uint:"r32uint",R32Sint:"r32sint",R32Float:"r32float",RG16Uint:"rg16uint",RG16Sint:"rg16sint",RG16Float:"rg16float",RGBA8Unorm:"rgba8unorm",RGBA8UnormSRGB:"rgba8unorm-srgb",RGBA8Snorm:"rgba8snorm",RGBA8Uint:"rgba8uint",RGBA8Sint:"rgba8sint",BGRA8Unorm:"bgra8unorm",BGRA8UnormSRGB:"bgra8unorm-srgb",RGB9E5UFloat:"rgb9e5ufloat",RGB10A2Unorm:"rgb10a2unorm",RG11B10UFloat:"rgb10a2unorm",RG32Uint:"rg32uint",RG32Sint:"rg32sint",RG32Float:"rg32float",RGBA16Uint:"rgba16uint",RGBA16Sint:"rgba16sint",RGBA16Float:"rgba16float",RGBA32Uint:"rgba32uint",RGBA32Sint:"rgba32sint",RGBA32Float:"rgba32float",Depth16Unorm:"depth16unorm",Depth24Plus:"depth24plus",Depth24PlusStencil8:"depth24plus-stencil8",Depth32Float:"depth32float",Depth32FloatStencil8:"depth32float-stencil8",BC1RGBAUnorm:"bc1-rgba-unorm",BC1RGBAUnormSRGB:"bc1-rgba-unorm-srgb",BC2RGBAUnorm:"bc2-rgba-unorm",BC2RGBAUnormSRGB:"bc2-rgba-unorm-srgb",BC3RGBAUnorm:"bc3-rgba-unorm",BC3RGBAUnormSRGB:"bc3-rgba-unorm-srgb",BC4RUnorm:"bc4-r-unorm",BC4RSnorm:"bc4-r-snorm",BC5RGUnorm:"bc5-rg-unorm",BC5RGSnorm:"bc5-rg-snorm",BC6HRGBUFloat:"bc6h-rgb-ufloat",BC6HRGBFloat:"bc6h-rgb-float",BC7RGBAUnorm:"bc7-rgba-unorm",BC7RGBAUnormSRGB:"bc7-rgba-srgb",ETC2RGB8Unorm:"etc2-rgb8unorm",ETC2RGB8UnormSRGB:"etc2-rgb8unorm-srgb",ETC2RGB8A1Unorm:"etc2-rgb8a1unorm",ETC2RGB8A1UnormSRGB:"etc2-rgb8a1unorm-srgb",ETC2RGBA8Unorm:"etc2-rgba8unorm",ETC2RGBA8UnormSRGB:"etc2-rgba8unorm-srgb",EACR11Unorm:"eac-r11unorm",EACR11Snorm:"eac-r11snorm",EACRG11Unorm:"eac-rg11unorm",EACRG11Snorm:"eac-rg11snorm",ASTC4x4Unorm:"astc-4x4-unorm",ASTC4x4UnormSRGB:"astc-4x4-unorm-srgb",ASTC5x4Unorm:"astc-5x4-unorm",ASTC5x4UnormSRGB:"astc-5x4-unorm-srgb",ASTC5x5Unorm:"astc-5x5-unorm",ASTC5x5UnormSRGB:"astc-5x5-unorm-srgb",ASTC6x5Unorm:"astc-6x5-unorm",ASTC6x5UnormSRGB:"astc-6x5-unorm-srgb",ASTC6x6Unorm:"astc-6x6-unorm",ASTC6x6UnormSRGB:"astc-6x6-unorm-srgb",ASTC8x5Unorm:"astc-8x5-unorm",ASTC8x5UnormSRGB:"astc-8x5-unorm-srgb",ASTC8x6Unorm:"astc-8x6-unorm",ASTC8x6UnormSRGB:"astc-8x6-unorm-srgb",ASTC8x8Unorm:"astc-8x8-unorm",ASTC8x8UnormSRGB:"astc-8x8-unorm-srgb",ASTC10x5Unorm:"astc-10x5-unorm",ASTC10x5UnormSRGB:"astc-10x5-unorm-srgb",ASTC10x6Unorm:"astc-10x6-unorm",ASTC10x6UnormSRGB:"astc-10x6-unorm-srgb",ASTC10x8Unorm:"astc-10x8-unorm",ASTC10x8UnormSRGB:"astc-10x8-unorm-srgb",ASTC10x10Unorm:"astc-10x10-unorm",ASTC10x10UnormSRGB:"astc-10x10-unorm-srgb",ASTC12x10Unorm:"astc-12x10-unorm",ASTC12x10UnormSRGB:"astc-12x10-unorm-srgb",ASTC12x12Unorm:"astc-12x12-unorm",ASTC12x12UnormSRGB:"astc-12x12-unorm-srgb"},tS={ClampToEdge:"clamp-to-edge",Repeat:"repeat",MirrorRepeat:"mirror-repeat"},cu={Linear:"linear",Nearest:"nearest"},Dt={Zero:"zero",One:"one",Src:"src",OneMinusSrc:"one-minus-src",SrcAlpha:"src-alpha",OneMinusSrcAlpha:"one-minus-src-alpha",Dst:"dst",OneMinusDst:"one-minus-dst",DstAlpha:"dst-alpha",OneMinusDstAlpha:"one-minus-dst-alpha",SrcAlphaSaturated:"src-alpha-saturated",Constant:"constant",OneMinusConstant:"one-minus-constant"},Zl={Add:"add",Subtract:"subtract",ReverseSubtract:"reverse-subtract",Min:"min",Max:"max"},b2={None:0,All:15},Zo={Keep:"keep",Zero:"zero",Replace:"replace",Invert:"invert",IncrementClamp:"increment-clamp",DecrementClamp:"decrement-clamp",IncrementWrap:"increment-wrap",DecrementWrap:"decrement-wrap"},nS={Storage:"storage",ReadOnlyStorage:"read-only-storage"},iS={WriteOnly:"write-only",ReadOnly:"read-only",ReadWrite:"read-write"},S2={NonFiltering:"non-filtering",Comparison:"comparison"},Ql={Float:"float",UnfilterableFloat:"unfilterable-float",Depth:"depth",SInt:"sint",UInt:"uint"},T2={TwoD:"2d",ThreeD:"3d"},Di={TwoD:"2d",TwoDArray:"2d-array",Cube:"cube",ThreeD:"3d"},Yre={All:"all"},hy={Vertex:"vertex",Instance:"instance"},yT={DepthClipControl:"depth-clip-control",Depth32FloatStencil8:"depth32float-stencil8",TextureCompressionBC:"texture-compression-bc",TextureCompressionETC2:"texture-compression-etc2",TextureCompressionASTC:"texture-compression-astc",TimestampQuery:"timestamp-query",IndirectFirstInstance:"indirect-first-instance",ShaderF16:"shader-f16",RG11B10UFloat:"rg11b10ufloat-renderable",BGRA8UNormStorage:"bgra8unorm-storage",Float32Filterable:"float32-filterable",ClipDistances:"clip-distances",DualSourceBlending:"dual-source-blending",Subgroups:"subgroups"};class Kre extends GE{constructor(e,t){super(e),this.texture=t,this.version=t?t.version:0,this.isSampler=!0}}class Zre extends Kre{constructor(e,t,n){super(e,t?t.value:null),this.textureNode=t,this.groupNode=n}update(){this.texture=this.textureNode.value}}class Qre extends II{constructor(e,t){super(e,t?t.array:null),this.attribute=t,this.isStorageBuffer=!0}}let Jre=0;class ese extends Qre{constructor(e,t){super("StorageBuffer_"+Jre++,e?e.value:null),this.nodeUniform=e,this.access=e?e.access:io.READ_WRITE,this.groupNode=t}get buffer(){return this.nodeUniform.value}}class tse extends _l{constructor(e){super(),this.device=e;const t=`
struct VarysStruct {
	@builtin( position ) Position: vec4<f32>,
	@location( 0 ) vTex : vec2<f32>
};

@vertex
fn main( @builtin( vertex_index ) vertexIndex : u32 ) -> VarysStruct {

	var Varys : VarysStruct;

	var pos = array< vec2<f32>, 4 >(
		vec2<f32>( -1.0,  1.0 ),
		vec2<f32>(  1.0,  1.0 ),
		vec2<f32>( -1.0, -1.0 ),
		vec2<f32>(  1.0, -1.0 )
	);

	var tex = array< vec2<f32>, 4 >(
		vec2<f32>( 0.0, 0.0 ),
		vec2<f32>( 1.0, 0.0 ),
		vec2<f32>( 0.0, 1.0 ),
		vec2<f32>( 1.0, 1.0 )
	);

	Varys.vTex = tex[ vertexIndex ];
	Varys.Position = vec4<f32>( pos[ vertexIndex ], 0.0, 1.0 );

	return Varys;

}
`,n=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vTex );

}
`,r=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vec2( vTex.x, 1.0 - vTex.y ) );

}
`;this.mipmapSampler=e.createSampler({minFilter:cu.Linear}),this.flipYSampler=e.createSampler({minFilter:cu.Nearest}),this.transferPipelines={},this.flipYPipelines={},this.mipmapVertexShaderModule=e.createShaderModule({label:"mipmapVertex",code:t}),this.mipmapFragmentShaderModule=e.createShaderModule({label:"mipmapFragment",code:n}),this.flipYFragmentShaderModule=e.createShaderModule({label:"flipYFragment",code:r})}getTransferPipeline(e){let t=this.transferPipelines[e];return t===void 0&&(t=this.device.createRenderPipeline({label:`mipmap-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.mipmapFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:Kc.TriangleStrip,stripIndexFormat:Ih.Uint32},layout:"auto"}),this.transferPipelines[e]=t),t}getFlipYPipeline(e){let t=this.flipYPipelines[e];return t===void 0&&(t=this.device.createRenderPipeline({label:`flipY-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.flipYFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:Kc.TriangleStrip,stripIndexFormat:Ih.Uint32},layout:"auto"}),this.flipYPipelines[e]=t),t}flipY(e,t,n=0){const r=t.format,{width:s,height:a}=t.size,l=this.getTransferPipeline(r),u=this.getFlipYPipeline(r),h=this.device.createTexture({size:{width:s,height:a,depthOrArrayLayers:1},format:r,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),d=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:Di.TwoD,baseArrayLayer:n}),p=h.createView({baseMipLevel:0,mipLevelCount:1,dimension:Di.TwoD,baseArrayLayer:0}),g=this.device.createCommandEncoder({}),y=(v,S,b)=>{const _=v.getBindGroupLayout(0),E=this.device.createBindGroup({layout:_,entries:[{binding:0,resource:this.flipYSampler},{binding:1,resource:S}]}),M=g.beginRenderPass({colorAttachments:[{view:b,loadOp:un.Clear,storeOp:cr.Store,clearValue:[0,0,0,0]}]});M.setPipeline(v),M.setBindGroup(0,E),M.draw(4,1,0,0),M.end()};y(l,d,p),y(u,p,d),this.device.queue.submit([g.finish()]),h.destroy()}generateMipmaps(e,t,n=0){const r=this.get(e);r.useCount===void 0&&(r.useCount=0,r.layers=[]);const s=r.layers[n]||this._mipmapCreateBundles(e,t,n),a=this.device.createCommandEncoder({});this._mipmapRunBundles(a,s),this.device.queue.submit([a.finish()]),r.useCount!==0&&(r.layers[n]=s),r.useCount++}_mipmapCreateBundles(e,t,n){const r=this.getTransferPipeline(t.format),s=r.getBindGroupLayout(0);let a=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:Di.TwoD,baseArrayLayer:n});const l=[];for(let u=1;u<t.mipLevelCount;u++){const h=this.device.createBindGroup({layout:s,entries:[{binding:0,resource:this.mipmapSampler},{binding:1,resource:a}]}),d=e.createView({baseMipLevel:u,mipLevelCount:1,dimension:Di.TwoD,baseArrayLayer:n}),p={colorAttachments:[{view:d,loadOp:un.Clear,storeOp:cr.Store,clearValue:[0,0,0,0]}]},g=this.device.createRenderBundleEncoder({colorFormats:[t.format]});g.setPipeline(r),g.setBindGroup(0,h),g.draw(4,1,0,0),l.push({renderBundles:[g.finish()],passDescriptor:p}),a=d}return l}_mipmapRunBundles(e,t){const n=t.length;for(let r=0;r<n;r++){const s=t[r],a=e.beginRenderPass(s.passDescriptor);a.executeBundles(s.renderBundles),a.end()}}}const nse={[UM]:"never",[Sv]:"less",[OM]:"equal",[Tv]:"less-equal",[BM]:"greater",[FM]:"greater-equal",[kM]:"always",[IM]:"not-equal"},ise=[0,1,3,2,4,5];class rse{constructor(e){this.backend=e,this._passUtils=null,this.defaultTexture={},this.defaultCubeTexture={},this.defaultVideoFrame=null,this.colorBuffer=null,this.depthTexture=new bs,this.depthTexture.name="depthBuffer"}createSampler(e){const t=this.backend,n=t.device,r=t.get(e),s={addressModeU:this._convertAddressMode(e.wrapS),addressModeV:this._convertAddressMode(e.wrapT),addressModeW:this._convertAddressMode(e.wrapR),magFilter:this._convertFilterMode(e.magFilter),minFilter:this._convertFilterMode(e.minFilter),mipmapFilter:this._convertFilterMode(e.minFilter),maxAnisotropy:1};s.magFilter===cu.Linear&&s.minFilter===cu.Linear&&s.mipmapFilter===cu.Linear&&(s.maxAnisotropy=e.anisotropy),e.isDepthTexture&&e.compareFunction!==null&&(s.compare=nse[e.compareFunction]),r.sampler=n.createSampler(s)}createDefaultTexture(e){let t;const n=vT(e);e.isCubeTexture?t=this._getDefaultCubeTextureGPU(n):e.isVideoTexture?this.backend.get(e).externalTexture=this._getDefaultVideoFrame():t=this._getDefaultTextureGPU(n),this.backend.get(e).texture=t}createTexture(e,t={}){const n=this.backend,r=n.get(e);if(r.initialized)throw new Error("WebGPUTextureUtils: Texture already initialized.");t.needsMipmaps===void 0&&(t.needsMipmaps=!1),t.levels===void 0&&(t.levels=1),t.depth===void 0&&(t.depth=1);const{width:s,height:a,depth:l,levels:u}=t;e.isFramebufferTexture&&(t.renderTarget?t.format=this.backend.utils.getCurrentColorFormat(t.renderTarget):t.format=this.backend.utils.getPreferredCanvasFormat());const h=this._getDimension(e),d=e.internalFormat||t.format||vT(e,n.device);r.format=d;const{samples:p,primarySamples:g,isMSAA:y}=n.utils.getTextureSampleData(e);let v=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;e.isStorageTexture===!0&&(v|=GPUTextureUsage.STORAGE_BINDING),e.isCompressedTexture!==!0&&e.isCompressedArrayTexture!==!0&&(v|=GPUTextureUsage.RENDER_ATTACHMENT);const S={label:e.name,size:{width:s,height:a,depthOrArrayLayers:l},mipLevelCount:u,sampleCount:g,dimension:h,format:d,usage:v};if(e.isVideoTexture){const b=e.source.data,_=new VideoFrame(b);S.size.width=_.displayWidth,S.size.height=_.displayHeight,_.close(),r.externalTexture=b}else{if(d===void 0){console.warn("WebGPURenderer: Texture format not supported."),this.createDefaultTexture(e);return}e.isCubeTexture&&(S.textureBindingViewDimension=Di.Cube),r.texture=n.device.createTexture(S)}if(y){const b=Object.assign({},S);b.label=b.label+"-msaa",b.sampleCount=p,r.msaaTexture=n.device.createTexture(b)}r.initialized=!0,r.textureDescriptorGPU=S}destroyTexture(e){const t=this.backend,n=t.get(e);n.texture!==void 0&&n.texture.destroy(),n.msaaTexture!==void 0&&n.msaaTexture.destroy(),t.delete(e)}destroySampler(e){const n=this.backend.get(e);delete n.sampler}generateMipmaps(e){const t=this.backend.get(e);if(e.isCubeTexture)for(let n=0;n<6;n++)this._generateMipmaps(t.texture,t.textureDescriptorGPU,n);else{const n=e.image.depth||1;for(let r=0;r<n;r++)this._generateMipmaps(t.texture,t.textureDescriptorGPU,r)}}getColorBuffer(){this.colorBuffer&&this.colorBuffer.destroy();const e=this.backend,{width:t,height:n}=e.getDrawingBufferSize();return this.colorBuffer=e.device.createTexture({label:"colorBuffer",size:{width:t,height:n,depthOrArrayLayers:1},sampleCount:e.utils.getSampleCount(e.renderer.samples),format:e.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC}),this.colorBuffer}getDepthBuffer(e=!0,t=!1){const n=this.backend,{width:r,height:s}=n.getDrawingBufferSize(),a=this.depthTexture,l=n.get(a).texture;let u,h;if(t?(u=is,h=ts):e&&(u=ns,h=En),l!==void 0){if(a.image.width===r&&a.image.height===s&&a.format===u&&a.type===h)return l;this.destroyTexture(a)}return a.name="depthBuffer",a.format=u,a.type=h,a.image.width=r,a.image.height=s,this.createTexture(a,{width:r,height:s}),n.get(a).texture}updateTexture(e,t){const n=this.backend.get(e),{textureDescriptorGPU:r}=n;if(!(e.isRenderTargetTexture||r===void 0)){if(e.isDataTexture)this._copyBufferToTexture(t.image,n.texture,r,0,e.flipY);else if(e.isArrayTexture||e.isDataArrayTexture||e.isData3DTexture)for(let s=0;s<t.image.depth;s++)this._copyBufferToTexture(t.image,n.texture,r,s,e.flipY,s);else if(e.isCompressedTexture||e.isCompressedArrayTexture)this._copyCompressedBufferToTexture(e.mipmaps,n.texture,r);else if(e.isCubeTexture)this._copyCubeMapToTexture(t.images,n.texture,r,e.flipY,e.premultiplyAlpha);else if(e.isVideoTexture){const s=e.source.data;n.externalTexture=s}else this._copyImageToTexture(t.image,n.texture,r,0,e.flipY,e.premultiplyAlpha);n.version=e.version,e.onUpdate&&e.onUpdate(e)}}async copyTextureToBuffer(e,t,n,r,s,a){const l=this.backend.device,u=this.backend.get(e),h=u.texture,d=u.textureDescriptorGPU.format,p=this._getBytesPerTexel(d);let g=r*p;g=Math.ceil(g/256)*256;const y=l.createBuffer({size:r*s*p,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),v=l.createCommandEncoder();v.copyTextureToBuffer({texture:h,origin:{x:t,y:n,z:a}},{buffer:y,bytesPerRow:g},{width:r,height:s});const S=this._getTypedArrayType(d);l.queue.submit([v.finish()]),await y.mapAsync(GPUMapMode.READ);const b=y.getMappedRange();return new S(b)}_getDefaultTextureGPU(e){let t=this.defaultTexture[e];if(t===void 0){const n=new ei;n.minFilter=Pn,n.magFilter=Pn,this.createTexture(n,{width:1,height:1,format:e}),this.defaultTexture[e]=t=n}return this.backend.get(t).texture}_getDefaultCubeTextureGPU(e){let t=this.defaultTexture[e];if(t===void 0){const n=new Wp;n.minFilter=Pn,n.magFilter=Pn,this.createTexture(n,{width:1,height:1,depth:6}),this.defaultCubeTexture[e]=t=n}return this.backend.get(t).texture}_getDefaultVideoFrame(){let e=this.defaultVideoFrame;if(e===null){const t={timestamp:0,codedWidth:1,codedHeight:1,format:"RGBA"};this.defaultVideoFrame=e=new VideoFrame(new Uint8Array([0,0,0,255]),t)}return e}_copyCubeMapToTexture(e,t,n,r,s){for(let a=0;a<6;a++){const l=e[a],u=r===!0?ise[a]:a;l.isDataTexture?this._copyBufferToTexture(l.image,t,n,u,r):this._copyImageToTexture(l,t,n,u,r,s)}}_copyImageToTexture(e,t,n,r,s,a){this.backend.device.queue.copyExternalImageToTexture({source:e,flipY:s},{texture:t,mipLevel:0,origin:{x:0,y:0,z:r},premultipliedAlpha:a},{width:e.width,height:e.height,depthOrArrayLayers:1})}_getPassUtils(){let e=this._passUtils;return e===null&&(this._passUtils=e=new tse(this.backend.device)),e}_generateMipmaps(e,t,n=0){this._getPassUtils().generateMipmaps(e,t,n)}_flipY(e,t,n=0){this._getPassUtils().flipY(e,t,n)}_copyBufferToTexture(e,t,n,r,s,a=0){const l=this.backend.device,u=e.data,h=this._getBytesPerTexel(n.format),d=e.width*h;l.queue.writeTexture({texture:t,mipLevel:0,origin:{x:0,y:0,z:r}},u,{offset:e.width*e.height*h*a,bytesPerRow:d},{width:e.width,height:e.height,depthOrArrayLayers:1}),s===!0&&this._flipY(t,n,r)}_copyCompressedBufferToTexture(e,t,n){const r=this.backend.device,s=this._getBlockData(n.format),a=n.size.depthOrArrayLayers>1;for(let l=0;l<e.length;l++){const u=e[l],h=u.width,d=u.height,p=a?n.size.depthOrArrayLayers:1,g=Math.ceil(h/s.width)*s.byteLength,y=g*Math.ceil(d/s.height);for(let v=0;v<p;v++)r.queue.writeTexture({texture:t,mipLevel:l,origin:{x:0,y:0,z:v}},u.data,{offset:v*y,bytesPerRow:g,rowsPerImage:Math.ceil(d/s.height)},{width:Math.ceil(h/s.width)*s.width,height:Math.ceil(d/s.height)*s.height,depthOrArrayLayers:1})}}_getBlockData(e){if(e===K.BC1RGBAUnorm||e===K.BC1RGBAUnormSRGB)return{byteLength:8,width:4,height:4};if(e===K.BC2RGBAUnorm||e===K.BC2RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===K.BC3RGBAUnorm||e===K.BC3RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===K.BC4RUnorm||e===K.BC4RSnorm)return{byteLength:8,width:4,height:4};if(e===K.BC5RGUnorm||e===K.BC5RGSnorm)return{byteLength:16,width:4,height:4};if(e===K.BC6HRGBUFloat||e===K.BC6HRGBFloat)return{byteLength:16,width:4,height:4};if(e===K.BC7RGBAUnorm||e===K.BC7RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===K.ETC2RGB8Unorm||e===K.ETC2RGB8UnormSRGB)return{byteLength:8,width:4,height:4};if(e===K.ETC2RGB8A1Unorm||e===K.ETC2RGB8A1UnormSRGB)return{byteLength:8,width:4,height:4};if(e===K.ETC2RGBA8Unorm||e===K.ETC2RGBA8UnormSRGB)return{byteLength:16,width:4,height:4};if(e===K.EACR11Unorm)return{byteLength:8,width:4,height:4};if(e===K.EACR11Snorm)return{byteLength:8,width:4,height:4};if(e===K.EACRG11Unorm)return{byteLength:16,width:4,height:4};if(e===K.EACRG11Snorm)return{byteLength:16,width:4,height:4};if(e===K.ASTC4x4Unorm||e===K.ASTC4x4UnormSRGB)return{byteLength:16,width:4,height:4};if(e===K.ASTC5x4Unorm||e===K.ASTC5x4UnormSRGB)return{byteLength:16,width:5,height:4};if(e===K.ASTC5x5Unorm||e===K.ASTC5x5UnormSRGB)return{byteLength:16,width:5,height:5};if(e===K.ASTC6x5Unorm||e===K.ASTC6x5UnormSRGB)return{byteLength:16,width:6,height:5};if(e===K.ASTC6x6Unorm||e===K.ASTC6x6UnormSRGB)return{byteLength:16,width:6,height:6};if(e===K.ASTC8x5Unorm||e===K.ASTC8x5UnormSRGB)return{byteLength:16,width:8,height:5};if(e===K.ASTC8x6Unorm||e===K.ASTC8x6UnormSRGB)return{byteLength:16,width:8,height:6};if(e===K.ASTC8x8Unorm||e===K.ASTC8x8UnormSRGB)return{byteLength:16,width:8,height:8};if(e===K.ASTC10x5Unorm||e===K.ASTC10x5UnormSRGB)return{byteLength:16,width:10,height:5};if(e===K.ASTC10x6Unorm||e===K.ASTC10x6UnormSRGB)return{byteLength:16,width:10,height:6};if(e===K.ASTC10x8Unorm||e===K.ASTC10x8UnormSRGB)return{byteLength:16,width:10,height:8};if(e===K.ASTC10x10Unorm||e===K.ASTC10x10UnormSRGB)return{byteLength:16,width:10,height:10};if(e===K.ASTC12x10Unorm||e===K.ASTC12x10UnormSRGB)return{byteLength:16,width:12,height:10};if(e===K.ASTC12x12Unorm||e===K.ASTC12x12UnormSRGB)return{byteLength:16,width:12,height:12}}_convertAddressMode(e){let t=tS.ClampToEdge;return e===Tu?t=tS.Repeat:e===Mu&&(t=tS.MirrorRepeat),t}_convertFilterMode(e){let t=cu.Linear;return(e===Pn||e===PM||e===eo)&&(t=cu.Nearest),t}_getBytesPerTexel(e){if(e===K.R8Unorm||e===K.R8Snorm||e===K.R8Uint||e===K.R8Sint)return 1;if(e===K.R16Uint||e===K.R16Sint||e===K.R16Float||e===K.RG8Unorm||e===K.RG8Snorm||e===K.RG8Uint||e===K.RG8Sint)return 2;if(e===K.R32Uint||e===K.R32Sint||e===K.R32Float||e===K.RG16Uint||e===K.RG16Sint||e===K.RG16Float||e===K.RGBA8Unorm||e===K.RGBA8UnormSRGB||e===K.RGBA8Snorm||e===K.RGBA8Uint||e===K.RGBA8Sint||e===K.BGRA8Unorm||e===K.BGRA8UnormSRGB||e===K.RGB9E5UFloat||e===K.RGB10A2Unorm||e===K.RG11B10UFloat||e===K.Depth32Float||e===K.Depth24Plus||e===K.Depth24PlusStencil8||e===K.Depth32FloatStencil8)return 4;if(e===K.RG32Uint||e===K.RG32Sint||e===K.RG32Float||e===K.RGBA16Uint||e===K.RGBA16Sint||e===K.RGBA16Float)return 8;if(e===K.RGBA32Uint||e===K.RGBA32Sint||e===K.RGBA32Float)return 16}_getTypedArrayType(e){if(e===K.R8Uint)return Uint8Array;if(e===K.R8Sint)return Int8Array;if(e===K.R8Unorm)return Uint8Array;if(e===K.R8Snorm)return Int8Array;if(e===K.RG8Uint)return Uint8Array;if(e===K.RG8Sint)return Int8Array;if(e===K.RG8Unorm)return Uint8Array;if(e===K.RG8Snorm)return Int8Array;if(e===K.RGBA8Uint)return Uint8Array;if(e===K.RGBA8Sint)return Int8Array;if(e===K.RGBA8Unorm)return Uint8Array;if(e===K.RGBA8Snorm)return Int8Array;if(e===K.R16Uint)return Uint16Array;if(e===K.R16Sint)return Int16Array;if(e===K.RG16Uint)return Uint16Array;if(e===K.RG16Sint)return Int16Array;if(e===K.RGBA16Uint)return Uint16Array;if(e===K.RGBA16Sint)return Int16Array;if(e===K.R16Float||e===K.RG16Float||e===K.RGBA16Float)return Uint16Array;if(e===K.R32Uint)return Uint32Array;if(e===K.R32Sint)return Int32Array;if(e===K.R32Float)return Float32Array;if(e===K.RG32Uint)return Uint32Array;if(e===K.RG32Sint)return Int32Array;if(e===K.RG32Float)return Float32Array;if(e===K.RGBA32Uint)return Uint32Array;if(e===K.RGBA32Sint)return Int32Array;if(e===K.RGBA32Float)return Float32Array;if(e===K.BGRA8Unorm||e===K.BGRA8UnormSRGB)return Uint8Array;if(e===K.RGB10A2Unorm||e===K.RGB9E5UFloat||e===K.RG11B10UFloat)return Uint32Array;if(e===K.Depth32Float)return Float32Array;if(e===K.Depth24Plus||e===K.Depth24PlusStencil8)return Uint32Array;if(e===K.Depth32FloatStencil8)return Float32Array}_getDimension(e){let t;return e.isData3DTexture?t=T2.ThreeD:t=T2.TwoD,t}}function vT(i,e=null){const t=i.format,n=i.type,r=i.colorSpace,s=wt.getTransfer(r);let a;if(i.isCompressedTexture===!0||i.isCompressedArrayTexture===!0)switch(t){case sl:a=s===Ze?K.BC1RGBAUnormSRGB:K.BC1RGBAUnorm;break;case al:a=s===Ze?K.BC2RGBAUnormSRGB:K.BC2RGBAUnorm;break;case ol:a=s===Ze?K.BC3RGBAUnormSRGB:K.BC3RGBAUnorm;break;case dh:a=s===Ze?K.ETC2RGB8UnormSRGB:K.ETC2RGB8Unorm;break;case ph:a=s===Ze?K.ETC2RGBA8UnormSRGB:K.ETC2RGBA8Unorm;break;case mh:a=s===Ze?K.ASTC4x4UnormSRGB:K.ASTC4x4Unorm;break;case gh:a=s===Ze?K.ASTC5x4UnormSRGB:K.ASTC5x4Unorm;break;case yh:a=s===Ze?K.ASTC5x5UnormSRGB:K.ASTC5x5Unorm;break;case vh:a=s===Ze?K.ASTC6x5UnormSRGB:K.ASTC6x5Unorm;break;case _h:a=s===Ze?K.ASTC6x6UnormSRGB:K.ASTC6x6Unorm;break;case xh:a=s===Ze?K.ASTC8x5UnormSRGB:K.ASTC8x5Unorm;break;case bh:a=s===Ze?K.ASTC8x6UnormSRGB:K.ASTC8x6Unorm;break;case Sh:a=s===Ze?K.ASTC8x8UnormSRGB:K.ASTC8x8Unorm;break;case Th:a=s===Ze?K.ASTC10x5UnormSRGB:K.ASTC10x5Unorm;break;case Mh:a=s===Ze?K.ASTC10x6UnormSRGB:K.ASTC10x6Unorm;break;case Eh:a=s===Ze?K.ASTC10x8UnormSRGB:K.ASTC10x8Unorm;break;case Ah:a=s===Ze?K.ASTC10x10UnormSRGB:K.ASTC10x10Unorm;break;case wh:a=s===Ze?K.ASTC12x10UnormSRGB:K.ASTC12x10Unorm;break;case Rh:a=s===Ze?K.ASTC12x12UnormSRGB:K.ASTC12x12Unorm;break;case Xn:a=s===Ze?K.RGBA8UnormSRGB:K.RGBA8Unorm;break;default:console.error("WebGPURenderer: Unsupported texture format.",t)}else switch(t){case Xn:switch(n){case gu:a=K.RGBA8Snorm;break;case yu:a=K.RGBA16Sint;break;case ks:a=K.RGBA16Uint;break;case En:a=K.RGBA32Uint;break;case Li:a=K.RGBA32Sint;break;case Gn:a=s===Ze?K.RGBA8UnormSRGB:K.RGBA8Unorm;break;case Oi:a=K.RGBA16Float;break;case Jn:a=K.RGBA32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBAFormat.",n)}break;case Vp:switch(n){case bv:a=K.RGB9E5UFloat;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBFormat.",n)}break;case Gp:switch(n){case gu:a=K.R8Snorm;break;case yu:a=K.R16Sint;break;case ks:a=K.R16Uint;break;case En:a=K.R32Uint;break;case Li:a=K.R32Sint;break;case Gn:a=K.R8Unorm;break;case Oi:a=K.R16Float;break;case Jn:a=K.R32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RedFormat.",n)}break;case to:switch(n){case gu:a=K.RG8Snorm;break;case yu:a=K.RG16Sint;break;case ks:a=K.RG16Uint;break;case En:a=K.RG32Uint;break;case Li:a=K.RG32Sint;break;case Gn:a=K.RG8Unorm;break;case Oi:a=K.RG16Float;break;case Jn:a=K.RG32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RGFormat.",n)}break;case ns:switch(n){case ks:a=K.Depth16Unorm;break;case En:a=K.Depth24Plus;break;case Jn:a=K.Depth32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with DepthFormat.",n)}break;case is:switch(n){case ts:a=K.Depth24PlusStencil8;break;case Jn:e&&e.features.has(yT.Depth32FloatStencil8)===!1&&console.error('WebGPURenderer: Depth textures with DepthStencilFormat + FloatType can only be used with the "depth32float-stencil8" GPU feature.'),a=K.Depth32FloatStencil8;break;default:console.error("WebGPURenderer: Unsupported texture type with DepthStencilFormat.",n)}break;case Wh:switch(n){case Li:a=K.R32Sint;break;case En:a=K.R32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RedIntegerFormat.",n)}break;case jh:switch(n){case Li:a=K.RG32Sint;break;case En:a=K.RG32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RGIntegerFormat.",n)}break;case qh:switch(n){case Li:a=K.RGBA32Sint;break;case En:a=K.RGBA32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBAIntegerFormat.",n)}break;default:console.error("WebGPURenderer: Unsupported texture format.",t)}return a}const sse=/^[fn]*\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)\s*[\-\>]*\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/i,ase=/([a-z_0-9]+)\s*:\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/ig,M2={f32:"float",i32:"int",u32:"uint",bool:"bool","vec2<f32>":"vec2","vec2<i32>":"ivec2","vec2<u32>":"uvec2","vec2<bool>":"bvec2",vec2f:"vec2",vec2i:"ivec2",vec2u:"uvec2",vec2b:"bvec2","vec3<f32>":"vec3","vec3<i32>":"ivec3","vec3<u32>":"uvec3","vec3<bool>":"bvec3",vec3f:"vec3",vec3i:"ivec3",vec3u:"uvec3",vec3b:"bvec3","vec4<f32>":"vec4","vec4<i32>":"ivec4","vec4<u32>":"uvec4","vec4<bool>":"bvec4",vec4f:"vec4",vec4i:"ivec4",vec4u:"uvec4",vec4b:"bvec4","mat2x2<f32>":"mat2",mat2x2f:"mat2","mat3x3<f32>":"mat3",mat3x3f:"mat3","mat4x4<f32>":"mat4",mat4x4f:"mat4",sampler:"sampler",texture_1d:"texture",texture_2d:"texture",texture_2d_array:"texture",texture_multisampled_2d:"cubeTexture",texture_depth_2d:"depthTexture",texture_depth_2d_array:"depthTexture",texture_depth_multisampled_2d:"depthTexture",texture_depth_cube:"depthTexture",texture_depth_cube_array:"depthTexture",texture_3d:"texture3D",texture_cube:"cubeTexture",texture_cube_array:"cubeTexture",texture_storage_1d:"storageTexture",texture_storage_2d:"storageTexture",texture_storage_2d_array:"storageTexture",texture_storage_3d:"storageTexture"},ose=i=>{i=i.trim();const e=i.match(sse);if(e!==null&&e.length===4){const t=e[2],n=[];let r=null;for(;(r=ase.exec(t))!==null;)n.push({name:r[1],type:r[2]});const s=[];for(let d=0;d<n.length;d++){const{name:p,type:g}=n[d];let y=g;y.startsWith("ptr")?y="pointer":(y.startsWith("texture")&&(y=g.split("<")[0]),y=M2[y]),s.push(new kE(y,p))}const a=i.substring(e[0].length),l=e[3]||"void",u=e[1]!==void 0?e[1]:"";return{type:M2[l]||l,inputs:s,name:u,inputsCode:t,blockCode:a,outputType:l}}else throw new Error("FunctionNode: Function is not a WGSL code.")};class lse extends VE{constructor(e){const{type:t,inputs:n,name:r,inputsCode:s,blockCode:a,outputType:l}=ose(e);super(t,n,r),this.inputsCode=s,this.blockCode=a,this.outputType=l}getCode(e=this.name){const t=this.outputType!=="void"?"-> "+this.outputType:"";return`fn ${e} ( ${this.inputsCode.trim()} ) ${t}`+this.blockCode}}class use extends OI{parseFunction(e){return new lse(e)}}const Ic=typeof self<"u"?self.GPUShaderStage:{VERTEX:1,FRAGMENT:2,COMPUTE:4},cse={[io.READ_ONLY]:"read",[io.WRITE_ONLY]:"write",[io.READ_WRITE]:"read_write"},E2={[Tu]:"repeat",[ra]:"clamp",[Mu]:"mirror"},fy={vertex:Ic?Ic.VERTEX:1,fragment:Ic?Ic.FRAGMENT:2,compute:Ic?Ic.COMPUTE:4},A2={instance:!0,swizzleAssign:!1,storageBuffer:!0},hse={"^^":"tsl_xor"},fse={float:"f32",int:"i32",uint:"u32",bool:"bool",color:"vec3<f32>",vec2:"vec2<f32>",ivec2:"vec2<i32>",uvec2:"vec2<u32>",bvec2:"vec2<bool>",vec3:"vec3<f32>",ivec3:"vec3<i32>",uvec3:"vec3<u32>",bvec3:"vec3<bool>",vec4:"vec4<f32>",ivec4:"vec4<i32>",uvec4:"vec4<u32>",bvec4:"vec4<bool>",mat2:"mat2x2<f32>",mat3:"mat3x3<f32>",mat4:"mat4x4<f32>"},w2={},gs={tsl_xor:new Si("fn tsl_xor( a : bool, b : bool ) -> bool { return ( a || b ) && !( a && b ); }"),mod_float:new Si("fn tsl_mod_float( x : f32, y : f32 ) -> f32 { return x - y * floor( x / y ); }"),mod_vec2:new Si("fn tsl_mod_vec2( x : vec2f, y : vec2f ) -> vec2f { return x - y * floor( x / y ); }"),mod_vec3:new Si("fn tsl_mod_vec3( x : vec3f, y : vec3f ) -> vec3f { return x - y * floor( x / y ); }"),mod_vec4:new Si("fn tsl_mod_vec4( x : vec4f, y : vec4f ) -> vec4f { return x - y * floor( x / y ); }"),equals_bool:new Si("fn tsl_equals_bool( a : bool, b : bool ) -> bool { return a == b; }"),equals_bvec2:new Si("fn tsl_equals_bvec2( a : vec2f, b : vec2f ) -> vec2<bool> { return vec2<bool>( a.x == b.x, a.y == b.y ); }"),equals_bvec3:new Si("fn tsl_equals_bvec3( a : vec3f, b : vec3f ) -> vec3<bool> { return vec3<bool>( a.x == b.x, a.y == b.y, a.z == b.z ); }"),equals_bvec4:new Si("fn tsl_equals_bvec4( a : vec4f, b : vec4f ) -> vec4<bool> { return vec4<bool>( a.x == b.x, a.y == b.y, a.z == b.z, a.w == b.w ); }"),repeatWrapping_float:new Si("fn tsl_repeatWrapping_float( coord: f32 ) -> f32 { return fract( coord ); }"),mirrorWrapping_float:new Si("fn tsl_mirrorWrapping_float( coord: f32 ) -> f32 { let mirrored = fract( coord * 0.5 ) * 2.0; return 1.0 - abs( 1.0 - mirrored ); }"),clampWrapping_float:new Si("fn tsl_clampWrapping_float( coord: f32 ) -> f32 { return clamp( coord, 0.0, 1.0 ); }"),biquadraticTexture:new Si(`
fn tsl_biquadraticTexture( map : texture_2d<f32>, coord : vec2f, iRes : vec2u, level : u32 ) -> vec4f {

	let res = vec2f( iRes );

	let uvScaled = coord * res;
	let uvWrapping = ( ( uvScaled % res ) + res ) % res;

	// https://www.shadertoy.com/view/WtyXRy

	let uv = uvWrapping - 0.5;
	let iuv = floor( uv );
	let f = fract( uv );

	let rg1 = textureLoad( map, vec2u( iuv + vec2( 0.5, 0.5 ) ) % iRes, level );
	let rg2 = textureLoad( map, vec2u( iuv + vec2( 1.5, 0.5 ) ) % iRes, level );
	let rg3 = textureLoad( map, vec2u( iuv + vec2( 0.5, 1.5 ) ) % iRes, level );
	let rg4 = textureLoad( map, vec2u( iuv + vec2( 1.5, 1.5 ) ) % iRes, level );

	return mix( mix( rg1, rg2, f.x ), mix( rg3, rg4, f.x ), f.y );

}
`)},Ud={dFdx:"dpdx",dFdy:"- dpdy",mod_float:"tsl_mod_float",mod_vec2:"tsl_mod_vec2",mod_vec3:"tsl_mod_vec3",mod_vec4:"tsl_mod_vec4",equals_bool:"tsl_equals_bool",equals_bvec2:"tsl_equals_bvec2",equals_bvec3:"tsl_equals_bvec3",equals_bvec4:"tsl_equals_bvec4",inversesqrt:"inverseSqrt",bitcast:"bitcast<f32>"};typeof navigator<"u"&&/Windows/g.test(navigator.userAgent)&&(gs.pow_float=new Si("fn tsl_pow_float( a : f32, b : f32 ) -> f32 { return select( -pow( -a, b ), pow( a, b ), a > 0.0 ); }"),gs.pow_vec2=new Si("fn tsl_pow_vec2( a : vec2f, b : vec2f ) -> vec2f { return vec2f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ) ); }",[gs.pow_float]),gs.pow_vec3=new Si("fn tsl_pow_vec3( a : vec3f, b : vec3f ) -> vec3f { return vec3f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ), tsl_pow_float( a.z, b.z ) ); }",[gs.pow_float]),gs.pow_vec4=new Si("fn tsl_pow_vec4( a : vec4f, b : vec4f ) -> vec4f { return vec4f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ), tsl_pow_float( a.z, b.z ), tsl_pow_float( a.w, b.w ) ); }",[gs.pow_float]),Ud.pow_float="tsl_pow_float",Ud.pow_vec2="tsl_pow_vec2",Ud.pow_vec3="tsl_pow_vec3",Ud.pow_vec4="tsl_pow_vec4");let jI="";(typeof navigator<"u"&&/Firefox|Deno/g.test(navigator.userAgent))!==!0&&(jI+=`diagnostic( off, derivative_uniformity );
`);class dse extends UI{constructor(e,t){super(e,t,new use),this.uniformGroups={},this.builtins={},this.directives={},this.scopedArrays=new Map}needsToWorkingColorSpace(e){return e.isVideoTexture===!0&&e.colorSpace!==pr}_generateTextureSample(e,t,n,r,s=this.shaderStage){return s==="fragment"?r?`textureSample( ${t}, ${t}_sampler, ${n}, ${r} )`:`textureSample( ${t}, ${t}_sampler, ${n} )`:this._generateTextureSampleLevel(e,t,n,"0",r)}_generateVideoSample(e,t,n=this.shaderStage){if(n==="fragment")return`textureSampleBaseClampToEdge( ${e}, ${e}_sampler, vec2<f32>( ${t}.x, 1.0 - ${t}.y ) )`;console.error(`WebGPURenderer: THREE.VideoTexture does not support ${n} shader.`)}_generateTextureSampleLevel(e,t,n,r,s){return this.isUnfilterable(e)===!1?`textureSampleLevel( ${t}, ${t}_sampler, ${n}, ${r} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,t,n,r):this.generateTextureLod(e,t,n,s,r)}generateWrapFunction(e){const t=`tsl_coord_${E2[e.wrapS]}S_${E2[e.wrapT]}_${e.isData3DTexture?"3d":"2d"}T`;let n=w2[t];if(n===void 0){const r=[],s=e.isData3DTexture?"vec3f":"vec2f";let a=`fn ${t}( coord : ${s} ) -> ${s} {

	return ${s}(
`;const l=(u,h)=>{u===Tu?(r.push(gs.repeatWrapping_float),a+=`		tsl_repeatWrapping_float( coord.${h} )`):u===ra?(r.push(gs.clampWrapping_float),a+=`		tsl_clampWrapping_float( coord.${h} )`):u===Mu?(r.push(gs.mirrorWrapping_float),a+=`		tsl_mirrorWrapping_float( coord.${h} )`):(a+=`		coord.${h}`,console.warn(`WebGPURenderer: Unsupported texture wrap type "${u}" for vertex shader.`))};l(e.wrapS,"x"),a+=`,
`,l(e.wrapT,"y"),e.isData3DTexture&&(a+=`,
`,l(e.wrapR,"z")),a+=`
	);

}
`,w2[t]=n=new Si(a,r)}return n.build(this),t}generateArrayDeclaration(e,t){return`array< ${this.getType(e)}, ${t} >`}generateTextureDimension(e,t,n){const r=this.getDataFromNode(e,this.shaderStage,this.globalCache);r.dimensionsSnippet===void 0&&(r.dimensionsSnippet={});let s=r.dimensionsSnippet[n];if(r.dimensionsSnippet[n]===void 0){let a,l;const{primarySamples:u}=this.renderer.backend.utils.getTextureSampleData(e),h=u>1;e.isData3DTexture?l="vec3<u32>":l="vec2<u32>",h||e.isVideoTexture||e.isStorageTexture?a=t:a=`${t}${n?`, u32( ${n} )`:""}`,s=new Py(new Ly(`textureDimensions( ${a} )`,l)),r.dimensionsSnippet[n]=s,(e.isArrayTexture||e.isDataArrayTexture||e.isData3DTexture)&&(r.arrayLayerCount=new Py(new Ly(`textureNumLayers(${t})`,"u32"))),e.isTextureCube&&(r.cubeFaceCount=new Py(new Ly("6u","u32")))}return s.build(this)}generateFilteredTexture(e,t,n,r="0u"){this._include("biquadraticTexture");const s=this.generateWrapFunction(e),a=this.generateTextureDimension(e,t,r);return`tsl_biquadraticTexture( ${t}, ${s}( ${n} ), ${a}, u32( ${r} ) )`}generateTextureLod(e,t,n,r,s="0u"){const a=this.generateWrapFunction(e),l=this.generateTextureDimension(e,t,s),u=e.isData3DTexture?"vec3":"vec2",h=`${u}<u32>( ${a}( ${n} ) * ${u}<f32>( ${l} ) )`;return this.generateTextureLoad(e,t,h,r,s)}generateTextureLoad(e,t,n,r,s="0u"){let a;return e.isVideoTexture===!0?a=`textureLoad( ${t}, ${n} )`:r?a=`textureLoad( ${t}, ${n}, ${r}, u32( ${s} ) )`:(a=`textureLoad( ${t}, ${n}, u32( ${s} ) )`,this.renderer.backend.compatibilityMode&&e.isDepthTexture&&(a+=".x")),a}generateTextureStore(e,t,n,r,s){let a;return r?a=`textureStore( ${t}, ${n}, ${r}, ${s} )`:a=`textureStore( ${t}, ${n}, ${s} )`,a}isSampleCompare(e){return e.isDepthTexture===!0&&e.compareFunction!==null}isUnfilterable(e){return this.getComponentTypeFromTexture(e)!=="float"||!this.isAvailable("float32Filterable")&&e.isDataTexture===!0&&e.type===Jn||this.isSampleCompare(e)===!1&&e.minFilter===Pn&&e.magFilter===Pn||this.renderer.backend.utils.getTextureSampleData(e).primarySamples>1}generateTexture(e,t,n,r,s=this.shaderStage){let a=null;return e.isVideoTexture===!0?a=this._generateVideoSample(t,n,s):this.isUnfilterable(e)?a=this.generateTextureLod(e,t,n,r,"0",s):a=this._generateTextureSample(e,t,n,r,s),a}generateTextureGrad(e,t,n,r,s,a=this.shaderStage){if(a==="fragment")return`textureSampleGrad( ${t}, ${t}_sampler, ${n},  ${r[0]}, ${r[1]} )`;console.error(`WebGPURenderer: THREE.TextureNode.gradient() does not support ${a} shader.`)}generateTextureCompare(e,t,n,r,s,a=this.shaderStage){if(a==="fragment")return e.isDepthTexture===!0&&e.isArrayTexture===!0?`textureSampleCompare( ${t}, ${t}_sampler, ${n}, ${s}, ${r} )`:`textureSampleCompare( ${t}, ${t}_sampler, ${n}, ${r} )`;console.error(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${a} shader.`)}generateTextureLevel(e,t,n,r,s,a=this.shaderStage){let l=null;return e.isVideoTexture===!0?l=this._generateVideoSample(t,n,a):l=this._generateTextureSampleLevel(e,t,n,r,s),l}generateTextureBias(e,t,n,r,s,a=this.shaderStage){if(a==="fragment")return`textureSampleBias( ${t}, ${t}_sampler, ${n}, ${r} )`;console.error(`WebGPURenderer: THREE.TextureNode.biasNode does not support ${a} shader.`)}getPropertyName(e,t=this.shaderStage){if(e.isNodeVarying===!0&&e.needsInterpolation===!0){if(t==="vertex")return`varyings.${e.name}`}else if(e.isNodeUniform===!0){const n=e.name,r=e.type;return r==="texture"||r==="cubeTexture"||r==="storageTexture"||r==="texture3D"?n:r==="buffer"||r==="storageBuffer"||r==="indirectStorageBuffer"?this.isCustomStruct(e)?n:n+".value":e.groupNode.name+"."+n}return super.getPropertyName(e)}getOutputStructName(){return"output"}getFunctionOperator(e){const t=hse[e];return t!==void 0?(this._include(t),t):null}getNodeAccess(e,t){return t!=="compute"?io.READ_ONLY:e.access}getStorageAccess(e,t){return cse[this.getNodeAccess(e,t)]}getUniformFromNode(e,t,n,r=null){const s=super.getUniformFromNode(e,t,n,r),a=this.getDataFromNode(e,n,this.globalCache);if(a.uniformGPU===void 0){let l;const u=e.groupNode,h=u.name,d=this.getBindGroupArray(h,n);if(t==="texture"||t==="cubeTexture"||t==="storageTexture"||t==="texture3D"){let p=null;const g=this.getNodeAccess(e,n);if(t==="texture"||t==="storageTexture"?p=new Xv(s.name,s.node,u,g):t==="cubeTexture"?p=new VI(s.name,s.node,u,g):t==="texture3D"&&(p=new GI(s.name,s.node,u,g)),p.store=e.isStorageTextureNode===!0,p.setVisibility(fy[n]),this.isUnfilterable(e.value)===!1&&p.store===!1){const y=new Zre(`${s.name}_sampler`,s.node,u);y.setVisibility(fy[n]),d.push(y,p),l=[y,p]}else d.push(p),l=[p]}else if(t==="buffer"||t==="storageBuffer"||t==="indirectStorageBuffer"){const p=t==="buffer"?kI:ese,g=new p(e,u);g.setVisibility(fy[n]),d.push(g),l=g,s.name=r||"NodeBuffer_"+s.id}else{const p=this.uniformGroups[n]||(this.uniformGroups[n]={});let g=p[h];g===void 0&&(g=new zI(h,u),g.setVisibility(fy[n]),p[h]=g,d.push(g)),l=this.getNodeUniform(s,t),g.addUniform(l)}a.uniformGPU=l}return s}getBuiltin(e,t,n,r=this.shaderStage){const s=this.builtins[r]||(this.builtins[r]=new Map);return s.has(e)===!1&&s.set(e,{name:e,property:t,type:n}),t}hasBuiltin(e,t=this.shaderStage){return this.builtins[t]!==void 0&&this.builtins[t].has(e)}getVertexIndex(){return this.shaderStage==="vertex"?this.getBuiltin("vertex_index","vertexIndex","u32","attribute"):"vertexIndex"}buildFunctionCode(e){const t=e.layout,n=this.flowShaderNode(e),r=[];for(const a of t.inputs)r.push(a.name+" : "+this.getType(a.type));let s=`fn ${t.name}( ${r.join(", ")} ) -> ${this.getType(t.type)} {
${n.vars}
${n.code}
`;return n.result&&(s+=`	return ${n.result};
`),s+=`
}
`,s}getInstanceIndex(){return this.shaderStage==="vertex"?this.getBuiltin("instance_index","instanceIndex","u32","attribute"):"instanceIndex"}getInvocationLocalIndex(){return this.getBuiltin("local_invocation_index","invocationLocalIndex","u32","attribute")}getSubgroupSize(){return this.enableSubGroups(),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute")}getInvocationSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_invocation_id","invocationSubgroupIndex","u32","attribute")}getSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_id","subgroupIndex","u32","attribute")}getDrawIndex(){return null}getFrontFacing(){return this.getBuiltin("front_facing","isFront","bool")}getFragCoord(){return this.getBuiltin("position","fragCoord","vec4<f32>")+".xy"}getFragDepth(){return"output."+this.getBuiltin("frag_depth","depth","f32","output")}getClipDistance(){return"varyings.hw_clip_distances"}isFlipY(){return!1}enableDirective(e,t=this.shaderStage){(this.directives[t]||(this.directives[t]=new Set)).add(e)}getDirectives(e){const t=[],n=this.directives[e];if(n!==void 0)for(const r of n)t.push(`enable ${r};`);return t.join(`
`)}enableSubGroups(){this.enableDirective("subgroups")}enableSubgroupsF16(){this.enableDirective("subgroups-f16")}enableClipDistances(){this.enableDirective("clip_distances")}enableShaderF16(){this.enableDirective("f16")}enableDualSourceBlending(){this.enableDirective("dual_source_blending")}enableHardwareClipping(e){this.enableClipDistances(),this.getBuiltin("clip_distances","hw_clip_distances",`array<f32, ${e} >`,"vertex")}getBuiltins(e){const t=[],n=this.builtins[e];if(n!==void 0)for(const{name:r,property:s,type:a}of n.values())t.push(`@builtin( ${r} ) ${s} : ${a}`);return t.join(`,
	`)}getScopedArray(e,t,n,r){return this.scopedArrays.has(e)===!1&&this.scopedArrays.set(e,{name:e,scope:t,bufferType:n,bufferCount:r}),e}getScopedArrays(e){if(e!=="compute")return;const t=[];for(const{name:n,scope:r,bufferType:s,bufferCount:a}of this.scopedArrays.values()){const l=this.getType(s);t.push(`var<${r}> ${n}: array< ${l}, ${a} >;`)}return t.join(`
`)}getAttributes(e){const t=[];if(e==="compute"&&(this.getBuiltin("global_invocation_id","globalId","vec3<u32>","attribute"),this.getBuiltin("workgroup_id","workgroupId","vec3<u32>","attribute"),this.getBuiltin("local_invocation_id","localId","vec3<u32>","attribute"),this.getBuiltin("num_workgroups","numWorkgroups","vec3<u32>","attribute"),this.renderer.hasFeature("subgroups")&&(this.enableDirective("subgroups",e),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute"))),e==="vertex"||e==="compute"){const n=this.getBuiltins("attribute");n&&t.push(n);const r=this.getAttributesArray();for(let s=0,a=r.length;s<a;s++){const l=r[s],u=l.name,h=this.getType(l.type);t.push(`@location( ${s} ) ${u} : ${h}`)}}return t.join(`,
	`)}getStructMembers(e){const t=[];for(const n of e.members){const r=e.output?"@location( "+n.index+" ) ":"";let s=this.getType(n.type);n.atomic&&(s="atomic< "+s+" >"),t.push(`	${r+n.name} : ${s}`)}return e.output&&t.push(`	${this.getBuiltins("output")}`),t.join(`,
`)}getStructs(e){let t="";const n=this.structs[e];if(n.length>0){const r=[];for(const s of n){let a=`struct ${s.name} {
`;a+=this.getStructMembers(s),a+=`
};`,r.push(a)}t=`
`+r.join(`

`)+`
`}return t}getVar(e,t,n=null){let r=`var ${t} : `;return n!==null?r+=this.generateArrayDeclaration(e,n):r+=this.getType(e),r}getVars(e){const t=[],n=this.vars[e];if(n!==void 0)for(const r of n)t.push(`	${this.getVar(r.type,r.name,r.count)};`);return`
${t.join(`
`)}
`}getVaryings(e){const t=[];if(e==="vertex"&&this.getBuiltin("position","Vertex","vec4<f32>","vertex"),e==="vertex"||e==="fragment"){const s=this.varyings,a=this.vars[e];for(let l=0;l<s.length;l++){const u=s[l];if(u.needsInterpolation){let h=`@location( ${l} )`;if(u.interpolationType){const d=u.interpolationSampling!==null?`, ${u.interpolationSampling} )`:" )";h+=` @interpolate( ${u.interpolationType}${d}`}else/^(int|uint|ivec|uvec)/.test(u.type)&&(h+=` @interpolate( ${this.renderer.backend.compatibilityMode?"flat, either":"flat"} )`);t.push(`${h} ${u.name} : ${this.getType(u.type)}`)}else e==="vertex"&&a.includes(u)===!1&&a.push(u)}}const n=this.getBuiltins(e);n&&t.push(n);const r=t.join(`,
	`);return e==="vertex"?this._getWGSLStruct("VaryingsStruct","	"+r):r}isCustomStruct(e){const t=e.value,n=e.node,r=(t.isBufferAttribute||t.isInstancedBufferAttribute)&&n.structTypeNode!==null,s=n.value&&n.value.array&&typeof n.value.itemSize=="number"&&n.value.array.length>n.value.itemSize;return r&&!s}getUniforms(e){const t=this.uniforms[e],n=[],r=[],s=[],a={};for(const u of t){const h=u.groupNode.name,d=this.bindingsIndexes[h];if(u.type==="texture"||u.type==="cubeTexture"||u.type==="storageTexture"||u.type==="texture3D"){const p=u.node.value;this.isUnfilterable(p)===!1&&u.node.isStorageTextureNode!==!0&&(this.isSampleCompare(p)?n.push(`@binding( ${d.binding++} ) @group( ${d.group} ) var ${u.name}_sampler : sampler_comparison;`):n.push(`@binding( ${d.binding++} ) @group( ${d.group} ) var ${u.name}_sampler : sampler;`));let g,y="";const{primarySamples:v}=this.renderer.backend.utils.getTextureSampleData(p);if(v>1&&(y="_multisampled"),p.isCubeTexture===!0)g="texture_cube<f32>";else if(p.isDepthTexture===!0)this.renderer.backend.compatibilityMode&&p.compareFunction===null?g=`texture${y}_2d<f32>`:g=`texture_depth${y}_2d${p.isArrayTexture===!0?"_array":""}`;else if(p.isArrayTexture===!0||p.isDataArrayTexture===!0||p.isCompressedArrayTexture===!0)g="texture_2d_array<f32>";else if(p.isVideoTexture===!0)g="texture_external";else if(p.isData3DTexture===!0)g="texture_3d<f32>";else if(u.node.isStorageTextureNode===!0){const S=vT(p),b=this.getStorageAccess(u.node,e);g=`texture_storage_2d<${S}, ${b}>`}else{const S=this.getComponentTypeFromTexture(p).charAt(0);g=`texture${y}_2d<${S}32>`}n.push(`@binding( ${d.binding++} ) @group( ${d.group} ) var ${u.name} : ${g};`)}else if(u.type==="buffer"||u.type==="storageBuffer"||u.type==="indirectStorageBuffer"){const p=u.node,g=this.getType(p.getNodeType(this)),y=p.bufferCount,v=y>0&&u.type==="buffer"?", "+y:"",S=p.isStorageBufferNode?`storage, ${this.getStorageAccess(p,e)}`:"uniform";if(this.isCustomStruct(u))r.push(`@binding( ${d.binding++} ) @group( ${d.group} ) var<${S}> ${u.name} : ${g};`);else{const _=`	value : array< ${p.isAtomic?`atomic<${g}>`:`${g}`}${v} >`;r.push(this._getWGSLStructBinding(u.name,_,S,d.binding++,d.group))}}else{const p=this.getType(this.getVectorType(u.type)),g=u.groupNode.name;(a[g]||(a[g]={index:d.binding++,id:d.group,snippets:[]})).snippets.push(`	${u.name} : ${p}`)}}for(const u in a){const h=a[u];s.push(this._getWGSLStructBinding(u,h.snippets.join(`,
`),"uniform",h.index,h.id))}let l=n.join(`
`);return l+=r.join(`
`),l+=s.join(`
`),l}buildCode(){const e=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){this.shaderStage=t;const n=e[t];n.uniforms=this.getUniforms(t),n.attributes=this.getAttributes(t),n.varyings=this.getVaryings(t),n.structs=this.getStructs(t),n.vars=this.getVars(t),n.codes=this.getCodes(t),n.directives=this.getDirectives(t),n.scopedArrays=this.getScopedArrays(t);let r=`// code

`;r+=this.flowCode[t];const s=this.flowNodes[t],a=s[s.length-1],l=a.outputNode,u=l!==void 0&&l.isOutputStructNode===!0;for(const h of s){const d=this.getFlowData(h),p=h.name;if(p&&(r.length>0&&(r+=`
`),r+=`	// flow -> ${p}
`),r+=`${d.code}
	`,h===a&&t!=="compute"){if(r+=`// result

	`,t==="vertex")r+=`varyings.Vertex = ${d.result};`;else if(t==="fragment")if(u)n.returnType=l.getNodeType(this),n.structs+="var<private> output : "+n.returnType+";",r+=`return ${d.result};`;else{let g="	@location(0) color: vec4<f32>";const y=this.getBuiltins("output");y&&(g+=`,
	`+y),n.returnType="OutputStruct",n.structs+=this._getWGSLStruct("OutputStruct",g),n.structs+=`
var<private> output : OutputStruct;`,r+=`output.color = ${d.result};

	return output;`}}}n.flow=r}this.shaderStage=null,this.material!==null?(this.vertexShader=this._getWGSLVertexCode(e.vertex),this.fragmentShader=this._getWGSLFragmentCode(e.fragment)):this.computeShader=this._getWGSLComputeCode(e.compute,(this.object.workgroupSize||[64]).join(", "))}getMethod(e,t=null){let n;return t!==null&&(n=this._getWGSLMethod(e+"_"+t)),n===void 0&&(n=this._getWGSLMethod(e)),n||e}getType(e){return fse[e]||e}isAvailable(e){let t=A2[e];return t===void 0&&(e==="float32Filterable"?t=this.renderer.hasFeature("float32-filterable"):e==="clipDistance"&&(t=this.renderer.hasFeature("clip-distances")),A2[e]=t),t}_getWGSLMethod(e){return gs[e]!==void 0&&this._include(e),Ud[e]}_include(e){const t=gs[e];return t.build(this),this.currentFunctionNode!==null&&this.currentFunctionNode.includes.push(t),t}_getWGSLVertexCode(e){return`${this.getSignature()}
// directives
${e.directives}

// structs
${e.structs}

// uniforms
${e.uniforms}

// varyings
${e.varyings}
var<private> varyings : VaryingsStruct;

// codes
${e.codes}

@vertex
fn main( ${e.attributes} ) -> VaryingsStruct {

	// vars
	${e.vars}

	// flow
	${e.flow}

	return varyings;

}
`}_getWGSLFragmentCode(e){return`${this.getSignature()}
// global
${jI}

// structs
${e.structs}

// uniforms
${e.uniforms}

// codes
${e.codes}

@fragment
fn main( ${e.varyings} ) -> ${e.returnType} {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLComputeCode(e,t){return`${this.getSignature()}
// directives
${e.directives}

// system
var<private> instanceIndex : u32;

// locals
${e.scopedArrays}

// structs
${e.structs}

// uniforms
${e.uniforms}

// codes
${e.codes}

@compute @workgroup_size( ${t} )
fn main( ${e.attributes} ) {

	// system
	instanceIndex = globalId.x + globalId.y * numWorkgroups.x * u32(${t}) + globalId.z * numWorkgroups.x * numWorkgroups.y * u32(${t});

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLStruct(e,t){return`
struct ${e} {
${t}
};`}_getWGSLStructBinding(e,t,n,r=0,s=0){const a=e+"Struct";return`${this._getWGSLStruct(a,t)}
@binding( ${r} ) @group( ${s} )
var<${n}> ${e} : ${a};`}}class pse{constructor(e){this.backend=e}getCurrentDepthStencilFormat(e){let t;return e.depthTexture!==null?t=this.getTextureFormatGPU(e.depthTexture):e.depth&&e.stencil?t=K.Depth24PlusStencil8:e.depth&&(t=K.Depth24Plus),t}getTextureFormatGPU(e){return this.backend.get(e).format}getTextureSampleData(e){let t;if(e.isFramebufferTexture)t=1;else if(e.isDepthTexture&&!e.renderTarget){const s=this.backend.renderer,a=s.getRenderTarget();t=a?a.samples:s.samples}else e.renderTarget&&(t=e.renderTarget.samples);t=t||1;const n=t>1&&e.renderTarget!==null&&e.isDepthTexture!==!0&&e.isFramebufferTexture!==!0;return{samples:t,primarySamples:n?1:t,isMSAA:n}}getCurrentColorFormat(e){let t;return e.textures!==null?t=this.getTextureFormatGPU(e.textures[0]):t=this.getPreferredCanvasFormat(),t}getCurrentColorSpace(e){return e.textures!==null?e.textures[0].colorSpace:this.backend.renderer.outputColorSpace}getPrimitiveTopology(e,t){if(e.isPoints)return Kc.PointList;if(e.isLineSegments||e.isMesh&&t.wireframe===!0)return Kc.LineList;if(e.isLine)return Kc.LineStrip;if(e.isMesh)return Kc.TriangleList}getSampleCount(e){let t=1;return e>1&&(t=Math.pow(2,Math.floor(Math.log2(e))),t===2&&(t=4)),t}getSampleCountRenderContext(e){return e.textures!==null?this.getSampleCount(e.sampleCount):this.getSampleCount(this.backend.renderer.samples)}getPreferredCanvasFormat(){const e=this.backend.parameters.outputType;if(e===void 0)return navigator.gpu.getPreferredCanvasFormat();if(e===Gn)return K.BGRA8Unorm;if(e===Oi)return K.RGBA16Float;throw new Error("Unsupported outputType")}}const mse=new Map([[Int8Array,["sint8","snorm8"]],[Uint8Array,["uint8","unorm8"]],[Int16Array,["sint16","snorm16"]],[Uint16Array,["uint16","unorm16"]],[Int32Array,["sint32","snorm32"]],[Uint32Array,["uint32","unorm32"]],[Float32Array,["float32"]]]),gse=new Map([[iO,["float16"]]]),yse=new Map([[Int32Array,"sint32"],[Int16Array,"sint32"],[Uint32Array,"uint32"],[Uint16Array,"uint32"],[Float32Array,"float32"]]);class vse{constructor(e){this.backend=e}createAttribute(e,t){const n=this._getBufferAttribute(e),r=this.backend,s=r.get(n);let a=s.buffer;if(a===void 0){const l=r.device;let u=n.array;if(e.normalized===!1){if(u.constructor===Int16Array||u.constructor===Int8Array)u=new Int32Array(u);else if((u.constructor===Uint16Array||u.constructor===Uint8Array)&&(u=new Uint32Array(u),t&GPUBufferUsage.INDEX))for(let p=0;p<u.length;p++)u[p]===65535&&(u[p]=4294967295)}if(n.array=u,(n.isStorageBufferAttribute||n.isStorageInstancedBufferAttribute)&&n.itemSize===3){u=new u.constructor(n.count*4);for(let p=0;p<n.count;p++)u.set(n.array.subarray(p*3,p*3+3),p*4);n.itemSize=4,n.array=u,s._force3to4BytesAlignment=!0}const h=u.byteLength,d=h+(4-h%4)%4;a=l.createBuffer({label:n.name,size:d,usage:t,mappedAtCreation:!0}),new u.constructor(a.getMappedRange()).set(u),a.unmap(),s.buffer=a}}updateAttribute(e){const t=this._getBufferAttribute(e),n=this.backend,r=n.device,s=n.get(t),a=n.get(t).buffer;let l=t.array;if(s._force3to4BytesAlignment===!0){l=new l.constructor(t.count*4);for(let d=0;d<t.count;d++)l.set(t.array.subarray(d*3,d*3+3),d*4);t.array=l}const u=this._isTypedArray(l),h=t.updateRanges;if(h.length===0)r.queue.writeBuffer(a,0,l,0);else{const d=u?1:l.BYTES_PER_ELEMENT;for(let p=0,g=h.length;p<g;p++){const y=h[p];let v,S;if(s._force3to4BytesAlignment===!0){const _=Math.floor(y.start/3),E=Math.ceil(y.count/3);v=_*4*d,S=E*4*d}else v=y.start*d,S=y.count*d;const b=v*(u?l.BYTES_PER_ELEMENT:1);r.queue.writeBuffer(a,b,l,v,S)}t.clearUpdateRanges()}}createShaderVertexBuffers(e){const t=e.getAttributes(),n=new Map;for(let r=0;r<t.length;r++){const s=t[r],a=s.array.BYTES_PER_ELEMENT,l=this._getBufferAttribute(s);let u=n.get(l);if(u===void 0){let p,g;s.isInterleavedBufferAttribute===!0?(p=s.data.stride*a,g=s.data.isInstancedInterleavedBuffer?hy.Instance:hy.Vertex):(p=s.itemSize*a,g=s.isInstancedBufferAttribute?hy.Instance:hy.Vertex),s.normalized===!1&&(s.array.constructor===Int16Array||s.array.constructor===Uint16Array)&&(p=4),u={arrayStride:p,attributes:[],stepMode:g},n.set(l,u)}const h=this._getVertexFormat(s),d=s.isInterleavedBufferAttribute===!0?s.offset*a:0;u.attributes.push({shaderLocation:r,offset:d,format:h})}return Array.from(n.values())}destroyAttribute(e){const t=this.backend;t.get(this._getBufferAttribute(e)).buffer.destroy(),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,n=t.device,s=t.get(this._getBufferAttribute(e)).buffer,a=s.size,l=n.createBuffer({label:`${e.name}_readback`,size:a,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),u=n.createCommandEncoder({label:`readback_encoder_${e.name}`});u.copyBufferToBuffer(s,0,l,0,a);const h=u.finish();n.queue.submit([h]),await l.mapAsync(GPUMapMode.READ);const d=l.getMappedRange(),p=new e.array.constructor(d.slice(0));return l.unmap(),p.buffer}_getVertexFormat(e){const{itemSize:t,normalized:n}=e,r=e.array.constructor,s=e.constructor;let a;if(t===1)a=yse.get(r);else{const u=(gse.get(s)||mse.get(r))[n?1:0];if(u){const h=r.BYTES_PER_ELEMENT*t,p=Math.floor((h+3)/4)*4/r.BYTES_PER_ELEMENT;if(p%1)throw new Error("THREE.WebGPUAttributeUtils: Bad vertex format item size.");a=`${u}x${p}`}}return a||console.error("THREE.WebGPUAttributeUtils: Vertex format not supported yet."),a}_isTypedArray(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}class _se{constructor(e){this.backend=e,this.bindGroupLayoutCache=new WeakMap}createBindingsLayout(e){const t=this.backend,n=t.device,r=[];let s=0;for(const a of e.bindings){const l={binding:s++,visibility:a.visibility};if(a.isUniformBuffer||a.isStorageBuffer){const u={};a.isStorageBuffer&&(a.visibility&4&&(a.access===io.READ_WRITE||a.access===io.WRITE_ONLY)?u.type=nS.Storage:u.type=nS.ReadOnlyStorage),l.buffer=u}else if(a.isSampler){const u={};a.texture.isDepthTexture&&(a.texture.compareFunction!==null?u.type=S2.Comparison:t.compatibilityMode&&(u.type=S2.NonFiltering)),l.sampler=u}else if(a.isSampledTexture&&a.texture.isVideoTexture)l.externalTexture={};else if(a.isSampledTexture&&a.store){const u={};u.format=this.backend.get(a.texture).texture.format;const h=a.access;h===io.READ_WRITE?u.access=iS.ReadWrite:h===io.WRITE_ONLY?u.access=iS.WriteOnly:u.access=iS.ReadOnly,l.storageTexture=u}else if(a.isSampledTexture){const u={},{primarySamples:h}=t.utils.getTextureSampleData(a.texture);if(h>1&&(u.multisampled=!0,a.texture.isDepthTexture||(u.sampleType=Ql.UnfilterableFloat)),a.texture.isDepthTexture)t.compatibilityMode&&a.texture.compareFunction===null?u.sampleType=Ql.UnfilterableFloat:u.sampleType=Ql.Depth;else if(a.texture.isDataTexture||a.texture.isDataArrayTexture||a.texture.isData3DTexture){const d=a.texture.type;d===Li?u.sampleType=Ql.SInt:d===En?u.sampleType=Ql.UInt:d===Jn&&(this.backend.hasFeature("float32-filterable")?u.sampleType=Ql.Float:u.sampleType=Ql.UnfilterableFloat)}a.isSampledCubeTexture?u.viewDimension=Di.Cube:a.texture.isArrayTexture||a.texture.isDataArrayTexture||a.texture.isCompressedArrayTexture?u.viewDimension=Di.TwoDArray:a.isSampledTexture3D&&(u.viewDimension=Di.ThreeD),l.texture=u}else console.error(`WebGPUBindingUtils: Unsupported binding "${a}".`);r.push(l)}return n.createBindGroupLayout({entries:r})}createBindings(e,t,n,r=0){const{backend:s,bindGroupLayoutCache:a}=this,l=s.get(e);let u=a.get(e.bindingsReference);u===void 0&&(u=this.createBindingsLayout(e),a.set(e.bindingsReference,u));let h;n>0&&(l.groups===void 0&&(l.groups=[],l.versions=[]),l.versions[n]===r&&(h=l.groups[n])),h===void 0&&(h=this.createBindGroup(e,u),n>0&&(l.groups[n]=h,l.versions[n]=r)),l.group=h,l.layout=u}updateBinding(e){const t=this.backend,n=t.device,r=e.buffer,s=t.get(e).buffer;n.queue.writeBuffer(s,0,r,0)}createBindGroupIndex(e,t){const r=this.backend.device,s=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,a=e[0],l=r.createBuffer({label:"bindingCameraIndex_"+a,size:16,usage:s});r.queue.writeBuffer(l,0,e,0);const u=[{binding:0,resource:{buffer:l}}];return r.createBindGroup({label:"bindGroupCameraIndex_"+a,layout:t,entries:u})}createBindGroup(e,t){const n=this.backend,r=n.device;let s=0;const a=[];for(const l of e.bindings){if(l.isUniformBuffer){const u=n.get(l);if(u.buffer===void 0){const h=l.byteLength,d=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,p=r.createBuffer({label:"bindingBuffer_"+l.name,size:h,usage:d});u.buffer=p}a.push({binding:s,resource:{buffer:u.buffer}})}else if(l.isStorageBuffer){const u=n.get(l);if(u.buffer===void 0){const h=l.attribute;u.buffer=n.get(h).buffer}a.push({binding:s,resource:{buffer:u.buffer}})}else if(l.isSampler){const u=n.get(l.texture);a.push({binding:s,resource:u.sampler})}else if(l.isSampledTexture){const u=n.get(l.texture);let h;if(u.externalTexture!==void 0)h=r.importExternalTexture({source:u.externalTexture});else{const d=l.store?1:u.texture.mipLevelCount,p=`view-${u.texture.width}-${u.texture.height}-${d}`;if(h=u[p],h===void 0){const g=Yre.All;let y;l.isSampledCubeTexture?y=Di.Cube:l.isSampledTexture3D?y=Di.ThreeD:l.texture.isArrayTexture||l.texture.isDataArrayTexture||l.texture.isCompressedArrayTexture?y=Di.TwoDArray:y=Di.TwoD,h=u[p]=u.texture.createView({aspect:g,dimension:y,mipLevelCount:d})}}a.push({binding:s,resource:h})}s++}return r.createBindGroup({label:"bindGroup_"+e.name,layout:t,entries:a})}}class xse{constructor(e){this.backend=e,this._activePipelines=new WeakMap}setPipeline(e,t){this._activePipelines.get(e)!==t&&(e.setPipeline(t),this._activePipelines.set(e,t))}_getSampleCount(e){return this.backend.utils.getSampleCountRenderContext(e)}createRenderPipeline(e,t){const{object:n,material:r,geometry:s,pipeline:a}=e,{vertexProgram:l,fragmentProgram:u}=a,h=this.backend,d=h.device,p=h.utils,g=h.get(a),y=[];for(const Y of e.getBindings()){const oe=h.get(Y);y.push(oe.layout)}const v=h.attributeUtils.createShaderVertexBuffers(e);let S;r.blending!==Ur&&(r.blending!==es||r.transparent!==!1)&&(S=this._getBlending(r));let b={};r.stencilWrite===!0&&(b={compare:this._getStencilCompare(r),failOp:this._getStencilOperation(r.stencilFail),depthFailOp:this._getStencilOperation(r.stencilZFail),passOp:this._getStencilOperation(r.stencilZPass)});const _=this._getColorWriteMask(r),E=[];if(e.context.textures!==null){const Y=e.context.textures;for(let oe=0;oe<Y.length;oe++){const le=p.getTextureFormatGPU(Y[oe]);E.push({format:le,blend:S,writeMask:_})}}else{const Y=p.getCurrentColorFormat(e.context);E.push({format:Y,blend:S,writeMask:_})}const M=h.get(l).module,A=h.get(u).module,w=this._getPrimitiveState(n,s,r),R=this._getDepthCompare(r),C=p.getCurrentDepthStencilFormat(e.context),L=this._getSampleCount(e.context),N={label:`renderPipeline_${r.name||r.type}_${r.id}`,vertex:Object.assign({},M,{buffers:v}),fragment:Object.assign({},A,{targets:E}),primitive:w,multisample:{count:L,alphaToCoverageEnabled:r.alphaToCoverage&&L>1},layout:d.createPipelineLayout({bindGroupLayouts:y})},D={},I=e.context.depth,W=e.context.stencil;if((I===!0||W===!0)&&(I===!0&&(D.format=C,D.depthWriteEnabled=r.depthWrite,D.depthCompare=R),W===!0&&(D.stencilFront=b,D.stencilBack={},D.stencilReadMask=r.stencilFuncMask,D.stencilWriteMask=r.stencilWriteMask),r.polygonOffset===!0&&(D.depthBias=r.polygonOffsetUnits,D.depthBiasSlopeScale=r.polygonOffsetFactor,D.depthBiasClamp=0),N.depthStencil=D),t===null)g.pipeline=d.createRenderPipeline(N);else{const Y=new Promise(oe=>{d.createRenderPipelineAsync(N).then(le=>{g.pipeline=le,oe()})});t.push(Y)}}createBundleEncoder(e,t="renderBundleEncoder"){const n=this.backend,{utils:r,device:s}=n,a=r.getCurrentDepthStencilFormat(e),l=r.getCurrentColorFormat(e),u=this._getSampleCount(e),h={label:t,colorFormats:[l],depthStencilFormat:a,sampleCount:u};return s.createRenderBundleEncoder(h)}createComputePipeline(e,t){const n=this.backend,r=n.device,s=n.get(e.computeProgram).module,a=n.get(e),l=[];for(const u of t){const h=n.get(u);l.push(h.layout)}a.pipeline=r.createComputePipeline({compute:s,layout:r.createPipelineLayout({bindGroupLayouts:l})})}_getBlending(e){let t,n;const r=e.blending,s=e.blendSrc,a=e.blendDst,l=e.blendEquation;if(r===Zc){const u=e.blendSrcAlpha!==null?e.blendSrcAlpha:s,h=e.blendDstAlpha!==null?e.blendDstAlpha:a,d=e.blendEquationAlpha!==null?e.blendEquationAlpha:l;t={srcFactor:this._getBlendFactor(s),dstFactor:this._getBlendFactor(a),operation:this._getBlendOperation(l)},n={srcFactor:this._getBlendFactor(u),dstFactor:this._getBlendFactor(h),operation:this._getBlendOperation(d)}}else{const u=e.premultipliedAlpha,h=(d,p,g,y)=>{t={srcFactor:d,dstFactor:p,operation:Zl.Add},n={srcFactor:g,dstFactor:y,operation:Zl.Add}};if(u)switch(r){case es:h(Dt.One,Dt.OneMinusSrcAlpha,Dt.One,Dt.OneMinusSrcAlpha);break;case lh:h(Dt.One,Dt.One,Dt.One,Dt.One);break;case uh:h(Dt.Zero,Dt.OneMinusSrc,Dt.Zero,Dt.One);break;case ch:h(Dt.Zero,Dt.Src,Dt.Zero,Dt.SrcAlpha);break}else switch(r){case es:h(Dt.SrcAlpha,Dt.OneMinusSrcAlpha,Dt.One,Dt.OneMinusSrcAlpha);break;case lh:h(Dt.SrcAlpha,Dt.One,Dt.SrcAlpha,Dt.One);break;case uh:h(Dt.Zero,Dt.OneMinusSrc,Dt.Zero,Dt.One);break;case ch:h(Dt.Zero,Dt.Src,Dt.Zero,Dt.Src);break}}if(t!==void 0&&n!==void 0)return{color:t,alpha:n};console.error("THREE.WebGPURenderer: Invalid blending: ",r)}_getBlendFactor(e){let t;switch(e){case qa:t=Dt.Zero;break;case SM:t=Dt.One;break;case TM:t=Dt.Src;break;case MM:t=Dt.OneMinusSrc;break;case ap:t=Dt.SrcAlpha;break;case op:t=Dt.OneMinusSrcAlpha;break;case wM:t=Dt.Dst;break;case RM:t=Dt.OneMinusDst;break;case EM:t=Dt.DstAlpha;break;case AM:t=Dt.OneMinusDstAlpha;break;case CM:t=Dt.SrcAlphaSaturated;break;case sne:t=Dt.Constant;break;case ane:t=Dt.OneMinusConstant;break;default:console.error("THREE.WebGPURenderer: Blend factor not supported.",e)}return t}_getStencilCompare(e){let t;const n=e.stencilFunc;switch(n){case x6:t=Vi.Never;break;case qS:t=Vi.Always;break;case b6:t=Vi.Less;break;case T6:t=Vi.LessEqual;break;case S6:t=Vi.Equal;break;case A6:t=Vi.GreaterEqual;break;case M6:t=Vi.Greater;break;case E6:t=Vi.NotEqual;break;default:console.error("THREE.WebGPURenderer: Invalid stencil function.",n)}return t}_getStencilOperation(e){let t;switch(e){case tu:t=Zo.Keep;break;case d6:t=Zo.Zero;break;case p6:t=Zo.Replace;break;case _6:t=Zo.Invert;break;case m6:t=Zo.IncrementClamp;break;case g6:t=Zo.DecrementClamp;break;case y6:t=Zo.IncrementWrap;break;case v6:t=Zo.DecrementWrap;break;default:console.error("THREE.WebGPURenderer: Invalid stencil operation.",t)}return t}_getBlendOperation(e){let t;switch(e){case er:t=Zl.Add;break;case xM:t=Zl.Subtract;break;case bM:t=Zl.ReverseSubtract;break;case WU:t=Zl.Min;break;case jU:t=Zl.Max;break;default:console.error("THREE.WebGPUPipelineUtils: Blend equation not supported.",e)}return t}_getPrimitiveState(e,t,n){const r={},s=this.backend.utils;switch(r.topology=s.getPrimitiveTopology(e,n),t.index!==null&&e.isLine===!0&&e.isLineSegments!==!0&&(r.stripIndexFormat=t.index.array instanceof Uint16Array?Ih.Uint16:Ih.Uint32),n.side){case Lr:r.frontFace=Jb.CCW,r.cullMode=eS.Back;break;case An:r.frontFace=Jb.CCW,r.cullMode=eS.Front;break;case dr:r.frontFace=Jb.CCW,r.cullMode=eS.None;break;default:console.error("THREE.WebGPUPipelineUtils: Unknown material.side value.",n.side);break}return r}_getColorWriteMask(e){return e.colorWrite===!0?b2.All:b2.None}_getDepthCompare(e){let t;if(e.depthTest===!1)t=Vi.Always;else{const n=e.depthFunc;switch(n){case lp:t=Vi.Never;break;case up:t=Vi.Always;break;case cp:t=Vi.Less;break;case hl:t=Vi.LessEqual;break;case hp:t=Vi.Equal;break;case fp:t=Vi.GreaterEqual;break;case dp:t=Vi.Greater;break;case pp:t=Vi.NotEqual;break;default:console.error("THREE.WebGPUPipelineUtils: Invalid depth function.",n)}}return t}}class bse extends WI{constructor(e,t,n=2048){super(n),this.device=e,this.type=t,this.querySet=this.device.createQuerySet({type:"timestamp",count:this.maxQueries,label:`queryset_global_timestamp_${t}`});const r=this.maxQueries*8;this.resolveBuffer=this.device.createBuffer({label:`buffer_timestamp_resolve_${t}`,size:r,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.resultBuffer=this.device.createBuffer({label:`buffer_timestamp_result_${t}`,size:r,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})}allocateQueriesForContext(e){if(!this.trackTimestamp||this.isDisposed)return null;if(this.currentQueryIndex+2>this.maxQueries)return rs(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const t=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryOffsets.set(e.id,t),t}async resolveQueriesAsync(){if(!this.trackTimestamp||this.currentQueryIndex===0||this.isDisposed)return this.lastValue;if(this.pendingResolve)return this.pendingResolve;this.pendingResolve=this._resolveQueries();try{return await this.pendingResolve}finally{this.pendingResolve=null}}async _resolveQueries(){if(this.isDisposed)return this.lastValue;try{if(this.resultBuffer.mapState!=="unmapped")return this.lastValue;const e=new Map(this.queryOffsets),t=this.currentQueryIndex,n=t*8;this.currentQueryIndex=0,this.queryOffsets.clear();const r=this.device.createCommandEncoder();r.resolveQuerySet(this.querySet,0,t,this.resolveBuffer,0),r.copyBufferToBuffer(this.resolveBuffer,0,this.resultBuffer,0,n);const s=r.finish();if(this.device.queue.submit([s]),this.resultBuffer.mapState!=="unmapped")return this.lastValue;if(await this.resultBuffer.mapAsync(GPUMapMode.READ,0,n),this.isDisposed)return this.resultBuffer.mapState==="mapped"&&this.resultBuffer.unmap(),this.lastValue;const a=new BigUint64Array(this.resultBuffer.getMappedRange(0,n));let l=0;for(const[,u]of e){const h=a[u],d=a[u+1],p=Number(d-h)/1e6;l+=p}return this.resultBuffer.unmap(),this.lastValue=l,l}catch(e){return console.error("Error resolving queries:",e),this.resultBuffer.mapState==="mapped"&&this.resultBuffer.unmap(),this.lastValue}}async dispose(){if(!this.isDisposed){if(this.isDisposed=!0,this.pendingResolve)try{await this.pendingResolve}catch(e){console.error("Error waiting for pending resolve:",e)}if(this.resultBuffer&&this.resultBuffer.mapState==="mapped")try{this.resultBuffer.unmap()}catch(e){console.error("Error unmapping buffer:",e)}this.querySet&&(this.querySet.destroy(),this.querySet=null),this.resolveBuffer&&(this.resolveBuffer.destroy(),this.resolveBuffer=null),this.resultBuffer&&(this.resultBuffer.destroy(),this.resultBuffer=null),this.queryOffsets.clear(),this.pendingResolve=null}}}class Sse extends HI{constructor(e={}){super(e),this.isWebGPUBackend=!0,this.parameters.alpha=e.alpha===void 0?!0:e.alpha,this.parameters.compatibilityMode=e.compatibilityMode===void 0?!1:e.compatibilityMode,this.parameters.requiredLimits=e.requiredLimits===void 0?{}:e.requiredLimits,this.compatibilityMode=this.parameters.compatibilityMode,this.device=null,this.context=null,this.colorBuffer=null,this.defaultRenderPassdescriptor=null,this.utils=new pse(this),this.attributeUtils=new vse(this),this.bindingUtils=new _se(this),this.pipelineUtils=new xse(this),this.textureUtils=new rse(this),this.occludedResolveCache=new Map}async init(e){await super.init(e);const t=this.parameters;let n;if(t.device===void 0){const a={powerPreference:t.powerPreference,featureLevel:t.compatibilityMode?"compatibility":void 0},l=typeof navigator<"u"?await navigator.gpu.requestAdapter(a):null;if(l===null)throw new Error("WebGPUBackend: Unable to create WebGPU adapter.");const u=Object.values(yT),h=[];for(const p of u)l.features.has(p)&&h.push(p);const d={requiredFeatures:h,requiredLimits:t.requiredLimits};n=await l.requestDevice(d)}else n=t.device;n.lost.then(a=>{const l={api:"WebGPU",message:a.message||"Unknown reason",reason:a.reason||null,originalEvent:a};e.onDeviceLost(l)});const r=t.context!==void 0?t.context:e.domElement.getContext("webgpu");this.device=n,this.context=r;const s=t.alpha?"premultiplied":"opaque";this.trackTimestamp=this.trackTimestamp&&this.hasFeature(yT.TimestampQuery),this.context.configure({device:this.device,format:this.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,alphaMode:s}),this.updateSize()}get coordinateSystem(){return fl}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}getContext(){return this.context}_getDefaultRenderPassDescriptor(){let e=this.defaultRenderPassdescriptor;if(e===null){const n=this.renderer;e={colorAttachments:[{view:null}]},(this.renderer.depth===!0||this.renderer.stencil===!0)&&(e.depthStencilAttachment={view:this.textureUtils.getDepthBuffer(n.depth,n.stencil).createView()});const r=e.colorAttachments[0];this.renderer.samples>0?r.view=this.colorBuffer.createView():r.resolveTarget=void 0,this.defaultRenderPassdescriptor=e}const t=e.colorAttachments[0];return this.renderer.samples>0?t.resolveTarget=this.context.getCurrentTexture().createView():t.view=this.context.getCurrentTexture().createView(),e}_isRenderCameraDepthArray(e){return e.depthTexture&&e.depthTexture.image.depth>1&&e.camera.isArrayCamera}_getRenderPassDescriptor(e,t={}){const n=e.renderTarget,r=this.get(n);let s=r.descriptors;if(s===void 0||r.width!==n.width||r.height!==n.height||r.dimensions!==n.dimensions||r.activeMipmapLevel!==e.activeMipmapLevel||r.activeCubeFace!==e.activeCubeFace||r.samples!==n.samples){s={},r.descriptors=s;const h=()=>{n.removeEventListener("dispose",h),this.delete(n)};n.hasEventListener("dispose",h)===!1&&n.addEventListener("dispose",h)}const a=e.getCacheKey();let l=s[a];if(l===void 0){const h=e.textures,d=[];let p;const g=this._isRenderCameraDepthArray(e);for(let y=0;y<h.length;y++){const v=this.get(h[y]),S={label:`colorAttachment_${y}`,baseMipLevel:e.activeMipmapLevel,mipLevelCount:1,baseArrayLayer:e.activeCubeFace,arrayLayerCount:1,dimension:Di.TwoD};if(n.isRenderTarget3D)p=e.activeCubeFace,S.baseArrayLayer=0,S.dimension=Di.ThreeD,S.depthOrArrayLayers=h[y].image.depth;else if(n.isRenderTarget&&h[y].image.depth>1)if(g===!0){const b=e.camera.cameras;for(let _=0;_<b.length;_++){const E={...S,baseArrayLayer:_,arrayLayerCount:1,dimension:Di.TwoD},M=v.texture.createView(E);d.push({view:M,resolveTarget:void 0,depthSlice:void 0})}}else S.dimension=Di.TwoDArray,S.depthOrArrayLayers=h[y].image.depth;if(g!==!0){const b=v.texture.createView(S);let _,E;v.msaaTexture!==void 0?(_=v.msaaTexture.createView(),E=b):(_=b,E=void 0),d.push({view:_,resolveTarget:E,depthSlice:p})}}if(l={textureViews:d},e.depth){const y=this.get(e.depthTexture),v={};e.depthTexture.isArrayTexture&&(v.dimension=Di.TwoD,v.arrayLayerCount=1,v.baseArrayLayer=e.activeCubeFace),l.depthStencilView=y.texture.createView(v)}s[a]=l,r.width=n.width,r.height=n.height,r.samples=n.samples,r.activeMipmapLevel=e.activeMipmapLevel,r.activeCubeFace=e.activeCubeFace,r.dimensions=n.dimensions}const u={colorAttachments:[]};for(let h=0;h<l.textureViews.length;h++){const d=l.textureViews[h];let p={r:0,g:0,b:0,a:1};h===0&&t.clearValue&&(p=t.clearValue),u.colorAttachments.push({view:d.view,depthSlice:d.depthSlice,resolveTarget:d.resolveTarget,loadOp:t.loadOp||un.Load,storeOp:t.storeOp||cr.Store,clearValue:p})}return l.depthStencilView&&(u.depthStencilAttachment={view:l.depthStencilView}),u}beginRender(e){const t=this.get(e),n=this.device,r=e.occlusionQueryCount;let s;r>0&&(t.currentOcclusionQuerySet&&t.currentOcclusionQuerySet.destroy(),t.currentOcclusionQueryBuffer&&t.currentOcclusionQueryBuffer.destroy(),t.currentOcclusionQuerySet=t.occlusionQuerySet,t.currentOcclusionQueryBuffer=t.occlusionQueryBuffer,t.currentOcclusionQueryObjects=t.occlusionQueryObjects,s=n.createQuerySet({type:"occlusion",count:r,label:`occlusionQuerySet_${e.id}`}),t.occlusionQuerySet=s,t.occlusionQueryIndex=0,t.occlusionQueryObjects=new Array(r),t.lastOcclusionObject=null);let a;e.textures===null?a=this._getDefaultRenderPassDescriptor():a=this._getRenderPassDescriptor(e,{loadOp:un.Load}),this.initTimestampQuery(e,a),a.occlusionQuerySet=s;const l=a.depthStencilAttachment;if(e.textures!==null){const h=a.colorAttachments;for(let d=0;d<h.length;d++){const p=h[d];e.clearColor?(p.clearValue=d===0?e.clearColorValue:{r:0,g:0,b:0,a:1},p.loadOp=un.Clear):p.loadOp=un.Load,p.storeOp=cr.Store}}else{const h=a.colorAttachments[0];e.clearColor?(h.clearValue=e.clearColorValue,h.loadOp=un.Clear):h.loadOp=un.Load,h.storeOp=cr.Store}e.depth&&(e.clearDepth?(l.depthClearValue=e.clearDepthValue,l.depthLoadOp=un.Clear):l.depthLoadOp=un.Load,l.depthStoreOp=cr.Store),e.stencil&&(e.clearStencil?(l.stencilClearValue=e.clearStencilValue,l.stencilLoadOp=un.Clear):l.stencilLoadOp=un.Load,l.stencilStoreOp=cr.Store);const u=n.createCommandEncoder({label:"renderContext_"+e.id});if(this._isRenderCameraDepthArray(e)===!0){const h=e.camera.cameras;!t.layerDescriptors||t.layerDescriptors.length!==h.length?this._createDepthLayerDescriptors(e,t,a,h):this._updateDepthLayerDescriptors(e,t,h),t.bundleEncoders=[],t.bundleSets=[];for(let d=0;d<h.length;d++){const p=this.pipelineUtils.createBundleEncoder(e,"renderBundleArrayCamera_"+d),g={attributes:{},bindingGroups:[],pipeline:null,index:null};t.bundleEncoders.push(p),t.bundleSets.push(g)}t.currentPass=null}else{const h=u.beginRenderPass(a);if(t.currentPass=h,e.viewport&&this.updateViewport(e),e.scissor){const{x:d,y:p,width:g,height:y}=e.scissorValue;h.setScissorRect(d,p,g,y)}}t.descriptor=a,t.encoder=u,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.renderBundles=[]}_createDepthLayerDescriptors(e,t,n,r){const s=n.depthStencilAttachment;t.layerDescriptors=[];const a=this.get(e.depthTexture);a.viewCache||(a.viewCache=[]);for(let l=0;l<r.length;l++){const u={...n,colorAttachments:[{...n.colorAttachments[0],view:n.colorAttachments[l].view}]};if(n.depthStencilAttachment){const h=l;a.viewCache[h]||(a.viewCache[h]=a.texture.createView({dimension:Di.TwoD,baseArrayLayer:l,arrayLayerCount:1})),u.depthStencilAttachment={view:a.viewCache[h],depthLoadOp:s.depthLoadOp||un.Clear,depthStoreOp:s.depthStoreOp||cr.Store,depthClearValue:s.depthClearValue||1},e.stencil&&(u.depthStencilAttachment.stencilLoadOp=s.stencilLoadOp,u.depthStencilAttachment.stencilStoreOp=s.stencilStoreOp,u.depthStencilAttachment.stencilClearValue=s.stencilClearValue)}else u.depthStencilAttachment={...s};t.layerDescriptors.push(u)}}_updateDepthLayerDescriptors(e,t,n){for(let r=0;r<n.length;r++){const s=t.layerDescriptors[r];if(s.depthStencilAttachment){const a=s.depthStencilAttachment;e.depth&&(e.clearDepth?(a.depthClearValue=e.clearDepthValue,a.depthLoadOp=un.Clear):a.depthLoadOp=un.Load),e.stencil&&(e.clearStencil?(a.stencilClearValue=e.clearStencilValue,a.stencilLoadOp=un.Clear):a.stencilLoadOp=un.Load)}}}finishRender(e){const t=this.get(e),n=e.occlusionQueryCount;t.renderBundles.length>0&&t.currentPass.executeBundles(t.renderBundles),n>t.occlusionQueryIndex&&t.currentPass.endOcclusionQuery();const r=t.encoder;if(this._isRenderCameraDepthArray(e)===!0){const s=[];for(let a=0;a<t.bundleEncoders.length;a++){const l=t.bundleEncoders[a];s.push(l.finish())}for(let a=0;a<t.layerDescriptors.length;a++)if(a<s.length){const l=t.layerDescriptors[a],u=r.beginRenderPass(l);if(e.viewport){const{x:h,y:d,width:p,height:g,minDepth:y,maxDepth:v}=e.viewportValue;u.setViewport(h,d,p,g,y,v)}if(e.scissor){const{x:h,y:d,width:p,height:g}=e.scissorValue;u.setScissorRect(h,d,p,g)}u.executeBundles([s[a]]),u.end()}}else t.currentPass&&t.currentPass.end();if(n>0){const s=n*8;let a=this.occludedResolveCache.get(s);a===void 0&&(a=this.device.createBuffer({size:s,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.occludedResolveCache.set(s,a));const l=this.device.createBuffer({size:s,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});t.encoder.resolveQuerySet(t.occlusionQuerySet,0,n,a,0),t.encoder.copyBufferToBuffer(a,0,l,0,s),t.occlusionQueryBuffer=l,this.resolveOccludedAsync(e)}if(this.device.queue.submit([t.encoder.finish()]),e.textures!==null){const s=e.textures;for(let a=0;a<s.length;a++){const l=s[a];l.generateMipmaps===!0&&this.textureUtils.generateMipmaps(l)}}}isOccluded(e,t){const n=this.get(e);return n.occluded&&n.occluded.has(t)}async resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueryBuffer:n,currentOcclusionQueryObjects:r}=t;if(n&&r){const s=new WeakSet;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueryBuffer=null,await n.mapAsync(GPUMapMode.READ);const a=n.getMappedRange(),l=new BigUint64Array(a);for(let u=0;u<r.length;u++)l[u]===BigInt(0)&&s.add(r[u]);n.destroy(),t.occluded=s}}updateViewport(e){const{currentPass:t}=this.get(e),{x:n,y:r,width:s,height:a,minDepth:l,maxDepth:u}=e.viewportValue;t.setViewport(n,r,s,a,l,u)}getClearColor(){const e=super.getClearColor();return this.renderer.alpha===!0&&(e.r*=e.a,e.g*=e.a,e.b*=e.a),e}clear(e,t,n,r=null){const s=this.device,a=this.renderer;let l=[],u,h,d,p;if(e){const v=this.getClearColor();h={r:v.r,g:v.g,b:v.b,a:v.a}}if(r===null){d=a.depth,p=a.stencil;const v=this._getDefaultRenderPassDescriptor();if(e){l=v.colorAttachments;const S=l[0];S.clearValue=h,S.loadOp=un.Clear,S.storeOp=cr.Store}(d||p)&&(u=v.depthStencilAttachment)}else{d=r.depth,p=r.stencil;const v={loadOp:e?un.Clear:un.Load,clearValue:e?h:void 0};d&&(v.depthLoadOp=t?un.Clear:un.Load,v.depthClearValue=t?a.getClearDepth():void 0,v.depthStoreOp=cr.Store),p&&(v.stencilLoadOp=n?un.Clear:un.Load,v.stencilClearValue=n?a.getClearStencil():void 0,v.stencilStoreOp=cr.Store);const S=this._getRenderPassDescriptor(r,v);l=S.colorAttachments,u=S.depthStencilAttachment}d&&u&&u.depthLoadOp===void 0&&(t?(u.depthLoadOp=un.Clear,u.depthClearValue=a.getClearDepth(),u.depthStoreOp=cr.Store):(u.depthLoadOp=un.Load,u.depthStoreOp=cr.Store)),p&&u&&u.stencilLoadOp===void 0&&(n?(u.stencilLoadOp=un.Clear,u.stencilClearValue=a.getClearStencil(),u.stencilStoreOp=cr.Store):(u.stencilLoadOp=un.Load,u.stencilStoreOp=cr.Store));const g=s.createCommandEncoder({label:"clear"});g.beginRenderPass({colorAttachments:l,depthStencilAttachment:u}).end(),s.queue.submit([g.finish()])}beginCompute(e){const t=this.get(e),n={label:"computeGroup_"+e.id};this.initTimestampQuery(e,n),t.cmdEncoderGPU=this.device.createCommandEncoder({label:"computeGroup_"+e.id}),t.passEncoderGPU=t.cmdEncoderGPU.beginComputePass(n)}compute(e,t,n,r){const{passEncoderGPU:s}=this.get(e),a=this.get(r).pipeline;this.pipelineUtils.setPipeline(s,a);for(let d=0,p=n.length;d<p;d++){const g=n[d],y=this.get(g);s.setBindGroup(d,y.group)}const l=this.device.limits.maxComputeWorkgroupsPerDimension,u=this.get(t);u.dispatchSize===void 0&&(u.dispatchSize={x:0,y:1,z:1});const{dispatchSize:h}=u;t.dispatchCount>l?(h.x=Math.min(t.dispatchCount,l),h.y=Math.ceil(t.dispatchCount/l)):h.x=t.dispatchCount,s.dispatchWorkgroups(h.x,h.y,h.z)}finishCompute(e){const t=this.get(e);t.passEncoderGPU.end(),this.device.queue.submit([t.cmdEncoderGPU.finish()])}async waitForGPU(){await this.device.queue.onSubmittedWorkDone()}draw(e,t){const{object:n,material:r,context:s,pipeline:a}=e,l=e.getBindings(),u=this.get(s),h=this.get(a).pipeline,d=e.getIndex(),p=d!==null,g=e.getDrawParameters();if(g===null)return;const y=(S,b)=>{this.pipelineUtils.setPipeline(S,h),b.pipeline=h;const _=b.bindingGroups;for(let M=0,A=l.length;M<A;M++){const w=l[M],R=this.get(w);_[w.index]!==w.id&&(S.setBindGroup(w.index,R.group),_[w.index]=w.id)}if(p===!0&&b.index!==d){const M=this.get(d).buffer,A=d.array instanceof Uint16Array?Ih.Uint16:Ih.Uint32;S.setIndexBuffer(M,A),b.index=d}const E=e.getVertexBuffers();for(let M=0,A=E.length;M<A;M++){const w=E[M];if(b.attributes[M]!==w){const R=this.get(w).buffer;S.setVertexBuffer(M,R),b.attributes[M]=w}}s.stencil===!0&&r.stencilWrite===!0&&u.currentStencilRef!==r.stencilRef&&(S.setStencilReference(r.stencilRef),u.currentStencilRef=r.stencilRef)},v=(S,b)=>{if(y(S,b),n.isBatchedMesh===!0){const _=n._multiDrawStarts,E=n._multiDrawCounts,M=n._multiDrawCount,A=n._multiDrawInstances;A!==null&&rs("THREE.WebGPUBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection.");for(let w=0;w<M;w++){const R=A?A[w]:1,C=R>1?0:w;p===!0?S.drawIndexed(E[w],R,_[w]/d.array.BYTES_PER_ELEMENT,0,C):S.draw(E[w],R,_[w],C),t.update(n,E[w],R)}}else if(p===!0){const{vertexCount:_,instanceCount:E,firstVertex:M}=g,A=e.getIndirect();if(A!==null){const w=this.get(A).buffer;S.drawIndexedIndirect(w,0)}else S.drawIndexed(_,E,M,0,0);t.update(n,_,E)}else{const{vertexCount:_,instanceCount:E,firstVertex:M}=g,A=e.getIndirect();if(A!==null){const w=this.get(A).buffer;S.drawIndirect(w,0)}else S.draw(_,E,M,0);t.update(n,_,E)}};if(e.camera.isArrayCamera&&e.camera.cameras.length>0){const S=this.get(e.camera),b=e.camera.cameras,_=e.getBindingGroup("cameraIndex");if(S.indexesGPU===void 0||S.indexesGPU.length!==b.length){const M=this.get(_),A=[],w=new Uint32Array([0,0,0,0]);for(let R=0,C=b.length;R<C;R++){w[0]=R;const L=this.bindingUtils.createBindGroupIndex(w,M.layout);A.push(L)}S.indexesGPU=A}const E=this.renderer.getPixelRatio();for(let M=0,A=b.length;M<A;M++){const w=b[M];if(n.layers.test(w.layers)){const R=w.viewport;let C=u.currentPass,L=u.currentSets;if(u.bundleEncoders){const N=u.bundleEncoders[M],D=u.bundleSets[M];C=N,L=D}R&&C.setViewport(Math.floor(R.x*E),Math.floor(R.y*E),Math.floor(R.width*E),Math.floor(R.height*E),s.viewportValue.minDepth,s.viewportValue.maxDepth),_&&S.indexesGPU&&(C.setBindGroup(_.index,S.indexesGPU[M]),L.bindingGroups[_.index]=_.id),v(C,L)}}}else if(u.currentPass){if(u.occlusionQuerySet!==void 0){const S=u.lastOcclusionObject;S!==n&&(S!==null&&S.occlusionTest===!0&&(u.currentPass.endOcclusionQuery(),u.occlusionQueryIndex++),n.occlusionTest===!0&&(u.currentPass.beginOcclusionQuery(u.occlusionQueryIndex),u.occlusionQueryObjects[u.occlusionQueryIndex]=n),u.lastOcclusionObject=n)}v(u.currentPass,u.currentSets)}}needsRenderUpdate(e){const t=this.get(e),{object:n,material:r}=e,s=this.utils,a=s.getSampleCountRenderContext(e.context),l=s.getCurrentColorSpace(e.context),u=s.getCurrentColorFormat(e.context),h=s.getCurrentDepthStencilFormat(e.context),d=s.getPrimitiveTopology(n,r);let p=!1;return(t.material!==r||t.materialVersion!==r.version||t.transparent!==r.transparent||t.blending!==r.blending||t.premultipliedAlpha!==r.premultipliedAlpha||t.blendSrc!==r.blendSrc||t.blendDst!==r.blendDst||t.blendEquation!==r.blendEquation||t.blendSrcAlpha!==r.blendSrcAlpha||t.blendDstAlpha!==r.blendDstAlpha||t.blendEquationAlpha!==r.blendEquationAlpha||t.colorWrite!==r.colorWrite||t.depthWrite!==r.depthWrite||t.depthTest!==r.depthTest||t.depthFunc!==r.depthFunc||t.stencilWrite!==r.stencilWrite||t.stencilFunc!==r.stencilFunc||t.stencilFail!==r.stencilFail||t.stencilZFail!==r.stencilZFail||t.stencilZPass!==r.stencilZPass||t.stencilFuncMask!==r.stencilFuncMask||t.stencilWriteMask!==r.stencilWriteMask||t.side!==r.side||t.alphaToCoverage!==r.alphaToCoverage||t.sampleCount!==a||t.colorSpace!==l||t.colorFormat!==u||t.depthStencilFormat!==h||t.primitiveTopology!==d||t.clippingContextCacheKey!==e.clippingContextCacheKey)&&(t.material=r,t.materialVersion=r.version,t.transparent=r.transparent,t.blending=r.blending,t.premultipliedAlpha=r.premultipliedAlpha,t.blendSrc=r.blendSrc,t.blendDst=r.blendDst,t.blendEquation=r.blendEquation,t.blendSrcAlpha=r.blendSrcAlpha,t.blendDstAlpha=r.blendDstAlpha,t.blendEquationAlpha=r.blendEquationAlpha,t.colorWrite=r.colorWrite,t.depthWrite=r.depthWrite,t.depthTest=r.depthTest,t.depthFunc=r.depthFunc,t.stencilWrite=r.stencilWrite,t.stencilFunc=r.stencilFunc,t.stencilFail=r.stencilFail,t.stencilZFail=r.stencilZFail,t.stencilZPass=r.stencilZPass,t.stencilFuncMask=r.stencilFuncMask,t.stencilWriteMask=r.stencilWriteMask,t.side=r.side,t.alphaToCoverage=r.alphaToCoverage,t.sampleCount=a,t.colorSpace=l,t.colorFormat=u,t.depthStencilFormat=h,t.primitiveTopology=d,t.clippingContextCacheKey=e.clippingContextCacheKey,p=!0),p}getRenderCacheKey(e){const{object:t,material:n}=e,r=this.utils,s=e.context;return[n.transparent,n.blending,n.premultipliedAlpha,n.blendSrc,n.blendDst,n.blendEquation,n.blendSrcAlpha,n.blendDstAlpha,n.blendEquationAlpha,n.colorWrite,n.depthWrite,n.depthTest,n.depthFunc,n.stencilWrite,n.stencilFunc,n.stencilFail,n.stencilZFail,n.stencilZPass,n.stencilFuncMask,n.stencilWriteMask,n.side,r.getSampleCountRenderContext(s),r.getCurrentColorSpace(s),r.getCurrentColorFormat(s),r.getCurrentDepthStencilFormat(s),r.getPrimitiveTopology(t,n),e.getGeometryCacheKey(),e.clippingContextCacheKey].join()}createSampler(e){this.textureUtils.createSampler(e)}destroySampler(e){this.textureUtils.destroySampler(e)}createDefaultTexture(e){this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e){this.textureUtils.destroyTexture(e)}async copyTextureToBuffer(e,t,n,r,s,a){return this.textureUtils.copyTextureToBuffer(e,t,n,r,s,a)}initTimestampQuery(e,t){if(!this.trackTimestamp)return;const n=e.isComputeNode?"compute":"render";this.timestampQueryPool[n]||(this.timestampQueryPool[n]=new bse(this.device,n,2048));const r=this.timestampQueryPool[n],s=r.allocateQueriesForContext(e);t.timestampWrites={querySet:r.querySet,beginningOfPassWriteIndex:s,endOfPassWriteIndex:s+1}}createNodeBuilder(e,t){return new dse(e,t)}createProgram(e){const t=this.get(e);t.module={module:this.device.createShaderModule({code:e.code,label:e.stage+(e.name!==""?`_${e.name}`:"")}),entryPoint:"main"}}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){this.pipelineUtils.createRenderPipeline(e,t)}createComputePipeline(e,t){this.pipelineUtils.createComputePipeline(e,t)}beginBundle(e){const t=this.get(e);t._currentPass=t.currentPass,t._currentSets=t.currentSets,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.currentPass=this.pipelineUtils.createBundleEncoder(e)}finishBundle(e,t){const n=this.get(e),s=n.currentPass.finish();this.get(t).bundleGPU=s,n.currentSets=n._currentSets,n.currentPass=n._currentPass}addBundle(e,t){this.get(e).renderBundles.push(this.get(t).bundleGPU)}createBindings(e,t,n,r){this.bindingUtils.createBindings(e,t,n,r)}updateBindings(e,t,n,r){this.bindingUtils.createBindings(e,t,n,r)}updateBinding(e){this.bindingUtils.updateBinding(e)}createIndexAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.INDEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createIndirectStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.INDIRECT|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}updateSize(){this.colorBuffer=this.textureUtils.getColorBuffer(),this.defaultRenderPassdescriptor=null}getMaxAnisotropy(){return 16}hasFeature(e){return this.device.features.has(e)}copyTextureToTexture(e,t,n=null,r=null,s=0,a=0){let l=0,u=0,h=0,d=0,p=0,g=0,y=e.image.width,v=e.image.height,S=1;n!==null&&(n.isBox3===!0?(d=n.min.x,p=n.min.y,g=n.min.z,y=n.max.x-n.min.x,v=n.max.y-n.min.y,S=n.max.z-n.min.z):(d=n.min.x,p=n.min.y,y=n.max.x-n.min.x,v=n.max.y-n.min.y,S=1)),r!==null&&(l=r.x,u=r.y,h=r.z||0);const b=this.device.createCommandEncoder({label:"copyTextureToTexture_"+e.id+"_"+t.id}),_=this.get(e).texture,E=this.get(t).texture;b.copyTextureToTexture({texture:_,mipLevel:s,origin:{x:d,y:p,z:g}},{texture:E,mipLevel:a,origin:{x:l,y:u,z:h}},[y,v,S]),this.device.queue.submit([b.finish()]),a===0&&t.generateMipmaps&&this.textureUtils.generateMipmaps(t)}copyFramebufferToTexture(e,t,n){const r=this.get(t);let s=null;t.renderTarget?e.isDepthTexture?s=this.get(t.depthTexture).texture:s=this.get(t.textures[0]).texture:e.isDepthTexture?s=this.textureUtils.getDepthBuffer(t.depth,t.stencil):s=this.context.getCurrentTexture();const a=this.get(e).texture;if(s.format!==a.format){console.error("WebGPUBackend: copyFramebufferToTexture: Source and destination formats do not match.",s.format,a.format);return}let l;if(r.currentPass?(r.currentPass.end(),l=r.encoder):l=this.device.createCommandEncoder({label:"copyFramebufferToTexture_"+e.id}),l.copyTextureToTexture({texture:s,origin:[n.x,n.y,0]},{texture:a},[n.z,n.w]),r.currentPass){const{descriptor:u}=r;for(let h=0;h<u.colorAttachments.length;h++)u.colorAttachments[h].loadOp=un.Load;if(t.depth&&(u.depthStencilAttachment.depthLoadOp=un.Load),t.stencil&&(u.depthStencilAttachment.stencilLoadOp=un.Load),r.currentPass=l.beginRenderPass(u),r.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.viewport&&this.updateViewport(t),t.scissor){const{x:h,y:d,width:p,height:g}=t.scissorValue;r.currentPass.setScissorRect(h,d,p,g)}}else this.device.queue.submit([l.finish()]);e.generateMipmaps&&this.textureUtils.generateMipmaps(e)}}class Tse extends iE{constructor(e,t,n,r,s,a){super(e,t,n,r,s,a),this.iesMap=null}copy(e,t){return super.copy(e,t),this.iesMap=e.iesMap,this}}class Mse extends iE{constructor(e,t,n,r,s,a){super(e,t,n,r,s,a),this.aspect=null}copy(e,t){return super.copy(e,t),this.aspect=e.aspect,this}}class Ese extends BI{constructor(){super(),this.addMaterial(jee,"MeshPhongMaterial"),this.addMaterial(vI,"MeshStandardMaterial"),this.addMaterial(Fte,"MeshPhysicalMaterial"),this.addMaterial(Gte,"MeshToonMaterial"),this.addMaterial(Fee,"MeshBasicMaterial"),this.addMaterial(Hee,"MeshLambertMaterial"),this.addMaterial(Dee,"MeshNormalMaterial"),this.addMaterial(qte,"MeshMatcapMaterial"),this.addMaterial(wee,"LineBasicMaterial"),this.addMaterial(Cee,"LineDashedMaterial"),this.addMaterial(Kte,"PointsMaterial"),this.addMaterial(xI,"SpriteMaterial"),this.addMaterial(Jte,"ShadowMaterial"),this.addLight(Rie,J8),this.addLight(tre,dO),this.addLight(nre,tW),this.addLight(zE,iE),this.addLight(are,pO),this.addLight(ore,K8),this.addLight(lre,iW),this.addLight(ire,Tse),this.addLight(sre,Mse),this.addToneMapping(Bne,XU),this.addToneMapping(Ine,YU),this.addToneMapping(Fne,KU),this.addToneMapping(zne,ZU),this.addToneMapping(Wne,QU),this.addToneMapping(jne,JU)}}class Ase extends wre{constructor(e={}){let t;e.forceWebGL?t=x2:(t=Sse,e.getFallback=()=>(console.warn("THREE.WebGPURenderer: WebGPU is not available, running under WebGL2 backend."),new x2(e)));const n=new t(e);super(n,e),this.library=new Ese,this.isWebGPURenderer=!0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}}const rS={type:"change"},HE={type:"start"},WE={type:"end"},R2=1e-6,cn={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4},dy=new Le,Qo=new Le,wse=new V,py=new V,sS=new V,Fc=new Vs,C2=new V,my=new V,aS=new V,gy=new V;class Rse extends Rv{constructor(e,t=null){super(e,t),this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.keys=["KeyA","KeyS","KeyD"],this.mouseButtons={LEFT:Hi.ROTATE,MIDDLE:Hi.DOLLY,RIGHT:Hi.PAN},this.target=new V,this.state=cn.NONE,this.keyState=cn.NONE,this._lastPosition=new V,this._lastZoom=1,this._touchZoomDistanceStart=0,this._touchZoomDistanceEnd=0,this._lastAngle=0,this._eye=new V,this._movePrev=new Le,this._moveCurr=new Le,this._lastAxis=new V,this._zoomStart=new Le,this._zoomEnd=new Le,this._panStart=new Le,this._panEnd=new Le,this._pointers=[],this._pointerPositions={},this._onPointerMove=Nse.bind(this),this._onPointerDown=Cse.bind(this),this._onPointerUp=Pse.bind(this),this._onPointerCancel=Dse.bind(this),this._onContextMenu=kse.bind(this),this._onMouseWheel=Fse.bind(this),this._onKeyDown=Use.bind(this),this._onKeyUp=Lse.bind(this),this._onTouchStart=zse.bind(this),this._onTouchMove=Vse.bind(this),this._onTouchEnd=Gse.bind(this),this._onMouseDown=Ose.bind(this),this._onMouseMove=Bse.bind(this),this._onMouseUp=Ise.bind(this),this._target0=this.target.clone(),this._position0=this.object.position.clone(),this._up0=this.object.up.clone(),this._zoom0=this.object.zoom,t!==null&&(this.connect(t),this.handleResize()),this.update()}connect(e){super.connect(e),window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="none"}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}handleResize(){const e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}update(){this._eye.subVectors(this.object.position,this.target),this.noRotate||this._rotateCamera(),this.noZoom||this._zoomCamera(),this.noPan||this._panCamera(),this.object.position.addVectors(this.target,this._eye),this.object.isPerspectiveCamera?(this._checkDistances(),this.object.lookAt(this.target),this._lastPosition.distanceToSquared(this.object.position)>R2&&(this.dispatchEvent(rS),this._lastPosition.copy(this.object.position))):this.object.isOrthographicCamera?(this.object.lookAt(this.target),(this._lastPosition.distanceToSquared(this.object.position)>R2||this._lastZoom!==this.object.zoom)&&(this.dispatchEvent(rS),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type.")}reset(){this.state=cn.NONE,this.keyState=cn.NONE,this.target.copy(this._target0),this.object.position.copy(this._position0),this.object.up.copy(this._up0),this.object.zoom=this._zoom0,this.object.updateProjectionMatrix(),this._eye.subVectors(this.object.position,this.target),this.object.lookAt(this.target),this.dispatchEvent(rS),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom}_panCamera(){if(Qo.copy(this._panEnd).sub(this._panStart),Qo.lengthSq()){if(this.object.isOrthographicCamera){const e=(this.object.right-this.object.left)/this.object.zoom/this.domElement.clientWidth,t=(this.object.top-this.object.bottom)/this.object.zoom/this.domElement.clientWidth;Qo.x*=e,Qo.y*=t}Qo.multiplyScalar(this._eye.length()*this.panSpeed),py.copy(this._eye).cross(this.object.up).setLength(Qo.x),py.add(wse.copy(this.object.up).setLength(Qo.y)),this.object.position.add(py),this.target.add(py),this.staticMoving?this._panStart.copy(this._panEnd):this._panStart.add(Qo.subVectors(this._panEnd,this._panStart).multiplyScalar(this.dynamicDampingFactor))}}_rotateCamera(){gy.set(this._moveCurr.x-this._movePrev.x,this._moveCurr.y-this._movePrev.y,0);let e=gy.length();e?(this._eye.copy(this.object.position).sub(this.target),C2.copy(this._eye).normalize(),my.copy(this.object.up).normalize(),aS.crossVectors(my,C2).normalize(),my.setLength(this._moveCurr.y-this._movePrev.y),aS.setLength(this._moveCurr.x-this._movePrev.x),gy.copy(my.add(aS)),sS.crossVectors(gy,this._eye).normalize(),e*=this.rotateSpeed,Fc.setFromAxisAngle(sS,e),this._eye.applyQuaternion(Fc),this.object.up.applyQuaternion(Fc),this._lastAxis.copy(sS),this._lastAngle=e):!this.staticMoving&&this._lastAngle&&(this._lastAngle*=Math.sqrt(1-this.dynamicDampingFactor),this._eye.copy(this.object.position).sub(this.target),Fc.setFromAxisAngle(this._lastAxis,this._lastAngle),this._eye.applyQuaternion(Fc),this.object.up.applyQuaternion(Fc)),this._movePrev.copy(this._moveCurr)}_zoomCamera(){let e;this.state===cn.TOUCH_ZOOM_PAN?(e=this._touchZoomDistanceStart/this._touchZoomDistanceEnd,this._touchZoomDistanceStart=this._touchZoomDistanceEnd,this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera?(this.object.zoom=Wy.clamp(this.object.zoom/e,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")):(e=1+(this._zoomEnd.y-this._zoomStart.y)*this.zoomSpeed,e!==1&&e>0&&(this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera?(this.object.zoom=Wy.clamp(this.object.zoom/e,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")),this.staticMoving?this._zoomStart.copy(this._zoomEnd):this._zoomStart.y+=(this._zoomEnd.y-this._zoomStart.y)*this.dynamicDampingFactor)}_getMouseOnScreen(e,t){return dy.set((e-this.screen.left)/this.screen.width,(t-this.screen.top)/this.screen.height),dy}_getMouseOnCircle(e,t){return dy.set((e-this.screen.width*.5-this.screen.left)/(this.screen.width*.5),(this.screen.height+2*(this.screen.top-t))/this.screen.width),dy}_addPointer(e){this._pointers.push(e)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t].pointerId==e.pointerId){this._pointers.splice(t,1);return}}_trackPointer(e){let t=this._pointerPositions[e.pointerId];t===void 0&&(t=new Le,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0].pointerId?this._pointers[1]:this._pointers[0];return this._pointerPositions[t.pointerId]}_checkDistances(){(!this.noZoom||!this.noPan)&&(this._eye.lengthSq()>this.maxDistance*this.maxDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.maxDistance)),this._zoomStart.copy(this._zoomEnd)),this._eye.lengthSq()<this.minDistance*this.minDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.minDistance)),this._zoomStart.copy(this._zoomEnd)))}}function Cse(i){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(i.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),this._addPointer(i),i.pointerType==="touch"?this._onTouchStart(i):this._onMouseDown(i))}function Nse(i){this.enabled!==!1&&(i.pointerType==="touch"?this._onTouchMove(i):this._onMouseMove(i))}function Pse(i){this.enabled!==!1&&(i.pointerType==="touch"?this._onTouchEnd(i):this._onMouseUp(),this._removePointer(i),this._pointers.length===0&&(this.domElement.releasePointerCapture(i.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp)))}function Dse(i){this._removePointer(i)}function Lse(){this.enabled!==!1&&(this.keyState=cn.NONE,window.addEventListener("keydown",this._onKeyDown))}function Use(i){this.enabled!==!1&&(window.removeEventListener("keydown",this._onKeyDown),this.keyState===cn.NONE&&(i.code===this.keys[cn.ROTATE]&&!this.noRotate?this.keyState=cn.ROTATE:i.code===this.keys[cn.ZOOM]&&!this.noZoom?this.keyState=cn.ZOOM:i.code===this.keys[cn.PAN]&&!this.noPan&&(this.keyState=cn.PAN)))}function Ose(i){let e;switch(i.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case Hi.DOLLY:this.state=cn.ZOOM;break;case Hi.ROTATE:this.state=cn.ROTATE;break;case Hi.PAN:this.state=cn.PAN;break;default:this.state=cn.NONE}const t=this.keyState!==cn.NONE?this.keyState:this.state;t===cn.ROTATE&&!this.noRotate?(this._moveCurr.copy(this._getMouseOnCircle(i.pageX,i.pageY)),this._movePrev.copy(this._moveCurr)):t===cn.ZOOM&&!this.noZoom?(this._zoomStart.copy(this._getMouseOnScreen(i.pageX,i.pageY)),this._zoomEnd.copy(this._zoomStart)):t===cn.PAN&&!this.noPan&&(this._panStart.copy(this._getMouseOnScreen(i.pageX,i.pageY)),this._panEnd.copy(this._panStart)),this.dispatchEvent(HE)}function Bse(i){const e=this.keyState!==cn.NONE?this.keyState:this.state;e===cn.ROTATE&&!this.noRotate?(this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(i.pageX,i.pageY))):e===cn.ZOOM&&!this.noZoom?this._zoomEnd.copy(this._getMouseOnScreen(i.pageX,i.pageY)):e===cn.PAN&&!this.noPan&&this._panEnd.copy(this._getMouseOnScreen(i.pageX,i.pageY))}function Ise(){this.state=cn.NONE,this.dispatchEvent(WE)}function Fse(i){if(this.enabled!==!1&&this.noZoom!==!0){switch(i.preventDefault(),i.deltaMode){case 2:this._zoomStart.y-=i.deltaY*.025;break;case 1:this._zoomStart.y-=i.deltaY*.01;break;default:this._zoomStart.y-=i.deltaY*25e-5;break}this.dispatchEvent(HE),this.dispatchEvent(WE)}}function kse(i){this.enabled!==!1&&i.preventDefault()}function zse(i){switch(this._trackPointer(i),this._pointers.length){case 1:this.state=cn.TOUCH_ROTATE,this._moveCurr.copy(this._getMouseOnCircle(this._pointers[0].pageX,this._pointers[0].pageY)),this._movePrev.copy(this._moveCurr);break;default:this.state=cn.TOUCH_ZOOM_PAN;const e=this._pointers[0].pageX-this._pointers[1].pageX,t=this._pointers[0].pageY-this._pointers[1].pageY;this._touchZoomDistanceEnd=this._touchZoomDistanceStart=Math.sqrt(e*e+t*t);const n=(this._pointers[0].pageX+this._pointers[1].pageX)/2,r=(this._pointers[0].pageY+this._pointers[1].pageY)/2;this._panStart.copy(this._getMouseOnScreen(n,r)),this._panEnd.copy(this._panStart);break}this.dispatchEvent(HE)}function Vse(i){switch(this._trackPointer(i),this._pointers.length){case 1:this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(i.pageX,i.pageY));break;default:const e=this._getSecondPointerPosition(i),t=i.pageX-e.x,n=i.pageY-e.y;this._touchZoomDistanceEnd=Math.sqrt(t*t+n*n);const r=(i.pageX+e.x)/2,s=(i.pageY+e.y)/2;this._panEnd.copy(this._getMouseOnScreen(r,s));break}}function Gse(i){switch(this._pointers.length){case 0:this.state=cn.NONE;break;case 1:this.state=cn.TOUCH_ROTATE,this._moveCurr.copy(this._getMouseOnCircle(i.pageX,i.pageY)),this._movePrev.copy(this._moveCurr);break;case 2:this.state=cn.TOUCH_ZOOM_PAN;for(let e=0;e<this._pointers.length;e++)if(this._pointers[e].pointerId!==i.pointerId){const t=this._pointerPositions[this._pointers[e].pointerId];this._moveCurr.copy(this._getMouseOnCircle(t.x,t.y)),this._movePrev.copy(this._moveCurr);break}break}this.dispatchEvent(WE)}const N2={type:"change"},jE={type:"start"},qI={type:"end"},yy=new Mv,P2=new Bs,Hse=Math.cos(70*Wy.DEG2RAD),bi=new V,wr=2*Math.PI,xn={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},oS=1e-6;class Wse extends Rv{constructor(e,t=null){super(e,t),this.state=xn.NONE,this.target=new V,this.cursor=new V,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Hi.ROTATE,MIDDLE:Hi.DOLLY,RIGHT:Hi.PAN},this.touches={ONE:Ja.ROTATE,TWO:Ja.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new V,this._lastQuaternion=new Vs,this._lastTargetPosition=new V,this._quat=new Vs().setFromUnitVectors(e.up,new V(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new ON,this._sphericalDelta=new ON,this._scale=1,this._panOffset=new V,this._rotateStart=new Le,this._rotateEnd=new Le,this._rotateDelta=new Le,this._panStart=new Le,this._panEnd=new Le,this._panDelta=new Le,this._dollyStart=new Le,this._dollyEnd=new Le,this._dollyDelta=new Le,this._dollyDirection=new V,this._mouse=new Le,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=qse.bind(this),this._onPointerDown=jse.bind(this),this._onPointerUp=$se.bind(this),this._onContextMenu=eae.bind(this),this._onMouseWheel=Kse.bind(this),this._onKeyDown=Zse.bind(this),this._onTouchStart=Qse.bind(this),this._onTouchMove=Jse.bind(this),this._onMouseDown=Xse.bind(this),this._onMouseMove=Yse.bind(this),this._interceptControlDown=tae.bind(this),this._interceptControlUp=nae.bind(this),this.domElement!==null&&this.connect(this.domElement),this.update()}connect(e){super.connect(e),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(N2),this.update(),this.state=xn.NONE}update(e=null){const t=this.object.position;bi.copy(t).sub(this.target),bi.applyQuaternion(this._quat),this._spherical.setFromVector3(bi),this.autoRotate&&this.state===xn.NONE&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let n=this.minAzimuthAngle,r=this.maxAzimuthAngle;isFinite(n)&&isFinite(r)&&(n<-Math.PI?n+=wr:n>Math.PI&&(n-=wr),r<-Math.PI?r+=wr:r>Math.PI&&(r-=wr),n<=r?this._spherical.theta=Math.max(n,Math.min(r,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(n+r)/2?Math.max(n,this._spherical.theta):Math.min(r,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let s=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const a=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),s=a!=this._spherical.radius}if(bi.setFromSpherical(this._spherical),bi.applyQuaternion(this._quatInverse),t.copy(this.target).add(bi),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let a=null;if(this.object.isPerspectiveCamera){const l=bi.length();a=this._clampDistance(l*this._scale);const u=l-a;this.object.position.addScaledVector(this._dollyDirection,u),this.object.updateMatrixWorld(),s=!!u}else if(this.object.isOrthographicCamera){const l=new V(this._mouse.x,this._mouse.y,0);l.unproject(this.object);const u=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),s=u!==this.object.zoom;const h=new V(this._mouse.x,this._mouse.y,0);h.unproject(this.object),this.object.position.sub(h).add(l),this.object.updateMatrixWorld(),a=bi.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;a!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(a).add(this.object.position):(yy.origin.copy(this.object.position),yy.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(yy.direction))<Hse?this.object.lookAt(this.target):(P2.setFromNormalAndCoplanarPoint(this.object.up,this.target),yy.intersectPlane(P2,this.target))))}else if(this.object.isOrthographicCamera){const a=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),a!==this.object.zoom&&(this.object.updateProjectionMatrix(),s=!0)}return this._scale=1,this._performCursorZoom=!1,s||this._lastPosition.distanceToSquared(this.object.position)>oS||8*(1-this._lastQuaternion.dot(this.object.quaternion))>oS||this._lastTargetPosition.distanceToSquared(this.target)>oS?(this.dispatchEvent(N2),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(e){return e!==null?wr/60*this.autoRotateSpeed*e:wr/60/60*this.autoRotateSpeed}_getZoomScale(e){const t=Math.abs(e*.01);return Math.pow(.95,this.zoomSpeed*t)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,t){bi.setFromMatrixColumn(t,0),bi.multiplyScalar(-e),this._panOffset.add(bi)}_panUp(e,t){this.screenSpacePanning===!0?bi.setFromMatrixColumn(t,1):(bi.setFromMatrixColumn(t,0),bi.crossVectors(this.object.up,bi)),bi.multiplyScalar(e),this._panOffset.add(bi)}_pan(e,t){const n=this.domElement;if(this.object.isPerspectiveCamera){const r=this.object.position;bi.copy(r).sub(this.target);let s=bi.length();s*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*s/n.clientHeight,this.object.matrix),this._panUp(2*t*s/n.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/n.clientWidth,this.object.matrix),this._panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/n.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,t){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const n=this.domElement.getBoundingClientRect(),r=e-n.left,s=t-n.top,a=n.width,l=n.height;this._mouse.x=r/a*2-1,this._mouse.y=-(s/l)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(wr*this._rotateDelta.x/t.clientHeight),this._rotateUp(wr*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let t=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(wr*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),t=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(-wr*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),t=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(wr*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),t=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(-wr*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),t=!0;break}t&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(this._pointers.length===1)this._rotateStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);this._rotateStart.set(n,r)}}_handleTouchStartPan(e){if(this._pointers.length===1)this._panStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);this._panStart.set(n,r)}}_handleTouchStartDolly(e){const t=this._getSecondPointerPosition(e),n=e.pageX-t.x,r=e.pageY-t.y,s=Math.sqrt(n*n+r*r);this._dollyStart.set(0,s)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(this._pointers.length==1)this._rotateEnd.set(e.pageX,e.pageY);else{const n=this._getSecondPointerPosition(e),r=.5*(e.pageX+n.x),s=.5*(e.pageY+n.y);this._rotateEnd.set(r,s)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(wr*this._rotateDelta.x/t.clientHeight),this._rotateUp(wr*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(this._pointers.length===1)this._panEnd.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);this._panEnd.set(n,r)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const t=this._getSecondPointerPosition(e),n=e.pageX-t.x,r=e.pageY-t.y,s=Math.sqrt(n*n+r*r);this._dollyEnd.set(0,s),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const a=(e.pageX+t.x)*.5,l=(e.pageY+t.y)*.5;this._updateZoomParameters(a,l)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId){this._pointers.splice(t,1);return}}_isTrackingPointer(e){for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId)return!0;return!1}_trackPointer(e){let t=this._pointerPositions[e.pointerId];t===void 0&&(t=new Le,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[t]}_customWheelEvent(e){const t=e.deltaMode,n={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(t){case 1:n.deltaY*=16;break;case 2:n.deltaY*=100;break}return e.ctrlKey&&!this._controlActive&&(n.deltaY*=10),n}}function jse(i){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(i.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(i)&&(this._addPointer(i),i.pointerType==="touch"?this._onTouchStart(i):this._onMouseDown(i)))}function qse(i){this.enabled!==!1&&(i.pointerType==="touch"?this._onTouchMove(i):this._onMouseMove(i))}function $se(i){switch(this._removePointer(i),this._pointers.length){case 0:this.domElement.releasePointerCapture(i.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(qI),this.state=xn.NONE;break;case 1:const e=this._pointers[0],t=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:t.x,pageY:t.y});break}}function Xse(i){let e;switch(i.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case Hi.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(i),this.state=xn.DOLLY;break;case Hi.ROTATE:if(i.ctrlKey||i.metaKey||i.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(i),this.state=xn.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(i),this.state=xn.ROTATE}break;case Hi.PAN:if(i.ctrlKey||i.metaKey||i.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(i),this.state=xn.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(i),this.state=xn.PAN}break;default:this.state=xn.NONE}this.state!==xn.NONE&&this.dispatchEvent(jE)}function Yse(i){switch(this.state){case xn.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(i);break;case xn.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(i);break;case xn.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(i);break}}function Kse(i){this.enabled===!1||this.enableZoom===!1||this.state!==xn.NONE||(i.preventDefault(),this.dispatchEvent(jE),this._handleMouseWheel(this._customWheelEvent(i)),this.dispatchEvent(qI))}function Zse(i){this.enabled!==!1&&this._handleKeyDown(i)}function Qse(i){switch(this._trackPointer(i),this._pointers.length){case 1:switch(this.touches.ONE){case Ja.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(i),this.state=xn.TOUCH_ROTATE;break;case Ja.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(i),this.state=xn.TOUCH_PAN;break;default:this.state=xn.NONE}break;case 2:switch(this.touches.TWO){case Ja.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(i),this.state=xn.TOUCH_DOLLY_PAN;break;case Ja.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(i),this.state=xn.TOUCH_DOLLY_ROTATE;break;default:this.state=xn.NONE}break;default:this.state=xn.NONE}this.state!==xn.NONE&&this.dispatchEvent(jE)}function Jse(i){switch(this._trackPointer(i),this.state){case xn.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(i),this.update();break;case xn.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(i),this.update();break;case xn.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(i),this.update();break;case xn.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(i),this.update();break;default:this.state=xn.NONE}}function eae(i){this.enabled!==!1&&i.preventDefault()}function tae(i){i.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function nae(i){i.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}const iae={type:"change"},D2=1e-6,L2=new Vs;class rae extends Rv{constructor(e,t=null){super(e,t),this.movementSpeed=1,this.rollSpeed=.005,this.dragToLook=!1,this.autoForward=!1,this._moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this._moveVector=new V(0,0,0),this._rotationVector=new V(0,0,0),this._lastQuaternion=new Vs,this._lastPosition=new V,this._status=0,this._onKeyDown=sae.bind(this),this._onKeyUp=aae.bind(this),this._onPointerMove=lae.bind(this),this._onPointerDown=oae.bind(this),this._onPointerUp=uae.bind(this),this._onPointerCancel=cae.bind(this),this._onContextMenu=hae.bind(this),t!==null&&this.connect(t)}connect(e){super.connect(e),window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("contextmenu",this._onContextMenu)}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("contextmenu",this._onContextMenu)}dispose(){this.disconnect()}update(e){if(this.enabled===!1)return;const t=this.object,n=e*this.movementSpeed,r=e*this.rollSpeed;t.translateX(this._moveVector.x*n),t.translateY(this._moveVector.y*n),t.translateZ(this._moveVector.z*n),L2.set(this._rotationVector.x*r,this._rotationVector.y*r,this._rotationVector.z*r,1).normalize(),t.quaternion.multiply(L2),(this._lastPosition.distanceToSquared(t.position)>D2||8*(1-this._lastQuaternion.dot(t.quaternion))>D2)&&(this.dispatchEvent(iae),this._lastQuaternion.copy(t.quaternion),this._lastPosition.copy(t.position))}_updateMovementVector(){const e=this._moveState.forward||this.autoForward&&!this._moveState.back?1:0;this._moveVector.x=-this._moveState.left+this._moveState.right,this._moveVector.y=-this._moveState.down+this._moveState.up,this._moveVector.z=-e+this._moveState.back}_updateRotationVector(){this._rotationVector.x=-this._moveState.pitchDown+this._moveState.pitchUp,this._rotationVector.y=-this._moveState.yawRight+this._moveState.yawLeft,this._rotationVector.z=-this._moveState.rollRight+this._moveState.rollLeft}_getContainerDimensions(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}}}function sae(i){if(!(i.altKey||this.enabled===!1)){switch(i.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this._moveState.forward=1;break;case"KeyS":this._moveState.back=1;break;case"KeyA":this._moveState.left=1;break;case"KeyD":this._moveState.right=1;break;case"KeyR":this._moveState.up=1;break;case"KeyF":this._moveState.down=1;break;case"ArrowUp":this._moveState.pitchUp=1;break;case"ArrowDown":this._moveState.pitchDown=1;break;case"ArrowLeft":this._moveState.yawLeft=1;break;case"ArrowRight":this._moveState.yawRight=1;break;case"KeyQ":this._moveState.rollLeft=1;break;case"KeyE":this._moveState.rollRight=1;break}this._updateMovementVector(),this._updateRotationVector()}}function aae(i){if(this.enabled!==!1){switch(i.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this._moveState.forward=0;break;case"KeyS":this._moveState.back=0;break;case"KeyA":this._moveState.left=0;break;case"KeyD":this._moveState.right=0;break;case"KeyR":this._moveState.up=0;break;case"KeyF":this._moveState.down=0;break;case"ArrowUp":this._moveState.pitchUp=0;break;case"ArrowDown":this._moveState.pitchDown=0;break;case"ArrowLeft":this._moveState.yawLeft=0;break;case"ArrowRight":this._moveState.yawRight=0;break;case"KeyQ":this._moveState.rollLeft=0;break;case"KeyE":this._moveState.rollRight=0;break}this._updateMovementVector(),this._updateRotationVector()}}function oae(i){if(this.enabled!==!1)if(this.dragToLook)this._status++;else{switch(i.button){case 0:this._moveState.forward=1;break;case 2:this._moveState.back=1;break}this._updateMovementVector()}}function lae(i){if(this.enabled!==!1&&(!this.dragToLook||this._status>0)){const e=this._getContainerDimensions(),t=e.size[0]/2,n=e.size[1]/2;this._moveState.yawLeft=-(i.pageX-e.offset[0]-t)/t,this._moveState.pitchDown=(i.pageY-e.offset[1]-n)/n,this._updateRotationVector()}}function uae(i){if(this.enabled!==!1){if(this.dragToLook)this._status--,this._moveState.yawLeft=this._moveState.pitchDown=0;else{switch(i.button){case 0:this._moveState.forward=0;break;case 2:this._moveState.back=0;break}this._updateMovementVector()}this._updateRotationVector()}}function cae(){this.enabled!==!1&&(this.dragToLook?(this._status=0,this._moveState.yawLeft=this._moveState.pitchDown=0):(this._moveState.forward=0,this._moveState.back=0,this._updateMovementVector()),this._updateRotationVector())}function hae(i){this.enabled!==!1&&i.preventDefault()}const fae={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = opacity * texel;


		}`};class Yv{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const dae=new Yp(-1,1,1,-1,0,1);class pae extends ar{constructor(){super(),this.setAttribute("position",new ni([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new ni([0,2,0,0,2,0],2))}}const mae=new pae;class gae{constructor(e){this._mesh=new fi(mae,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,dae)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class yae extends Yv{constructor(e,t="tDiffuse"){super(),this.textureID=t,this.uniforms=null,this.material=null,e instanceof da?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=sO.clone(e.uniforms),this.material=new da({name:e.name!==void 0?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this._fsQuad=new gae(this.material)}render(e,t,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this._fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this._fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this._fsQuad.render(e))}dispose(){this.material.dispose(),this._fsQuad.dispose()}}class U2 extends Yv{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,n){const r=e.getContext(),s=e.state;s.buffers.color.setMask(!1),s.buffers.depth.setMask(!1),s.buffers.color.setLocked(!0),s.buffers.depth.setLocked(!0);let a,l;this.inverse?(a=0,l=1):(a=1,l=0),s.buffers.stencil.setTest(!0),s.buffers.stencil.setOp(r.REPLACE,r.REPLACE,r.REPLACE),s.buffers.stencil.setFunc(r.ALWAYS,a,4294967295),s.buffers.stencil.setClear(l),s.buffers.stencil.setLocked(!0),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),s.buffers.color.setLocked(!1),s.buffers.depth.setLocked(!1),s.buffers.color.setMask(!0),s.buffers.depth.setMask(!0),s.buffers.stencil.setLocked(!1),s.buffers.stencil.setFunc(r.EQUAL,1,4294967295),s.buffers.stencil.setOp(r.KEEP,r.KEEP,r.KEEP),s.buffers.stencil.setLocked(!0)}}class vae extends Yv{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class _ae{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),t===void 0){const n=e.getSize(new Le);this._width=n.width,this._height=n.height,t=new dl(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:Oi}),t.texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new yae(fae),this.copyPass.material.blending=Ur,this.clock=new gO}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let n=!1;for(let r=0,s=this.passes.length;r<s;r++){const a=this.passes[r];if(a.enabled!==!1){if(a.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(r),a.render(this.renderer,this.writeBuffer,this.readBuffer,e,n),a.needsSwap){if(n){const l=this.renderer.getContext(),u=this.renderer.state.buffers.stencil;u.setFunc(l.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),u.setFunc(l.EQUAL,1,4294967295)}this.swapBuffers()}U2!==void 0&&(a instanceof U2?n=!0:a instanceof vae&&(n=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new Le);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const n=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget1.setSize(n,r),this.renderTarget2.setSize(n,r);for(let s=0;s<this.passes.length;s++)this.passes[s].setSize(n,r)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class xae extends Yv{constructor(e,t,n=null,r=null,s=null){super(),this.scene=e,this.camera=t,this.overrideMaterial=n,this.clearColor=r,this.clearAlpha=s,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new ot}render(e,t,n){const r=e.autoClear;e.autoClear=!1;let s,a;this.overrideMaterial!==null&&(a=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor!==null&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor,e.getClearAlpha())),this.clearAlpha!==null&&(s=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),this.clearDepth==!0&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:n),this.clear===!0&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor!==null&&e.setClearColor(this._oldClearColor),this.clearAlpha!==null&&e.setClearAlpha(s),this.overrideMaterial!==null&&(this.scene.overrideMaterial=a),e.autoClear=r}}function Ir(){return Ir=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(i[n]=t[n])}return i},Ir.apply(null,arguments)}function bae(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function Dp(i,e){return Dp=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t},Dp(i,e)}function Sae(i,e){i.prototype=Object.create(e.prototype),i.prototype.constructor=i,Dp(i,e)}function _T(i){return _T=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},_T(i)}function Tae(i){try{return Function.toString.call(i).indexOf("[native code]")!==-1}catch{return typeof i=="function"}}function $I(){try{var i=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return($I=function(){return!!i})()}function Mae(i,e,t){if($I())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,e);var r=new(i.bind.apply(i,n));return t&&Dp(r,t.prototype),r}function xT(i){var e=typeof Map=="function"?new Map:void 0;return xT=function(n){if(n===null||!Tae(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(e!==void 0){if(e.has(n))return e.get(n);e.set(n,r)}function r(){return Mae(n,arguments,_T(this).constructor)}return r.prototype=Object.create(n.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),Dp(r,n)},xT(i)}var sa=function(i){Sae(e,i);function e(t){var n;return n=i.call(this,"An error occurred. See https://github.com/styled-components/polished/blob/main/src/internalHelpers/errors.md#"+t+" for more information.")||this,bae(n)}return e}(xT(Error));function lS(i){return Math.round(i*255)}function Eae(i,e,t){return lS(i)+","+lS(e)+","+lS(t)}function lv(i,e,t,n){if(n===void 0&&(n=Eae),e===0)return n(t,t,t);var r=(i%360+360)%360/60,s=(1-Math.abs(2*t-1))*e,a=s*(1-Math.abs(r%2-1)),l=0,u=0,h=0;r>=0&&r<1?(l=s,u=a):r>=1&&r<2?(l=a,u=s):r>=2&&r<3?(u=s,h=a):r>=3&&r<4?(u=a,h=s):r>=4&&r<5?(l=a,h=s):r>=5&&r<6&&(l=s,h=a);var d=t-s/2,p=l+d,g=u+d,y=h+d;return n(p,g,y)}var O2={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"639",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"};function Aae(i){if(typeof i!="string")return i;var e=i.toLowerCase();return O2[e]?"#"+O2[e]:i}var wae=/^#[a-fA-F0-9]{6}$/,Rae=/^#[a-fA-F0-9]{8}$/,Cae=/^#[a-fA-F0-9]{3}$/,Nae=/^#[a-fA-F0-9]{4}$/,uS=/^rgb\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*\)$/i,Pae=/^rgb(?:a)?\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i,Dae=/^hsl\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*\)$/i,Lae=/^hsl(?:a)?\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i;function Fh(i){if(typeof i!="string")throw new sa(3);var e=Aae(i);if(e.match(wae))return{red:parseInt(""+e[1]+e[2],16),green:parseInt(""+e[3]+e[4],16),blue:parseInt(""+e[5]+e[6],16)};if(e.match(Rae)){var t=parseFloat((parseInt(""+e[7]+e[8],16)/255).toFixed(2));return{red:parseInt(""+e[1]+e[2],16),green:parseInt(""+e[3]+e[4],16),blue:parseInt(""+e[5]+e[6],16),alpha:t}}if(e.match(Cae))return{red:parseInt(""+e[1]+e[1],16),green:parseInt(""+e[2]+e[2],16),blue:parseInt(""+e[3]+e[3],16)};if(e.match(Nae)){var n=parseFloat((parseInt(""+e[4]+e[4],16)/255).toFixed(2));return{red:parseInt(""+e[1]+e[1],16),green:parseInt(""+e[2]+e[2],16),blue:parseInt(""+e[3]+e[3],16),alpha:n}}var r=uS.exec(e);if(r)return{red:parseInt(""+r[1],10),green:parseInt(""+r[2],10),blue:parseInt(""+r[3],10)};var s=Pae.exec(e.substring(0,50));if(s)return{red:parseInt(""+s[1],10),green:parseInt(""+s[2],10),blue:parseInt(""+s[3],10),alpha:parseFloat(""+s[4])>1?parseFloat(""+s[4])/100:parseFloat(""+s[4])};var a=Dae.exec(e);if(a){var l=parseInt(""+a[1],10),u=parseInt(""+a[2],10)/100,h=parseInt(""+a[3],10)/100,d="rgb("+lv(l,u,h)+")",p=uS.exec(d);if(!p)throw new sa(4,e,d);return{red:parseInt(""+p[1],10),green:parseInt(""+p[2],10),blue:parseInt(""+p[3],10)}}var g=Lae.exec(e.substring(0,50));if(g){var y=parseInt(""+g[1],10),v=parseInt(""+g[2],10)/100,S=parseInt(""+g[3],10)/100,b="rgb("+lv(y,v,S)+")",_=uS.exec(b);if(!_)throw new sa(4,e,b);return{red:parseInt(""+_[1],10),green:parseInt(""+_[2],10),blue:parseInt(""+_[3],10),alpha:parseFloat(""+g[4])>1?parseFloat(""+g[4])/100:parseFloat(""+g[4])}}throw new sa(5)}function Uae(i){var e=i.red/255,t=i.green/255,n=i.blue/255,r=Math.max(e,t,n),s=Math.min(e,t,n),a=(r+s)/2;if(r===s)return i.alpha!==void 0?{hue:0,saturation:0,lightness:a,alpha:i.alpha}:{hue:0,saturation:0,lightness:a};var l,u=r-s,h=a>.5?u/(2-r-s):u/(r+s);switch(r){case e:l=(t-n)/u+(t<n?6:0);break;case t:l=(n-e)/u+2;break;default:l=(e-t)/u+4;break}return l*=60,i.alpha!==void 0?{hue:l,saturation:h,lightness:a,alpha:i.alpha}:{hue:l,saturation:h,lightness:a}}function bl(i){return Uae(Fh(i))}var Oae=function(e){return e.length===7&&e[1]===e[2]&&e[3]===e[4]&&e[5]===e[6]?"#"+e[1]+e[3]+e[5]:e},bT=Oae;function su(i){var e=i.toString(16);return e.length===1?"0"+e:e}function cS(i){return su(Math.round(i*255))}function Bae(i,e,t){return bT("#"+cS(i)+cS(e)+cS(t))}function XI(i,e,t){return lv(i,e,t,Bae)}function Iae(i,e,t){if(typeof i=="object"&&e===void 0&&t===void 0)return XI(i.hue,i.saturation,i.lightness);throw new sa(1)}function Fae(i,e,t,n){if(typeof i=="object"&&e===void 0&&t===void 0&&n===void 0)return i.alpha>=1?XI(i.hue,i.saturation,i.lightness):"rgba("+lv(i.hue,i.saturation,i.lightness)+","+i.alpha+")";throw new sa(2)}function YI(i,e,t){if(typeof i=="number"&&typeof e=="number"&&typeof t=="number")return bT("#"+su(i)+su(e)+su(t));if(typeof i=="object"&&e===void 0&&t===void 0)return bT("#"+su(i.red)+su(i.green)+su(i.blue));throw new sa(6)}function Kv(i,e,t,n){if(typeof i=="object"&&e===void 0&&t===void 0&&n===void 0)return i.alpha>=1?YI(i.red,i.green,i.blue):"rgba("+i.red+","+i.green+","+i.blue+","+i.alpha+")";throw new sa(7)}var kae=function(e){return typeof e.red=="number"&&typeof e.green=="number"&&typeof e.blue=="number"&&(typeof e.alpha!="number"||typeof e.alpha>"u")},zae=function(e){return typeof e.red=="number"&&typeof e.green=="number"&&typeof e.blue=="number"&&typeof e.alpha=="number"},Vae=function(e){return typeof e.hue=="number"&&typeof e.saturation=="number"&&typeof e.lightness=="number"&&(typeof e.alpha!="number"||typeof e.alpha>"u")},Gae=function(e){return typeof e.hue=="number"&&typeof e.saturation=="number"&&typeof e.lightness=="number"&&typeof e.alpha=="number"};function Sl(i){if(typeof i!="object")throw new sa(8);if(zae(i))return Kv(i);if(kae(i))return YI(i);if(Gae(i))return Fae(i);if(Vae(i))return Iae(i);throw new sa(8)}function KI(i,e,t){return function(){var r=t.concat(Array.prototype.slice.call(arguments));return r.length>=e?i.apply(this,r):KI(i,e,r)}}function ss(i){return KI(i,i.length,[])}function Hae(i,e){if(e==="transparent")return e;var t=bl(e);return Sl(Ir({},t,{hue:t.hue+parseFloat(i)}))}ss(Hae);function Qh(i,e,t){return Math.max(i,Math.min(e,t))}function Wae(i,e){if(e==="transparent")return e;var t=bl(e);return Sl(Ir({},t,{lightness:Qh(0,1,t.lightness-parseFloat(i))}))}ss(Wae);function jae(i,e){if(e==="transparent")return e;var t=bl(e);return Sl(Ir({},t,{saturation:Qh(0,1,t.saturation-parseFloat(i))}))}ss(jae);function qae(i,e){if(e==="transparent")return e;var t=bl(e);return Sl(Ir({},t,{lightness:Qh(0,1,t.lightness+parseFloat(i))}))}ss(qae);function $ae(i,e,t){if(e==="transparent")return t;if(t==="transparent")return e;if(i===0)return t;var n=Fh(e),r=Ir({},n,{alpha:typeof n.alpha=="number"?n.alpha:1}),s=Fh(t),a=Ir({},s,{alpha:typeof s.alpha=="number"?s.alpha:1}),l=r.alpha-a.alpha,u=parseFloat(i)*2-1,h=u*l===-1?u:u+l,d=1+u*l,p=(h/d+1)/2,g=1-p,y={red:Math.floor(r.red*p+a.red*g),green:Math.floor(r.green*p+a.green*g),blue:Math.floor(r.blue*p+a.blue*g),alpha:r.alpha*parseFloat(i)+a.alpha*(1-parseFloat(i))};return Kv(y)}var Xae=ss($ae),ZI=Xae;function Yae(i,e){if(e==="transparent")return e;var t=Fh(e),n=typeof t.alpha=="number"?t.alpha:1,r=Ir({},t,{alpha:Qh(0,1,(n*100+parseFloat(i)*100)/100)});return Kv(r)}var Kae=ss(Yae),Zae=Kae;function Qae(i,e){if(e==="transparent")return e;var t=bl(e);return Sl(Ir({},t,{saturation:Qh(0,1,t.saturation+parseFloat(i))}))}ss(Qae);function Jae(i,e){return e==="transparent"?e:Sl(Ir({},bl(e),{hue:parseFloat(i)}))}ss(Jae);function eoe(i,e){return e==="transparent"?e:Sl(Ir({},bl(e),{lightness:parseFloat(i)}))}ss(eoe);function toe(i,e){return e==="transparent"?e:Sl(Ir({},bl(e),{saturation:parseFloat(i)}))}ss(toe);function noe(i,e){return e==="transparent"?e:ZI(parseFloat(i),"rgb(0, 0, 0)",e)}ss(noe);function ioe(i,e){return e==="transparent"?e:ZI(parseFloat(i),"rgb(255, 255, 255)",e)}ss(ioe);function roe(i,e){if(e==="transparent")return e;var t=Fh(e),n=typeof t.alpha=="number"?t.alpha:1,r=Ir({},t,{alpha:Qh(0,1,+(n*100-parseFloat(i)*100).toFixed(2)/100)});return Kv(r)}ss(roe);var bu=Object.freeze({Linear:Object.freeze({None:function(i){return i},In:function(i){return i},Out:function(i){return i},InOut:function(i){return i}}),Quadratic:Object.freeze({In:function(i){return i*i},Out:function(i){return i*(2-i)},InOut:function(i){return(i*=2)<1?.5*i*i:-.5*(--i*(i-2)-1)}}),Cubic:Object.freeze({In:function(i){return i*i*i},Out:function(i){return--i*i*i+1},InOut:function(i){return(i*=2)<1?.5*i*i*i:.5*((i-=2)*i*i+2)}}),Quartic:Object.freeze({In:function(i){return i*i*i*i},Out:function(i){return 1- --i*i*i*i},InOut:function(i){return(i*=2)<1?.5*i*i*i*i:-.5*((i-=2)*i*i*i-2)}}),Quintic:Object.freeze({In:function(i){return i*i*i*i*i},Out:function(i){return--i*i*i*i*i+1},InOut:function(i){return(i*=2)<1?.5*i*i*i*i*i:.5*((i-=2)*i*i*i*i+2)}}),Sinusoidal:Object.freeze({In:function(i){return 1-Math.sin((1-i)*Math.PI/2)},Out:function(i){return Math.sin(i*Math.PI/2)},InOut:function(i){return .5*(1-Math.sin(Math.PI*(.5-i)))}}),Exponential:Object.freeze({In:function(i){return i===0?0:Math.pow(1024,i-1)},Out:function(i){return i===1?1:1-Math.pow(2,-10*i)},InOut:function(i){return i===0?0:i===1?1:(i*=2)<1?.5*Math.pow(1024,i-1):.5*(-Math.pow(2,-10*(i-1))+2)}}),Circular:Object.freeze({In:function(i){return 1-Math.sqrt(1-i*i)},Out:function(i){return Math.sqrt(1- --i*i)},InOut:function(i){return(i*=2)<1?-.5*(Math.sqrt(1-i*i)-1):.5*(Math.sqrt(1-(i-=2)*i)+1)}}),Elastic:Object.freeze({In:function(i){return i===0?0:i===1?1:-Math.pow(2,10*(i-1))*Math.sin((i-1.1)*5*Math.PI)},Out:function(i){return i===0?0:i===1?1:Math.pow(2,-10*i)*Math.sin((i-.1)*5*Math.PI)+1},InOut:function(i){return i===0?0:i===1?1:(i*=2,i<1?-.5*Math.pow(2,10*(i-1))*Math.sin((i-1.1)*5*Math.PI):.5*Math.pow(2,-10*(i-1))*Math.sin((i-1.1)*5*Math.PI)+1)}}),Back:Object.freeze({In:function(i){var e=1.70158;return i===1?1:i*i*((e+1)*i-e)},Out:function(i){var e=1.70158;return i===0?0:--i*i*((e+1)*i+e)+1},InOut:function(i){var e=2.5949095;return(i*=2)<1?.5*(i*i*((e+1)*i-e)):.5*((i-=2)*i*((e+1)*i+e)+2)}}),Bounce:Object.freeze({In:function(i){return 1-bu.Bounce.Out(1-i)},Out:function(i){return i<1/2.75?7.5625*i*i:i<2/2.75?7.5625*(i-=1.5/2.75)*i+.75:i<2.5/2.75?7.5625*(i-=2.25/2.75)*i+.9375:7.5625*(i-=2.625/2.75)*i+.984375},InOut:function(i){return i<.5?bu.Bounce.In(i*2)*.5:bu.Bounce.Out(i*2-1)*.5+.5}}),generatePow:function(i){return i===void 0&&(i=4),i=i<Number.EPSILON?Number.EPSILON:i,i=i>1e4?1e4:i,{In:function(e){return Math.pow(e,i)},Out:function(e){return 1-Math.pow(1-e,i)},InOut:function(e){return e<.5?Math.pow(e*2,i)/2:(1-Math.pow(2-e*2,i))/2+.5}}}}),Od=function(){return performance.now()},QI=function(){function i(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._tweens={},this._tweensAddedDuringUpdate={},this.add.apply(this,e)}return i.prototype.getAll=function(){var e=this;return Object.keys(this._tweens).map(function(t){return e._tweens[t]})},i.prototype.removeAll=function(){this._tweens={}},i.prototype.add=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=0,s=t;r<s.length;r++){var a=s[r];(e=a._group)===null||e===void 0||e.remove(a),a._group=this,this._tweens[a.getId()]=a,this._tweensAddedDuringUpdate[a.getId()]=a}},i.prototype.remove=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=0,r=e;n<r.length;n++){var s=r[n];s._group=void 0,delete this._tweens[s.getId()],delete this._tweensAddedDuringUpdate[s.getId()]}},i.prototype.allStopped=function(){return this.getAll().every(function(e){return!e.isPlaying()})},i.prototype.update=function(e,t){e===void 0&&(e=Od()),t===void 0&&(t=!0);var n=Object.keys(this._tweens);if(n.length!==0)for(;n.length>0;){this._tweensAddedDuringUpdate={};for(var r=0;r<n.length;r++){var s=this._tweens[n[r]],a=!t;s&&s.update(e,a)===!1&&!t&&this.remove(s)}n=Object.keys(this._tweensAddedDuringUpdate)}},i}(),ST={Linear:function(i,e){var t=i.length-1,n=t*e,r=Math.floor(n),s=ST.Utils.Linear;return e<0?s(i[0],i[1],n):e>1?s(i[t],i[t-1],t-n):s(i[r],i[r+1>t?t:r+1],n-r)},Utils:{Linear:function(i,e,t){return(e-i)*t+i}}},JI=function(){function i(){}return i.nextId=function(){return i._nextId++},i._nextId=0,i}(),TT=new QI,B2=function(){function i(e,t){this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._isDynamic=!1,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=bu.Linear.None,this._interpolationFunction=ST.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=JI.nextId(),this._isChainStopped=!1,this._propertiesAreSetUp=!1,this._goToEnd=!1,this._object=e,typeof t=="object"?(this._group=t,t.add(this)):t===!0&&(this._group=TT,TT.add(this))}return i.prototype.getId=function(){return this._id},i.prototype.isPlaying=function(){return this._isPlaying},i.prototype.isPaused=function(){return this._isPaused},i.prototype.getDuration=function(){return this._duration},i.prototype.to=function(e,t){if(t===void 0&&(t=1e3),this._isPlaying)throw new Error("Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.");return this._valuesEnd=e,this._propertiesAreSetUp=!1,this._duration=t<0?0:t,this},i.prototype.duration=function(e){return e===void 0&&(e=1e3),this._duration=e<0?0:e,this},i.prototype.dynamic=function(e){return e===void 0&&(e=!1),this._isDynamic=e,this},i.prototype.start=function(e,t){if(e===void 0&&(e=Od()),t===void 0&&(t=!1),this._isPlaying)return this;if(this._repeat=this._initialRepeat,this._reversed){this._reversed=!1;for(var n in this._valuesStartRepeat)this._swapEndStartRepeatValues(n),this._valuesStart[n]=this._valuesStartRepeat[n]}if(this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=e,this._startTime+=this._delayTime,!this._propertiesAreSetUp||t){if(this._propertiesAreSetUp=!0,!this._isDynamic){var r={};for(var s in this._valuesEnd)r[s]=this._valuesEnd[s];this._valuesEnd=r}this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,t)}return this},i.prototype.startFromCurrentValues=function(e){return this.start(e,!0)},i.prototype._setupProperties=function(e,t,n,r,s){for(var a in n){var l=e[a],u=Array.isArray(l),h=u?"array":typeof l,d=!u&&Array.isArray(n[a]);if(!(h==="undefined"||h==="function")){if(d){var p=n[a];if(p.length===0)continue;for(var g=[l],y=0,v=p.length;y<v;y+=1){var S=this._handleRelativeValue(l,p[y]);if(isNaN(S)){d=!1,console.warn("Found invalid interpolation list. Skipping.");break}g.push(S)}d&&(n[a]=g)}if((h==="object"||u)&&l&&!d){t[a]=u?[]:{};var b=l;for(var _ in b)t[a][_]=b[_];r[a]=u?[]:{};var p=n[a];if(!this._isDynamic){var E={};for(var _ in p)E[_]=p[_];n[a]=p=E}this._setupProperties(b,t[a],p,r[a],s)}else(typeof t[a]>"u"||s)&&(t[a]=l),u||(t[a]*=1),d?r[a]=n[a].slice().reverse():r[a]=t[a]||0}}},i.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},i.prototype.end=function(){return this._goToEnd=!0,this.update(this._startTime+this._duration),this},i.prototype.pause=function(e){return e===void 0&&(e=Od()),this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._pauseStart=e,this)},i.prototype.resume=function(e){return e===void 0&&(e=Od()),!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._startTime+=e-this._pauseStart,this._pauseStart=0,this)},i.prototype.stopChainedTweens=function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop();return this},i.prototype.group=function(e){return e?(e.add(this),this):(console.warn("tween.group() without args has been removed, use group.add(tween) instead."),this)},i.prototype.remove=function(){var e;return(e=this._group)===null||e===void 0||e.remove(this),this},i.prototype.delay=function(e){return e===void 0&&(e=0),this._delayTime=e,this},i.prototype.repeat=function(e){return e===void 0&&(e=0),this._initialRepeat=e,this._repeat=e,this},i.prototype.repeatDelay=function(e){return this._repeatDelayTime=e,this},i.prototype.yoyo=function(e){return e===void 0&&(e=!1),this._yoyo=e,this},i.prototype.easing=function(e){return e===void 0&&(e=bu.Linear.None),this._easingFunction=e,this},i.prototype.interpolation=function(e){return e===void 0&&(e=ST.Linear),this._interpolationFunction=e,this},i.prototype.chain=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this._chainedTweens=e,this},i.prototype.onStart=function(e){return this._onStartCallback=e,this},i.prototype.onEveryStart=function(e){return this._onEveryStartCallback=e,this},i.prototype.onUpdate=function(e){return this._onUpdateCallback=e,this},i.prototype.onRepeat=function(e){return this._onRepeatCallback=e,this},i.prototype.onComplete=function(e){return this._onCompleteCallback=e,this},i.prototype.onStop=function(e){return this._onStopCallback=e,this},i.prototype.update=function(e,t){var n=this,r;if(e===void 0&&(e=Od()),t===void 0&&(t=i.autoStartOnUpdate),this._isPaused)return!0;var s;if(!this._goToEnd&&!this._isPlaying)if(t)this.start(e,!0);else return!1;if(this._goToEnd=!1,e<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),this._onEveryStartCallbackFired===!1&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0);var a=e-this._startTime,l=this._duration+((r=this._repeatDelayTime)!==null&&r!==void 0?r:this._delayTime),u=this._duration+this._repeat*l,h=function(){if(n._duration===0||a>u)return 1;var S=Math.trunc(a/l),b=a-S*l,_=Math.min(b/n._duration,1);return _===0&&a===n._duration?1:_},d=h(),p=this._easingFunction(d);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,p),this._onUpdateCallback&&this._onUpdateCallback(this._object,d),this._duration===0||a>=this._duration)if(this._repeat>0){var g=Math.min(Math.trunc((a-this._duration)/l)+1,this._repeat);isFinite(this._repeat)&&(this._repeat-=g);for(s in this._valuesStartRepeat)!this._yoyo&&typeof this._valuesEnd[s]=="string"&&(this._valuesStartRepeat[s]=this._valuesStartRepeat[s]+parseFloat(this._valuesEnd[s])),this._yoyo&&this._swapEndStartRepeatValues(s),this._valuesStart[s]=this._valuesStartRepeat[s];return this._yoyo&&(this._reversed=!this._reversed),this._startTime+=l*g,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1,!0}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var y=0,v=this._chainedTweens.length;y<v;y++)this._chainedTweens[y].start(this._startTime+this._duration,!1);return this._isPlaying=!1,!1}return!0},i.prototype._updateProperties=function(e,t,n,r){for(var s in n)if(t[s]!==void 0){var a=t[s]||0,l=n[s],u=Array.isArray(e[s]),h=Array.isArray(l),d=!u&&h;d?e[s]=this._interpolationFunction(l,r):typeof l=="object"&&l?this._updateProperties(e[s],a,l,r):(l=this._handleRelativeValue(a,l),typeof l=="number"&&(e[s]=a+(l-a)*r))}},i.prototype._handleRelativeValue=function(e,t){return typeof t!="string"?t:t.charAt(0)==="+"||t.charAt(0)==="-"?e+parseFloat(t):parseFloat(t)},i.prototype._swapEndStartRepeatValues=function(e){var t=this._valuesStartRepeat[e],n=this._valuesEnd[e];typeof n=="string"?this._valuesStartRepeat[e]=this._valuesStartRepeat[e]+parseFloat(n):this._valuesStartRepeat[e]=this._valuesEnd[e],this._valuesEnd[e]=t},i.autoStartOnUpdate=!1,i}();JI.nextId;var ya=TT;ya.getAll.bind(ya);ya.removeAll.bind(ya);ya.add.bind(ya);ya.remove.bind(ya);ya.update.bind(ya);var MT="http://www.w3.org/1999/xhtml";const I2={svg:"http://www.w3.org/2000/svg",xhtml:MT,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function e3(i){var e=i+="",t=e.indexOf(":");return t>=0&&(e=i.slice(0,t))!=="xmlns"&&(i=i.slice(t+1)),I2.hasOwnProperty(e)?{space:I2[e],local:i}:i}function soe(i){return function(){var e=this.ownerDocument,t=this.namespaceURI;return t===MT&&e.documentElement.namespaceURI===MT?e.createElement(i):e.createElementNS(t,i)}}function aoe(i){return function(){return this.ownerDocument.createElementNS(i.space,i.local)}}function t3(i){var e=e3(i);return(e.local?aoe:soe)(e)}function ooe(){}function n3(i){return i==null?ooe:function(){return this.querySelector(i)}}function loe(i){typeof i!="function"&&(i=n3(i));for(var e=this._groups,t=e.length,n=new Array(t),r=0;r<t;++r)for(var s=e[r],a=s.length,l=n[r]=new Array(a),u,h,d=0;d<a;++d)(u=s[d])&&(h=i.call(u,u.__data__,d,s))&&("__data__"in u&&(h.__data__=u.__data__),l[d]=h);return new Ms(n,this._parents)}function uoe(i){return i==null?[]:Array.isArray(i)?i:Array.from(i)}function coe(){return[]}function hoe(i){return i==null?coe:function(){return this.querySelectorAll(i)}}function foe(i){return function(){return uoe(i.apply(this,arguments))}}function doe(i){typeof i=="function"?i=foe(i):i=hoe(i);for(var e=this._groups,t=e.length,n=[],r=[],s=0;s<t;++s)for(var a=e[s],l=a.length,u,h=0;h<l;++h)(u=a[h])&&(n.push(i.call(u,u.__data__,h,a)),r.push(u));return new Ms(n,r)}function poe(i){return function(){return this.matches(i)}}function i3(i){return function(e){return e.matches(i)}}var moe=Array.prototype.find;function goe(i){return function(){return moe.call(this.children,i)}}function yoe(){return this.firstElementChild}function voe(i){return this.select(i==null?yoe:goe(typeof i=="function"?i:i3(i)))}var _oe=Array.prototype.filter;function xoe(){return Array.from(this.children)}function boe(i){return function(){return _oe.call(this.children,i)}}function Soe(i){return this.selectAll(i==null?xoe:boe(typeof i=="function"?i:i3(i)))}function Toe(i){typeof i!="function"&&(i=poe(i));for(var e=this._groups,t=e.length,n=new Array(t),r=0;r<t;++r)for(var s=e[r],a=s.length,l=n[r]=[],u,h=0;h<a;++h)(u=s[h])&&i.call(u,u.__data__,h,s)&&l.push(u);return new Ms(n,this._parents)}function r3(i){return new Array(i.length)}function Moe(){return new Ms(this._enter||this._groups.map(r3),this._parents)}function uv(i,e){this.ownerDocument=i.ownerDocument,this.namespaceURI=i.namespaceURI,this._next=null,this._parent=i,this.__data__=e}uv.prototype={constructor:uv,appendChild:function(i){return this._parent.insertBefore(i,this._next)},insertBefore:function(i,e){return this._parent.insertBefore(i,e)},querySelector:function(i){return this._parent.querySelector(i)},querySelectorAll:function(i){return this._parent.querySelectorAll(i)}};function Eoe(i){return function(){return i}}function Aoe(i,e,t,n,r,s){for(var a=0,l,u=e.length,h=s.length;a<h;++a)(l=e[a])?(l.__data__=s[a],n[a]=l):t[a]=new uv(i,s[a]);for(;a<u;++a)(l=e[a])&&(r[a]=l)}function woe(i,e,t,n,r,s,a){var l,u,h=new Map,d=e.length,p=s.length,g=new Array(d),y;for(l=0;l<d;++l)(u=e[l])&&(g[l]=y=a.call(u,u.__data__,l,e)+"",h.has(y)?r[l]=u:h.set(y,u));for(l=0;l<p;++l)y=a.call(i,s[l],l,s)+"",(u=h.get(y))?(n[l]=u,u.__data__=s[l],h.delete(y)):t[l]=new uv(i,s[l]);for(l=0;l<d;++l)(u=e[l])&&h.get(g[l])===u&&(r[l]=u)}function Roe(i){return i.__data__}function Coe(i,e){if(!arguments.length)return Array.from(this,Roe);var t=e?woe:Aoe,n=this._parents,r=this._groups;typeof i!="function"&&(i=Eoe(i));for(var s=r.length,a=new Array(s),l=new Array(s),u=new Array(s),h=0;h<s;++h){var d=n[h],p=r[h],g=p.length,y=Noe(i.call(d,d&&d.__data__,h,n)),v=y.length,S=l[h]=new Array(v),b=a[h]=new Array(v),_=u[h]=new Array(g);t(d,p,S,b,_,y,e);for(var E=0,M=0,A,w;E<v;++E)if(A=S[E]){for(E>=M&&(M=E+1);!(w=b[M])&&++M<v;);A._next=w||null}}return a=new Ms(a,n),a._enter=l,a._exit=u,a}function Noe(i){return typeof i=="object"&&"length"in i?i:Array.from(i)}function Poe(){return new Ms(this._exit||this._groups.map(r3),this._parents)}function Doe(i,e,t){var n=this.enter(),r=this,s=this.exit();return typeof i=="function"?(n=i(n),n&&(n=n.selection())):n=n.append(i+""),e!=null&&(r=e(r),r&&(r=r.selection())),t==null?s.remove():t(s),n&&r?n.merge(r).order():r}function Loe(i){for(var e=i.selection?i.selection():i,t=this._groups,n=e._groups,r=t.length,s=n.length,a=Math.min(r,s),l=new Array(r),u=0;u<a;++u)for(var h=t[u],d=n[u],p=h.length,g=l[u]=new Array(p),y,v=0;v<p;++v)(y=h[v]||d[v])&&(g[v]=y);for(;u<r;++u)l[u]=t[u];return new Ms(l,this._parents)}function Uoe(){for(var i=this._groups,e=-1,t=i.length;++e<t;)for(var n=i[e],r=n.length-1,s=n[r],a;--r>=0;)(a=n[r])&&(s&&a.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(a,s),s=a);return this}function Ooe(i){i||(i=Boe);function e(p,g){return p&&g?i(p.__data__,g.__data__):!p-!g}for(var t=this._groups,n=t.length,r=new Array(n),s=0;s<n;++s){for(var a=t[s],l=a.length,u=r[s]=new Array(l),h,d=0;d<l;++d)(h=a[d])&&(u[d]=h);u.sort(e)}return new Ms(r,this._parents).order()}function Boe(i,e){return i<e?-1:i>e?1:i>=e?0:NaN}function Ioe(){var i=arguments[0];return arguments[0]=this,i.apply(null,arguments),this}function Foe(){return Array.from(this)}function koe(){for(var i=this._groups,e=0,t=i.length;e<t;++e)for(var n=i[e],r=0,s=n.length;r<s;++r){var a=n[r];if(a)return a}return null}function zoe(){let i=0;for(const e of this)++i;return i}function Voe(){return!this.node()}function Goe(i){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],s=0,a=r.length,l;s<a;++s)(l=r[s])&&i.call(l,l.__data__,s,r);return this}function Hoe(i){return function(){this.removeAttribute(i)}}function Woe(i){return function(){this.removeAttributeNS(i.space,i.local)}}function joe(i,e){return function(){this.setAttribute(i,e)}}function qoe(i,e){return function(){this.setAttributeNS(i.space,i.local,e)}}function $oe(i,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttribute(i):this.setAttribute(i,t)}}function Xoe(i,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttributeNS(i.space,i.local):this.setAttributeNS(i.space,i.local,t)}}function Yoe(i,e){var t=e3(i);if(arguments.length<2){var n=this.node();return t.local?n.getAttributeNS(t.space,t.local):n.getAttribute(t)}return this.each((e==null?t.local?Woe:Hoe:typeof e=="function"?t.local?Xoe:$oe:t.local?qoe:joe)(t,e))}function s3(i){return i.ownerDocument&&i.ownerDocument.defaultView||i.document&&i||i.defaultView}function Koe(i){return function(){this.style.removeProperty(i)}}function Zoe(i,e,t){return function(){this.style.setProperty(i,e,t)}}function Qoe(i,e,t){return function(){var n=e.apply(this,arguments);n==null?this.style.removeProperty(i):this.style.setProperty(i,n,t)}}function Joe(i,e,t){return arguments.length>1?this.each((e==null?Koe:typeof e=="function"?Qoe:Zoe)(i,e,t??"")):ele(this.node(),i)}function ele(i,e){return i.style.getPropertyValue(e)||s3(i).getComputedStyle(i,null).getPropertyValue(e)}function tle(i){return function(){delete this[i]}}function nle(i,e){return function(){this[i]=e}}function ile(i,e){return function(){var t=e.apply(this,arguments);t==null?delete this[i]:this[i]=t}}function rle(i,e){return arguments.length>1?this.each((e==null?tle:typeof e=="function"?ile:nle)(i,e)):this.node()[i]}function a3(i){return i.trim().split(/^|\s+/)}function qE(i){return i.classList||new o3(i)}function o3(i){this._node=i,this._names=a3(i.getAttribute("class")||"")}o3.prototype={add:function(i){var e=this._names.indexOf(i);e<0&&(this._names.push(i),this._node.setAttribute("class",this._names.join(" ")))},remove:function(i){var e=this._names.indexOf(i);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(i){return this._names.indexOf(i)>=0}};function l3(i,e){for(var t=qE(i),n=-1,r=e.length;++n<r;)t.add(e[n])}function u3(i,e){for(var t=qE(i),n=-1,r=e.length;++n<r;)t.remove(e[n])}function sle(i){return function(){l3(this,i)}}function ale(i){return function(){u3(this,i)}}function ole(i,e){return function(){(e.apply(this,arguments)?l3:u3)(this,i)}}function lle(i,e){var t=a3(i+"");if(arguments.length<2){for(var n=qE(this.node()),r=-1,s=t.length;++r<s;)if(!n.contains(t[r]))return!1;return!0}return this.each((typeof e=="function"?ole:e?sle:ale)(t,e))}function ule(){this.textContent=""}function cle(i){return function(){this.textContent=i}}function hle(i){return function(){var e=i.apply(this,arguments);this.textContent=e??""}}function fle(i){return arguments.length?this.each(i==null?ule:(typeof i=="function"?hle:cle)(i)):this.node().textContent}function dle(){this.innerHTML=""}function ple(i){return function(){this.innerHTML=i}}function mle(i){return function(){var e=i.apply(this,arguments);this.innerHTML=e??""}}function gle(i){return arguments.length?this.each(i==null?dle:(typeof i=="function"?mle:ple)(i)):this.node().innerHTML}function yle(){this.nextSibling&&this.parentNode.appendChild(this)}function vle(){return this.each(yle)}function _le(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function xle(){return this.each(_le)}function ble(i){var e=typeof i=="function"?i:t3(i);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function Sle(){return null}function Tle(i,e){var t=typeof i=="function"?i:t3(i),n=e==null?Sle:typeof e=="function"?e:n3(e);return this.select(function(){return this.insertBefore(t.apply(this,arguments),n.apply(this,arguments)||null)})}function Mle(){var i=this.parentNode;i&&i.removeChild(this)}function Ele(){return this.each(Mle)}function Ale(){var i=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(i,this.nextSibling):i}function wle(){var i=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(i,this.nextSibling):i}function Rle(i){return this.select(i?wle:Ale)}function Cle(i){return arguments.length?this.property("__data__",i):this.node().__data__}function Nle(i){return function(e){i.call(this,e,this.__data__)}}function Ple(i){return i.trim().split(/^|\s+/).map(function(e){var t="",n=e.indexOf(".");return n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),{type:e,name:t}})}function Dle(i){return function(){var e=this.__on;if(e){for(var t=0,n=-1,r=e.length,s;t<r;++t)s=e[t],(!i.type||s.type===i.type)&&s.name===i.name?this.removeEventListener(s.type,s.listener,s.options):e[++n]=s;++n?e.length=n:delete this.__on}}}function Lle(i,e,t){return function(){var n=this.__on,r,s=Nle(e);if(n){for(var a=0,l=n.length;a<l;++a)if((r=n[a]).type===i.type&&r.name===i.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=s,r.options=t),r.value=e;return}}this.addEventListener(i.type,s,t),r={type:i.type,name:i.name,value:e,listener:s,options:t},n?n.push(r):this.__on=[r]}}function Ule(i,e,t){var n=Ple(i+""),r,s=n.length,a;if(arguments.length<2){var l=this.node().__on;if(l){for(var u=0,h=l.length,d;u<h;++u)for(r=0,d=l[u];r<s;++r)if((a=n[r]).type===d.type&&a.name===d.name)return d.value}return}for(l=e?Lle:Dle,r=0;r<s;++r)this.each(l(n[r],e,t));return this}function c3(i,e,t){var n=s3(i),r=n.CustomEvent;typeof r=="function"?r=new r(e,t):(r=n.document.createEvent("Event"),t?(r.initEvent(e,t.bubbles,t.cancelable),r.detail=t.detail):r.initEvent(e,!1,!1)),i.dispatchEvent(r)}function Ole(i,e){return function(){return c3(this,i,e)}}function Ble(i,e){return function(){return c3(this,i,e.apply(this,arguments))}}function Ile(i,e){return this.each((typeof e=="function"?Ble:Ole)(i,e))}function*Fle(){for(var i=this._groups,e=0,t=i.length;e<t;++e)for(var n=i[e],r=0,s=n.length,a;r<s;++r)(a=n[r])&&(yield a)}var kle=[null];function Ms(i,e){this._groups=i,this._parents=e}function zle(){return this}Ms.prototype={constructor:Ms,select:loe,selectAll:doe,selectChild:voe,selectChildren:Soe,filter:Toe,data:Coe,enter:Moe,exit:Poe,join:Doe,merge:Loe,selection:zle,order:Uoe,sort:Ooe,call:Ioe,nodes:Foe,node:koe,size:zoe,empty:Voe,each:Goe,attr:Yoe,style:Joe,property:rle,classed:lle,text:fle,html:gle,raise:vle,lower:xle,append:ble,insert:Tle,remove:Ele,clone:Rle,datum:Cle,on:Ule,dispatch:Ile,[Symbol.iterator]:Fle};function Vle(i){return typeof i=="string"?new Ms([[document.querySelector(i)]],[document.documentElement]):new Ms([[i]],kle)}function Gle(i){let e;for(;e=i.sourceEvent;)i=e;return i}function Hle(i,e){if(i=Gle(i),e===void 0&&(e=i.currentTarget),e){var t=e.ownerSVGElement||e;if(t.createSVGPoint){var n=t.createSVGPoint();return n.x=i.clientX,n.y=i.clientY,n=n.matrixTransform(e.getScreenCTM().inverse()),[n.x,n.y]}if(e.getBoundingClientRect){var r=e.getBoundingClientRect();return[i.clientX-r.left-e.clientLeft,i.clientY-r.top-e.clientTop]}}return[i.pageX,i.pageY]}var em,In,h3,f3,hu,F2,d3,p3,m3,$E,ET,AT,Lp={},g3=[],Wle=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,Zv=Array.isArray;function aa(i,e){for(var t in e)i[t]=e[t];return i}function XE(i){i&&i.parentNode&&i.parentNode.removeChild(i)}function jle(i,e,t){var n,r,s,a={};for(s in e)s=="key"?n=e[s]:s=="ref"?r=e[s]:a[s]=e[s];if(arguments.length>2&&(a.children=arguments.length>3?em.call(arguments,2):t),typeof i=="function"&&i.defaultProps!=null)for(s in i.defaultProps)a[s]===void 0&&(a[s]=i.defaultProps[s]);return Kd(i,a,n,r,null)}function Kd(i,e,t,n,r){var s={type:i,props:e,key:t,ref:n,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:r??++h3,__i:-1,__u:0};return r==null&&In.vnode!=null&&In.vnode(s),s}function Qv(i){return i.children}function Oy(i,e){this.props=i,this.context=e}function kh(i,e){if(e==null)return i.__?kh(i.__,i.__i+1):null;for(var t;e<i.__k.length;e++)if((t=i.__k[e])!=null&&t.__e!=null)return t.__e;return typeof i.type=="function"?kh(i):null}function y3(i){var e,t;if((i=i.__)!=null&&i.__c!=null){for(i.__e=i.__c.base=null,e=0;e<i.__k.length;e++)if((t=i.__k[e])!=null&&t.__e!=null){i.__e=i.__c.base=t.__e;break}return y3(i)}}function k2(i){(!i.__d&&(i.__d=!0)&&hu.push(i)&&!cv.__r++||F2!=In.debounceRendering)&&((F2=In.debounceRendering)||d3)(cv)}function cv(){for(var i,e,t,n,r,s,a,l=1;hu.length;)hu.length>l&&hu.sort(p3),i=hu.shift(),l=hu.length,i.__d&&(t=void 0,r=(n=(e=i).__v).__e,s=[],a=[],e.__P&&((t=aa({},n)).__v=n.__v+1,In.vnode&&In.vnode(t),YE(e.__P,t,n,e.__n,e.__P.namespaceURI,32&n.__u?[r]:null,s,r??kh(n),!!(32&n.__u),a),t.__v=n.__v,t.__.__k[t.__i]=t,x3(s,t,a),t.__e!=r&&y3(t)));cv.__r=0}function v3(i,e,t,n,r,s,a,l,u,h,d){var p,g,y,v,S,b,_=n&&n.__k||g3,E=e.length;for(u=qle(t,e,_,u,E),p=0;p<E;p++)(y=t.__k[p])!=null&&(g=y.__i==-1?Lp:_[y.__i]||Lp,y.__i=p,b=YE(i,y,g,r,s,a,l,u,h,d),v=y.__e,y.ref&&g.ref!=y.ref&&(g.ref&&KE(g.ref,null,y),d.push(y.ref,y.__c||v,y)),S==null&&v!=null&&(S=v),4&y.__u||g.__k===y.__k?u=_3(y,u,i):typeof y.type=="function"&&b!==void 0?u=b:v&&(u=v.nextSibling),y.__u&=-7);return t.__e=S,u}function qle(i,e,t,n,r){var s,a,l,u,h,d=t.length,p=d,g=0;for(i.__k=new Array(r),s=0;s<r;s++)(a=e[s])!=null&&typeof a!="boolean"&&typeof a!="function"?(u=s+g,(a=i.__k[s]=typeof a=="string"||typeof a=="number"||typeof a=="bigint"||a.constructor==String?Kd(null,a,null,null,null):Zv(a)?Kd(Qv,{children:a},null,null,null):a.constructor==null&&a.__b>0?Kd(a.type,a.props,a.key,a.ref?a.ref:null,a.__v):a).__=i,a.__b=i.__b+1,l=null,(h=a.__i=$le(a,t,u,p))!=-1&&(p--,(l=t[h])&&(l.__u|=2)),l==null||l.__v==null?(h==-1&&(r>d?g--:r<d&&g++),typeof a.type!="function"&&(a.__u|=4)):h!=u&&(h==u-1?g--:h==u+1?g++:(h>u?g--:g++,a.__u|=4))):i.__k[s]=null;if(p)for(s=0;s<d;s++)(l=t[s])!=null&&(2&l.__u)==0&&(l.__e==n&&(n=kh(l)),S3(l,l));return n}function _3(i,e,t){var n,r;if(typeof i.type=="function"){for(n=i.__k,r=0;n&&r<n.length;r++)n[r]&&(n[r].__=i,e=_3(n[r],e,t));return e}i.__e!=e&&(e&&i.type&&!t.contains(e)&&(e=kh(i)),t.insertBefore(i.__e,e||null),e=i.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function $le(i,e,t,n){var r,s,a=i.key,l=i.type,u=e[t];if(u===null&&i.key==null||u&&a==u.key&&l==u.type&&(2&u.__u)==0)return t;if(n>(u!=null&&(2&u.__u)==0?1:0))for(r=t-1,s=t+1;r>=0||s<e.length;){if(r>=0){if((u=e[r])&&(2&u.__u)==0&&a==u.key&&l==u.type)return r;r--}if(s<e.length){if((u=e[s])&&(2&u.__u)==0&&a==u.key&&l==u.type)return s;s++}}return-1}function z2(i,e,t){e[0]=="-"?i.setProperty(e,t??""):i[e]=t==null?"":typeof t!="number"||Wle.test(e)?t:t+"px"}function vy(i,e,t,n,r){var s,a;e:if(e=="style")if(typeof t=="string")i.style.cssText=t;else{if(typeof n=="string"&&(i.style.cssText=n=""),n)for(e in n)t&&e in t||z2(i.style,e,"");if(t)for(e in t)n&&t[e]==n[e]||z2(i.style,e,t[e])}else if(e[0]=="o"&&e[1]=="n")s=e!=(e=e.replace(m3,"$1")),a=e.toLowerCase(),e=a in i||e=="onFocusOut"||e=="onFocusIn"?a.slice(2):e.slice(2),i.l||(i.l={}),i.l[e+s]=t,t?n?t.u=n.u:(t.u=$E,i.addEventListener(e,s?AT:ET,s)):i.removeEventListener(e,s?AT:ET,s);else{if(r=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in i)try{i[e]=t??"";break e}catch{}typeof t=="function"||(t==null||t===!1&&e[4]!="-"?i.removeAttribute(e):i.setAttribute(e,e=="popover"&&t==1?"":t))}}function V2(i){return function(e){if(this.l){var t=this.l[e.type+i];if(e.t==null)e.t=$E++;else if(e.t<t.u)return;return t(In.event?In.event(e):e)}}}function YE(i,e,t,n,r,s,a,l,u,h){var d,p,g,y,v,S,b,_,E,M,A,w,R,C,L,N,D,I=e.type;if(e.constructor!=null)return null;128&t.__u&&(u=!!(32&t.__u),s=[l=e.__e=t.__e]),(d=In.__b)&&d(e);e:if(typeof I=="function")try{if(_=e.props,E="prototype"in I&&I.prototype.render,M=(d=I.contextType)&&n[d.__c],A=d?M?M.props.value:d.__:n,t.__c?b=(p=e.__c=t.__c).__=p.__E:(E?e.__c=p=new I(_,A):(e.__c=p=new Oy(_,A),p.constructor=I,p.render=Yle),M&&M.sub(p),p.props=_,p.state||(p.state={}),p.context=A,p.__n=n,g=p.__d=!0,p.__h=[],p._sb=[]),E&&p.__s==null&&(p.__s=p.state),E&&I.getDerivedStateFromProps!=null&&(p.__s==p.state&&(p.__s=aa({},p.__s)),aa(p.__s,I.getDerivedStateFromProps(_,p.__s))),y=p.props,v=p.state,p.__v=e,g)E&&I.getDerivedStateFromProps==null&&p.componentWillMount!=null&&p.componentWillMount(),E&&p.componentDidMount!=null&&p.__h.push(p.componentDidMount);else{if(E&&I.getDerivedStateFromProps==null&&_!==y&&p.componentWillReceiveProps!=null&&p.componentWillReceiveProps(_,A),!p.__e&&p.shouldComponentUpdate!=null&&p.shouldComponentUpdate(_,p.__s,A)===!1||e.__v==t.__v){for(e.__v!=t.__v&&(p.props=_,p.state=p.__s,p.__d=!1),e.__e=t.__e,e.__k=t.__k,e.__k.some(function(W){W&&(W.__=e)}),w=0;w<p._sb.length;w++)p.__h.push(p._sb[w]);p._sb=[],p.__h.length&&a.push(p);break e}p.componentWillUpdate!=null&&p.componentWillUpdate(_,p.__s,A),E&&p.componentDidUpdate!=null&&p.__h.push(function(){p.componentDidUpdate(y,v,S)})}if(p.context=A,p.props=_,p.__P=i,p.__e=!1,R=In.__r,C=0,E){for(p.state=p.__s,p.__d=!1,R&&R(e),d=p.render(p.props,p.state,p.context),L=0;L<p._sb.length;L++)p.__h.push(p._sb[L]);p._sb=[]}else do p.__d=!1,R&&R(e),d=p.render(p.props,p.state,p.context),p.state=p.__s;while(p.__d&&++C<25);p.state=p.__s,p.getChildContext!=null&&(n=aa(aa({},n),p.getChildContext())),E&&!g&&p.getSnapshotBeforeUpdate!=null&&(S=p.getSnapshotBeforeUpdate(y,v)),N=d,d!=null&&d.type===Qv&&d.key==null&&(N=b3(d.props.children)),l=v3(i,Zv(N)?N:[N],e,t,n,r,s,a,l,u,h),p.base=e.__e,e.__u&=-161,p.__h.length&&a.push(p),b&&(p.__E=p.__=null)}catch(W){if(e.__v=null,u||s!=null)if(W.then){for(e.__u|=u?160:128;l&&l.nodeType==8&&l.nextSibling;)l=l.nextSibling;s[s.indexOf(l)]=null,e.__e=l}else for(D=s.length;D--;)XE(s[D]);else e.__e=t.__e,e.__k=t.__k;In.__e(W,e,t)}else s==null&&e.__v==t.__v?(e.__k=t.__k,e.__e=t.__e):l=e.__e=Xle(t.__e,e,t,n,r,s,a,u,h);return(d=In.diffed)&&d(e),128&e.__u?void 0:l}function x3(i,e,t){for(var n=0;n<t.length;n++)KE(t[n],t[++n],t[++n]);In.__c&&In.__c(e,i),i.some(function(r){try{i=r.__h,r.__h=[],i.some(function(s){s.call(r)})}catch(s){In.__e(s,r.__v)}})}function b3(i){return typeof i!="object"||i==null||i.__b&&i.__b>0?i:Zv(i)?i.map(b3):aa({},i)}function Xle(i,e,t,n,r,s,a,l,u){var h,d,p,g,y,v,S,b=t.props,_=e.props,E=e.type;if(E=="svg"?r="http://www.w3.org/2000/svg":E=="math"?r="http://www.w3.org/1998/Math/MathML":r||(r="http://www.w3.org/1999/xhtml"),s!=null){for(h=0;h<s.length;h++)if((y=s[h])&&"setAttribute"in y==!!E&&(E?y.localName==E:y.nodeType==3)){i=y,s[h]=null;break}}if(i==null){if(E==null)return document.createTextNode(_);i=document.createElementNS(r,E,_.is&&_),l&&(In.__m&&In.__m(e,s),l=!1),s=null}if(E==null)b===_||l&&i.data==_||(i.data=_);else{if(s=s&&em.call(i.childNodes),b=t.props||Lp,!l&&s!=null)for(b={},h=0;h<i.attributes.length;h++)b[(y=i.attributes[h]).name]=y.value;for(h in b)if(y=b[h],h!="children"){if(h=="dangerouslySetInnerHTML")p=y;else if(!(h in _)){if(h=="value"&&"defaultValue"in _||h=="checked"&&"defaultChecked"in _)continue;vy(i,h,null,y,r)}}for(h in _)y=_[h],h=="children"?g=y:h=="dangerouslySetInnerHTML"?d=y:h=="value"?v=y:h=="checked"?S=y:l&&typeof y!="function"||b[h]===y||vy(i,h,y,b[h],r);if(d)l||p&&(d.__html==p.__html||d.__html==i.innerHTML)||(i.innerHTML=d.__html),e.__k=[];else if(p&&(i.innerHTML=""),v3(e.type=="template"?i.content:i,Zv(g)?g:[g],e,t,n,E=="foreignObject"?"http://www.w3.org/1999/xhtml":r,s,a,s?s[0]:t.__k&&kh(t,0),l,u),s!=null)for(h=s.length;h--;)XE(s[h]);l||(h="value",E=="progress"&&v==null?i.removeAttribute("value"):v!=null&&(v!==i[h]||E=="progress"&&!v||E=="option"&&v!=b[h])&&vy(i,h,v,b[h],r),h="checked",S!=null&&S!=i[h]&&vy(i,h,S,b[h],r))}return i}function KE(i,e,t){try{if(typeof i=="function"){var n=typeof i.__u=="function";n&&i.__u(),n&&e==null||(i.__u=i(e))}else i.current=e}catch(r){In.__e(r,t)}}function S3(i,e,t){var n,r;if(In.unmount&&In.unmount(i),(n=i.ref)&&(n.current&&n.current!=i.__e||KE(n,null,e)),(n=i.__c)!=null){if(n.componentWillUnmount)try{n.componentWillUnmount()}catch(s){In.__e(s,e)}n.base=n.__P=null}if(n=i.__k)for(r=0;r<n.length;r++)n[r]&&S3(n[r],e,t||typeof i.type!="function");t||XE(i.__e),i.__c=i.__=i.__e=void 0}function Yle(i,e,t){return this.constructor(i,t)}function Kle(i,e,t){var n,r,s,a;e==document&&(e=document.documentElement),In.__&&In.__(i,e),r=(n=!1)?null:e.__k,s=[],a=[],YE(e,i=e.__k=jle(Qv,null,[i]),r||Lp,Lp,e.namespaceURI,r?null:e.firstChild?em.call(e.childNodes):null,s,r?r.__e:e.firstChild,n,a),x3(s,i,a)}function T3(i,e,t){var n,r,s,a,l=aa({},i.props);for(s in i.type&&i.type.defaultProps&&(a=i.type.defaultProps),e)s=="key"?n=e[s]:s=="ref"?r=e[s]:l[s]=e[s]===void 0&&a!=null?a[s]:e[s];return arguments.length>2&&(l.children=arguments.length>3?em.call(arguments,2):t),Kd(i.type,l,n||i.key,r||i.ref,null)}em=g3.slice,In={__e:function(i,e,t,n){for(var r,s,a;e=e.__;)if((r=e.__c)&&!r.__)try{if((s=r.constructor)&&s.getDerivedStateFromError!=null&&(r.setState(s.getDerivedStateFromError(i)),a=r.__d),r.componentDidCatch!=null&&(r.componentDidCatch(i,n||{}),a=r.__d),a)return r.__E=r}catch(l){i=l}throw i}},h3=0,f3=function(i){return i!=null&&i.constructor==null},Oy.prototype.setState=function(i,e){var t;t=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=aa({},this.state),typeof i=="function"&&(i=i(aa({},t),this.props)),i&&aa(t,i),i!=null&&this.__v&&(e&&this._sb.push(e),k2(this))},Oy.prototype.forceUpdate=function(i){this.__v&&(this.__e=!0,i&&this.__h.push(i),k2(this))},Oy.prototype.render=Qv,hu=[],d3=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,p3=function(i,e){return i.__v.__b-e.__v.__b},cv.__r=0,m3=/(PointerCapture)$|Capture$/i,$E=0,ET=V2(!1),AT=V2(!0);function G2(i,e){(e==null||e>i.length)&&(e=i.length);for(var t=0,n=Array(e);t<e;t++)n[t]=i[t];return n}function Zle(i){if(Array.isArray(i))return i}function Qle(i,e,t){return(e=rue(e))in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Jle(i,e){var t=i==null?null:typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(t!=null){var n,r,s,a,l=[],u=!0,h=!1;try{if(s=(t=t.call(i)).next,e!==0)for(;!(u=(n=s.call(t)).done)&&(l.push(n.value),l.length!==e);u=!0);}catch(d){h=!0,r=d}finally{try{if(!u&&t.return!=null&&(a=t.return(),Object(a)!==a))return}finally{if(h)throw r}}return l}}function eue(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function H2(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);e&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(i,r).enumerable})),t.push.apply(t,n)}return t}function tue(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?H2(Object(t),!0).forEach(function(n){Qle(i,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):H2(Object(t)).forEach(function(n){Object.defineProperty(i,n,Object.getOwnPropertyDescriptor(t,n))})}return i}function nue(i,e){return Zle(i)||Jle(i,e)||sue(i,e)||eue()}function iue(i,e){if(typeof i!="object"||!i)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var n=t.call(i,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function rue(i){var e=iue(i,"string");return typeof e=="symbol"?e:e+""}function hv(i){"@babel/helpers - typeof";return hv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},hv(i)}function sue(i,e){if(i){if(typeof i=="string")return G2(i,e);var t={}.toString.call(i).slice(8,-1);return t==="Object"&&i.constructor&&(t=i.constructor.name),t==="Map"||t==="Set"?Array.from(i):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?G2(i,e):void 0}}var wT=function(e){if(hv(e)!=="object")return e;var t=T3(e);if(t.props){var n;t.props=tue({},t.props),t!=null&&(n=t.props)!==null&&n!==void 0&&n.children&&(t.props.children=Array.isArray(t.props.children)?t.props.children.map(wT):wT(t.props.children))}return t},aue=function(e){return f3(T3(e))},oue=function(e,t){delete t.__k,Kle(wT(e),t)};function lue(i,e){e===void 0&&(e={});var t=e.insertAt;if(!(typeof document>"u")){var n=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",t==="top"&&n.firstChild?n.insertBefore(r,n.firstChild):n.appendChild(r),r.styleSheet?r.styleSheet.cssText=i:r.appendChild(document.createTextNode(i))}}var uue=`.float-tooltip-kap {
  position: absolute;
  width: max-content; /* prevent shrinking near right edge */
  max-width: max(50%, 150px);
  padding: 3px 5px;
  border-radius: 3px;
  font: 12px sans-serif;
  color: #eee;
  background: rgba(0,0,0,0.6);
  pointer-events: none;
}
`;lue(uue);var cue=Pv({props:{content:{default:!1},offsetX:{triggerUpdate:!1},offsetY:{triggerUpdate:!1}},init:function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=n.style,s=r===void 0?{}:r,a=!!e&&hv(e)==="object"&&!!e.node&&typeof e.node=="function",l=Vle(a?e.node():e);l.style("position")==="static"&&l.style("position","relative"),t.tooltipEl=l.append("div").attr("class","float-tooltip-kap"),Object.entries(s).forEach(function(h){var d=nue(h,2),p=d[0],g=d[1];return t.tooltipEl.style(p,g)}),t.tooltipEl.style("left","-10000px").style("display","none");var u="tooltip-".concat(Math.round(Math.random()*1e12));t.mouseInside=!1,l.on("mousemove.".concat(u),function(h){t.mouseInside=!0;var d=Hle(h),p=l.node(),g=p.offsetWidth,y=p.offsetHeight,v=[t.offsetX===null||t.offsetX===void 0?"-".concat(d[0]/g*100,"%"):typeof t.offsetX=="number"?"calc(-50% + ".concat(t.offsetX,"px)"):t.offsetX,t.offsetY===null||t.offsetY===void 0?y>130&&y-d[1]<100?"calc(-100% - 6px)":"21px":typeof t.offsetY=="number"?t.offsetY<0?"calc(-100% - ".concat(Math.abs(t.offsetY),"px)"):"".concat(t.offsetY,"px"):t.offsetY];t.tooltipEl.style("left",d[0]+"px").style("top",d[1]+"px").style("transform","translate(".concat(v.join(","),")")),t.content&&t.tooltipEl.style("display","inline")}),l.on("mouseover.".concat(u),function(){t.mouseInside=!0,t.content&&t.tooltipEl.style("display","inline")}),l.on("mouseout.".concat(u),function(){t.mouseInside=!1,t.tooltipEl.style("display","none")})},update:function(e){e.tooltipEl.style("display",e.content&&e.mouseInside?"inline":"none"),e.content?e.content instanceof HTMLElement?(e.tooltipEl.text(""),e.tooltipEl.append(function(){return e.content})):typeof e.content=="string"?e.tooltipEl.html(e.content):aue(e.content)?(e.tooltipEl.text(""),oue(e.content,e.tooltipEl.node())):(e.tooltipEl.style("display","none"),console.warn("Tooltip content is invalid, skipping.",e.content,e.content.toString())):e.tooltipEl.text("")}});function hue(i,e){e===void 0&&(e={});var t=e.insertAt;if(!(typeof document>"u")){var n=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",t==="top"&&n.firstChild?n.insertBefore(r,n.firstChild):n.appendChild(r),r.styleSheet?r.styleSheet.cssText=i:r.appendChild(document.createTextNode(i))}}var fue=`.scene-nav-info {
  position: absolute;
  bottom: 5px;
  width: 100%;
  text-align: center;
  color: slategrey;
  opacity: 0.7;
  font-size: 10px;
  font-family: sans-serif;
  pointer-events: none;
  user-select: none;
}

.scene-container canvas:focus {
  outline: none;
}`;hue(fue);function RT(i,e){(e==null||e>i.length)&&(e=i.length);for(var t=0,n=Array(e);t<e;t++)n[t]=i[t];return n}function due(i){if(Array.isArray(i))return i}function pue(i){if(Array.isArray(i))return RT(i)}function mue(i,e,t){return(e=Sue(e))in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function gue(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function yue(i,e){var t=i==null?null:typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(t!=null){var n,r,s,a,l=[],u=!0,h=!1;try{if(s=(t=t.call(i)).next,e!==0)for(;!(u=(n=s.call(t)).done)&&(l.push(n.value),l.length!==e);u=!0);}catch(d){h=!0,r=d}finally{try{if(!u&&t.return!=null&&(a=t.return(),Object(a)!==a))return}finally{if(h)throw r}}return l}}function vue(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _ue(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xue(i,e){return due(i)||yue(i,e)||M3(i,e)||vue()}function Jl(i){return pue(i)||gue(i)||M3(i)||_ue()}function bue(i,e){if(typeof i!="object"||!i)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var n=t.call(i,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function Sue(i){var e=bue(i,"string");return typeof e=="symbol"?e:e+""}function M3(i,e){if(i){if(typeof i=="string")return RT(i,e);var t={}.toString.call(i).slice(8,-1);return t==="Object"&&i.constructor&&(t=i.constructor.name),t==="Map"||t==="Set"?Array.from(i):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?RT(i,e):void 0}}var On=window.THREE?window.THREE:{WebGLRenderer:V$,Scene:Ev,PerspectiveCamera:Ui,Raycaster:yO,SRGBColorSpace:Ji,TextureLoader:Y8,Vector2:Le,Vector3:V,Box3:Pu,Color:ot,Mesh:fi,SphereGeometry:Xp,MeshBasicMaterial:na,BackSide:An,Clock:gO},E3=Pv({props:{width:{default:window.innerWidth,onChange:function(e,t,n){isNaN(e)&&(t.width=n)}},height:{default:window.innerHeight,onChange:function(e,t,n){isNaN(e)&&(t.height=n)}},viewOffset:{default:[0,0]},backgroundColor:{default:"#000011"},backgroundImageUrl:{},onBackgroundImageLoaded:{},showNavInfo:{default:!0},skyRadius:{default:5e4},objects:{default:[]},lights:{default:[]},enablePointerInteraction:{default:!0,onChange:function(e,t){t.hoverObj=null,t.tooltip&&t.tooltip.content(null)},triggerUpdate:!1},pointerRaycasterThrottleMs:{default:50,triggerUpdate:!1},lineHoverPrecision:{default:1,triggerUpdate:!1},pointsHoverPrecision:{default:1,triggerUpdate:!1},hoverOrderComparator:{triggerUpdate:!1},hoverFilter:{default:function(){return!0},triggerUpdate:!1},tooltipContent:{triggerUpdate:!1},hoverDuringDrag:{default:!1,triggerUpdate:!1},clickAfterDrag:{default:!1,triggerUpdate:!1},onHover:{default:function(){},triggerUpdate:!1},onClick:{default:function(){},triggerUpdate:!1},onRightClick:{triggerUpdate:!1}},methods:{tick:function(e){if(e.initialised){e.controls.enabled&&e.controls.update&&e.controls.update(Math.min(1,e.clock.getDelta())),e.postProcessingComposer?e.postProcessingComposer.render():e.renderer.render(e.scene,e.camera),e.extraRenderers.forEach(function(a){return a.render(e.scene,e.camera)});var t=+new Date;if(e.enablePointerInteraction&&t-e.lastRaycasterCheck>=e.pointerRaycasterThrottleMs){e.lastRaycasterCheck=t;var n=null;if(e.hoverDuringDrag||!e.isPointerDragging){var r=this.intersectingObjects(e.pointerPos.x,e.pointerPos.y);e.hoverOrderComparator&&r.sort(function(a,l){return e.hoverOrderComparator(a.object,l.object)});var s=r.find(function(a){return e.hoverFilter(a.object)})||null;n=s?s.object:null,e.intersection=s||null}n!==e.hoverObj&&(e.onHover(n,e.hoverObj,e.intersection),e.tooltip.content(n&&tn(e.tooltipContent)(n,e.intersection)||null),e.hoverObj=n)}e.tweenGroup.update()}return this},getPointerPos:function(e){var t=e.pointerPos,n=t.x,r=t.y;return{x:n,y:r}},cameraPosition:function(e,t,n,r){var s=e.camera;if(t&&e.initialised){var a=t,l=n||{x:0,y:0,z:0};if(!r)d(a),p(l);else{var u=Object.assign({},s.position),h=g();e.tweenGroup.add(new B2(u).to(a,r).easing(bu.Quadratic.Out).onUpdate(d).start()),e.tweenGroup.add(new B2(h).to(l,r/3).easing(bu.Quadratic.Out).onUpdate(p).start())}return this}return Object.assign({},s.position,{lookAt:g()});function d(y){var v=y.x,S=y.y,b=y.z;v!==void 0&&(s.position.x=v),S!==void 0&&(s.position.y=S),b!==void 0&&(s.position.z=b)}function p(y){var v=new On.Vector3(y.x,y.y,y.z);e.controls.target?e.controls.target=v:s.lookAt(v)}function g(){return Object.assign(new On.Vector3(0,0,-1e3).applyQuaternion(s.quaternion).add(s.position))}},zoomToFit:function(e){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:10,r=arguments.length,s=new Array(r>3?r-3:0),a=3;a<r;a++)s[a-3]=arguments[a];return this.fitToBbox(this.getBbox.apply(this,s),t,n)},fitToBbox:function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:10,s=e.camera;if(t){var a=new On.Vector3(0,0,0),l=Math.max.apply(Math,Jl(Object.entries(t).map(function(y){var v=xue(y,2),S=v[0],b=v[1];return Math.max.apply(Math,Jl(b.map(function(_){return Math.abs(a[S]-_)})))})))*2,u=(1-r*2/e.height)*s.fov,h=l/Math.atan(u*Math.PI/180),d=h/s.aspect,p=Math.max(h,d);if(p>0){var g=a.clone().sub(s.position).normalize().multiplyScalar(-p);this.cameraPosition(g,a,n)}}return this},getBbox:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){return!0},n=new On.Box3(new On.Vector3(0,0,0),new On.Vector3(0,0,0)),r=e.objects.filter(t);return r.length?(r.forEach(function(s){return n.expandByObject(s)}),Object.assign.apply(Object,Jl(["x","y","z"].map(function(s){return mue({},s,[n.min[s],n.max[s]])})))):null},getScreenCoords:function(e,t,n,r){var s=new On.Vector3(t,n,r);return s.project(this.camera()),{x:(s.x+1)*e.width/2,y:-(s.y-1)*e.height/2}},getSceneCoords:function(e,t,n){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,s=new On.Vector2(t/e.width*2-1,-(n/e.height)*2+1),a=new On.Raycaster;return a.setFromCamera(s,e.camera),Object.assign({},a.ray.at(r,new On.Vector3))},intersectingObjects:function(e,t,n){var r=new On.Vector2(t/e.width*2-1,-(n/e.height)*2+1),s=new On.Raycaster;return s.params.Line.threshold=e.lineHoverPrecision,s.params.Points.threshold=e.pointsHoverPrecision,s.setFromCamera(r,e.camera),s.intersectObjects(e.objects,!0)},renderer:function(e){return e.renderer},scene:function(e){return e.scene},camera:function(e){return e.camera},postProcessingComposer:function(e){return e.postProcessingComposer},controls:function(e){return e.controls},tbControls:function(e){return e.controls}},stateInit:function(){return{scene:new On.Scene,camera:new On.PerspectiveCamera,clock:new On.Clock,tweenGroup:new QI,lastRaycasterCheck:0}},init:function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=n.controlType,s=r===void 0?"trackball":r,a=n.useWebGPU,l=a===void 0?!1:a,u=n.rendererConfig,h=u===void 0?{}:u,d=n.extraRenderers,p=d===void 0?[]:d,g=n.waitForLoadComplete,y=g===void 0?!0:g;e.innerHTML="",e.appendChild(t.container=document.createElement("div")),t.container.className="scene-container",t.container.style.position="relative",t.container.appendChild(t.navInfo=document.createElement("div")),t.navInfo.className="scene-nav-info",t.navInfo.textContent={orbit:"Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan",trackball:"Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan",fly:"WASD: move, R|F: up | down, Q|E: roll, up|down: pitch, left|right: yaw"}[s]||"",t.navInfo.style.display=t.showNavInfo?null:"none",t.tooltip=new cue(t.container),t.pointerPos=new On.Vector2,t.pointerPos.x=-2,t.pointerPos.y=-2,["pointermove","pointerdown"].forEach(function(v){return t.container.addEventListener(v,function(S){if(v==="pointerdown"&&(t.isPointerPressed=!0),!t.isPointerDragging&&S.type==="pointermove"&&(S.pressure>0||t.isPointerPressed)&&(S.pointerType!=="touch"||S.movementX===void 0||[S.movementX,S.movementY].some(function(E){return Math.abs(E)>1}))&&(t.isPointerDragging=!0),t.enablePointerInteraction){var b=_(t.container);t.pointerPos.x=S.pageX-b.left,t.pointerPos.y=S.pageY-b.top}function _(E){var M=E.getBoundingClientRect(),A=window.pageXOffset||document.documentElement.scrollLeft,w=window.pageYOffset||document.documentElement.scrollTop;return{top:M.top+w,left:M.left+A}}},{passive:!0})}),t.container.addEventListener("pointerup",function(v){t.isPointerPressed&&(t.isPointerPressed=!1,!(t.isPointerDragging&&(t.isPointerDragging=!1,!t.clickAfterDrag))&&requestAnimationFrame(function(){v.button===0&&t.onClick(t.hoverObj||null,v,t.intersection),v.button===2&&t.onRightClick&&t.onRightClick(t.hoverObj||null,v,t.intersection)}))},{passive:!0,capture:!0}),t.container.addEventListener("contextmenu",function(v){t.onRightClick&&v.preventDefault()}),t.renderer=new(l?Ase:On.WebGLRenderer)(Object.assign({antialias:!0,alpha:!0},h)),t.renderer.setPixelRatio(Math.min(2,window.devicePixelRatio)),t.container.appendChild(t.renderer.domElement),t.extraRenderers=p,t.extraRenderers.forEach(function(v){v.domElement.style.position="absolute",v.domElement.style.top="0px",v.domElement.style.pointerEvents="none",t.container.appendChild(v.domElement)}),t.postProcessingComposer=new _ae(t.renderer),t.postProcessingComposer.addPass(new xae(t.scene,t.camera)),t.controls=new{trackball:Rse,orbit:Wse,fly:rae}[s](t.camera,t.renderer.domElement),s==="fly"&&(t.controls.movementSpeed=300,t.controls.rollSpeed=Math.PI/6,t.controls.dragToLook=!0),(s==="trackball"||s==="orbit")&&(t.controls.minDistance=.1,t.controls.maxDistance=t.skyRadius,t.controls.addEventListener("start",function(){t.controlsEngaged=!0}),t.controls.addEventListener("change",function(){t.controlsEngaged&&(t.controlsDragging=!0)}),t.controls.addEventListener("end",function(){t.controlsEngaged=!1,t.controlsDragging=!1})),[t.renderer,t.postProcessingComposer].concat(Jl(t.extraRenderers)).forEach(function(v){return v.setSize(t.width,t.height)}),t.camera.aspect=t.width/t.height,t.camera.updateProjectionMatrix(),t.camera.position.z=1e3,t.scene.add(t.skysphere=new On.Mesh),t.skysphere.visible=!1,t.loadComplete=t.scene.visible=!y,window.scene=t.scene},update:function(e,t){if(e.width&&e.height&&(t.hasOwnProperty("width")||t.hasOwnProperty("height"))){var n,r=e.width,s=e.height;e.container.style.width="".concat(r,"px"),e.container.style.height="".concat(s,"px"),[e.renderer,e.postProcessingComposer].concat(Jl(e.extraRenderers)).forEach(function(y){return y.setSize(r,s)}),e.camera.aspect=r/s;var a=e.viewOffset.slice(0,2);a.some(function(y){return y})&&(n=e.camera).setViewOffset.apply(n,[r,s].concat(Jl(a),[r,s])),e.camera.updateProjectionMatrix()}if(t.hasOwnProperty("viewOffset")){var l,u=e.width,h=e.height,d=e.viewOffset.slice(0,2);d.some(function(y){return y})?(l=e.camera).setViewOffset.apply(l,[u,h].concat(Jl(d),[u,h])):e.camera.clearViewOffset()}if(t.hasOwnProperty("skyRadius")&&e.skyRadius&&(e.controls.hasOwnProperty("maxDistance")&&t.skyRadius&&(e.controls.maxDistance=Math.min(e.controls.maxDistance,e.skyRadius)),e.camera.far=e.skyRadius*2.5,e.camera.updateProjectionMatrix(),e.skysphere.geometry=new On.SphereGeometry(e.skyRadius)),t.hasOwnProperty("backgroundColor")){var p=Fh(e.backgroundColor).alpha;p===void 0&&(p=1),e.renderer.setClearColor(new On.Color(Zae(1,e.backgroundColor)),p)}t.hasOwnProperty("backgroundImageUrl")&&(e.backgroundImageUrl?new On.TextureLoader().load(e.backgroundImageUrl,function(y){y.colorSpace=On.SRGBColorSpace,e.skysphere.material=new On.MeshBasicMaterial({map:y,side:On.BackSide}),e.skysphere.visible=!0,e.onBackgroundImageLoaded&&setTimeout(e.onBackgroundImageLoaded),!e.loadComplete&&g()}):(e.skysphere.visible=!1,e.skysphere.material.map=null,!e.loadComplete&&g())),t.hasOwnProperty("showNavInfo")&&(e.navInfo.style.display=e.showNavInfo?null:"none"),t.hasOwnProperty("lights")&&((t.lights||[]).forEach(function(y){return e.scene.remove(y)}),e.lights.forEach(function(y){return e.scene.add(y)})),t.hasOwnProperty("objects")&&((t.objects||[]).forEach(function(y){return e.scene.remove(y)}),e.objects.forEach(function(y){return e.scene.add(y)}));function g(){e.loadComplete=e.scene.visible=!0}}});function Tue(i,e){e===void 0&&(e={});var t=e.insertAt;if(!(typeof document>"u")){var n=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",t==="top"&&n.firstChild?n.insertBefore(r,n.firstChild):n.appendChild(r),r.styleSheet?r.styleSheet.cssText=i:r.appendChild(document.createTextNode(i))}}var Mue=`.graph-info-msg {
  top: 50%;
  width: 100%;
  text-align: center;
  color: lavender;
  opacity: 0.7;
  font-size: 22px;
  position: absolute;
  font-family: Sans-serif;
}

.scene-container .clickable {
  cursor: pointer;
}

.scene-container .grabbable {
  cursor: move;
  cursor: grab;
  cursor: -moz-grab;
  cursor: -webkit-grab;
}

.scene-container .grabbable:active {
  cursor: grabbing;
  cursor: -moz-grabbing;
  cursor: -webkit-grabbing;
}`;Tue(Mue);function CT(i,e){(e==null||e>i.length)&&(e=i.length);for(var t=0,n=Array(e);t<e;t++)n[t]=i[t];return n}function Eue(i){if(Array.isArray(i))return CT(i)}function tm(i,e,t){return(e=Cue(e))in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Aue(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function wue(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function W2(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);e&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(i,r).enumerable})),t.push.apply(t,n)}return t}function _y(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?W2(Object(t),!0).forEach(function(n){tm(i,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):W2(Object(t)).forEach(function(n){Object.defineProperty(i,n,Object.getOwnPropertyDescriptor(t,n))})}return i}function Jv(i){return Eue(i)||Aue(i)||Nue(i)||wue()}function Rue(i,e){if(typeof i!="object"||!i)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var n=t.call(i,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function Cue(i){var e=Rue(i,"string");return typeof e=="symbol"?e:e+""}function Nue(i,e){if(i){if(typeof i=="string")return CT(i,e);var t={}.toString.call(i).slice(8,-1);return t==="Object"&&i.constructor&&(t=i.constructor.name),t==="Map"||t==="Set"?Array.from(i):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?CT(i,e):void 0}}function A3(i,e){var t=new e;return t._destructor&&t._destructor(),{linkProp:function(r){return{default:t[r](),onChange:function(a,l){l[i][r](a)},triggerUpdate:!1}},linkMethod:function(r){return function(s){for(var a=s[i],l=arguments.length,u=new Array(l>1?l-1:0),h=1;h<l;h++)u[h-1]=arguments[h];var d=a[r].apply(a,u);return d===a?this:d}}}}var hS=window.THREE?window.THREE:{AmbientLight:pO,DirectionalLight:dO,REVISION:Hh},Pue=170,w3=A3("forceGraph",iB),Due=Object.assign.apply(Object,Jv(["jsonUrl","graphData","numDimensions","dagMode","dagLevelDistance","dagNodeFilter","onDagError","nodeRelSize","nodeId","nodeVal","nodeResolution","nodeColor","nodeAutoColorBy","nodeOpacity","nodeVisibility","nodeThreeObject","nodeThreeObjectExtend","nodePositionUpdate","linkSource","linkTarget","linkVisibility","linkColor","linkAutoColorBy","linkOpacity","linkWidth","linkResolution","linkCurvature","linkCurveRotation","linkMaterial","linkThreeObject","linkThreeObjectExtend","linkPositionUpdate","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution","forceEngine","d3AlphaDecay","d3VelocityDecay","d3AlphaMin","ngraphPhysics","warmupTicks","cooldownTicks","cooldownTime","onEngineTick","onEngineStop"].map(function(i){return tm({},i,w3.linkProp(i))}))),Lue=Object.assign.apply(Object,Jv(["refresh","getGraphBbox","d3Force","d3ReheatSimulation","emitParticle"].map(function(i){return tm({},i,w3.linkMethod(i))}))),By=A3("renderObjs",E3),Uue=Object.assign.apply(Object,Jv(["width","height","backgroundColor","showNavInfo","enablePointerInteraction"].map(function(i){return tm({},i,By.linkProp(i))}))),Oue=Object.assign.apply(Object,Jv(["lights","cameraPosition","postProcessingComposer"].map(function(i){return tm({},i,By.linkMethod(i))})).concat([{graph2ScreenCoords:By.linkMethod("getScreenCoords"),screen2GraphCoords:By.linkMethod("getSceneCoords")}])),Bue=Pv({props:_y(_y({nodeLabel:{default:"name",triggerUpdate:!1},linkLabel:{default:"name",triggerUpdate:!1},linkHoverPrecision:{default:1,onChange:function(e,t){return t.renderObjs.lineHoverPrecision(e)},triggerUpdate:!1},enableNavigationControls:{default:!0,onChange:function(e,t){var n=t.renderObjs.controls();n&&(n.enabled=e,e&&n.domElement&&n.domElement.dispatchEvent(new PointerEvent("pointerup")))},triggerUpdate:!1},enableNodeDrag:{default:!0,triggerUpdate:!1},onNodeDrag:{default:function(){},triggerUpdate:!1},onNodeDragEnd:{default:function(){},triggerUpdate:!1},onNodeClick:{triggerUpdate:!1},onNodeRightClick:{triggerUpdate:!1},onNodeHover:{triggerUpdate:!1},onLinkClick:{triggerUpdate:!1},onLinkRightClick:{triggerUpdate:!1},onLinkHover:{triggerUpdate:!1},onBackgroundClick:{triggerUpdate:!1},onBackgroundRightClick:{triggerUpdate:!1}},Due),Uue),methods:_y(_y({zoomToFit:function(e,t,n){for(var r,s=arguments.length,a=new Array(s>3?s-3:0),l=3;l<s;l++)a[l-3]=arguments[l];return e.renderObjs.fitToBbox((r=e.forceGraph).getGraphBbox.apply(r,a),t,n),this},pauseAnimation:function(e){return e.animationFrameRequestId!==null&&(cancelAnimationFrame(e.animationFrameRequestId),e.animationFrameRequestId=null),this},resumeAnimation:function(e){return e.animationFrameRequestId===null&&this._animationCycle(),this},_animationCycle:function(e){e.enablePointerInteraction&&(this.renderer().domElement.style.cursor=null),e.forceGraph.tickFrame(),e.renderObjs.tick(),e.animationFrameRequestId=requestAnimationFrame(this._animationCycle)},scene:function(e){return e.renderObjs.scene()},camera:function(e){return e.renderObjs.camera()},renderer:function(e){return e.renderObjs.renderer()},controls:function(e){return e.renderObjs.controls()},tbControls:function(e){return e.renderObjs.tbControls()},_destructor:function(){this.pauseAnimation(),this.graphData({nodes:[],links:[]})}},Lue),Oue),stateInit:function(e){var t=e.controlType,n=e.rendererConfig,r=e.extraRenderers,s=new iB;return{forceGraph:s,renderObjs:E3({controlType:t,rendererConfig:n,extraRenderers:r}).objects([s]).lights([new hS.AmbientLight(13421772,Math.PI),new hS.DirectionalLight(16777215,.6*Math.PI)])}},init:function(e,t){e.innerHTML="",e.appendChild(t.container=document.createElement("div")),t.container.style.position="relative";var n=document.createElement("div");t.container.appendChild(n),t.renderObjs(n);var r=t.renderObjs.camera(),s=t.renderObjs.renderer(),a=t.renderObjs.controls();a.enabled=!!t.enableNavigationControls,t.lastSetCameraZ=r.position.z;var l;t.container.appendChild(l=document.createElement("div")),l.className="graph-info-msg",l.textContent="",t.forceGraph.onLoading(function(){l.textContent="Loading..."}).onFinishLoading(function(){l.textContent=""}).onUpdate(function(){t.graphData=t.forceGraph.graphData(),r.position.x===0&&r.position.y===0&&r.position.z===t.lastSetCameraZ&&t.graphData.nodes.length&&(r.lookAt(t.forceGraph.position),t.lastSetCameraZ=r.position.z=Math.cbrt(t.graphData.nodes.length)*Pue)}).onFinishUpdate(function(){if(t._dragControls){var u=t.graphData.nodes.find(function(d){return d.__initialFixedPos&&!d.__disposeControlsAfterDrag});u?u.__disposeControlsAfterDrag=!0:t._dragControls.dispose(),t._dragControls=void 0}if(t.enableNodeDrag&&t.enablePointerInteraction&&t.forceEngine==="d3"){var h=t._dragControls=new G$(t.graphData.nodes.map(function(d){return d.__threeObj}).filter(function(d){return d}),r,s.domElement);h.addEventListener("dragstart",function(d){var p=ja(d.object);if(p){a.enabled=!1,d.object.__initialPos=d.object.position.clone(),d.object.__prevPos=d.object.position.clone();var g=p.__data;!g.__initialFixedPos&&(g.__initialFixedPos={fx:g.fx,fy:g.fy,fz:g.fz}),!g.__initialPos&&(g.__initialPos={x:g.x,y:g.y,z:g.z}),["x","y","z"].forEach(function(y){return g["f".concat(y)]=g[y]}),s.domElement.classList.add("grabbable")}}),h.addEventListener("drag",function(d){var p=ja(d.object);if(p){if(!d.object.hasOwnProperty("__graphObjType")){var g=d.object.__initialPos,y=d.object.__prevPos,v=d.object.position;p.position.add(v.clone().sub(y)),y.copy(v),v.copy(g)}var S=p.__data,b=p.position,_={x:b.x-S.x,y:b.y-S.y,z:b.z-S.z};["x","y","z"].forEach(function(E){return S["f".concat(E)]=S[E]=b[E]}),t.forceGraph.d3AlphaTarget(.3).resetCountdown(),S.__dragged=!0,t.onNodeDrag(S,_)}}),h.addEventListener("dragend",function(d){var p=ja(d.object);if(p){delete d.object.__initialPos,delete d.object.__prevPos;var g=p.__data;g.__disposeControlsAfterDrag&&(h.dispose(),delete g.__disposeControlsAfterDrag);var y=g.__initialFixedPos,v=g.__initialPos,S={x:v.x-g.x,y:v.y-g.y,z:v.z-g.z};y&&(["x","y","z"].forEach(function(b){var _="f".concat(b);y[_]===void 0&&delete g[_]}),delete g.__initialFixedPos,delete g.__initialPos,g.__dragged&&(delete g.__dragged,t.onNodeDragEnd(g,S))),t.forceGraph.d3AlphaTarget(0).resetCountdown(),t.enableNavigationControls&&(a.enabled=!0,a.domElement&&a.domElement.ownerDocument&&a.domElement.ownerDocument.dispatchEvent(new PointerEvent("pointerup",{pointerType:"touch"}))),s.domElement.classList.remove("grabbable")}})}}),hS.REVISION<155&&(t.renderObjs.renderer().useLegacyLights=!1),t.renderObjs.hoverOrderComparator(function(u,h){var d=ja(u);if(!d)return 1;var p=ja(h);if(!p)return-1;var g=function(v){return v.__graphObjType==="node"};return g(p)-g(d)}).tooltipContent(function(u){var h=ja(u);return h&&tn(t["".concat(h.__graphObjType,"Label")])(h.__data)||""}).hoverDuringDrag(!1).onHover(function(u){var h=ja(u);if(h!==t.hoverObj){var d=t.hoverObj?t.hoverObj.__graphObjType:null,p=t.hoverObj?t.hoverObj.__data:null,g=h?h.__graphObjType:null,y=h?h.__data:null;if(d&&d!==g){var v=t["on".concat(d==="node"?"Node":"Link","Hover")];v&&v(null,p)}if(g){var S=t["on".concat(g==="node"?"Node":"Link","Hover")];S&&S(y,d===g?p:null)}s.domElement.classList[h&&t["on".concat(g==="node"?"Node":"Link","Click")]||!h&&t.onBackgroundClick?"add":"remove"]("clickable"),t.hoverObj=h}}).clickAfterDrag(!1).onClick(function(u,h){var d=ja(u);if(d){var p=t["on".concat(d.__graphObjType==="node"?"Node":"Link","Click")];p&&p(d.__data,h)}else t.onBackgroundClick&&t.onBackgroundClick(h)}).onRightClick(function(u,h){var d=ja(u);if(d){var p=t["on".concat(d.__graphObjType==="node"?"Node":"Link","RightClick")];p&&p(d.__data,h)}else t.onBackgroundRightClick&&t.onBackgroundRightClick(h)}),this._animationCycle()}});function ja(i){for(var e=i;e&&!e.hasOwnProperty("__graphObjType");)e=e.parent;return e}var fS={exports:{}},dS,j2;function Iue(){if(j2)return dS;j2=1;var i="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return dS=i,dS}var pS,q2;function Fue(){if(q2)return pS;q2=1;var i=Iue();function e(){}function t(){}return t.resetWarningCache=e,pS=function(){function n(a,l,u,h,d,p){if(p!==i){var g=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw g.name="Invariant Violation",g}}n.isRequired=n;function r(){return n}var s={array:n,bigint:n,bool:n,func:n,number:n,object:n,string:n,symbol:n,any:n,arrayOf:r,element:n,elementType:n,instanceOf:r,node:n,objectOf:r,oneOf:r,oneOfType:r,shape:r,exact:r,checkPropTypes:t,resetWarningCache:e};return s.PropTypes=s,s},pS}var $2;function kue(){return $2||($2=1,fS.exports=Fue()()),fS.exports}var zue=kue();const ee=Up(zue),e_={width:ee.number,height:ee.number,graphData:ee.shape({nodes:ee.arrayOf(ee.object).isRequired,links:ee.arrayOf(ee.object).isRequired}),backgroundColor:ee.string,nodeRelSize:ee.number,nodeId:ee.string,nodeLabel:ee.oneOfType([ee.string,ee.func]),nodeVal:ee.oneOfType([ee.number,ee.string,ee.func]),nodeVisibility:ee.oneOfType([ee.bool,ee.string,ee.func]),nodeColor:ee.oneOfType([ee.string,ee.func]),nodeAutoColorBy:ee.oneOfType([ee.string,ee.func]),onNodeHover:ee.func,onNodeClick:ee.func,linkSource:ee.string,linkTarget:ee.string,linkLabel:ee.oneOfType([ee.string,ee.func]),linkVisibility:ee.oneOfType([ee.bool,ee.string,ee.func]),linkColor:ee.oneOfType([ee.string,ee.func]),linkAutoColorBy:ee.oneOfType([ee.string,ee.func]),linkWidth:ee.oneOfType([ee.number,ee.string,ee.func]),linkCurvature:ee.oneOfType([ee.number,ee.string,ee.func]),linkDirectionalArrowLength:ee.oneOfType([ee.number,ee.string,ee.func]),linkDirectionalArrowColor:ee.oneOfType([ee.string,ee.func]),linkDirectionalArrowRelPos:ee.oneOfType([ee.number,ee.string,ee.func]),linkDirectionalParticles:ee.oneOfType([ee.number,ee.string,ee.func]),linkDirectionalParticleSpeed:ee.oneOfType([ee.number,ee.string,ee.func]),linkDirectionalParticleWidth:ee.oneOfType([ee.number,ee.string,ee.func]),linkDirectionalParticleColor:ee.oneOfType([ee.string,ee.func]),onLinkHover:ee.func,onLinkClick:ee.func,dagMode:ee.oneOf(["td","bu","lr","rl","zin","zout","radialin","radialout"]),dagLevelDistance:ee.number,dagNodeFilter:ee.func,onDagError:ee.func,d3AlphaMin:ee.number,d3AlphaDecay:ee.number,d3VelocityDecay:ee.number,warmupTicks:ee.number,cooldownTicks:ee.number,cooldownTime:ee.number,onEngineTick:ee.func,onEngineStop:ee.func,getGraphBbox:ee.func},R3={zoomToFit:ee.func,onNodeRightClick:ee.func,onNodeDrag:ee.func,onNodeDragEnd:ee.func,onLinkRightClick:ee.func,linkHoverPrecision:ee.number,onBackgroundClick:ee.func,onBackgroundRightClick:ee.func,enablePointerInteraction:ee.bool,enableNodeDrag:ee.bool},ZE={showNavInfo:ee.bool,nodeOpacity:ee.number,nodeResolution:ee.number,nodeThreeObject:ee.oneOfType([ee.object,ee.string,ee.func]),nodeThreeObjectExtend:ee.oneOfType([ee.bool,ee.string,ee.func]),nodePositionUpdate:ee.func,linkOpacity:ee.number,linkResolution:ee.number,linkCurveRotation:ee.oneOfType([ee.number,ee.string,ee.func]),linkMaterial:ee.oneOfType([ee.object,ee.string,ee.func]),linkThreeObject:ee.oneOfType([ee.object,ee.string,ee.func]),linkThreeObjectExtend:ee.oneOfType([ee.bool,ee.string,ee.func]),linkPositionUpdate:ee.func,linkDirectionalArrowResolution:ee.number,linkDirectionalParticleResolution:ee.number,forceEngine:ee.oneOf(["d3","ngraph"]),ngraphPhysics:ee.object,numDimensions:ee.oneOf([1,2,3])};Object.assign({},e_,R3,{linkLineDash:ee.oneOfType([ee.arrayOf(ee.number),ee.string,ee.func]),nodeCanvasObjectMode:ee.oneOfType([ee.string,ee.func]),nodeCanvasObject:ee.func,nodePointerAreaPaint:ee.func,linkCanvasObjectMode:ee.oneOfType([ee.string,ee.func]),linkCanvasObject:ee.func,linkPointerAreaPaint:ee.func,autoPauseRedraw:ee.bool,minZoom:ee.number,maxZoom:ee.number,enableZoomInteraction:ee.oneOfType([ee.bool,ee.func]),enablePanInteraction:ee.oneOfType([ee.bool,ee.func]),onZoom:ee.func,onZoomEnd:ee.func,onRenderFramePre:ee.func,onRenderFramePost:ee.func});const Vue=Object.assign({},e_,R3,ZE,{enableNavigationControls:ee.bool,controlType:ee.oneOf(["trackball","orbit","fly"]),rendererConfig:ee.object,extraRenderers:ee.arrayOf(ee.shape({render:ee.func.isRequired}))});Object.assign({},e_,ZE,{nodeDesc:ee.oneOfType([ee.string,ee.func]),linkDesc:ee.oneOfType([ee.string,ee.func])});Object.assign({},e_,ZE,{markerAttrs:ee.object,yOffset:ee.number,glScale:ee.number});const QE=n6(Bue,{methodNames:["emitParticle","d3Force","d3ReheatSimulation","stopAnimation","pauseAnimation","resumeAnimation","cameraPosition","zoomToFit","getGraphBbox","screen2GraphCoords","graph2ScreenCoords","postProcessingComposer","lights","scene","camera","renderer","controls","refresh"],initPropNames:["controlType","rendererConfig","extraRenderers"]});QE.displayName="ForceGraph3D";QE.propTypes=Vue;function NT(i,e){(e==null||e>i.length)&&(e=i.length);for(var t=0,n=Array(e);t<e;t++)n[t]=i[t];return n}function Gue(i){if(Array.isArray(i))return i}function Hue(i){if(Array.isArray(i))return NT(i)}function Wue(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function jue(i,e,t){return e=fv(e),ece(i,C3()?Reflect.construct(e,t||[],fv(i).constructor):e.apply(i,t))}function que(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function $ue(i,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,nce(n.key),n)}}function Xue(i,e,t){return e&&$ue(i.prototype,e),Object.defineProperty(i,"prototype",{writable:!1}),i}function fv(i){return fv=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},fv(i)}function Yue(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(e&&e.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Object.defineProperty(i,"prototype",{writable:!1}),e&&PT(i,e)}function C3(){try{var i=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(C3=function(){return!!i})()}function Kue(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function Zue(i,e){var t=i==null?null:typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(t!=null){var n,r,s,a,l=[],u=!0,h=!1;try{if(s=(t=t.call(i)).next,e===0){if(Object(t)!==t)return;u=!1}else for(;!(u=(n=s.call(t)).done)&&(l.push(n.value),l.length!==e);u=!0);}catch(d){h=!0,r=d}finally{try{if(!u&&t.return!=null&&(a=t.return(),Object(a)!==a))return}finally{if(h)throw r}}return l}}function Que(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Jue(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ece(i,e){if(e&&(typeof e=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Wue(i)}function PT(i,e){return PT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t},PT(i,e)}function X2(i,e){return Gue(i)||Zue(i,e)||N3(i,e)||Que()}function xy(i){return Hue(i)||Kue(i)||N3(i)||Jue()}function tce(i,e){if(typeof i!="object"||!i)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var n=t.call(i,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(i)}function nce(i){var e=tce(i,"string");return typeof e=="symbol"?e:e+""}function N3(i,e){if(i){if(typeof i=="string")return NT(i,e);var t={}.toString.call(i).slice(8,-1);return t==="Object"&&i.constructor&&(t=i.constructor.name),t==="Map"||t==="Set"?Array.from(i):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?NT(i,e):void 0}}var Md=typeof window<"u"&&window.THREE?window.THREE:{CanvasTexture:b8,Sprite:d8,SpriteMaterial:YM,SRGBColorSpace:Ji},ice=function(i){function e(){var t,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:10,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"rgba(255, 255, 255, 1)";return que(this,e),t=jue(this,e,[new Md.SpriteMaterial]),t._text="".concat(n),t._textHeight=r,t._color=s,t._backgroundColor=!1,t._padding=0,t._borderWidth=0,t._borderRadius=0,t._borderColor="white",t._strokeWidth=0,t._strokeColor="white",t._fontFace="system-ui",t._fontSize=90,t._fontWeight="normal",t._canvas=document.createElement("canvas"),t._genCanvas(),t}return Yue(e,i),Xue(e,[{key:"text",get:function(){return this._text},set:function(n){this._text=n,this._genCanvas()}},{key:"textHeight",get:function(){return this._textHeight},set:function(n){this._textHeight=n,this._genCanvas()}},{key:"color",get:function(){return this._color},set:function(n){this._color=n,this._genCanvas()}},{key:"backgroundColor",get:function(){return this._backgroundColor},set:function(n){this._backgroundColor=n,this._genCanvas()}},{key:"padding",get:function(){return this._padding},set:function(n){this._padding=n,this._genCanvas()}},{key:"borderWidth",get:function(){return this._borderWidth},set:function(n){this._borderWidth=n,this._genCanvas()}},{key:"borderRadius",get:function(){return this._borderRadius},set:function(n){this._borderRadius=n,this._genCanvas()}},{key:"borderColor",get:function(){return this._borderColor},set:function(n){this._borderColor=n,this._genCanvas()}},{key:"fontFace",get:function(){return this._fontFace},set:function(n){this._fontFace=n,this._genCanvas()}},{key:"fontSize",get:function(){return this._fontSize},set:function(n){this._fontSize=n,this._genCanvas()}},{key:"fontWeight",get:function(){return this._fontWeight},set:function(n){this._fontWeight=n,this._genCanvas()}},{key:"strokeWidth",get:function(){return this._strokeWidth},set:function(n){this._strokeWidth=n,this._genCanvas()}},{key:"strokeColor",get:function(){return this._strokeColor},set:function(n){this._strokeColor=n,this._genCanvas()}},{key:"_genCanvas",value:function(){var n=this,r=this._canvas,s=r.getContext("2d"),a=1/this.textHeight,l=Array.isArray(this.borderWidth)?this.borderWidth:[this.borderWidth,this.borderWidth],u=l.map(function(L){return L*n.fontSize*a}),h=Array.isArray(this.borderRadius)?this.borderRadius:[this.borderRadius,this.borderRadius,this.borderRadius,this.borderRadius],d=h.map(function(L){return L*n.fontSize*a}),p=Array.isArray(this.padding)?this.padding:[this.padding,this.padding],g=p.map(function(L){return L*n.fontSize*a}),y=this.text.split(`
`),v="".concat(this.fontWeight," ").concat(this.fontSize,"px ").concat(this.fontFace);s.font=v;var S=Math.max.apply(Math,xy(y.map(function(L){return s.measureText(L).width}))),b=this.fontSize*y.length;if(r.width=S+u[0]*2+g[0]*2,r.height=b+u[1]*2+g[1]*2,this.borderWidth){if(s.strokeStyle=this.borderColor,u[0]){var _=u[0]/2;s.lineWidth=u[0],s.beginPath(),s.moveTo(_,d[0]),s.lineTo(_,r.height-d[3]),s.moveTo(r.width-_,d[1]),s.lineTo(r.width-_,r.height-d[2]),s.stroke()}if(u[1]){var E=u[1]/2;s.lineWidth=u[1],s.beginPath(),s.moveTo(Math.max(u[0],d[0]),E),s.lineTo(r.width-Math.max(u[0],d[1]),E),s.moveTo(Math.max(u[0],d[3]),r.height-E),s.lineTo(r.width-Math.max(u[0],d[2]),r.height-E),s.stroke()}if(this.borderRadius){var M=Math.max.apply(Math,xy(u)),A=M/2;s.lineWidth=M,s.beginPath(),[!!d[0]&&[d[0],A,A,d[0]],!!d[1]&&[r.width-d[1],r.width-A,A,d[1]],!!d[2]&&[r.width-d[2],r.width-A,r.height-A,r.height-d[2]],!!d[3]&&[d[3],A,r.height-A,r.height-d[3]]].filter(function(L){return L}).forEach(function(L){var N=X2(L,4),D=N[0],I=N[1],W=N[2],Y=N[3];s.moveTo(D,W),s.quadraticCurveTo(I,W,I,Y)}),s.stroke()}}this.backgroundColor&&(s.fillStyle=this.backgroundColor,this.borderRadius?(s.beginPath(),s.moveTo(u[0],d[0]),[[u[0],d[0],r.width-d[1],u[1],u[1],u[1]],[r.width-u[0],r.width-u[0],r.width-u[0],u[1],d[1],r.height-d[2]],[r.width-u[0],r.width-d[2],d[3],r.height-u[1],r.height-u[1],r.height-u[1]],[u[0],u[0],u[0],r.height-u[1],r.height-d[3],d[0]]].forEach(function(L){var N=X2(L,6),D=N[0],I=N[1],W=N[2],Y=N[3],oe=N[4],le=N[5];s.quadraticCurveTo(D,Y,I,oe),s.lineTo(W,le)}),s.closePath(),s.fill()):s.fillRect(u[0],u[1],r.width-u[0]*2,r.height-u[1]*2)),s.translate.apply(s,xy(u)),s.translate.apply(s,xy(g)),s.font=v,s.fillStyle=this.color,s.textBaseline="bottom";var w=this.strokeWidth>0;w&&(s.lineWidth=this.strokeWidth*this.fontSize/10,s.strokeStyle=this.strokeColor),y.forEach(function(L,N){var D=(S-s.measureText(L).width)/2,I=(N+1)*n.fontSize;w&&s.strokeText(L,D,I),s.fillText(L,D,I)}),this.material.map&&this.material.map.dispose();var R=this.material.map=new Md.CanvasTexture(r);R.colorSpace=Md.SRGBColorSpace;var C=this.textHeight*y.length+l[1]*2+p[1]*2;this.scale.set(C*r.width/r.height,C,0)}},{key:"clone",value:function(){return new this.constructor(this.text,this.textHeight,this.color).copy(this)}},{key:"copy",value:function(n){return Md.Sprite.prototype.copy.call(this,n),this.color=n.color,this.backgroundColor=n.backgroundColor,this.padding=n.padding,this.borderWidth=n.borderWidth,this.borderColor=n.borderColor,this.fontFace=n.fontFace,this.fontSize=n.fontSize,this.fontWeight=n.fontWeight,this.strokeWidth=n.strokeWidth,this.strokeColor=n.strokeColor,this}}])}(Md.Sprite);const rce={nodes:[{id:"Mind",group:0,description:"The central node"},{id:"MAC",group:1,description:"A research framework exploring post-postmodern phenomena and the shaping of post-human culture, society, and education through artistic practice, digital resistance, and ethical design."},{id:"Interfacial Thinking",group:1,description:"Treating interfaces as spaces of cultural negotiation — where meaning, structure, and identity are enacted."},{id:"Languages",group:1,description:"Where linguistic fluency and computational fluency meet: human languages, programming languages, and the patterns they shape in thought."},{id:"Experiments",group:1,description:"Prototypes, essays, and creative outputs."},{id:"Research",group:1,description:"My inquiries, frameworks, and what I question, test, or want to reimagine."},{id:"Poetic UX",group:2,description:"Interfaces that spark emotion, reflection, and calm — poetic not just in content, but in how they care, support, and resonate."},{id:"Multimodal",group:2,description:"Working across text, sound, visuals, interaction, and motion."},{id:"Cultural Code",group:2,description:"Code as memory, identity, and resistance shaped by who writes it, and for whom."},{id:"Synesthetic Design",group:2,description:"Translating between senses — from sound to color, language to motion, feeling to interface."},{id:"Ethical Aesthetics",group:2,description:"Design guided by care, consent, and context — where aesthetics carry responsibility."},{id:"Conversational Interfaces",group:3,description:"Designing systems for written and spoken interaction — accessible, emotional, human."},{id:"Language Models as Collaborators",group:3,description:"Working with AI as creative colleagues."},{id:"Embedded Interaction",group:3,description:"Interfaces embedded in bodies, lives, and routines."},{id:"Visual Narratives",group:3,description:"Stories told through structure, space, and motion — meaning made visual."},{id:"Voice UI",group:3,description:"Voice as input and output — accessible, affective, and immediate."},{id:"Text-to-Feeling Translation",group:3,description:"Systems that turn language into emotion, visuals, or sensation — bridging meaning and affect."},{id:"Hungarian",group:4,description:"Mother tongue - language of emotion, memory, and intimacy."},{id:"Italian",group:4,description:"Language of  aesthetic nuance and emotional expression."},{id:"English",group:4,description:"Language of research, connection, and global discourse."},{id:"HTML & CSS",group:4,description:"Structure and surface of the web."},{id:"JavaScript",group:4,description:"Logical, chaotic, poetic."},{id:"Vue & React",group:4,description:"My expressive frontend frameworks."},{id:"GlucoLogs",group:5,description:"A tool for diabetics — blending glucose tracking, reflection, and ethical data management."},{id:"Hymn of Resistance",group:5,description:"A multilingual, multisensory digital poem — music, movement, and protest as interface."},{id:"Vocabulary of Resistance",group:5,description:'A map exploring vocabulary connected to the word "resistance".'},{id:"Towards a Grammar of Resistance",group:5,description:"The theoretical foundation of MAC — an academic paper."},{id:"Learn to Resist",group:5,description:"A reflection on post-human education."},{id:"The First Cyborgs",group:5,description:"A poetic-critical essay on diabetes tech, exploitative devices, and cyberbodily autonomy."},{id:"Ada Lovelace",group:5,description:"A storytelling website and chatbot — about the birth of algorithms."},{id:"Wearable Paintings",group:6,description:"Hand-painted, upcycled clothing."},{id:"Patches & Ceramics",group:6,description:"Small crafted pieces —  stitched patches, hand-glazed clay."},{id:"Knits & Crochets",group:6,description:"Loops — warmth and handmade garments."},{id:"Collage & Drawing",group:6,description:"Analog storytelling — layering memory, media, and form."},{id:"Interactive Collage Book",group:6,description:'A physical book entitled "Holiday to the Moon."'},{id:"Scotty",group:6,description:"My four-legged sidekick — the one closest to my heart."},{id:"✶",group:99,decorative:!0},{id:"∞",group:99,decorative:!0},{id:"↺",group:99,decorative:!0},{id:"夢",group:99,decorative:!0},{id:"♡",group:99,decorative:!0},{id:"✶",group:99,decorative:!0},{id:"∞",group:99,decorative:!0},{id:"↺",group:99,decorative:!0},{id:"夢",group:99,decorative:!0},{id:"♡",group:99,decorative:!0},{id:"✶",group:99,decorative:!0},{id:"∞",group:99,decorative:!0},{id:"↺",group:99,decorative:!0},{id:"夢",group:99,decorative:!0},{id:"♡",group:99,decorative:!0},{id:"✶",group:99,decorative:!0},{id:"∞",group:99,decorative:!0},{id:"↺",group:99,decorative:!0},{id:"夢",group:99,decorative:!0},{id:"♡",group:99,decorative:!0}],links:[{source:"Mind",target:"MAC"},{source:"Mind",target:"Interfacial Thinking"},{source:"Mind",target:"Languages"},{source:"Mind",target:"Experiments"},{source:"Mind",target:"Research"},{source:"MAC",target:"Poetic UX"},{source:"MAC",target:"Ethical Aesthetics"},{source:"MAC",target:"Cultural Code"},{source:"MAC",target:"Text-to-Feeling Translation"},{source:"Interfacial Thinking",target:"Voice UI"},{source:"Interfacial Thinking",target:"Conversational Interfaces"},{source:"Interfacial Thinking",target:"Visual Narratives"},{source:"Languages",target:"Hungarian"},{source:"Languages",target:"Italian"},{source:"Languages",target:"English"},{source:"Languages",target:"HTML & CSS"},{source:"Languages",target:"JavaScript"},{source:"Languages",target:"Vue & React"},{source:"Experiments",target:"GlucoLogs"},{source:"Experiments",target:"Hymn of Resistance"},{source:"Experiments",target:"Ada Lovelace"},{source:"Research",target:"Towards a Grammar of Resistance"},{source:"Research",target:"Learn to Resist"},{source:"Research",target:"The First Cyborgs"},{source:"Research",target:"Vocabulary of Resistance"},{source:"Scotty",target:"Mind"},{source:"Poetic UX",target:"Synesthetic Design"},{source:"Multimodal",target:"Visual Narratives"}]};function sce(){const i=fe.useRef(),{lang:e}=kU(),t=iL();fe.useEffect(()=>{i.current&&i.current.cameraPosition({x:0,y:0,z:300},{x:0,y:0,z:0},3e3)},[]);const n={GlucoReflect:"glucologs","Ada Lovelace":"ada-lovelace-storytelling","Vocabulary of Resistance":"vocabulary-of-resistance","Towards a Grammar of Resistance":"grammar-of-resistance","Hymn of Resistance":"hymn-of-resistance",Brainmap:"brainmap"},r=l=>{const u=n[l.id];u?t(`/projects/${u}`):new Audio("/sounds/chime.mp3").play()},s=l=>{var h,d;const u=(d=(h=zS[e])==null?void 0:h.nodes)==null?void 0:d[l.id];return(u==null?void 0:u.description)||l.description},a=l=>{var h,d;const u=(d=(h=zS[e])==null?void 0:h.nodes)==null?void 0:d[l.id];return(u==null?void 0:u.id)||l.id};return _e.jsx("div",{className:"w-full h-full font-thin pointer-events-auto",children:_e.jsx(QE,{ref:i,graphData:rce,backgroundColor:"#220340",nodeLabel:s,nodeAutoColorBy:"group",linkDirectionalParticles:2e3,linkColor:l=>l.source.id==="Mind"?"#c084fc":"#444",enableNodeDrag:!0,cooldownTicks:1e3,onEngineStop:()=>i.current.zoomToFit(400),onNodeClick:r,onNodeHover:l=>{document.body.style.cursor=l?"pointer":"default"},nodeThreeObject:l=>{const u=new ice(a(l));return u.color=l.id==="Mind"?"#c084fc":"#eae6dc",u.textHeight=7,u.fontWeight="normal",u.fontFace="monospace",u.borderRadius=4,u}})})}const ace=[{year:"2015",label:"BA in English and Portuguese Studies, ELTE & NOVA"},{year:"2018",label:"MA in Language Education (EN & HU), ELTE"},{year:"2022",label:"MA in Digital Humanities and Digital Knowledge, UniBo"},{year:"2023",label:"IT Specialist at Allnet Italia"},{year:"2024",label:"Research Fellow, DARE Project (UniBo)"},{year:"2025",label:"Independent research on Multilingual Artistic Code (MAC)"}],oce=["HTML & CSS","JavaScript","Vue","React","TailwindCSS","BootStrap","GSAP","Three.js","APIs","Github","SQL","Webflow","WordPress","Figma","Photoshop","Canva","Blender","ChatGPT","LeonardoAI"];function lce(){return _e.jsxs(fr.section,{initial:{opacity:0,y:80},whileInView:{opacity:1,y:0},transition:{duration:1,ease:"easeOut"},viewport:{once:!0},className:"w-full bg-blackish text-bone",children:[_e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[80vh] px-6 py-20 text-center sm:px-12",children:[_e.jsx(fr.h2,{className:"mb-6 text-4xl md:text-6xl text-electric poetic-heading",children:"About"}),_e.jsx("p",{className:"max-w-2xl mb-4 text-lg leading-relaxed text-justify",children:"I believe the most meaningful work happens between disciplines — where code, culture, language, and design intersect."}),_e.jsx("p",{className:"max-w-2xl text-lg leading-relaxed text-justify",children:"My background spans frontend development, digital humanities, and language education, convinced that real knowledge is inherently interdisciplinary."})]}),_e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[80vh] px-6 py-5 text-left sm:px-5",children:[_e.jsx("h3",{className:"mb-6 text-2xl font-semibold text-electric",children:"Timeline"}),_e.jsx("div",{className:"w-full max-w-md pl-6 space-y-4 border-l border-electric",children:ace.map((i,e)=>_e.jsx(fr.div,{className:"relative",initial:{opacity:0,x:-20},whileInView:{opacity:1,x:0},transition:{delay:e*.1,duration:.6},viewport:{once:!0},children:_e.jsxs("p",{className:"font-mono text-sm text-bone/80",children:[_e.jsx("span",{className:"font-semibold text-bone",children:i.year})," — ",i.label]})},e))})]}),_e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[80vh] px-6 py-20 text-center sm:px-12",children:[_e.jsx("p",{className:"max-w-2xl mb-4 text-lg leading-relaxed text-justify",children:"I aim to create interfaces and experiences that are technically precise and culturally impactful: tools that bridge boundaries, educate, and inspire."}),_e.jsx("p",{className:"max-w-2xl mb-4 text-lg leading-relaxed text-justify",children:"I work best in inclusive, flexible teams that value creativity and critical thinking. Whether research or design, I build digital spaces for care and clarity."}),_e.jsx("p",{className:"max-w-2xl text-lg font-thin leading-relaxed text-justify",children:"In the long run, I want to rethink how we engage with language, culture, and technology  through research, art, and expressive code."})]}),_e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[80vh] px-6 py-5 text-center sm:px-12",children:[_e.jsx("h3",{className:"mb-4 text-xl font-semibold text-electric",children:"Tools I like"}),_e.jsx("div",{className:"flex flex-wrap justify-center max-w-3xl gap-2",children:oce.map((i,e)=>_e.jsx(fr.span,{className:"px-3 py-2 m-1 font-mono text-sm text-bone border-electric tooltip-float","data-tooltip":"Used in my work",initial:{opacity:0,scale:.8},whileInView:{opacity:1,scale:1},transition:{delay:.2+e*.03,duration:.3},viewport:{once:!0},children:i},e))})]}),_e.jsx("div",{className:"flex items-center justify-center min-h-[60vh] px-6 py-5 sm:px-12",children:_e.jsx(fr.a,{href:"./cv.pdf",target:"_blank",rel:"noopener noreferrer",className:"px-6 py-3 font-mono text-lg font-semibold border-l-4 border-electric button-glow hover:bg-blackish hover:text-electric",initial:{opacity:0},whileInView:{opacity:1},transition:{delay:.3,duration:.6},viewport:{once:!0},children:"View CV"})})]})}const P3="/portfolio/assets/glucologs-3-CkDGiz_q.png",D3="/portfolio/assets/hymn-D8WVpQyk.jpg",L3="/portfolio/assets/ada-BctllYtC.jpg",U3="/portfolio/assets/vocab-CRJ4M1zV.jpg",O3="/portfolio/assets/grammar-DGWzmTaZ.jpg",B3="/portfolio/assets/mind-DQSnRrSK.jpg",DT=[{id:"glucologs",title:"Glucologs",subtitle:"A journal for glucose, wellbeing, and ethical data futures",description:"Glucologs is a conceptual frontend prototype exploring ethical and accessible digital care. It functions as a reflective glucose journal with built-in AI coaching, emphasizing user emotion, voice input, and gentle behavioral nudging. Users can optionally tag and donate their anonymized data for research, shifting health data from surveillance to solidarity.",tech:["React","TailwindCSS","ChatGPT API","GSAP"],keywords:["data ethics","poetic UX","creative coding","frontend prototypes"],thumbnail:P3},{id:"hymn-of-resistance",title:"Hymn of Resistance",subtitle:"A multisensory protest in motion and sound",description:"An experimental digital art piece that translates an anti-fascist speech into a responsive audiovisual experience. Through color pulses, ambient vibration, and synchronized sound, it creates a space where political urgency becomes bodily and emotional. The project acts as both standalone artwork and early prototype for a future VJ plugin.",tech:["React","Canvas","WebAudio API"],keywords:["creative coding","multisensory interface","digital protest","generative visuals"],thumbnail:D3},{id:"ada-lovelace-storytelling",title:"Ada Lovelace Storytelling",subtitle:"An archival collage brought to life through code",description:"An immersive web-based tribute to Ada Lovelace, this project weaves visual storytelling, layered parallax effects, and AI interaction into a speculative interface. Built with digital collage techniques and sourced from the Europeana Archive, it reclaims forgotten histories of women in computing through an aesthetic of glitch, gesture, and poetic computation.",tech:["HTML","CSS","JavaScript","parallax","3D avatar","Europeana Archive"],keywords:["archival media","visual storytelling","digital humanities"],thumbnail:L3},{id:"vocabulary-of-resistance",title:"Vocabulary of Resistance",subtitle:"Mapping the language of dissent across cultures",description:"An interactive semantic interface prototype (beta) that visualizes vocabularies tied to resistance. Designed as a frontend experiment in data and cultural nuance, the project uses visual mapping, relational nodes, and image API calls.",tech:["React","Framer Motion","Three.js","TailwindCSS","Unsplash API"],keywords:["semantic interface","linguistics","protest vocabulary","MAC"],thumbnail:U3},{id:"grammar-of-resistance",title:"Toward a Grammar of Resistance",subtitle:"Language, computation, and power in interface design",description:"A long-form academic article exploring how digital interfaces encode political values. Drawing on critical theory, computational linguistics, and design studies, the paper proposes a grammar for creating culturally rooted, resistant, and decolonial digital systems. This work forms the conceptual basis of the Multilingual Artistic Code framework.",tech:[],keywords:["critical design","interface theory","linguistics","MAC"],thumbnail:O3},{id:"brainmap",title:"My Brainmap",subtitle:"A poetic CV rendered as a system of thought",description:"Brainmap is an interactive, graph-based visualization of my creative research practice. It maps out the relationships between my ideas, tools, prototypes, and languages — spanning disciplines, media, and modes of thinking. Designed as a poetic self-portrait, it offers an alternative to the traditional résumé: experiential and structurally nonlinear.",tech:["React","Canvas","WebAudio API"],keywords:["poetic UX","creative coding","experimental UI","frontend prototypes"],thumbnail:B3}],uce=Array.from(new Set(DT.flatMap(i=>i.keywords))).sort();function cce(){const[i,e]=fe.useState("All"),t=fe.useMemo(()=>i==="All"?DT:DT.filter(n=>n.keywords.includes(i)),[i]);return _e.jsxs("section",{className:"relative min-h-screen px-4 py-20 bg-blackish text-bone md:px-20",children:[_e.jsxs("div",{className:"px-4 mb-10 md:px-20",children:[_e.jsx("h2",{className:"text-4xl font-light tracking-tight md:text-6xl text-electric",children:"Projects"}),_e.jsx("p",{className:"mt-6 text-sm text-bone/80 md:text-base",children:"Filter by tag:"})]}),_e.jsxs("div",{className:"flex flex-wrap justify-start gap-2 px-4 mb-16 md:px-20",children:[_e.jsx("button",{onClick:()=>e("All"),className:`px-3 py-1 font-mono text-xs rounded-full border whitespace-nowrap ${i==="All"?"bg-electric text-blackish border-electric":"text-bone border-bone/30 hover:border-electric hover:text-electric"}`,children:"All"}),uce.map(n=>_e.jsx("button",{onClick:()=>e(n),className:`px-3 py-1 font-mono text-xs rounded-full border whitespace-nowrap ${i===n?"bg-electric text-blackish border-electric":"text-bone border-bone/30 hover:border-electric hover:text-electric"}`,children:n},n))]}),_e.jsx("div",{className:"flex flex-col gap-16 px-4 md:px-0",children:_e.jsx(QG,{children:t.map((n,r)=>_e.jsxs(fr.div,{initial:{opacity:0,y:50},animate:{opacity:1,y:0},exit:{opacity:0,y:20},transition:{duration:.6,delay:r*.1},className:"relative w-full mx-auto overflow-hidden rounded-2xl shadow-xl bg-[#111] hover:bg-[#181818] transition group md:grid md:grid-cols-2 md:gap-10 md:max-w-5xl",children:[_e.jsx(_S,{to:`/projects/${n.id}`,className:"block h-full",children:_e.jsx("img",{src:n.thumbnail,alt:n.title,className:"object-contain w-full h-64 transition sm:h-72 md:h-full grayscale group-hover:grayscale-0"})}),_e.jsxs("div",{className:"flex flex-col justify-between gap-4 p-6 md:p-8",children:[_e.jsxs("div",{children:[_e.jsxs("h3",{className:"text-2xl font-light text-electric md:text-3xl",children:[n.title,_e.jsx("span",{className:"block mt-1 text-sm italic text-bone/70",children:n.subtitle})]}),_e.jsx("p",{className:"mt-3 text-sm leading-relaxed text-justify text-bone/60",children:n.description})]}),_e.jsx("div",{className:"flex flex-wrap gap-2 mt-4",children:n.tech.map((s,a)=>_e.jsx("span",{className:"px-2 py-1 font-mono text-xs border rounded-full bg-electric/10 text-electric border-electric/20",children:s},a))}),_e.jsx("div",{className:"mt-2 font-mono text-xs text-bone/60",children:n.keywords.join(" • ")})]})]},n.id))})})]})}function hce(){const[i,e]=fe.useState(!1);return fe.useEffect(()=>{const t=setTimeout(()=>e(!0),300);return()=>clearTimeout(t)},[]),_e.jsxs(fr.footer,{initial:{opacity:0,y:50},animate:i?{opacity:1,y:0}:{},transition:{duration:3,ease:"easeOut"},className:"relative flex flex-col items-center justify-center w-screen min-h-screen py-10 text-center animated-gradient",children:[_e.jsxs("div",{className:"max-w-xl",children:[_e.jsx("h2",{className:"mb-6 font-mono text-3xl sm:text-4xl md:text-5xl text-electric",children:"Let’s create something meaningful together."}),_e.jsx("p",{className:"mb-8 text-base sm:text-lg text-bone",children:"If you’re building cultural tools, experimental frontend, or human-centered AI, I’d love to hear from you."}),_e.jsx("a",{href:"mailto:szilvia.barat@gmail.com",className:"inline-block px-6 py-3 font-mono text-base font-semibold text-white transition sm:text-lg hover:text-electric/90",children:"Get in touch"})]}),_e.jsxs("div",{className:"absolute flex flex-wrap justify-center gap-6 px-4 text-sm bottom-8 text-bone/60",children:[_e.jsx("a",{href:"https://github.com/szilvia-barath",target:"_blank",rel:"noopener noreferrer",className:"hover:text-electric",children:"GitHub"}),_e.jsx("a",{href:"https://www.linkedin.com/in/szilvia-bar%C3%A1th-630ab717a/",target:"_blank",rel:"noopener noreferrer",className:"hover:text-electric",children:"LinkedIn"}),_e.jsx("a",{href:"https://www.instagram.com/serena.serotonina/",target:"_blank",rel:"noopener noreferrer",className:"hover:text-electric",children:"Instagram"})]})]})}function fce({active:i,onNavClick:e}){const[t,n]=fe.useState(!1),r=[{id:"hero",label:"Home"},{id:"about",label:"About"},{id:"projects",label:"Projects"},{id:"gallery",label:"Gallery"},{id:"contact",label:"Contact"}],s=a=>{e(a),n(!1)};return _e.jsxs("nav",{className:"fixed top-0 left-0 z-50 w-full bg-[#0e0e0e] text-bone border-b-2 border-b-electric  md:w-20 md:h-screen md:flex md:flex-col md:items-center md:border-b-0",children:[_e.jsxs("div",{className:"flex-col items-center hidden gap-6 py-6 md:flex",children:[_e.jsx("div",{className:"w-8 h-8 rounded-full bg-electric/50 hover: animate-pulse",children:_e.jsx("a",{href:"hero",children:_e.jsx("img",{src:"./icon_scott.svg"})})}),_e.jsx("div",{className:"flex flex-col gap-4 mt-8 font-mono text-xs text-left",children:r.map(a=>_e.jsx("button",{onClick:()=>s(a.id),className:`transition hover:text-electric ${i===a.id?"text-electric font-bold":"text-bone/70"}`,children:a.label},a.id))})]}),_e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b-electric md:hidden",children:[_e.jsx("div",{className:"font-mono text-lg",children:_e.jsx("a",{href:"hero",children:_e.jsx("img",{className:"w-8 h-8 hover: animate-pulse ",src:"./icon_scott.svg"})})}),_e.jsx("button",{onClick:()=>n(!t),className:"text-2xl focus:outline-none","aria-label":"Toggle menu",children:_e.jsx("b",{children:"┊"})})]}),t&&_e.jsx("div",{className:"md:hidden absolute top-full left-0 w-full bg-[#1a2129] px-4 py-6 flex flex-col gap-4 font-mono text-sm  z-[1001]",children:r.map(a=>_e.jsx("button",{onClick:()=>s(a.id),className:`text-left transition hover:text-electric ${i===a.id?"text-electric font-bold":"text-bone/70"}`,children:a.label},a.id))})]})}function dce({onFinish:i}){const[e,t]=fe.useState(!0);return fe.useEffect(()=>{const n=setTimeout(()=>{t(!1),i==null||i()},5e3);return()=>clearTimeout(n)},[i]),e?_e.jsx(fr.div,{className:"fixed inset-0 z-50 flex items-center justify-center bg-blackish scanlines glitch-overlay",initial:{opacity:1},animate:{opacity:0},transition:{duration:1.5,delay:2.5},children:_e.jsxs("div",{className:"font-mono text-4xl text-white md:text-6xl glitch-text poetic-heading",children:[_e.jsx("span",{"aria-hidden":"true",children:"Connecting to mind..."}),"Connecting to mind...",_e.jsx("span",{"aria-hidden":"true",children:"Connecting to mind... "})]})}):null}const pce="/portfolio/assets/1-HFmeipKO.png",mce="/portfolio/assets/2-BbN4D1WU.png",gce="/portfolio/assets/3-BJtHIa3U.png",yce=[{id:"art1",title:"Holiday to the Moon - a collage book",image:pce,caption:"I started with old computer-generated graphics and moon photos, then let the collage grow through found materials: magazines, journals, stickers, scraps."},{id:"art2",title:"Camminare sola... - digital zine",image:mce,caption:"A hybrid zine where I used my hand-drawn drawings of buildings and women’s faces, then remixed them digitally. It’s a quiet reflection on space, safety, memory, and how cities can feel both yours and not yours at the same time."},{id:"art3",title:"Serena Serotonina - digital illustrations",image:gce,caption:"Serena Serotonina is the name of my old art Instagram — a space where I posted digital illustrations. They were never meant to shout, just to stay visible."}];function vce(){const[i,e]=fe.useState(null);return _e.jsxs("section",{className:"w-full px-4 py-16 overflow-x-auto sm:px-6 sm:py-20 text-bone bg-blackish",children:[_e.jsx("h2",{className:"px-20 mb-6 text-3xl font-light sm:text-4xl text-electric",children:"Artworks"}),_e.jsx("div",{className:"flex gap-6 pb-4 sm:gap-8 snap-x snap-mandatory",children:yce.map(t=>_e.jsxs(fr.div,{whileHover:{scale:1.03},whileTap:{scale:.97},className:"snap-center min-w-[90vw] sm:min-w-[60vw] md:min-w-[40vw] bg-[#111] rounded-xl shadow-lg overflow-hidden cursor-pointer relative",onClick:()=>e(t),children:[_e.jsx("img",{src:t.image,alt:t.title,className:"object-cover w-full h-56 sm:h-64 md:h-96"}),_e.jsx("div",{className:"absolute bottom-0 left-0 w-full p-4 bg-black/60",children:_e.jsx("h3",{className:"font-mono text-lg sm:text-xl text-electric",children:t.title})})]},t.id))}),i&&_e.jsx(fr.div,{className:"fixed inset-0 z-50 flex items-center justify-center px-4 bg-black/80 backdrop-blur-md",initial:{opacity:0},animate:{opacity:1},onClick:()=>e(null),children:_e.jsxs(fr.div,{className:"max-w-4xl p-4 sm:p-6 bg-[#111] border border-electric rounded-lg shadow-xl",onClick:t=>t.stopPropagation(),initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},children:[_e.jsx("img",{src:i.image,alt:i.title,className:"object-cover w-full mb-4 rounded"}),_e.jsx("h3",{className:"mb-2 font-mono text-xl sm:text-2xl text-electric",children:i.title}),_e.jsx("p",{className:"text-base italic text-bone/80",children:i.caption})]})})]})}function _ce(){const[i,e]=fe.useState(()=>!sessionStorage.getItem("introPlayed")),[t,n]=fe.useState(!1),{t:r}=kU(),[s,a]=fe.useState("hero"),l=fe.useRef(null),u=fe.useRef(null),h=fe.useRef(null),d=fe.useRef(null),p=fe.useRef(null),g=Yf(l,{}),y=Yf(u,{}),v=Yf(h,{}),S=Yf(d,{}),b=Yf(p,{});fe.useEffect(()=>{b?a("contact"):S?a("gallery"):v?a("projects"):y?a("about"):g&&a("hero")},[g,y,v,S,b]);const _=M=>{var w,R;(R=(w={hero:l,about:u,projects:h,gallery:d,contact:p}[M])==null?void 0:w.current)==null||R.scrollIntoView({behavior:"smooth"}),a(M)};fe.useEffect(()=>{var A,w;const M=window.location.hash.replace("#","");M&&l.current&&((w=(A={hero:l,about:u,projects:h,gallery:d,contact:p}[M])==null?void 0:A.current)==null||w.scrollIntoView({behavior:"auto"}))},[]);const E=()=>{sessionStorage.setItem("introPlayed","true"),e(!1),n(!0)};return fe.useEffect(()=>{i||n(!0)},[i]),_e.jsxs(fr.div,{className:"relative w-full overflow-hidden scroll-smooth",children:[i&&_e.jsx(dce,{onFinish:E}),_e.jsx(fce,{active:s,onNavClick:_}),_e.jsxs("section",{id:"hero",className:"relative w-full h-screen overflow-hidden scroll-mt-24",children:[_e.jsx("div",{className:"absolute inset-0 z-0 pointer-events-none",children:t&&_e.jsx(sce,{aboutRef:u})}),t&&_e.jsx(fr.div,{className:"absolute inset-0 z-40 flex flex-col items-center justify-center gap-6 px-4 text-center pointer-events-none text-bone",initial:{opacity:0},animate:{opacity:1},transition:{delay:.4,duration:1.2},children:_e.jsx(fr.h1,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{duration:5.2,ease:"easeOut"},className:"font-mono text-4xl md:text-6xl glitch-flicker",children:r("explore")})}),_e.jsx("div",{className:"absolute z-40 px-4 bottom-10 left-6 sm:left-10",children:_e.jsx("button",{onClick:()=>{var M;return(M=u.current)==null?void 0:M.scrollIntoView({behavior:"smooth"})},className:"px-10 py-2 font-mono text-sm transition glitch-flicker-2 sm:text-base text-electric/60 hover:text-white",children:"Find out more ↓"})})]}),_e.jsx("section",{ref:u,id:"about",className:"flex flex-col items-center px-4 scroll-mt-24 min-w-screen animated-gradient",children:_e.jsx(lce,{})}),_e.jsx("section",{ref:h,id:"projects",className:"w-full px-4 scroll-mt-24 animated-gradient md:px-4 bg-blackish text-bone",children:_e.jsx(cce,{})}),_e.jsx("section",{ref:d,id:"gallery",className:"w-full px-4 scroll-mt-24 bg-blackish text-bone animated-gradient",children:_e.jsx(vce,{})}),_e.jsx(fr.section,{ref:p,id:"contact",className:"flex items-center justify-center w-screen h-screen scroll-mt-24 md:px-0 bg-blackish text-bone",initial:{opacity:0,y:80},whileInView:{opacity:1,y:0},transition:{duration:1.2,ease:"easeOut"},viewport:{once:!0,amount:.4},children:_e.jsx(hce,{})})]})}const xce={glucologs:{title:"Glucologs",subtitle:"A glucose and wellbeing journal designed around care, not compliance",description:"Glucologs is a speculative frontend project that reimagines how we engage with chronic care through emotional design and data ethics. Built as a digital journal for people with diabetes, it integrates voice-to-text input, image uploads, and a conversational AI coach that responds with empathy and encouragement. Users can optionally tag their data and contribute it to research, turning personal health tracking into a form of collective insight. Designed with accessibility and dignity in mind, Glucologs shifts the paradigm from passive monitoring to meaningful reflection.",tech:["React","TailwindCSS","ChatGPT API","GSAP"],heroImage:P3,status:"Under development"},"ada-lovelace-storytelling":{title:"Ada Lovelace Storytelling",subtitle:"Chat with the first programmer — through archival collage and code",description:"This project is a browser-native experiment in interactive storytelling, designed as a digital monument to Ada Lovelace. Through layered parallax visuals, archival imagery from the Europeana Archive, and an animated 3D avatar, users explore her legacy as both poet and programmer. The interface shifts modes — from speculative fiction to critical computing — as the chatbot adapts its tone and voice. Technically lightweight but visually rich, the piece reclaims erased narratives through code, collage, and conversation.",tech:["HTML","CSS","JavaScript","parallax","3D avatar","Europeana Archive"],heroImage:L3,status:"https://szilvia-barath.github.io/ada-lovelace/"},"vocabulary-of-resistance":{title:"Vocabulary of Resistance",subtitle:"A semantic interface exploring protest language across cultures",description:"This project is a beta-stage frontend prototype that maps a vocabulary of resistance. Through interactive graph visualization and dynamic image interpretation, it reveals both the emotional charge and relational depth of language. Built using React and Three.js, the prototype serves as both a speculative design tool and a research interface.",tech:["React","Framer Motion","Three.js","TailwindCSS","Unsplash API"],heroImage:U3,status:""},"grammar-of-resistance":{title:"Toward a Grammar of Resistance",subtitle:"A critical framework for interface design, power, and language",description:"This long-form academic article investigates how language, UI structures, and algorithmic systems encode sociopolitical values. Drawing from fields including critical theory, computational linguistics, interface design, and posthuman studies, the piece articulates a “grammar” for designing digital systems that resist dominant techno-cultural narratives. The article introduces the Multilingual Artistic Code (MAC) framework — a conceptual and design scaffold for culturally specific, ethically grounded digital tools. Structured as a theoretical exploration with visual examples, it serves both as an academic contribution and a call for interdisciplinary design resistance.",tech:[],heroImage:O3,status:"Sent for journal submission"},"hymn-of-resistance":{title:"Hymn of Resistance",subtitle:"An audiovisual protest felt through color, motion, and sound",description:"Hymn of Resistance is an interactive art piece that transforms a nearly century-old anti-fascist speech into a multisensory experience. The speaker remains unnamed, allowing the emotional register of the words to take center stage. The interface responds dynamically to shifts in tone — bursts of rage trigger visual distortions, while moments of hope pulse gently through light and sound. Designed with React, the Canvas API, and WebAudio, the piece is both a standalone digital artwork and an evolving prototype for a VJ plugin or live audiovisual tool. It asks: what does resistance feel like when rendered through code?",tech:["React","Canvas","WebAudio API"],heroImage:D3,status:"https://hymn-of-resistance.netlify.app/"},brainmap:{title:"My Brainmap",subtitle:"A poetic system of thought — rendered as interactive graph",description:"Brainmap is a creative CV built as a living interface — a network of my core concepts, digital tools, and interdisciplinary projects. Rather than listing experiences, it visualizes how they interconnect. Each node represents a thematic focus. Designed with React, Brainmap is both a portfolio experiment and a personal cartography — a map of meaning, not just milestones.",tech:["React","Canvas","WebAudio API"],heroImage:B3,status:"Published in the hero section of this website"}};function bce(){const{slug:i}=Az(),e=xce[i];return e?_e.jsxs("div",{className:"min-h-screen p-10 bg-blackish text-bone",children:[e.heroImage&&_e.jsx("div",{className:"mb-8",children:_e.jsx("img",{src:e.heroImage,alt:`${e.title} hero`,className:"w-screen max-h-[100vh] object-cover rounded-lg"})}),_e.jsx("h1",{className:"mb-2 font-mono text-4xl font-bold text-electric",children:e.title}),_e.jsx("p",{className:"mb-4 font-mono text-lg",children:e.subtitle}),_e.jsx("p",{className:"mb-6 text-justify",children:e.description}),_e.jsx("h3",{className:"mb-2 font-mono text-xl font-semibold",children:"Technologies used"}),_e.jsx("div",{className:"flex flex-wrap gap-2 mb-10",children:e.tech.map((t,n)=>_e.jsx("span",{className:"px-1 py-1 font-mono text-sm rounded-full text-bone",children:t},n))}),e.status&&_e.jsxs(_e.Fragment,{children:[_e.jsx("h3",{className:"mb-2 font-mono text-xl font-semibold",children:"Status"}),_e.jsx("div",{className:"mb-10",children:e.status.startsWith("http")?_e.jsx("a",{href:e.status,target:"_blank",rel:"noopener noreferrer",className:"inline-block px-3 py-1 font-mono text-sm transition border rounded-full text-electric border-electric hover:bg-electric hover:text-blackish",children:"View Live ↗"}):_e.jsx("span",{className:"inline-block px-3 py-1 font-mono text-sm border rounded-full text-bone border-bone/50",children:e.status})})]}),_e.jsx(_S,{to:"/#/",className:"inline-block px-6 py-2 transition border rounded border-bone hover:bg-electric hover:text-blackish",children:"← Back to projects"})]}):_e.jsxs("div",{className:"min-h-screen p-10 bg-blackish text-bone",children:[_e.jsx("h1",{className:"text-3xl font-bold text-electric",children:"Oh, no! Project not found"}),_e.jsx(_S,{to:"/",className:"inline-block mt-4 underline text-bone",children:"← Back to home"})]})}const Sce=Kk.createRoot(document.getElementById("root"));Sce.render(_e.jsx(UT.StrictMode,{children:_e.jsx(Yz,{children:_e.jsxs(Gz,{children:[_e.jsx(gS,{path:"/",element:_e.jsx(_ce,{})}),_e.jsx(gS,{path:"/projects/:slug",element:_e.jsx(bce,{})})]})})}));
